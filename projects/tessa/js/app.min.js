!function(){"use strict";angular.module("tessaApp",["ui.router","restangular","ngSanitize","ui.bootstrap","ui.select","ngTouch","ngAnimate","angularjs-dropdown-multiselect","toastr","LocalStorageModule","angucomplete-alt","ngFrontier","angularMoment","ngDialog","angularSpinner","angular-loading-bar","angular.filter","textAngular","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster","com.2fdevs.videogular.plugins.buffering","angular-jwt","infinite-scroll","io.dennis.contextmenu","bootstrapLightbox","angularTreeview","angularFileUpload","btford.socket-io","tessa-presentation"]).constant("ACCESSKEY","jeJMH2vWAQocOrat0bu1yqLJg1X0xdYZ").constant("API_URL","http://54.206.38.223:5002").constant("API_VERSION","/api/1.0/")}();
!function(){"use strict";angular.module("tessaApp").run(["$location","APIFactory","$rootScope","$window","$state","localStorageService","$frontierAnalytics","usSpinnerService","AuthFactory","jwtHelper",function(e,n,t,i,r,a,o,c,s,u){t._=window._,t.allproducts=[],t.cartItems=[],t.cartItems=_.isEmpty(a.get("Cart"))?[]:JSON.parse(a.get("Cart")),o.debugMode(!1),o.allowPageTracking(!1),o.allowEventTracking(!1),o.allowViewTracking(!1),o.allowAppTracking(!1),o.allowDeviceTracking(!1),o.Initialize({accessCode:"958441082755103",trackerName:"project-tessa",encoding:"utf-8"});var l=function(){async.waterfall([function(e){n.getArticles(function(n){_.each(n.response.result,function(e){e.type="Experience"}),_.each(n.response.result,function(e){e.name=e.title,e.id=e.article_id}),e(null,n.response.result)})},function(e,t){n.getProductBundle(function(n){_.each(n.response.result,function(e){e.type="Solutions"}),_.each(n.response.result,function(e){e.name=e.bundle_name,e.id=e.pb_id}),t(null,n.response.result,e)})},function(e,t,i){var r=[];n.getProduct(function(n,a){r=_.filter(a.response.result,function(e){return"Hardware"==e.product_type}),_.each(r,function(e){e.type="Hardware"}),_.each(r,function(e){e.name=e.item_name,e.id=e.p_id}),i(null,r,e,t)})},function(e,n,i,r){var a=[];_.each(e,function(e){1==e.is_published&&0==e.is_archived&&a.push(e)}),_.each(n,function(e){1==e.is_published&&0==e.is_archived&&a.push(e)}),_.each(i,function(e){1==e.is_active&&a.push(e)}),t.allproducts=a}])};s.getCurrentUser()&&l(),t.$on("InitializeData",function(){l()}),t.$on("loading:progress",function(){c.spin("spinner-1")}),t.$on("loading:finish",function(){c.stop("spinner-1")}),t.goBack=function(){i.history.back()},t.$on("$stateChangeStart",function(n,t,i,c,l){if(_.isNull(s.getCurrentUser()))"login"!==t.name&&(n.preventDefault(),r.go("login"));else{var p=s.getUserToken(),f=JSON.parse(a.get("appuser"));o.setUserId(_.toString(f.uc_id)),u.isTokenExpired(p)?s.logout().then(function(){e.path("/login")}):"login"==t.name&&(n.preventDefault(),r.go("main.experience"))}}),t.$on("$stateChangeSuccess",function(e,n,i,r,a){t.currentUser=s.getCurrentUser(),t.label="Solutions",o.trackPage(n.name,n.url,n.templateUrl)})}])}();
!function(){"use strict";angular.module("tessaApp").config(["$stateProvider","$httpProvider","RestangularProvider","$urlRouterProvider","API_URL","API_VERSION","$provide","usSpinnerConfigProvider","localStorageServiceProvider",function(t,e,r,l,a,o,n,i,s){e.interceptors.push("authInterceptor"),e.interceptors.push("httpInterceptor"),n.value("baseURL",a),r.setBaseUrl(a+o),i.setDefaults({color:"#004D7F",radius:20,width:8,length:16}),s.setPrefix("tessa"),t.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl"}).state("presentation",{url:"/presentation",templateUrl:"presentation/templates/main.html",controller:"GlobalCtrl"}).state("main",{url:"/main",templateUrl:"views/main.html",controller:"MainCtrl"}).state("main.experience",{url:"/experience",templateUrl:"views/experience.html",controller:"expCtrl"}).state("priceBook",{url:"/priceBook",templateUrl:"views/priceBook.html"}).state("main.productCatalogue",{url:"/productCatalogue",templateUrl:"views/catalogue-page.html",controller:"productCtrl"}).state("main.articlePage",{url:"/articlePage/:selected_id",templateUrl:"views/article.page.html",controller:"ModalInstanceCtrl"}).state("main.customerQuotes",{url:"/customerQuotes",templateUrl:"views/customerQuotes.html"}).state("main.quoteProfile",{url:"/quoteProfile/:quote_id",templateUrl:"views/quoteProfile.html",controller:"QuoteCtrl"}).state("main.search",{url:"/search?value",templateUrl:"views/search.html",controller:"searchCtrl"}).state("main.quote",{url:"/quote",templateUrl:"views/quote.html",controller:"QuoteCtrl"}).state("main.productDetailsSolution",{url:"/productCatalogue/productDetailsSolution/:selected_id",templateUrl:"views/productDetailsSolution.html",controller:"detailSolutionCtrl"}).state("main.productDetailsHardware",{url:"/productCatalogue/productDetailsHardware/:selected_id",templateUrl:"views/productDetailsHardware.html",controller:"hardwareDetailsCtrl"}).state("main.presentation",{url:"/presentation",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.assetGallery",{url:"/assetGallery",templateUrl:"views/presentation/asset-gallery.html",controller:"presentationCtrl"}).state("main.presentation_starred",{url:"/presentation/starred",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.presentation_trash",{url:"/presentation/trash",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.openfolder",{url:"/presentation/folder/:_id",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.opensubfolder",{url:"/presentation/folder/:_id/s/:sub_id",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}),l.otherwise("/login")}])}();
!function(){"use strict";function t(t,e,o,r,a,c,i,p,s,l,u){i.user=a.isEmpty(l.get("appuser"))?[]:JSON.parse(l.get("appuser"))}angular.module("tessaApp").controller("MainCtrl",t),t.$inject=["$http","$scope","APIFactory","$location","_","$state","$rootScope","$filter","$uibModal","localStorageService","$timeout"]}();
!function(){"use strict";function n(n,e,s,t,r,o,i,c,u,a){n.user={},n.login=function(){u.spin("spinner-login"),e.authenticateAccount(n.user).then(function(n){400!=n.statusCode||n.response.success?n.success?(a.success(n.msg),e.setCurrentUser(n.result.user),e.setUserToken(n.result.token),u.stop("spinner-login"),i.go("main.experience",null,{reload:!0})):(a.warning(n.msg,"Warning"),u.stop("spinner-login")):(o.each(n.response.result,function(n){a.warning(n.msg,"Warning")}),u.stop("spinner-login"))})}}angular.module("tessaApp").controller("loginCtrl",n),n.$inject=["$scope","AuthFactory","$location","$stateParams","$filter","_","$state","localStorageService","usSpinnerService","toastr"]}();
!function(){"use strict";function e(e,t,l,i,r,a,n,c,s,o,d,u){function p(e){return a.map(e,function(e){if("location"==e.type){var t=e.label.replace(/[\s]/g,"");return{label:t.toLowerCase(),type:e.type,index:e.sortindex}}if("configuration"==e.type){e.label.replace(/[\s]/g,"");return{label:e.label,type:e.type,index:e.sortindex}}return"Family"==e.type?{label:e.label,type:e.type,index:e.sortindex}:"Products"==e.type?{label:e.label,type:e.type,index:e.sortindex}:void 0})}e.shows=!0,e.DisplayTab="All",e.allproducts=c.allproducts,e.searchkeyword=i.value,e.bundles=[],e.experience=[],e.location=[],e.configuration=[],e.filterProduct=[],e.filtersearch=[],e.copy=[],e.typeselected=[],e.typeselected2=[],e.typeselected3=[],e.typeselected4=[],e.experiencedata=[{id:1,label:"Eze Impress",type:"Family"},{id:2,label:"Eze Wifi",type:"Family"}],e.producttypedata=[{id:4,label:"Hardware",type:"Products"},{id:6,label:"Experience",type:"Products"},{id:7,label:"Solution",type:"Products"}],e.location=[{id:8,label:"Indoor",type:"location"},{id:9,label:"Outdoor",type:"location"},{id:10,label:"Semi Outdoor",type:"location"}],e.config=[{id:11,label:"Wall Mounted",type:"configuration"},{id:12,label:"Floor Mounted",type:"configuration"}],e.dynamicPopover={templateUrl:"productType.html",templateUrl2:"ezefamily.html",templateUrl3:"location.html",templateUrl4:"configuration.html"},c.$watch("allproducts",function(t){e.allproducts=t}),i.value&&(async.waterfall([function(e){t.getProduct(function(t,l){e(null,l.response.result)})},function(e,l){t.getProductBundle(function(t){l(null,e,t.response.result)})},function(l,n,c){t.getAll(i.value).then(function(t){if(200==t.statusCode&&t.response.success){var l=[];l=a.filter(t.response.result.values,function(e){return"Services"!==e.type}),a.each(l,function(t){if(!a.isEmpty(e.allproducts)){var l=a.find(e.allproducts,{id:t.id});a.isUndefined(l)||(l.p_id?(t.is_archived=l.is_archived,t.img_default=l.img_default,t.is_published=l.is_published,t.tags=l.tags):l.pb_id?(t.product_images=l.product_images,t.is_archived=l.is_archived,t.is_published=l.is_published,t.product_bundle_category=l.product_bundle_category):l.article_id&&(t.mediafiles=l.mediafiles,t.is_active=l.is_active,t.type=l.type))}})}var i=[],c=r("filter")(l,{self:"articles"});e.articles=a.filter(c,function(e){return 1==e.is_active});var s=r("filter")(l,{self:"products"});e.products=a.filter(s,function(e){return 1==e.is_published&&0==e.is_archived});var d=r("filter")(l,{self:"bundles"});a.each(d,function(t){var l=a.find(n,{pb_id:t.id});a.isUndefined(l)||(l.pb_id==t.id&&(l.self=t.self,l.type="Solution",l.product_bundle_category.length>0&&(l.category_label=l.product_bundle_category[0].category_label)),e.bundles.push(l))}),e.bundles=a.filter(e.bundles,function(e){return 1==e.is_published&&0==e.is_archived}),i.push(e.articles),i.push(e.products),i.push(e.bundles),e.filtersearch=a.flattenDeep(i),e.copy=angular.copy(e.filtersearch),e.filterProduct=angular.copy(e.filtersearch),a.isEmpty(e.filtersearch)&&o(function(){e.noresult="NO RESULT FOUND"},700)})}]),u.trackEvent("Global Search","search",i.value,e.filtersearch.length)),e.activeTab=function(t){e.DisplayTab=t},e.detail=function(t,l){e.selected=t},e.openModal=function(t){var l=s.open({animation:!0,templateUrl:"./views/search.detail.modal.html",size:"md",controller:"searchDetailControl",backdrop:!0,windowClass:"xd-modal",backdropClass:"modal-backdrop fade in",resolve:{search:function(){return t}}});l.result.then(function(t){e.selected=t},function(){console.info("Modal dismissed at: "+new Date)})},e.filterCheck=function(){e.typeselected&&e.typeselected.length<1?(e.filterProduct=angular.copy(e.copy),e.filtersearch=angular.copy(e.filterProduct)):e.typeselected2&&e.typeselected2.length<1?e.filtersearch=angular.copy(e.filterProduct):e.typeselected3&&e.typeselected3.length<1?e.filtersearch=angular.copy(e.filterFamily):e.typeselected4&&e.typeselected4.length<1&&(e.filtersearch=angular.copy(e.filterLocation)),e.articles=r("filter")(e.filtersearch,{self:"articles"}),e.products=r("filter")(e.filtersearch,{self:"products"}),e.bundles=r("filter")(e.filtersearch,{self:"bundles"}),c.$broadcast("loading:finish")},e.toggleSelectedType=function(t,l){e.bundleTags=[];var i=[];e.filtersearch=[],c.$broadcast("loading:progress"),o(function(){n()},600);var n=function(){if(e.typeselected.indexOf(t)==-1?(t.sortindex=l,e.typeselected.push(t)):e.typeselected=a.filter(e.typeselected,function(e){return e.id!=t.id}),e.typeselected=a.sortBy(e.typeselected,["sortindex"]),i=p(e.typeselected),i&&i.length>0){var n=[];a.map(e.copy,function(t){a.each(t.tags,function(t){a.isEmpty(t.tags)||e.bundleTags.push(t)})});a.each(i,function(t){var l=[],i=[],c=[];l=a.filter(e.copy,{type:t.label}),i=a.filter(e.copy,{category_label:t.label}),c=r("filter")(e.bundleTags,{tags:t.label}),l&&l.length>0&&a.each(l,function(t){var l=a.find(e.copy,{_id:t._id});a.isUndefined(l)||n.push(l)}),i&&i.length>0&&a.each(i,function(t){var l=a.find(e.copy,{_id:t._id});a.isUndefined(l)||n.push(l)}),c&&c.length>0&&a.each(c,function(t){if(t.pb_id){var l=a.find(e.copy,{pb_id:t.pb_id});a.isUndefined(l)||n.push(l)}else{var l=a.find(e.copy,{p_id:t.p_id});a.isUndefined(l)||n.push(l)}})}),e.filterProduct=a.uniqBy(n,function(e){return e._id})}else e.filterProduct=angular.copy(e.copy);e.filtersearch=angular.copy(e.filterProduct),e.articles=r("filter")(e.filtersearch,{self:"articles"}),e.products=r("filter")(e.filtersearch,{self:"products"}),e.bundles=r("filter")(e.filtersearch,{self:"bundles"}),c.$broadcast("loading:finish"),a.isEmpty(e.filtersearch)&&o(function(){e.noresult="NO RESULT FOUND"},700)}}}angular.module("tessaApp").controller("searchCtrl",e),e.$inject=["$scope","APIFactory","$location","$stateParams","$filter","_","$state","$rootScope","$uibModal","$timeout","usSpinnerService","$frontierAnalytics"]}();
!function(){"use strict";function e(e,s,l,t,n,a){console.log("selected:",l),e.selected=l,e.images=e.selected.mediafiles,e.cancel=function(){s.dismiss("cancel")},e.viewDetails=function(e){"products"==e.self?(n.go("main.productDetailsHardware",{selected_id:e.id},{reload:!0}),s.dismiss("cancel")):(n.go("main.productDetailsSolution",{selected_id:e.pb_id},{reload:!0}),s.dismiss("cancel"))},e.openShareModal=function(){var s=t.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return e.selected},param:function(){return"articles"==e.selected.self?"article":"bundles"==e.selected.self?"bundle":"products"==e.selected.self?"product":void 0}}});s.result.then(function(s){e.selected=s},function(){console.info("Modal dismissed at: "+new Date)})}}angular.module("tessaApp").controller("searchDetailControl",e),e.$inject=["$scope","$uibModalInstance","search","$uibModal","$state","$sce"]}();
!function(){"use strict";function e(e,t,a,r,i,c,n,o,l,s,d){function u(e){return i.map(e,function(e){if("location"==e.type){var t=e.label.replace(/[\s]/g,"");return{label:t.toLowerCase(),type:e.type,index:e.sortindex}}if("configuration"==e.type)return{label:e.label,type:e.type,index:e.sortindex}})}function p(e,t,a,c){var n=[],o=[],l=[];return e.att_id?(i.each(t,function(e){n=i.filter(a,{value:e.value}),n&&n.length>0&&i.each(n,function(e){o=i.find(c,{p_id:e.p_id}),l.push(o)})}),l):(i.each(t,function(e){n=r("filter")(a,{tags:e.label}),n.length>0&&i.each(n,function(e){o=i.find(c,{pb_id:e.pb_id}),l.push(o)})}),l)}e.solutionTypes="EzeImpress",e.prodTypeLabel=i.isEmpty(l.get("label"))?"Solution":JSON.parse(l.get("label")),d.trackView("Product Catalogue/",e.prodTypeLabel,"/",e.solutionTypes),e.txtSearch="",e.bundles=[],e.productDetails=[],e.seemore=!0,e.products=[],e.productscopy=[],e.ezewificopy=[],e.categoryWifi=[],e.screens=[],e.Screens=[],e.ScreenSize=[],e.media=[],e.MediaPlayer=[],e.Mediacopy=[],e.bundleTags=[],e.searchcopy=[],e.filtercopy=[],e.typeselected=[],e.tagselected=[],e.productsAttributesValue=[],e.hardwareType=i.isEmpty(l.get("hardtype"))?"Screens":JSON.parse(l.get("hardtype")),e.location=[{id:8,label:"Indoor",type:"location"},{id:9,label:"Outdoor",type:"location"},{id:10,label:"Semi Outdoor",type:"location"}],e.config=[{id:11,label:"Wall Mounted",type:"configuration"},{id:12,label:"Floor Mounted",type:"configuration"}],e.dynamicPopover={location:"location.html",mounting:"configuration.html",screensize:"screens.html",brightness:"brightness.html",bezel:"bezel.html",usage:"usage.html",displaytechno:"displaytechno.html",weight:"weight.html",dimensions:"dimensions.html",orientation:"orientation.html",displayinterface:"displayinterface.html",vesa:"vesa.html",screentype:"screentype.html",resolution:"resolution.html",templateUrl7:"wifi.html",templateUrl8:"ram.html",templateUrl9:"displaytechno.html",templateUrlStorage:"storage.html",templateUrlGraphics:"graphics.html",templateUrlResolution:"resolutions.html"},e.infiniteScrollData={},e.infiniteScrollData.numToAdd=10,e.infiniteScrollData.currentItems=10,e.resetInfScroll=function(){e.infiniteScrollData.currentItems=e.infiniteScrollData.numToAdd},e.addMoreItems=function(){e.infiniteScrollData.currentItems+=e.infiniteScrollData.numToAdd};var f=function(){t.getProductBundle(function(t){var a=[],c=[];e.products=t.response.result,c=i.map(e.products,function(e){return void 0!=e.product_bundle_category[0]&&a.push(e.product_bundle_category[0]),e.products.length>0||(e.weekly=0),e.products});var n=i.flattenDeep(c),o=i.map(n,function(e){return e.product_detail});i.each(n,function(e){var t=i.find(o,{p_id:e.product_id});i.isUndefined(t)||(e.productType_id=t.productType_id,e.sell_price=t.sell_price,t.product_category.length>0&&(e.category_id=t.product_category[0].category_id))});var l=i.groupBy(n,"pb_id");if(i.map(l,function(t,a){var c=r("filter")(t,{productType_id:18}),n=r("filter")(t,{productType_id:17}),o=r("filter")(t,{productType_id:20});if(parseInt(a)==parseInt(a)){if((n.length>0||c.length>0)&&(e.resulthardwaresum=i.sum(i.map(n,function(e){return e.sell_price*e.quantity})),e.softwaresum=i.sum(i.map(c,function(e){return e.sell_price*e.quantity}))),o.length>0){var l=r("filter")(o,{category_id:87}),s=r("filter")(o,{category_id:90});(l.length>0||s.length>0)&&(e.deploymentservice=i.sum(i.map(l,function(e){return e.sell_price*e.quantity})),e.supportservice=i.sum(i.map(s,function(e){return e.sell_price*e.quantity}))),e.servicesum=i.sum(i.map(o,function(e){return e.sell_price*e.quantity}))}void 0==e.deploymentservice&&void 0==e.supportservice?(e.deploymentservice=0,e.supportservice=0):(e.deploymentservice,e.supportservice);var d=e.deploymentservice+e.softwaresum+e.resulthardwaresum;e.weekly=12*(31.111*d/1e3+e.supportservice)/52}i.each(e.products,function(t){t.pb_id==parseInt(a)&&(t.weekly=e.weekly)})}),i.each(e.products,function(e){i.find(a,function(t){e.pb_id==t.bundle_id&&(e.category_label=t.category_label,e.category_id=t.category_id)})}),e.categoryWifi=i.filter(e.products,function(e){return 101==e.category_id}),e.categoryWifi&&e.categoryWifi.length>0){var s=i.flattenDeep(i.map(e.categoryWifi,function(e){return e.products})),d=i.map(s,function(e){return e.product_detail});i.each(d,function(e){i.each(e.product_category,function(t){"CMS"==t.category_label&&(e.category_label=t.category_label)})}),e.categWifi=r("filter")(d,{category_label:"CMS"})}e.alength=e.products.length,e.productscopy=angular.copy(e.products),e.ezewificopy=angular.copy(e.categoryWifi)}),async.waterfall([function(a){t.getProduct(function(t,c){e.allproducts=c.response.result,e.hardware=i.filter(e.allproducts,function(e){return"Hardware"===e.product_type}),e.prodCateg=[];for(var n=0;n<e.hardware.length;n++)for(var o=0;o<e.hardware[n].product_category.length;o++)e.prodCateg.push(e.hardware[n].product_category[o]);i.each(e.hardware,function(t){i.find(e.prodCateg,function(e){t.p_id==e.product_id&&(t.category_id=e.category_id)})});var l=r("filter")(e.hardware,{category_id:80}),s=r("filter")(e.hardware,{category_id:83});a(null,l,s)})},function(e,a,r){async.each(e,function(e,a){t.getProductAttribute(e.p_id,function(t,r){if(200==r.statusCode&&r.response.success&&e.p_id==r.response.result.p_id){var i=r.response.result.attribute_values;i&&i.length>0?e.attributes=r.response.result:e.attributes=null,a()}})},function(t,i){var c=e;r(null,e,a,c)})},function(e,a,r,i){async.each(a,function(e,a){t.getProductAttribute(e.p_id,function(t,r){if(200==r.statusCode&&r.response.success&&e.p_id==r.response.result.p_id){var i=r.response.result.attribute_values;i&&i.length>0?e.attributes=r.response.result:e.attributes=null,a()}})},function(t,c){var n=a;i(null,e,a,r,n)})},function(t,a,c,n,o){if(c&&c.length>0){e.Screens=c,e.Screenscopy=angular.copy(c);var l=[];i.each(c,function(e){i.isNull(e.attributes)||l.push(e.attributes.attribute_values)}),l=i.flattenDeep(l),e.attribute_values=angular.copy(l),e.ScreenSize=r("filter")(l,{attribute:"Screen Size"}),e.Brightness=r("filter")(l,{attribute:"Brightness"}),e.Bezel=r("filter")(l,{attribute:"Bezel Size"}),e.Usage=r("filter")(l,{attribute:"Usage"}),e.Displaytechno=r("filter")(l,{attribute:"Display Technology"}),e.weight=r("filter")(l,{attribute:"Weight"}),e.dimensions=r("filter")(l,{attribute:"Dimensions"}),e.orientation=r("filter")(l,{attribute:"Orientation"}),e.displayinterface=r("filter")(l,{attribute:"Display Interface"}),e.vesa=r("filter")(l,{attribute:"Vesa"}),e.screentype=r("filter")(l,{attribute:"Screen type"}),e.resolution=r("filter")(l,{attribute:"Resolution"})}if(n&&n.length>0){e.MediaPlayer=n,e.Mediacopy=angular.copy(n);var l=[];i.each(n,function(e){i.isNull(e.attributes)||l.push(e.attributes.attribute_values)}),l=i.flattenDeep(l),e.Mediaattribute_values=angular.copy(l),e.Ram=r("filter")(l,{attribute:"RAM"}),e.Storage=r("filter")(l,{attribute:"Storage"}),e.Graphics=r("filter")(l,{attribute:"Graphics"}),e.Resolution=r("filter")(l,{attribute:"Maximum Resolution"})}}])};e.activateTab=function(t){e.solutionTypes=t,d.trackView("Product Catalogue/",e.prodTypeLabel,"/",t)},e.toggleSelectedType=function(t){var a=[];if(o.$broadcast("loading:progress"),t.att_id)if("MediaPlayer"==e.hardwareType)if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchmedia)if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.Mediaattribute_values,e.searchmedia),s(function(){e.MediaPlayer=c,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else s(function(){e.MediaPlayer=angular.copy(e.searchmedia),o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.Mediaattribute_values,e.Mediacopy),s(function(){e.MediaPlayer=c,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else e.MediaPlayer=angular.copy(e.Mediacopy),s(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchscreen)if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.attribute_values,e.searchscreen),e.Screens=angular.copy(c),e.filterScreens=angular.copy(r),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.searchscreen),e.filterScreens=angular.copy(e.Screens),s(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.attribute_values,e.Screenscopy),e.Screens=c,e.filterScreens=angular.copy(r),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.Screenscopy),e.filterScreens=angular.copy(e.Screens),o.$broadcast("loading:finish");else{s(function(){n()},600);var n=function(){if(e.typeselected.indexOf(t)==-1?e.typeselected.push(t):e.typeselected=i.filter(e.typeselected,function(e){return e.id!=t.id}),a=u(e.typeselected),i.isEmpty(e.searchcopy)){if(a&&a.length>0){i.map(e.productscopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),c=p(t,a,e.bundleTags,e.productscopy),e.filterProduct=i.uniqBy(c,function(e){return e._id})}else e.filterProduct=angular.copy(e.productscopy);e.products=angular.copy(e.filterProduct),e.filtercopy=angular.copy(e.filterProduct),o.$broadcast("loading:finish")}else{if(a&&a.length>0){i.map(e.searchcopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),c=p(t,a,e.bundleTags,e.searchcopy),e.filterProduct=i.uniqBy(c,function(e){return e._id}),s(function(){o.$broadcast("loading:finish")},600)}else e.filterProduct=angular.copy(e.searchcopy),s(function(){o.$broadcast("loading:finish")},600);e.products=angular.copy(e.filterProduct),e.filtercopy=angular.copy(e.filterProduct)}}}},e.refresh=function(){o.$broadcast("loading:progress"),s(function(){f()},600),o.$broadcast("loading:finish")},e.uncheck=function(t,a){var r=[];if(t.checked)if(t.att_id)if(i.each(e.tagselected,function(e){e._id==t._id&&(e.checked=!1)}),"MediaPlayer"==e.hardwareType)if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchmedia)if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.Mediaattribute_values,e.searchmedia),s(function(){e.MediaPlayer=n,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else s(function(){e.MediaPlayer=angular.copy(e.searchmedia),o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.Mediaattribute_values,e.Mediacopy),s(function(){e.MediaPlayer=n,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else e.MediaPlayer=angular.copy(e.Mediacopy),s(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchscreen)if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.attribute_values,e.searchscreen),e.Screens=n,e.filterScreens=angular.copy(c),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.searchscreen),e.filterScreens=angular.copy(e.Screens),s(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.attribute_values,e.Screenscopy),e.Screens=n,e.filterScreens=angular.copy(c),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.Screenscopy),e.filterScreens=angular.copy(e.Screens),o.$broadcast("loading:finish");else{if(i.each(e.typeselected,function(e){e.id==t.id&&(e.checked=!1)}),e.typeselected.splice(a,1),r=u(e.typeselected),i.isEmpty(e.searchcopy))if(r&&r.length>0){var c=[],n=[];i.map(e.productscopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),n=p(t,r,e.bundleTags,e.productscopy),e.filterProduct=i.uniqBy(n,function(e){return e._id})}else e.filterProduct=angular.copy(e.productscopy);else if(r&&r.length>0){var c=[];i.map(e.searchcopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),n=p(t,r,e.bundleTags,e.searchcopy),e.filterProduct=i.uniqBy(n,function(e){return e._id})}else e.filterProduct=angular.copy(e.searchcopy);e.products=angular.copy(e.filterProduct),e.filtercopy=angular.copy(e.filterProduct)}},e.searchData=function(){if(o.$broadcast("loading:progress"),"Solution"==e.prodTypeLabel){s(function(){t()},600);var t=function(){i.isEmpty(e.txtSearch)?(e.products=e.productscopy,o.$broadcast("loading:finish")):i.isEmpty(e.typeselected)&&"EzeImpress"==e.solutionTypes?s(function(){e.products=r("filter")(e.productscopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.products.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.typeselected)&&"EzeWifi"==e.solutionTypes?s(function(){e.categoryWifi=r("filter")(e.ezewificopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.categoryWifi.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.typeselected)||"EzeImpress"!=e.solutionTypes?i.isEmpty(e.typeselected)||"EzeWifi"!=e.solutionTypes||s(function(){e.products=r("filter")(e.filtercopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.products.length),o.$broadcast("loading:finish")},300):s(function(){e.products=r("filter")(e.filtercopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.products.length),o.$broadcast("loading:finish")},300)}}else{s(function(){t()},600);var t=function(){i.isEmpty(e.txtSearch)?"MediaPlayer"==e.hardwareType?i.isEmpty(e.tagselected)?(e.MediaPlayer=e.Mediacopy,o.$broadcast("loading:finish")):(e.MediaPlayer=angular.copy(e.filterMedia),o.$broadcast("loading:finish")):i.isEmpty(e.tagselected)?e.Screens=e.Screenscopy:(console.log("NOT EMPTY TAG"),e.Screens=angular.copy(e.filterScreens),o.$broadcast("loading:finish")):i.isEmpty(e.tagselected)&&"Screens"==e.hardwareType?s(function(){e.Screens=r("filter")(e.Screenscopy,e.txtSearch),e.searchscreen=angular.copy(e.Screens),d.trackEvent("Category Search","search",e.txtSearch,e.Screens.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.tagselected)&&"MediaPlayer"==e.hardwareType?s(function(){e.MediaPlayer=r("filter")(e.Mediacopy,e.txtSearch),e.searchmedia=angular.copy(e.MediaPlayer),d.trackEvent("Category Search","search",e.txtSearch,e.MediaPlayer.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.tagselected)||"Screens"!=e.hardwareType?i.isEmpty(e.tagselected)||"MediaPlayer"!=e.hardwareType||s(function(){e.MediaPlayer=r("filter")(e.filterMedia,e.txtSearch),e.copymedia=angular.copy(e.MediaPlayer),d.trackEvent("Category Search","search",e.txtSearch,e.MediaPlayer.length),o.$broadcast("loading:finish")},300):s(function(){e.Screens=r("filter")(e.filterScreens,e.txtSearch),e.copyscreens=angular.copy(e.Screens),d.trackEvent("Category Search","search",e.txtSearch,e.Screens.length),o.$broadcast("loading:finish")},300)}}},e.clear=function(){"Solution"==e.prodTypeLabel?i.isEmpty(e.txtSearch)&&i.isEmpty(e.typeselected)||(e.txtSearch="",i.forEach(e.typeselected,function(e){e.checked=!1}),e.typeselected.splice(e.typeselected),e.refresh()):"MediaPlayer"==e.hardwareType?i.isEmpty(e.txtSearch)&&i.isEmpty(e.tagselected)||(e.txtSearch="",i.forEach(e.tagselected,function(e){e.checked=!1}),e.tagselected.splice(e.tagselected),e.refresh()):i.isEmpty(e.txtSearch)&&i.isEmpty(e.tagselected)||(e.txtSearch="",i.forEach(e.tagselected,function(e){e.checked=!1}),e.tagselected.splice(e.tagselected),e.refresh())},e.activeProd=function(t){e.prodTypeLabel=t,"Hardware"==t?(e.txtSearch="",e.seemore=!0,d.trackView("Product Catalogue/",t,"/",e.hardwareType)):(e.txtSearch="",e.seemore=!0,d.trackView("Product Catalogue/",t,"/",e.solutionTypes)),l.set("label",JSON.stringify(e.prodTypeLabel))},e.activeHard=function(t){e.hardwareType=t,l.set("hardtype",JSON.stringify(e.hardwareType)),d.trackView("Product Catalogue/",e.prodTypeLabel,"/",t)},e.togglemodal=function(e){var t=c.open({animation:!0,templateUrl:"./views/share.modal.html",controller:"articleCtrl",size:"sm",resolve:{article:function(){return e}}});t.result.then(function(){n.reload()},function(){console.info("Modal dismissed")})},e.refresh()}angular.module("tessaApp").controller("productCtrl",e),e.$inject=["$scope","APIFactory","$location","$filter","_","$uibModal","$state","$rootScope","localStorageService","$timeout","$frontierAnalytics"]}();
!function(){"use strict";function e(e,t,r,o,a,c,s,i,n,d){e.slides=[],e.allproduct=[],e.hardware_category=[],e.service_category=[],e.hardwarecategories=[],e.servicecategories=[],e.service=[],e.hardwares=[],e.softwares=[],e.relatedProductHardware=[],e.relatedProductSoftware=[],s.cartItems=[],s.cartItems=c.isEmpty(n.get("Cart"))?[]:JSON.parse(n.get("Cart")),o.selected_id&&async.waterfall([function(r){t.getProduct(function(t,o){e.allproduct=o.response.result,r(null,o.response.result)})},function(r,o){t.getCategory(function(t,a){e.allcategory=a.response.result,o(null,r,a.response.result)})},function(r,s,i){t.getDetailSolution(o.selected_id,function(t,o){if(200==o.statusCode&&o.response.success){var n=0;e.details=o.response.result,c.each(e.details.product_images,function(t){e.slides.push({image:t.image_path,index:n}),n++}),i(null,r,s,o.response.result),e.products=e.details.products,c.isNull(e.products)&&(e.details.upfront=0),c.map(e.products,function(e){e.product_detail&&(e.productType_id=e.product_detail.productType_id,e.product_category=e.product_detail.product_category,e.sell_price=e.product_detail.sell_price,e.category_id=e.product_detail.product_category[0].category_id,e.item_name=e.product_detail.item_name,e.category_label=e.product_detail.product_category[0].category_label)}),e.services=a("filter")(e.products,{productType_id:20}),e.hardware=a("filter")(e.products,{productType_id:17}),e.software=a("filter")(e.products,{productType_id:18}),e.softwarePrice=c.map(e.software,function(e){return e.sell_price*e.quantity}),e.hardwareCategory=c.filter(e.hardware,function(e){return e.product_category.length>=1}),console.log("$scope.hardwareCategory:",e.hardwareCategory),c.isNull(e.software)||(c.map(e.software,function(t){void 0!=t.product_category[0]&&e.softwares.push(t.product_category[0])}),c.each(e.software,function(t){c.find(e.softwares,function(e){t.product_id==e.product_id&&(t.category_label=e.category_label)})})),c.isNull(e.hardware)||(c.map(e.hardware,function(t){void 0!=t.product_category[0]&&e.hardwares.push(t.product_category[0])}),c.each(e.hardware,function(t){c.find(e.hardwares,function(e){t.p_id==e.product_id&&(t.category_label=e.category_label)})})),c.isNull(e.services)||(c.map(e.services,function(t){void 0!==t.product_category[0]&&e.service.push(t.product_category[0])}),c.each(e.services,function(t){c.find(e.service,function(e){t.p_id==e.product_id&&(t.category_id=e.category_id)})}),e.deployment=a("filter")(e.services,{category_id:87}),e.support=a("filter")(e.services,{category_id:90}),e.hardwarePrice=c.map(e.hardware,function(e){return e.sell_price*e.quantity}),e.deploymentPrice=c.map(e.deployment,function(e){return e.sell_price*e.quantity}),e.upfront=c.sum(e.deploymentPrice)+c.sum(e.hardwarePrice)+c.sum(e.softwarePrice),e.weekly=31.111*e.upfront/1e3*12/52,e.supportPrice=c.map(e.support,function(e){return e.sell_price*e.quantity}),e.spPrice=c.sum(e.supportPrice))}else d.error(o.response.msg,"Error")})},function(r,a,s,i){t.getRelatedSolutions(o.selected_id,function(t,o){if(200==o.statusCode&&o.response.success){var n=o.response.result;i(null,r,a,s,o.response.result),c.each(n,function(t){"Hardware"==t.ref_product.product_type&&e.relatedProductHardware.push(t),"Software"==t.ref_product.product_type&&e.relatedProductSoftware.push(t)})}else d.error(o.response.msg,"Error")})}]),e.openProductModal=function(t){var r=i.open({animation:!0,templateUrl:"./views/productCatalogue.modal.html",size:"md",controller:"detailControl",windowClass:"xd-modal",backdropClass:"modal-backdrop fade in",resolve:{product:function(){return t}}});r.result.then(function(t){e.selected=t})},e.next=function(){console.log("NEXT")},e.addToCart=function(t){if(0==e.upfront)d.error("Cannot add product when the values are 0","Error");else if(t.upfront=e.upfront,t.spPrice=e.spPrice,t.quantity=1,s.cartItems.length>=0){var r=c.filter(s.cartItems,{pb_id:t.pb_id});r.length>0?(r[0].quantity++,c.each(s.cartItems,function(e){e.pb_id==r[0].pb_id&&(e.quantity=r[0].quantity)}),d.success("Quantity Added","Success"),n.set("Cart",JSON.stringify(s.cartItems))):(d.success("Successfully Added","Success"),s.cartItems.push(t),n.set("Cart",JSON.stringify(s.cartItems)))}},e.openShareModal=function(){if(o.selected_id){var t=i.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return{bundle_name:e.details.bundle_name,product_images:e.details.product_images,bundle_description:e.details.bundle_description,products:e.details.products,upfront:e.upfront.toFixed(2),spPrice:e.spPrice.toFixed(2),opex:(36*e.upfront/1e3).toFixed(2),weekly:e.weekly.toFixed(2)}},param:function(){return"bundle"}}});t.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})}}}function t(e,t,r){e.selected=r,e.cancel=function(){t.dismiss("cancel")}}angular.module("tessaApp").controller("detailSolutionCtrl",e).controller("detailControl",t),e.$inject=["$scope","APIFactory","$location","$stateParams","$filter","_","$rootScope","$uibModal","localStorageService","toastr"],t.$inject=["$scope","$uibModalInstance","product"]}();
!function(){"use strict";function e(e,t,s,r,a,c,o,u,i,n,l){u.cartItems=[],e.attributevalues=[],e.SolutionPack=[],e.products=[],e.slides=[],e.relatedProductHardware=[],e.relatedProductSoftware=[],u.cartItems=c.isEmpty(i.get("Cart"))?[]:JSON.parse(i.get("Cart")),r.selected_id&&(async.waterfall([function(s){t.getProductDetail(r.selected_id,function(t,r){if(200==r.statusCode&&r.response.success){e.productDetails=r.response.result;var a=0;e.productDetails.product_images.length>0?c.each(e.productDetails.product_images,function(t){e.slides.push({image:t.image_path,index:a}),a++}):(e.slides.push({image:e.productDetails.img_default,index:a}),a++),s(null,r.response.result)}})},function(s,a){t.getProdCateg(r.selected_id,function(t,r){200==r.statusCode&&r.response.success&&(e.category=r.response.result,a(null,s,r.response.result))})},function(s,a,o){t.getProductBundle(function(t){200==t.statusCode&&t.response.success&&(o(null,s,a,t.response.result),c.each(t.response.result,function(t){c.each(t.products,function(s){s.product_id==r.selected_id&&e.SolutionPack.push(t)})}))})},function(s,a,c,o){t.getProductAttribute(r.selected_id,function(t,r){if(200==r.statusCode&&r.response.success){o(null,s,a,c,r.response.result),e.attributes=r.response.result,e.attributevalues=e.attributes.attribute_values;e.attributes.attribute_values}})}]),async.waterfall([function(s){t.getProduct(function(t,r){200==r.statusCode&&r.response.success&&(e.products=r.response.result,s(null,r.response.result))})},function(s,a){t.getRelatedProduct(r.selected_id,function(t,r){if(200==r.statusCode&&r.response.success){var a=r.response.result;c.each(a,function(t){c.each(s,function(e){e.p_id==t.main_id&&(t.img_default=e.img_default)}),"Hardware"==t.ref_product.product_type&&e.relatedProductHardware.push(t),"Software"==t.ref_product.product_type&&e.relatedProductSoftware.push(t)})}else n.error(r.response.msg,"Error")})}])),e.addToCart=function(t){if(t.upfront=e.productDetails.sell_price,t.quantity=1,u.cartItems.length>=0){var s=c.filter(u.cartItems,{p_id:t.p_id});s.length>0?(s[0].quantity++,c.each(u.cartItems,function(e){e.p_id==s[0].p_id&&(e.quantity=s[0].quantity)}),n.success("Quantity Added","Success"),i.set("Cart",JSON.stringify(u.cartItems))):(n.success("Successfully Added","Success"),u.cartItems.push(t),i.set("Cart",JSON.stringify(u.cartItems)))}},e.openDetail=function(e){l.go("main.productDetailsHardware",{selected_id:e},{reload:!0})},e.openShareModal=function(){if(r.selected_id){var t=o.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return{item_name:e.productDetails.item_name,img_default:e.productDetails.img_default,item_description:e.productDetails.item_description,sell_price:e.productDetails.sell_price.toFixed(2)}},param:function(){return"product"}}});t.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})}}}function t(e,t,s){e.selected=s,e.cancel=function(){t.dismiss("cancel")}}angular.module("tessaApp").controller("hardwareDetailsCtrl",e).controller("hardwareCtrl",t),e.$inject=["$scope","APIFactory","$location","$stateParams","$filter","_","$uibModal","$rootScope","localStorageService","toastr","$state"],t.$inject=["$scope","$uibModalInstance","product"]}();
!function(){"use strict";function e(e,t,i,a,l,s,r,n,d,u){e.detail=[],e.bundles=[],e.slides=[],e.relatedExperience=[],d.selected_id&&(async.waterfall([function(e){n.getArticles(function(t){200==t.statusCode&&t.response.result&&e(null,t.response.result)})},function(t,i){n.getArticleDetail(d.selected_id,function(a){if(200==a.statusCode&&a.response.success){e.detail=a.response.result;var l=0;i(null,t,a.response.result),_.isEmpty(e.detail.mediafiles)||_.each(e.detail.mediafiles,function(t){if(t){if("video/mp4"==t.media_mimetype)return t.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-flv"==t.media_mimetype)return t.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-msvideo"==t.media_mimetype)return t.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-ms-wmv"==t.media_mimetype)return t.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/quicktime"==t.media_mimetype)return t.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";"image/png"==t.media_mimetype||"image/jpeg"==t.media_mimetype?(e.slides.push({media_name:t.media_name,media_mimetype:t.media_mimetype,image:t.media_path,index:l}),l++):"video/mp4"==t.media_mimetype&&(e.slides.push({media_name:t.media_name,media_mimetype:t.media_mimetype,image:t.media_path,url:t.url,index:l}),l++)}return t.index=l++})}})},function(e,t,i){n.getArticleTags(t.article_id,function(a){if(200==a.statusCode&&a.response.success){var l=[];_.map(a.response.result,function(e){"Article"!=e.tags&&"Portfolio"!=e.tags&&l.push(e)}),i(null,e,t,l)}})},function(t,i,a,l){var s=[],r=_.flattenDeep(_.map(t,function(e){return e.tags}));if(_.map(a,function(e){_.each(r,function(t){e.tags==t.tags&&s.push(t)})}),_.each(t,function(t){_.each(s,function(i){t.article_id==i.article_id&&e.relatedExperience.push(t)})}),!_.isEmpty(e.relatedExperience)){var d=_.uniq(e.relatedExperience);e.relatedExperiences=_.filter(d,function(e){return i.article_id!=e.article_id}),_.each(e.relatedExperiences,function(e){if(e.mediafiles.length>0&&(e.image=e.mediafiles[0].media_path),!_.isNull(e.thumbnail_media)){var t=e.article_thumbnail;if(t){if("video/mp4"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-flv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-msvideo"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-ms-wmv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/quicktime"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css"}}})}n.getProductBundle(function(t){var a=t.response.result;i.article_features.length>0?_.each(i.article_features,function(t){var i=_.find(a,{pb_id:t.bundle_id});e.bundles.push(i)}):e.norelated="No related solutions"})}]),e.openShareModal=function(){var t=u.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",backdrop:!1,windowClass:"sharemodal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return e.detail},param:function(){return"article"}}});t.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})},e.select=function(e){r.hash("article_page"),t.go("main.articlePage",{selected_id:e},{reload:!0})})}angular.module("tessaApp").controller("ModalInstanceCtrl",e),e.$inject=["$scope","$state","sharerFactory","toastr","$window","$anchorScroll","$location","APIFactory","$stateParams","$uibModal"]}();
!function(){"use strict";function e(e,t,s,a,i,c,r,d){e.data={},e.data.from="support@engagis-tessa.com.au",e.date=new Date,e.param=a,e.selected={},"article"==a?(e.selected.title=s.title,s.mediafiles&&s.mediafiles.length>0?e.selected.mediafiles=s.mediafiles[0].media_path:e.selected.mediafiles="",e.selected.description=s.description):"bundle"==a?(e.selected.bundle_name=s.bundle_name,s.product_images&&s.product_images.length>0?e.selected.product_images=s.product_images[0].media_path:e.selected.product_images="",e.selected.bundle_description=s.bundle_description,e.selected.products=s.products,e.selected.others={upfront:s.upfront,spPrice:s.spPrice,opex:s.opex,weekly:s.weekly}):"product"==a?(e.selected.item_name=s.item_name,e.selected.img_default=s.img_default,e.selected.item_description=s.item_description,e.selected.sell_price=s.sell_price):"quote"==a&&(e.selected=s),e.spprice=_.sum(_.map(e.selected.quote_item_list,function(e){return e.spprices*e.quantity})),e.subtotal=_.sum(_.map(e.selected.quote_item_list,function(e){var t=e.price*e.quantity;return t})),e.subtotalOpex=_.sum(_.map(e.selected.quote_item_list,function(e){_.isUndefined(e.spprices)&&(e.spprices=0);var t=(31.11*e.price/1e3+e.spprices)*e.quantity;return t})),console.log("$scope.subtotalOpex:",e.subtotalOpex),e.send=function(){"article"==a?(e.data.subject="ENGAGIS-TESSA Articles",e.data.message=$("#printarticle").html()):"bundle"==a?(e.data.subject="ENGAGIS-TESSA Bundle",e.data.message=$("#printbundle").html()):"product"==a?(e.data.subject="ENGAGIS-TESSA Product",e.data.message=$("#printproduct").html()):"quote"==a&&(e.data.subject="ENGAGIS-TESSA Quotes",e.data.message=$("#printquote").html(),e.data.pdf=$("#printpdfquote").html(),e.data._id=e.selected._id),i.shareExperience(e.data,function(s,a){return 200==a.statusCode&&a.response.success?(c.success(a.response.msg,"Success"),e.data.email="",t.dismiss("cancel"),r.go(r.current,null,{reload:!0}),void 0):400===a.statusCode&&!a.response.success&&_.isArray(a.response.result)?void _.each(a.response.result,function(e){c.warning(e.msg,"Warning")}):void c.error(a.response.msg,"Error")}),t.dismiss("send")},e.cancel=function(){t.dismiss("cancel")}}angular.module("tessaApp").controller("ShareModalInstanceCtrl",e),e.$inject=["$scope","$uibModalInstance","article","param","sharerFactory","toastr","$state","localStorageService"]}();
!function(){"use strict";function t(t,e,o,i,n,a,s,c,r){function l(t){_.each(n.cartItems,function(e){e.pb_id==t.pb_id&&e.p_id==t.p_id&&(e.quantity=t.quantity)}),a.set("Cart",JSON.stringify(n.cartItems))}if(n.cartItems=[],t.details=[],t.quantity=1,t.customers=[],t.companies=[],t.company={},t.countries=[],t.cart="items",t.radioModel,t.detail={},t.detail.quote_date=new Date,n.cartItems=_.isEmpty(a.get("Cart"))?[]:JSON.parse(a.get("Cart")),!_.isEmpty(n.cartItems)){t.details=n.cartItems;var p=_.map(t.details,function(t){return t.spPrice});t.spprice=_.sum(p),_.map(t.details,function(t){t.p_id&&(t.spPrice=0)}),a.set("Products",JSON.stringify(t.details)),async.waterfall([function(e){s.getCountries(function(o,i){200==i.statusCode&&i.response.success&&(t.countries=i.response.result,e(null,i.response.result))})},function(e,o){s.getAllPerson(function(i,n){t.customers=_.filter(n.response.result,function(t){return"Customer"==t.person_type}),o(null,e,n.response.result)})},function(e,o,i){s.getCompany(function(e,o){t.companies=o.response.result})}])}t.getCompanyDetail=function(e){console.log("value:",e.originalObject),e.originalObject.company_id?s.companyDetail(e.description.company_id,function(e,o){200==o.statusCode&&o.response.success&&(t.company=o.response.result,t.companycopy=angular.copy(o.response.result))}):t.company.name=e.originalObject},t.getCustomer=function(e){console.log("value:",e),e.originalObject.person_id?(t.company.customer_id=e.originalObject.person_id,t.company.customer=e.originalObject):t.company.customer=e.originalObject},t.inputProductChanged=function(e){t.searchinput=e},t.useBillingAddress=function(e){e?t.company&&(t.company.ship_name=t.company.bill_name,t.company.ship_address=t.company.bill_address,t.company.ship_city=t.company.bill_city,t.company.ship_state=t.company.bill_state,t.company.ship_zipcode=t.company.bill_zipcode,t.company.ship_country=t.company.bill_country):(t.company.ship_address=t.companycopy.ship_address,t.company.ship_city=t.companycopy.ship_city,t.company.ship_state=t.companycopy.ship_state,t.company.ship_zipcode=t.companycopy.ship_zipcode,t.company.ship_country=t.companycopy.ship_country)},t.proceed=function(){t.cart="payment"},t.back=function(){t.cart="items"},t.next=function(){t.cart="customer"},t.monthly=function(){return t.spprice=_.sum(_.map(t.details,function(t){return t.spPrice*t.quantity})),t.spprice},t.total=function(){return t.totals=0,_.forEach(t.details,function(e){t.totals+=e.upfront*e.quantity}),t.totals},t.detail.sub_total=t.total(),t.minusbutton=function(t){t.quantity<=1?(t.quantity=1,l(t)):(t.quantity--,l(t))},t.addbutton=function(t){t.quantity++,l(t)},t.reset=function(){_.each(n.cartItems,function(t){return n.cartItems.splice(n.cartItems,1)}),a.set("Cart",JSON.stringify(n.cartItems))},t.remove=function(t){var e=_.findIndex(n.cartItems,function(e){return e.pb_id==t.pb_id});n.cartItems.splice(e,1),a.set("Cart",JSON.stringify(n.cartItems))},t.cancel=function(){e.dismiss("cancel")},t.confirmation=function(){t.modal={title:"Archive Product?",message:"Are you sure to archive this selected products?"},c.openConfirm({templateUrl:"views/dialog.html",scope:t,className:"ngdialog-theme-default"}).then(function(){var c=JSON.parse(a.get("appuser")),l=new Date;t.detail.quoteproduct_list=[],_.each(n.cartItems,function(e){e.p_id?t.detail.quoteproduct_list.push({item_name:e.item_name,quantity:e.quantity,price:e.upfront,product_id:e.p_id,bundle_id:null,discount:0,total:0}):e.pb_id&&t.detail.quoteproduct_list.push({item_name:e.bundle_name,quantity:e.quantity,price:e.upfront,product_id:null,bundle_id:e.pb_id,discount:0,total:0})});var p=Math.floor(1e3*Math.random()+1);t.detail.quote_number="1000"+p,t.detail.quote_status="P",t.detail.staff_id=c.uc_id,t.detail.customer=t.company.customer,t.detail.other_fee=0,t.detail.tax=0,t.detail.tax=0,t.detail.total_fee=110,t.detail.valid_until=new Date,t.detail.valid_until=new Date(l.setDate(l.getDate()+30)),t.detail.bill_to_address=t.company.bill_address,t.detail.bill_to_city=t.company.bill_city,t.detail.bill_to_country=t.company.bill_country,t.detail.bill_to_state=t.company.bill_state,t.detail.bill_to_zipcode=t.company.bill_zipcode,t.detail.comments=t.company.comments,t.detail.customer_id=t.company.customer_id,t.detail.ship_to_address=t.company.ship_address,t.detail.ship_to_city=t.company.ship_city,t.detail.ship_to_country=t.company.ship_country,t.detail.ship_to_state=t.company.ship_state,t.detail.ship_to_zipcode=t.company.ship_zipcode,t.detail.ship_to=t.company.customer_id,t.detail.bill_to_name=t.company.bill_name,t.detail.ship_to_name=t.company.ship_name,console.log("$scope.detail:",t.detail),console.log("$scope.company:",t.company),s.saveQuote(t.detail,function(s,c){console.log("data:",c),console.log("err:",s),200==c.statusCode&&c.response.success&&(_.isEmpty(n.cartItems)||a.remove("Cart"),e.close(),i(function(){o.go("main.quoteProfile",{quote_id:c.response.result},{reload:!0}),a.set("Company",JSON.stringify(t.company)),a.remove("Customer"),a.remove("Payment"),a.remove("Cart"),r.trackEvent("Quote Generation","generate quote","$scope.detail.quote_number",c.response.result)},300))})},function(t){console.log("Modal promise close: ")})}}angular.module("tessaApp").controller("CartCtrl",t),t.$inject=["$scope","$uibModalInstance","$state","$timeout","$rootScope","localStorageService","APIFactory","ngDialog","$frontierAnalytics"]}();
!function(){"use strict";function t(t,e,s,i,o,r,a,n,u,c){o.user=_.isEmpty(r.get("User"))?[]:JSON.parse(r.get("User")),t.products=_.isEmpty(r.get("Products"))?[]:JSON.parse(r.get("Products")),t.company=_.isEmpty(r.get("Company"))?[]:JSON.parse(r.get("Company")),t.companyname=o.user.company_name,t.details={},t.radioModel="Capex",u.quote_id&&n.getQuoteDetail(u.quote_id,function(e,s){200==s.statusCode&&s.response.success&&(t.details=s.response.result,t.details.type=t.radioModel,t.details.customer=t.details.bill_qoute_info,t.details.date_created=moment(t.details.date_created).format("YYYY-MM-DD"),t.details.valid_until=moment(t.details.valid_until).format("YYYY-MM-DD"),n.getProductBundle(function(e){t.result=[],200==e.statusCode&e.response.success&&(_.each(t.details.quote_item_list,function(t){_.find(e.response.result,function(e){t.bundle_id==e.pb_id&&(_.each(e.products,function(t){t.category_id=t.product_detail.product_category[0].category_id,t.sell_price=t.product_detail.sell_price}),t.products=e.products)})}),t.items=_.map(t.details.quote_item_list,function(e){return e.products&&_.each(e.products,function(e){t.result.push(e)}),_.each(t.products,function(t){e.bundle_id==t.pb_id&&(e.spprices=t.spPrice)}),e.product_id?e:e}),t.totalupfront=_.sum(_.map(t.items,function(t){return t.price*t.quantity})),t.totalupfrontopex=_.sum(_.map(t.items,function(t){return t.price})),t.opexquantity=_.sum(_.map(t.items,function(t){return t.quantity})),t.subtotalOpex=_.sum(_.map(t.items,function(t){_.isUndefined(t.spprices)&&(t.spprices=0);var e=(31.111*t.price/1e3+t.spprices)*t.quantity;return e})),t.spprice=_.sum(_.map(t.items,function(t){return t.spprices*t.quantity})))}))}),t.newvalue=function(){t.details.type=t.radioModel},t.printQoute=function(t){i.print()},t.openShareModal=function(){a.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return t.details},param:function(){return"quote"}}})}}angular.module("tessaApp").controller("QuoteCtrl",t),t.$inject=["$scope","sharerFactory","toastr","$window","$rootScope","localStorageService","$uibModal","APIFactory","$stateParams","$filter"]}();
!function(){"use strict";function e(e,t,n,a,o,c,r,s,i,l,u,d,p){t.seemore=!0,t.date=new Date,t.msg="hello",t.shows=!1,t.value="",r.cartItems=o.isEmpty(l.get("Cart"))?[]:JSON.parse(l.get("Cart")),r.user=o.isEmpty(l.get("User"))?[]:JSON.parse(l.get("User")),t.seemore=!t.custom,t.searchinput=u.value,angular.element(document).ready(function(){$("#trigger-sidebar").click(function(){function e(){var e=$(window).width();e<700?$("#myBar, .acc-menu li a").css({"min-width":"0"}):e>700&&$("#myBar, .acc-menu li a").css({"min-width":"56px"})}$(".collapsible").toggle(),$(".collapsible").is(":visible")?$("#myBar, .acc-menu li a").css({"min-width":"245px"}):(e(),$(window).resize(e))}),$("#trigger-close-search, #srch-pop, .exit").click(function(){$("#toolbar-search").hide()}),$("#trigger-toolbar-search,#srch-pop").click(function(){$("#toolbar-search").show()}),$(document).on("click",".btn-checkbox",function(e){e.stopPropagation(),$(this).toggleClass("btn-checkbox-active")})});var h=function(){async.waterfall([function(e){n.getArticles(function(t){o.each(t.response.result,function(e){e.type="Experience"}),o.each(t.response.result,function(e){e.name=e.title,e.id=e.article_id}),e(null,t.response.result)})},function(e,t){n.getProductBundle(function(n){o.each(n.response.result,function(e){e.type="Solutions"}),o.each(n.response.result,function(e){e.name=e.bundle_name,e.id=e.pb_id}),t(null,n.response.result,e)})},function(e,t,a){var c=[];n.getProduct(function(n,r){c=o.filter(r.response.result,function(e){return"Hardware"==e.product_type}),o.each(c,function(e){e.type="Hardware"}),o.each(c,function(e){e.name=e.item_name,e.id=e.p_id}),a(null,c,e,t)})},function(e,n,a,c){var r=[];o.each(e,function(e){1==e.is_published&&0==e.is_archived&&r.push(e)}),o.each(n,function(e){1==e.is_published&&0==e.is_archived&&r.push(e)}),o.each(a,function(e){1==e.is_active&&r.push(e)}),t.allproducts=r}])};h(),t.signout=function(){d.logout().then(function(e){200==e.statusCode&&e.response.success&&(p.success(e.response.msg,"Success"),c.reload())})},t.clear=function(e){e?$("#searchBar").val($("#searchBar").val().slice(0,-1)):$("#searchBar").val("")},t.resetCart=function(){for(var e=t.customers.length;e--;){var n=t.customers[e];"expired"==n.status&&t.customers.splice(e,1)}},t.refreshDelay=function(e){t.search=e,t.allSearch=[],angular.isUndefined(e)||null==e||""==e?t.allSearch=[]:n.getAll(e).then(function(n){if(200==n.statusCode&&n.response.success){o.each(n.response.result.values,function(e){return"Services"==e.type?null:void t.allSearch.push(e)}),o.each(t.allSearch,function(e){"articles"==e.self&&(e.group="Experience"),"bundles"==e.self&&(e.group="Solutions"),"products"==e.self&&(e.group="Hardware")});var a=t.allSearch.slice();return e&&a.indexOf(e)===-1&&a.unshift(e),a}})},t.cartModal=function(){var e=i.open({animation:!0,templateUrl:"./views/cart.modal.html",size:"md",controller:"CartCtrl",windowClass:"xd-modal"});e.result.then(function(e){t.selected=e},function(){console.info("Modal dismissed at: "+new Date),l.remove("Payment")})},t.compareModal=function(){var e=i.open({animation:!0,templateUrl:"./views/compare.modal.html",size:"lg",windowClass:"xd-modal"});e.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})},t.inputProductChanged=function(e){t.searchinput=e},t.dataSelected=function(e){console.log("selected:",e),e&&(c.go("main.search",{value:e.originalObject},{reload:!1}),e.originalObject&&c.go("main.search",{value:e.originalObject},{reload:!1}),e.title&&c.go("main.search",{value:e.title},{reload:!1}))},t.clearInput=function(e){e?t.$broadcast("angucomplete-alt:clearInput",e):t.$broadcast("angucomplete-alt:clearInput")}}function t(e,t,n,a){e.product=function(){console.log("product():"),a.remove("label"),a.remove("hardtype"),n.go("main.productCatalogue")}}angular.module("tessaApp").controller("headerCtrl",e).controller("sidebarCtrl",t),e.$inject=["$http","$scope","APIFactory","$location","_","$state","$rootScope","$filter","$uibModal","localStorageService","$stateParams","AuthFactory","toastr"],t.$inject=["$scope","$location","$state","localStorageService"]}();
!function(){"use strict";function e(e,t,i,a,s,l,r,c,n,o,u){t.seemore=!0,t.date=new Date,r.user=s.isEmpty(o.get("User"))?[]:JSON.parse(o.get("User")),t.selectedItem=[],t.articlesList=[],t.lists=[],t.tags=[],t.tagscopy=[],t.selectedTag=[],t.tagselected=[],t.expFilter="all",t.infiniteScrollData={},t.infiniteScrollData.numToAdd=1,t.infiniteScrollData.currentItems=10,t.dynamicPopover={templateUrl:"myPopoverTemplate.html"},t.resetInfScroll=function(){t.infiniteScrollData.currentItems=t.infiniteScrollData.numToAdd},t.addMoreItems=function(){t.infiniteScrollData.currentItems!==t.lists.length&&(t.infiniteScrollData.currentItems+=t.infiniteScrollData.numToAdd,t.articlesList=t.lists,t.articlesList.length=t.infiniteScrollData.currentItems)},t.generateArticles=function(){t.articlesList=[],t.tags=[],t.tagscopy=[],t.lists=[],t.selectedTag=[],i.getArticles(function(e){if(200==e.statusCode&&e.response.success){s.each(e.response.result,function(e){e.name=e.title,e.type="Experience"}),s.map(e.response.result,function(e){e.tags.length>=1&&1==e.is_active&&t.articlesList.push(e)}),t.articlesList=s.map(s.orderBy(t.articlesList,"date_created")).reverse();for(var i=0;i<t.articlesList.length;i++)for(var a=0;a<t.articlesList[a].tags.length;a++)t.articlesList[i].tags[a]&&t.tags.push(t.articlesList[i].tags[a]);s.each(t.articlesList,function(e){if(e.mediafiles.length>0&&(e.image=e.mediafiles[0].media_path),!s.isNull(e.thumbnail_media)){var t=e.article_thumbnail;if(t){if("video/mp4"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-flv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-msvideo"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-ms-wmv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/quicktime"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css"}}}),t.tagscopy=angular.copy(t.tags),t.tagscopy=s.uniqBy(t.tagscopy,function(e){return e.tags}),t.tagscopy=s.filter(t.tagscopy,function(e){if("Article"!==e.tags&&"Portfolio"!==e.tags)return e}),t.lists=angular.copy(t.articlesList)}})},t.product=function(){o.remove("label"),o.remove("hardtype"),l.go("main.productCatalogue")},t.toggleSelectedTag=function(e){t.tagselected.indexOf(e)==-1?t.tagselected.push(e):t.tagselected=s.filter(t.tagselected,function(t){return t.tags_id!=e.tags_id})},t.isTagSelected=function(e){return t.tagselected.indexOf(e)!==-1},t.isOnSelectedTag=function(){return function(e){if(!(t.tagselected.length>0))return!0;var i=!1,a=s.map(t.tagselected,"tags_id");s.forEach(e.tags,function(e){a.indexOf(e.tags_id)!==-1&&(i=!0)});return i}},t.filterArticle=function(e){if(t.expFilter=e,"all"==e)t.articlesList=angular.copy(t.lists);else{t.articlesList=[];var i=c("filter")(t.tags,{tags:e});s.each(i,function(e){var i=s.find(t.lists,{article_id:e.article_id});t.articlesList.push(i)})}},t.$on("$stateChangeSuccess",function(e,i,a,s,l){"main.experience"==i.name&&(t.tagselected=[],t.generateArticles())})}angular.module("tessaApp").controller("expCtrl",e),e.$inject=["$http","$scope","APIFactory","$location","_","$state","$rootScope","$filter","$uibModal","localStorageService","$timeout"]}();
!function(){"use strict";function e(e,s,t,o,a,i,r,l,n,c,d,m,f){function p(e,s){if(0==e)return"0 Byte";var t=1024,o=s+1||3,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(o))+" "+a[i]}function u(s){if(200==s.statusCode&&s.response.success){e.items=s.response.result,e.assets=angular.copy(s.response.result),e.isLoading=!1,e.showBread=!0,e.disableToolNewFolder=!1,"main.presentation"==i.current.name?(e.activeAllFiles=!0,e.showToolNewFolder=!0,e.showToolNewUpload=!0,e.assets.folders=_.filter(e.assets.folders,function(e){return 0==e.isDeleted}),e.assets.assets=_.filter(e.assets.assets,function(e){return 0==e.isDeleted}),e.assets.assets=_.filter(e.assets.assets,function(e){return null==e.folder_id}),e.assets.folderscopy=angular.copy(e.assets.folders),e.assets.assetscopy=angular.copy(e.assets.assets)):"main.presentation_starred"==i.current.name?(e.activeStarredFiles=!0,e.showToolNewFolder=!1,e.showToolNewUpload=!1,e.showBarDelete=!1,e.assets.folders=_.filter(e.assets.folders,function(e){return 0==e.isDeleted&&1==e.isStarred}),e.assets.assets=_.filter(e.assets.assets,function(e){return 0==e.isDeleted&&1==e.isStarred}),e.starred.folderscopy=angular.copy(e.assets.folders),e.starred.assetscopy=angular.copy(e.assets.assets)):"main.presentation_trash"==i.current.name?(e.activeTrashFiles=!0,e.showToolNewFolder=!1,e.showToolNewUpload=!1,e.showBarDelete=!1,e.showBarRestore=!0,e.showBarShare=!1,e.showToolPreview=!1,e.showToolOpen=!1,e.showBarMore=!1,e.assets.folders=_.filter(e.assets.folders,function(e){return 1==e.isDeleted}),e.assets.assets=_.filter(e.assets.assets,function(e){return 1==e.isDeleted}),e.trash.folderscopy=angular.copy(e.assets.folders),e.trash.assetscopy=angular.copy(e.assets.assets)):e.showToolBar=!1,_.each(e.assets.folders,function(e){var s=_.sumBy(e.files,function(e){return e.asset_filesize});e.folder_filesize=p(s),e.isActive=!1,e.isFolder=!0}),_.each(e.assets.assets,function(e){e.asset_filesize=p(e.asset_filesize),e.isActive=!1,e.isFolder=!1}),e.assets.folders&&e.assets.assets&&(e.assets.folders.length>0&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length>0&&e.assets.assets.length<1?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length<1&&(e.showFiles=!1)),_.each(e.assets.folders,function(e){e.files.length>0&&_.each(e.files,function(e){if("video/mp4"==e.asset_mimetype||"video/x-flv"==e.asset_mimetype||"video/x-msvideo"==e.asset_mimetype||"video/x-ms-wmv"==e.asset_mimetype||"video/quicktime"==e.asset_mimetype)return e.url="http://www.videogular.com/styles/themes/default/latest/videogular.css"})}),e.presentationfolders=e.assets.folders,e.toppresentation=_.find(e.presentationfolders,{folder_name:"Top 10 Presentations"});var t=_.find(e.assets.folders,{folder_name:"About Engagis"});e.aboutengagis=_.each(t.files,function(e){"image/png"==e.asset_mimetype&&(e.asset_name=e.asset_name.slice(0,-4))}),console.log("$scope.aboutengagis:",e.aboutengagis),e.foldercopy=angular.copy(e.assets.folders),e.assetcopy=angular.copy(e.assets.assets)}}console.log("presentationCtrl"),e.items={},e.assets={},e.trash={},e.starred={},e.DeSelectAll=!1,e.selectedText="Select All",e.selectedFile={},e.presentationfolders=[],e.isList="null"!=s.get("isList")&&0!=s.get("isList"),e.isLoading=!0,e.showBread=!1,e.showFiles=!1,e.disableToolNewFolder=!0,e.showToolNewFolder=!0,e.showToolNewUpload=!0,e.showToolMakeCopy=!1,e.showToolPreview=!1,e.showToolOpen=!1,e.showToolBar=!0,e.showBarDelete=!1,e.showBarRestore=!1,e.showBarShare=!1,e.showBarMore=!1,e.activeAllFiles=!1,e.activeSharedFiles=!1,e.activeStarredFiles=!1,e.activeTrashFiles=!1,e.mirrorFile=!1,e.mirrorDevice={},e.activeDevices=[],f.on("pair:init",function(){console.log("pair:init tessa")}),f.on("pair:sendCode",function(s){_.find(e.activeDevices,{deviceUUID:s.deviceUUID})||e.activeDevices.push(s)}),e.changeDisplay=function(){e.isList=!e.isList,s.set("isList",e.isList),e.isPreso=!e.isPreso,s.set("isPreso",e.isPreso)},e.refreshAssets=function(){e.assets={},e.items={},"main.presentation"==i.current.name?e.activePage="Assets":"main.presentation_starred"==i.current.name?e.activePage="Favorites":"main.presentation_trash"==i.current.name&&(e.activePage="Trash"),a._id&&_.isUndefined(a.sub_id)?(e.isLoading=!0,o.getFolderAssets(a._id).then(u)):a._id&&a.sub_id?(e.showToolNewFolder=!1,e.isLoading=!0,o.getFolderAssets(a.sub_id).then(u)):o.getAllAssets().then(u)},e.refreshAssets(),e.showAllFiles=function(){console.log("$state.current.name:",i.current.name),"main.presentation"==i.current.name?(e.activePage="Assets",e.refreshAssets()):i.go("main.presentation")},e.showAllTrash=function(){console.log("$state.current.name:",i.current.name),"main.presentation_trash"==i.current.name?(e.activePage="Trash",e.refreshAssets()):i.go("main.presentation_trash")},e.showAllStarred=function(){"main.presentation_starred"==i.current.name?(e.activePage="Favorites",e.refreshAssets()):i.go("main.presentation_starred")},e.castModal=function(){var s=t.open({animation:!0,templateUrl:"./views/folder/cast.html",windowClass:"xd-modal",controller:"assetsMirrorModalCtrl",resolve:{activeDevices:function(){return e.activeDevices},asset_file:function(){return e.selectedFile}}});s.result.then(function(s){e.selectedFile&&("mirror"==s.msg&&(e.mirrorFile=!0,e.mirrorDevice=s.device),e.selectedFile.isFolder?e.openFolder(e.selectedFile):e.openFile(e.selectedFile))})},e.newFolder=function(){var e=t.open({animation:!0,templateUrl:"./views/folder/new-item.html",size:"sm",windowClass:"xd-modal",controller:"presentationFolderModalCtrl"});e.result.then(function(e){e&&i.reload()})},e.newUploader=function(){var s=t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/uploader.html",size:"lg",controller:"assetsUploadModalCtrl"});s.result.then(function(s){s&&e.refreshAssets()})},e.copySelected=function(){var e=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/copy.html",controller:"modalpresentation"});e.result.then(function(e){},function(){console.info("Modal dismissed at: "+new Date)})},e.shareToOthers=function(){var s=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/share.html",controller:"assetsShareModalCtrl",resolve:{asset_file:function(){return e.selectedFile}}});s.result.then(function(e){},function(){console.info("Modal dismissed at: "+new Date)})},e.renameSelected=function(){var s=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/rename.html",controller:"assetsRenameModalCtrl",resolve:{asset_file:function(){return e.selectedFile}}});s.result.then(function(e){e&&i.reload()})},e.deleteSelected=function(){function s(e){200==e.statusCode&&e.response.success&&(r.success(e.response.msg,"Success"),l(function(){i.reload()},200))}console.log("deleteSelected"),e.modal={title:"Remove?",message:"Are you sure to remove this?"},c.openConfirm({templateUrl:"./views/folder/customDialog.html",scope:e,className:"ngdialog-theme-default"}).then(function(){_.isEmpty(e.selectedFile)||(e.selectedFile.isFolder?e.selectedFile.isDeleted?o.deleteFolder(e.selectedFile._id).then(s):o.trashFolder(e.selectedFile._id).then(s):e.selectedFile.isDeleted?o.deleteAssetFile(e.selectedFile._id).then(s):o.trashAssetFile(e.selectedFile._id).then(s))})},e.moveSelected=function(){var s=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/move.html",controller:"assetsMoveModalCtrl",resolve:{asset_file:function(){return e.selectedFile}}});s.result.then(function(e){e&&i.reload()})},e.previewSelected=function(){console.log(""),e.selectedFile&&(e.selectedFile.isFolder?(e.openFolder(e.selectedFile),m.trackEvent("Presentation Assets","View",e.selectedFile.folder_name,e.selectedFile.folder_id)):(e.openFile(e.selectedFile),m.trackEvent("Presentation Assets","View",e.selectedFile.asset_name,e.selectedFile.asset_id)))},e.imagepreview=function(s){e.openFile(s)},e.imageCast=function(s){t.open({animation:!0,templateUrl:"./views/folder/cast.html",windowClass:"xd-modal",controller:"assetsMirrorModalCtrl",resolve:{activeDevices:function(){return e.activeDevices},asset_file:function(){return s}}})},e.starredSelected=function(){function s(e){200==e.statusCode&&e.response.success&&(r.success(e.response.msg,"Success"),l(function(){i.reload()},200))}e.selectedFile&&(e.selectedFile.isFolder?o.starredFolder(e.selectedFile._id).then(s):o.starredAssetFile(e.selectedFile._id).then(s))},e.restoreSelected=function(){function s(e){200==e.statusCode&&e.response.success&&(r.success(e.response.msg,"Success"),l(function(){i.reload()},200))}e.selectedFile&&(e.selectedFile.isFolder?o.restoreFolder(e.selectedFile._id).then(s):o.restoreAssetFile(e.selectedFile._id).then(s))},e.openLightboxModal=function(s){e.image_file={url:s.asset_url,caption:s.asset_name,thumbUrl:s.asset_url};var o=t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/lightbox-modal.html",windowClass:"modal-img-fullscreen xd-modal",scope:e,size:"lg",resolve:{files:function(){return s},type:function(){return"video"}}});e.cancel=function(){o.dismiss("cancel")}},e.openVideoModal=function(s){t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/media.html",controller:"assetsMediaModalCtrl",windowClass:"xd-modal",size:"lg",resolve:{files:function(){return s},type:function(){return"video"},mirrorFile:function(){return e.mirrorFile}}}).result.then(function(){e.mirrorFile=!1})},e.openAudioModal=function(s){t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/media.html",controller:"assetsMediaModalCtrl",windowClass:"xd-modal",size:"md",resolve:{files:function(){return s},type:function(){return"audio"},mirrorFile:function(){return e.mirrorFile},mirrorDevice:function(){return e.mirrorDevice}}}).result.then(function(){e.mirrorFile=!1,e.mirrorDevice={}})},e.openDocsModal=function(s){t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/preview.html",controller:"assetsDocsModalCtrl",size:"lg",windowClass:"modal-fullscreen xd-modal",resolve:{files:function(){return s},mirrorFile:function(){return e.mirrorFile},mirrorDevice:function(){return e.mirrorDevice}}}).result.then(function(){e.mirrorFile=!1,e.mirrorDevice={}})},e.openFolder=function(s){s.isFolder&&("main.presentation_trash"!==i.current.name?a._id?i.go("main.opensubfolder",{_id:a._id,sub_id:s._id}):i.go("main.openfolder",{_id:s._id}):(e.modal={title:"This folder is in your trash",message:"To view this folder, youll need to restore it from your trash. Restore folder?"},c.openConfirm({templateUrl:"./views/folder/customDialog.html",scope:e,className:"ngdialog-theme-default"}).then(function(){o.restoreFolder(s._id).then(function(e){200==e.statusCode&&e.response.success&&(r.success(e.response.msg,"Success"),l(function(){i.reload()},200))})})))},e.openFile=function(s){if("image/jpeg"==s.asset_mimetype||"image/jpg"==s.asset_mimetype||"image/gif"==s.asset_mimetype||"image/x-ms-bmp"==s.asset_mimetype||"image/png"==s.asset_mimetype)e.openLightboxModal(s);else if("audio/mp3"==s.asset_mimetype||"audio/mp4"==s.asset_mimetype)e.openAudioModal(s);else if("video/mp4"==s.asset_mimetype||"video/x-flv"==s.asset_mimetype||"video/x-msvideo"==s.asset_mimetype||"video/x-ms-wmv"==s.asset_mimetype||"video/quicktime"==s.asset_mimetype||"video/3gpp"==s.asset_mimetype)e.openVideoModal(s);else if("application/pdf"==s.asset_mimetype)e.openDocsModal(s);else if("text/plain"==s.asset_mimetype)e.openDocsModal(s);else if("application/msword"==s.asset_mimetype||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==s.asset_mimetype)e.openDocsModal(s);else if("text/csv"==s.asset_mimetype||"application/vnd.ms-excel"==s.asset_mimetype||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==s.asset_mimetype)e.openDocsModal(s);else{if("application/vnd.openxmlformats-officedocument.presentationml.presentation"!=s.asset_mimetype&&"application/vnd.ms-powerpoint"!=s.asset_mimetype)return void r.warning("No available tools to open","Failed");e.openDocsModal(s)}_.isNull(s.folder_id)?m.trackEvent("Presentation Assets","Click",s.asset_name,s.asset_id):m.trackEvent("Presentation Assets","Click",s.folder_name,s.files)},e.deleteFile=function(s){e.modal={title:"Remove File",message:"Are you sure to remove the file?"},c.openConfirm({templateUrl:"./views/folder/customDialog.html",scope:e,className:"ngdialog-theme-default"}).then(function(){o.deleteAssetFile(s._id).then(function(e){200==e.statusCode&&e.response.success&&(r.success(e.response.msg,"Success"),l(function(){i.reload()},200))})})},e.clearSelection=function(){e.selectedFile={},e.showBarDelete=!1,e.showBarRestore=!1,e.showBarShare=!1,e.showBarMore=!1,e.showToolPreview=!1,e.showToolOpen=!1,_.each(e.assets.folders,function(e){e.isActive=!1}),_.each(e.assets.assets,function(e){e.isActive=!1})},e.searchData=function(){_.isEmpty(e.txtSearch)||"main.presentation_trash"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.presentation_trash"==i.current.name?(e.assets.folders=e.trash.folderscopy,e.assets.assets=e.trash.assetscopy):_.isEmpty(e.txtSearch)||"main.presentation_starred"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.presentation_starred"==i.current.name?(e.assets.folders=e.starred.folderscopy,e.assets.assets=e.starred.assetscopy):_.isEmpty(e.txtSearch)||"main.presentation"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.presentation"==i.current.name?(e.assets.folders=e.assets.folderscopy,e.assets.assets=e.assets.assetscopy):_.isEmpty(e.txtSearch)||"main.opensubfolder"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.opensubfolder"==i.current.name?(e.assets.folders=e.foldercopy,e.assets.assets=e.assetcopy):_.isEmpty(e.txtSearch)||"main.openfolder"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.openfolder"==i.current.name&&(e.assets.folders=e.foldercopy,e.assets.assets=e.assetcopy):(e.assets.folders=d("filter")(e.foldercopy,e.txtSearch),e.assets.assets=d("filter")(e.assetcopy,e.txtSearch)):(e.assets.folders=d("filter")(e.foldercopy,e.txtSearch),e.assets.assets=d("filter")(e.assetcopy,e.txtSearch)):(e.assets.folders=d("filter")(e.assets.folderscopy,e.txtSearch),e.assets.assets=d("filter")(e.assets.assetscopy,e.txtSearch)):(e.assets.folders=d("filter")(e.starred.folderscopy,e.txtSearch),e.assets.assets=d("filter")(e.starred.assetscopy,e.txtSearch)):(e.assets.folders=d("filter")(e.trash.folderscopy,e.txtSearch),e.assets.assets=d("filter")(e.trash.assetscopy,e.txtSearch)),_.each(e.assets.folders,function(e){var s=_.sumBy(e.files,function(e){return e.asset_filesize});e.folder_filesize=p(s),e.isActive=!1,e.isFolder=!0}),_.each(e.assets.assets,function(e){e.asset_filesize=_.isInteger(e.asset_filesize)?p(e.asset_filesize):e.asset_filesize,e.isActive=!1,e.isFolder=!1}),e.assets.folders&&e.assets.assets&&(e.assets.folders.length>0&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length>0&&e.assets.assets.length<1?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length<1&&(e.showFiles=!1))},e.selectAll=function(){0==e.DeSelectAll?(e.showBarDelete=!0,e.showBarRestore=!1,e.showBarShare=!0,e.showBarMore=!0,_.each(e.assets.folders,function(e){e.isActive=!0}),_.each(e.assets.assets,function(e){e.isActive=!0}),e.DeSelectAll=!0,e.selectedText="Deselect All"):(e.showBarDelete=!1,e.showBarRestore=!0,e.showBarShare=!1,e.showBarMore=!1,_.each(e.assets.folders,function(e){e.isActive=!1}),_.each(e.assets.assets,function(e){e.isActive=!1}),e.DeSelectAll=!1,e.selectedText="Select All")},e.activeSelected=function(s){console.log("folder:",s),e.DeSelectAll=!1,e.selectedText="Select All",s&&(s.isActive=!0,"main.presentation_trash"==i.current.name?(e.showBarDelete=!0,e.showBarRestore=!0,e.showBarShare=!1,e.showBarMore=!1,e.showToolPreview=!1,e.showToolOpen=!1,e.showToolMakeCopy=!1):"main.presentation_starred"==i.current.name?(e.showBarDelete=!1,e.showBarRestore=!1,e.showBarShare=!0,e.showBarMore=!0,s.isFolder?(e.showToolPreview=!1,e.showToolOpen=!0,e.showToolMakeCopy=!1):(e.showToolPreview=!0,e.showToolOpen=!1,e.showToolMakeCopy=!0)):(e.showBarDelete=!0,e.showBarRestore=!1,e.showBarShare=!0,e.showBarMore=!0,s.isFolder?(e.showToolPreview=!1,e.showToolOpen=!0,e.showToolMakeCopy=!1):(e.showToolPreview=!0,e.showToolOpen=!1,e.showToolMakeCopy=!0)),e.selectedFile=s,e.presentationfolders&&_.each(e.presentationfolders,function(e){_.each(e.files,function(e){e._id!==s._id&&(e.isActive=!1)})}),e.toppresentation&&_.each(e.toppresentation.files,function(e){e._id!==s._id&&(e.isActive=!1)}),_.each(e.assets.folders,function(e){e._id!==s._id&&(e.isActive=!1)}),_.each(e.assets.assets,function(e){e._id!==s._id&&(e.isActive=!1)}))}}angular.module("tessaApp").controller("presentationCtrl",e),e.$inject=["$scope","localStorageService","$uibModal","assetsFctry","$stateParams","$state","toastr","$timeout","Lightbox","ngDialog","$filter","$frontierAnalytics","socket"]}();
!function(){"use strict";function s(s,e,n,r,t,o){s.folder={},s.create=function(){r._id&&(s.folder.parent_id=r._id),o.createFolder(s.folder).then(function(s){200==s.statusCode&&s.response.success?(t.success(s.response.msg,"Success"),n(function(){e.close("save")},100)):400===s.statusCode&&!s.response.success&&_.isArray(s.response.result)?_.each(s.response.result,function(s){t.warning(s.msg,"Warning")}):t.error(s.response.msg,"Error")})},s.cancel=function(){e.dismiss("cancel")}}angular.module("tessaApp").controller("presentationFolderModalCtrl",s),s.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry"]}();
!function(){"use strict";function e(e,t,s,i,c,o,n,l,r,a){function m(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()}function u(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,t=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;t?m(document.documentElement):e&&m(document.documentElement)}function d(){document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function p(){t.reload()}function v(e){console.log("Error: ",e)}e.audio="audio"==o,e.mirrorFile=mirrorFile,e.mirrorDevice=a,e.onReady=function(e){e.autoPlay=!0},e.config={autoPlay:!0,sources:[{src:c.trustAsResourceUrl(i.asset_url),type:i.asset_mimetype}],theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}},e.device={},e.asset_file=i,e.displayInstallPlugin=!1,e.activeDevices=[],n.on("pair:sendCode",function(t){_.find(e.activeDevices,{deviceUUID:t.deviceUUID})||e.activeDevices.push(t)}),DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"!=t&&(DetectRTC.screen.chromeMediaSource="desktop",r(function(){e.$apply(function(){e.displayInstallPlugin=!0})},10))}),e.selectDevice=function(t){console.log("selectDevice"),e.device=t,e.device?(e.device.connected=!0,"audio/mp3"==e.asset_file.asset_mimetype||"audio/mp4"==e.asset_file.asset_mimetype?e.asset_file.asset_type="audio":"video/mp4"==e.asset_file.asset_mimetype||"video/x-flv"==e.asset_file.asset_mimetype||"video/x-msvideo"==e.asset_file.asset_mimetype||"video/x-ms-wmv"==e.asset_file.asset_mimetype||"video/quicktime"==e.asset_file.asset_mimetype||"video/3gpp"==e.asset_file.asset_mimetype?e.asset_file.asset_type="video":e.asset_file.asset_type="none",e.asset_file.deviceUUID=e.device.deviceUUID,e.asset_file.url=window.location.origin+"/presentation.html?s=tEs$@486759",console.log("$scope.asset_file: ",e.asset_file),e.device.asset_file=e.asset_file,u(),n.emit("pair:getCode",e.device)):u()},e.castScreen=function(){console.log("castScreen"),e.mirrorDevice&&!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.runtime.sendMessage("klaagnfcilpkdeicdamepejjmaoahple",{openplugin:window.location.origin},function(t){console.log("response: ",t),u(),n.emit("pair:getCode",e.mirrorDevice)})},e.starredSelected=function(){function t(t){200==t.statusCode&&t.response.success&&(toastr.success(t.response.msg,"Success"),e.asset_file.isStarred=1)}e.asset_file&&(e.asset_file.isFolder?l.starredFolder(e.asset_file._id).then(t):l.starredAssetFile(e.asset_file._id).then(t))},e.cancel=function(){e.device?n.emit("pair:closePresent",{deviceUUID:e.device.deviceUUID}):n.emit("pair:closePresent",{}),d(),s.dismiss("cancel")},e.installPlugin=function(){!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.webstore.install("https://chrome.google.com/webstore/detail/tessa-presentation/klaagnfcilpkdeicdamepejjmaoahple",p,v)}}function t(e,t,s,i,c,o,n,l,r,a,m,u){function d(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()}function p(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,t=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;t?d(document.documentElement):e&&d(document.documentElement)}function v(){document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function f(){t.reload()}function g(e){console.log("Error: ",e)}e.pdfName=c.media_name,e.file_type=c.asset_mimetype,e.device={},e.activeDevices=[],e.onMouseMoveResult="",e.displayInstallPlugin=!1,e.mirrorFile=m,e.mirrorDevice=u,console.log("$scope.mirrorFile: ",e.mirrorFile),console.log("$scope.mirrorDevice: ",e.mirrorDevice);var w,F=c;if(DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"!=t&&(DetectRTC.screen.chromeMediaSource="desktop",a(function(){e.$apply(function(){e.displayInstallPlugin=!0})},10))}),"application/pdf"==c.asset_mimetype)e.pdfUrl=i.trustAsResourceUrl(c.asset_url);else if("text/plain"==c.asset_mimetype)e.pdfUrl=i.trustAsResourceUrl("https://docs.google.com/gview?url="+c.asset_url+"&embedded=true");else{var y=encodeURI(c.asset_url);e.pdfUrl=i.trustAsResourceUrl("https://view.officeapps.live.com/op/view.aspx?src="+y)}e.stop=function(){r.cancel(w)},e.selectDevice=function(t){e.device=t,e.device?(e.device.connected=!0,"audio/mp3"==F.asset_mimetype||"audio/mp4"==F.asset_mimetype?F.asset_type="audio":"video/mp4"==F.asset_mimetype||"video/x-flv"==F.asset_mimetype||"video/x-msvideo"==F.asset_mimetype||"video/x-ms-wmv"==F.asset_mimetype||"video/quicktime"==F.asset_mimetype||"video/3gpp"==F.asset_mimetype?F.asset_type="video":F.asset_type="none",F.deviceUUID=e.device.deviceUUID,F.url=window.location.origin+"/presentation.html?s=tEs$@486759",console.log("$scope.asset_file: ",F),e.device.asset_file=F,p(),n.emit("pair:getCode",e.device)):p()},e.castScreen=function(){console.log("castScreen: ",e.mirrorDevice),e.mirrorDevice&&!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.runtime.sendMessage("klaagnfcilpkdeicdamepejjmaoahple",{openplugin:window.location.origin},function(t){console.log("response: ",t),p(),n.emit("pair:getCode",e.mirrorDevice)})},e.cancel=function(){e.device?n.emit("pair:closePresent",{deviceUUID:e.device.deviceUUID}):n.emit("pair:closePresent",{}),e.stop(),v(),s.dismiss("cancel")},e.installPlugin=function(){!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.webstore.install("https://chrome.google.com/webstore/detail/tessa-presentation/klaagnfcilpkdeicdamepejjmaoahple",f,g)},n.on("pair:sendCode",function(t){_.find(e.activeDevices,{deviceUUID:t.deviceUUID})||e.activeDevices.push(t)})}angular.module("tessaApp").controller("assetsMediaModalCtrl",e).controller("assetsDocsModalCtrl",t),e.$inject=["$scope","$state","$uibModalInstance","files","$sce","type","socket","assetsFctry","$timeout","mirrorFile","mirrorDevice"],t.$inject=["$scope","$state","$uibModalInstance","$sce","files","localStorageService","socket","$window","$interval","$timeout","mirrorFile","mirrorDevice"]}();
!function(){"use strict";function e(e,s,o,t,i,l,a){e.files={},e.treedata=[],e.asset_file=a,e.isLoading=!0,e.treedata.push({label:"Main Files",_id:null,folder_id:null}),l.getAllAssets().then(function(s){200==s.statusCode&&s.response.success&&(e.files=s.response.result,_.each(e.files.folders,function(s){var o={label:s.folder_name,_id:s._id,folder_id:s.folder_id,children:[]};_.each(s.sub_folders,function(e){o.children.push({label:e.folder_name,_id:s._id,folder_id:s.folder_id})}),e.treedata.push(o)}),e.isLoading=!1,console.log("$scope.treedata: ",e.treedata))}),e.Move=function(){function t(e){200==e.statusCode&&e.response.success&&(i.success(e.response.msg,"Success"),o(function(){s.close("save")},100))}if(!e.abc||!angular.isObject(e.abc.currentNode))return void i.warning("Please select directory where the files/folder to move","WARNING");var a=e.abc.currentNode;if(e.asset_file.isFolder){if(e.asset_file._id==a._id)return void i.warning("Unable to move folder on same folder source","WARNING");if(e.asset_file.parent_id==a._id)return void i.warning("Unable to move folder on root folder source","WARNING");l.moveFolder(e.asset_file._id,a._id).then(t)}else l.moveAssetFile(e.asset_file._id,a._id).then(t)},e.cancel=function(){s.dismiss("cancel")}}angular.module("tessaApp").controller("assetsMoveModalCtrl",e),e.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","asset_file"]}();
!function(){"use strict";function e(e,s,n,i,l,t,a){e.file={},e.file=a,e.file.isFolder?e.file.foldername=e.file.folder_name:e.file.filename=e.file.asset_name,e.Rename=function(){function i(e){200==e.statusCode&&e.response.success?(l.success(e.response.msg,"Success"),n(function(){s.close("save")},100)):400===e.statusCode&&!e.response.success&&_.isArray(e.response.result)?_.each(e.response.result,function(e){l.warning(e.msg,"Warning")}):l.error(e.response.msg,"Error")}e.file.isFolder?t.updateFolder(e.file._id,{folder_name:e.file.foldername}).then(i):t.updateAssetFile(e.file._id,{file_name:e.file.filename}).then(i)},e.cancel=function(){s.dismiss("cancel")}}angular.module("tessaApp").controller("assetsRenameModalCtrl",e),e.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","asset_file"]}();
!function(){"use strict";function s(s,e,n,r,a,t,o,i,c,u){s.sharer={},s.persons=[],s.company=[],s.items=[],async.waterfall([function(s){o.getCompany(function(e,n){if(200==n.statusCode&&n.response.success){var r=n.response.result;s(null,r)}else s(null,[])})},function(s,e){o.getAllPerson(function(n,r){if(200==r.statusCode&&r.response.success){var a=r.response.result;e(null,s,a)}else e(null,[])})},function(e,n,r){s.persons=angular.copy(n),s.company=angular.copy(e),s.persons=_.filter(s.persons,function(s){if("Customer"==s.person_type&&0==s.isSubscriber)return s}),_.each(s.persons,function(e){s.items.push({displayName:e.displayName,email:e.email||"",_id:e._id})}),_.each(s.company,function(e){s.items.push({displayName:e.name,email:e.email_address||"",_id:e._id})})}]),s.tagTransform=function(s){return{email:s}},s.clearInput=function(s){s.search=""},s.deleteEmail=function(s){console.log("deleteEmail: ",s)},s.sendMail=function(){s.sharer.from="support@engagis-tessa.com.au",s.sharer.subject="ENGAGIS-TESSA Presentation",s.sharer.message=$("#printasset").html(),s.sharer.attachment=c.asset_url||"",s.sharer.email=_.map(s.sharer.email,function(s){return s.email}),i.sendMail(s.sharer,function(s,n){return 200==n.statusCode&&n.response.success?(a.success(n.response.msg,"Success"),e.dismiss("send"),u.go(u.current,null,{reload:!0}),void 0):400===n.statusCode&&!n.response.success&&_.isArray(n.response.result)?void _.each(n.response.result,function(s){a.warning(s.msg,"Warning")}):void a.error(n.response.msg,"Error")})},s.cancel=function(){e.dismiss("cancel")}}angular.module("tessaApp").controller("assetsShareModalCtrl",s),s.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","APIFactory","sharerFactory","asset_file","$state"]}();
!function(){"use strict";function e(e,o,s,l,t,n,i,a,c,u,d,r){console.log("assetsUploadModalCtrl: ",u),e.item={},e.isUploadAll=!0,e.isClose=!1;var f=(JSON.parse(d.get("user")),e.uploader=new l({url:t+n+"assets",method:"POST",headers:{Authorization:"Bearer "+c.getUserToken(),accesskey:i}}));f.filters.push({name:"customFilter",fn:function(e,o){return this.queue.length<10}}),f.onBeforeUploadItem=function(e){e.alias="files",u._id&&_.isUndefined(u.sub_id)?e.formData=[{parent_id:u._id}]:u._id&&u.sub_id&&(e.formData=[{parent_id:u.sub_id}])},f.onSuccessItem=function(e,o,s,l){r.success(o.response.msg,"Success")},f.onWhenAddingFileFailed=function(e,o,s){console.log("item:",e),console.log("filter:",o),console.log("options:",s)},f.onAfterAddingFile=function(e){console.log("onAfterAddingFile:",e)},f.onCompleteAll=function(e){r.success("Media / File upload complete","Success"),a(function(){s.close("success")},1300)},e.uploadAll=function(){f.uploadAll(),e.isUploadAll=!1,e.isClose=!0},e.cancel=function(){s.dismiss("cancel")}}angular.module("tessaApp").controller("assetsUploadModalCtrl",e),e.$inject=["$scope","$state","$uibModalInstance","FileUploader","API_URL","API_VERSION","ACCESSKEY","$timeout","AuthFactory","$stateParams","localStorageService","toastr"]}();
!function(){"use strict";function e(e,i,t,s,c,o,n,a,l,d,m){e.device={},e.activeDevices=[],e.activeDevices=angular.copy(a),e.enableCasting=!0,e.displayInstallPlugin=!1,DetectRTC.screen.getChromeExtensionStatus(function(i){"installed-enabled"!=i&&(DetectRTC.screen.chromeMediaSource="desktop",t(function(){e.$apply(function(){e.displayInstallPlugin=!0})},10))}),e.installPlugin=function(){!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.webstore.install("https://chrome.google.com/webstore/detail/webrtc-desktop-sharing/nkemblooioekjnpfekmjhpgkackcajhg",successCallback,failureCallback)},e.selectDevice=function(i){_.each(e.activeDevices,function(e){return e.selected=!1}),e.enableCasting=!1,i.selected=!0,e.device=i},e.connectDevice=function(){console.log("$scope.device: ",e.device),e.device&&(e.device.connected=!0,"audio/mp3"==l.asset_mimetype||"audio/mp4"==l.asset_mimetype?l.asset_type="audio":"video/mp4"==l.asset_mimetype||"video/x-flv"==l.asset_mimetype||"video/x-msvideo"==l.asset_mimetype||"video/x-ms-wmv"==l.asset_mimetype||"video/quicktime"==l.asset_mimetype||"video/3gpp"==l.asset_mimetype?l.asset_type="video":l.asset_type="none",l.deviceUUID=e.device.deviceUUID,l.url=window.location.origin+"/presentation.html?s=tEs$@486759",e.device.asset_file=l,i.close({device:e.device,msg:"mirror"}))},e.cancel=function(){i.dismiss("cancel")},n.on("pair:sendCode",function(i){_.find(e.activeDevices,{deviceUUID:i.deviceUUID})||e.activeDevices.push(i)}),n.on("disconnect",function(e){console.log("disconnect: ",e)})}angular.module("tessaApp").controller("assetsMirrorModalCtrl",e),e.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","socket","activeDevices","asset_file","API_URL","$window"]}();
!function(){"use strict";var r=function(r){return function(t,n){return r.uniqBy(t,function(r){return r[n]})}},t=function(){return function(r,t){for(var n="test",e=0;e<r.length;e++);return n}};angular.module("tessaApp").filter("duplicates",["_",r]).filter("count",[t]).filter("ellipsis",function(){return function(r,t,n,e){if(!r)return"";if(n=parseInt(n,10),!n)return r;if(r.length<=n)return r;if(r=r.substr(0,n),t){var u=r.lastIndexOf(" ");u!=-1&&("."!=r.charAt(u-1)&&","!=r.charAt(u-1)||(u-=1),r=r.substr(0,u))}return r+(e||" ")}}).filter("propsFilter",function(){return function(r,t){var n=[];return angular.isArray(r)?r.forEach(function(r){for(var e=!1,u=Object.keys(t),i=0;i<u.length;i++){var f=u[i],o=t[f].toLowerCase();if(r[f].toString().toLowerCase().indexOf(o)!==-1){e=!0;break}}e&&n.push(r)}):n=r,n}})}();
!function(){"use strict";angular.module("tessaApp").directive("errSrc",function(){return{transclude:!0,link:function(n,t,e){n.$watch(function(){return e.ngSrc},function(n){n||t.attr("src",e.errSrc)}),t.bind("error",function(){t.attr("src",e.errSrc)})}}}).directive("ngPrint",function(){function n(n,r,i){r.on("click",function(){var n=document.getElementById(i.printElementId);n&&t(n)}),window.onafterprint=function(){e.innerHTML=""}}function t(n){var t=n.cloneNode(!0);e.innerHTML="",e.appendChild(t),window.print()}var e=document.getElementById("printSection");return e||(e=document.createElement("div"),e.id="printSection",document.body.appendChild(e)),{link:n,restrict:"A"}}).directive("appHeader",function(){return{restrict:"AE",replace:!0,templateUrl:"./views/header.html",controller:"headerCtrl"}}).directive("imageonload",function(){return{restrict:"AE",link:function(n,t,e){t.on("load",function(){t.removeClass("spinner-hide"),t.addClass("spinner-show"),t.parent().find("span").remove()}),n.$watch("ngSrc",function(){t.addClass("spinner-hide")})}}}).directive("lightboxDirective",function(){return{restrict:"E",transclude:!0,template:"<section ng-transclude></section>"}}).directive("ngScrollEvent",["$parse","$window",function(n,t){return function(e,r,i){var c,o,l=n(i.ngScrollEvent),d=r[0],u="scroll",a={x:0,y:0},s=function(){o=function(n){a.x=d.scrollLeft,a.y=d.scrollTop,f(n),p(),v(n,!1)},r.bind(u,o)},f=function(n){c=t.setInterval(function(){a.x==d.scrollLeft&&a.y==d.scrollTop?(t.clearInterval(c),s(),v(n,!0)):(a.x=d.scrollLeft,a.y=d.scrollTop)},INTERVAL_DELAY)},p=function(){r.unbind(u,o)},v=function(n,t){e.$apply(function(){l(e,{$event:n,isEndEvent:t})})};s()}}])}();
angular.module("infinite-scroll",[]).value("THROTTLE_MILLISECONDS",null).directive("infiniteScroll",["$rootScope","$window","$interval","THROTTLE_MILLISECONDS",function(n,e,t,i){return{scope:{infiniteScroll:"&",infiniteScrollContainer:"=",infiniteScrollDistance:"=",infiniteScrollDisabled:"=",infiniteScrollUseDocumentBottom:"=",infiniteScrollListenForEvent:"@"},link:function(l,o,r){var c,u,f,a,d,s,m,S,p,g,$,v,w,D,h,E,T,y,C;return C=angular.element(e),D=null,h=null,f=null,a=null,$=!0,y=!1,T=null,u=!1,g=function(n){return n=n[0]||n,isNaN(n.offsetHeight)?n.document.documentElement.clientHeight:n.offsetHeight},v=function(n){if(n[0].getBoundingClientRect&&!n.css("none"))return n[0].getBoundingClientRect().top+w(n)},w=function(n){return n=n[0]||n,isNaN(window.pageYOffset)?n.document.documentElement.scrollTop:n.ownerDocument.defaultView.pageYOffset},p=function(){var e,i,r,c,d;return a===C?(e=g(a)+w(a[0].document.documentElement),r=v(o)+g(o)):(e=g(a),i=0,void 0!==v(a)&&(i=v(a)),r=v(o)-i+g(o)),y&&(r=g((o[0].ownerDocument||o[0].document).documentElement)),c=r-e,d=c<=g(a)*D+1,d?(f=!0,h?l.$$phase||n.$$phase?l.infiniteScroll():l.$apply(l.infiniteScroll):void 0):(u&&t.cancel(u),f=!1)},E=function(n,e){var i,l,o;return o=null,l=0,i=function(){return l=(new Date).getTime(),t.cancel(o),o=null,n.call()},function(){var r,c;return r=(new Date).getTime(),c=e-(r-l),c<=0?(t.cancel(o),o=null,l=r,n.call()):o?void 0:o=t(i,c,1)}},null!=i&&(p=E(p,i)),l.$on("$destroy",function(){if(a.unbind("scroll",p),null!=T&&(T(),T=null),u)return t.cancel(u)}),m=function(n){return D=parseFloat(n)||0},l.$watch("infiniteScrollDistance",m),m(l.infiniteScrollDistance),s=function(n){if(h=!n,h&&f)return f=!1,p()},l.$watch("infiniteScrollDisabled",s),s(l.infiniteScrollDisabled),S=function(n){return y=n},l.$watch("infiniteScrollUseDocumentBottom",S),S(l.infiniteScrollUseDocumentBottom),c=function(n){if(null!=a&&a.unbind("scroll",p),a=n,null!=n)return a.bind("scroll",p)},c(C),l.infiniteScrollListenForEvent&&(T=n.$on(l.infiniteScrollListenForEvent,p)),d=function(n){if(null!=n&&0!==n.length){if(n.nodeType&&1===n.nodeType?n=angular.element(n):"function"==typeof n.append?n=angular.element(n[n.length-1]):"string"==typeof n&&(n=angular.element(document.querySelector(n))),null!=n)return c(n);throw new Error("invalid infinite-scroll-container attribute.")}},l.$watch("infiniteScrollContainer",d),d(l.infiniteScrollContainer||[]),null!=r.infiniteScrollParent&&c(angular.element(o.parent())),null!=r.infiniteScrollImmediateCheck&&($=l.$eval(r.infiniteScrollImmediateCheck)),u=t(function(){return $&&p(),t.cancel(u)})}}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="infinite-scroll");
!function(){"use strict";function n(n,t,u,l,o){var c={};return c.articleItems=[],c.allitems=[],c.getArticles=function(n){o.all("articleinfo").customGET().then(function(t){n(t)})},c.getArticleDetail=function(n,t){o.all("articleinfo").customGET(n).then(function(n){t(n)})},c.getArticleTags=function(n,t){o.all("article/"+n+"/tags").customGET().then(function(n){t(n)})},c.getProductBundle=function(n){o.all("product-bundle").customGET().then(function(t){n(t)})},c.getAllTags=function(n){o.all("tags").customGET().then(function(t){n(t)})},c.getDetailSolution=function(n,t){o.all("product-bundle/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getProductDetail=function(n,t){o.all("product/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getProduct=function(n){o.all("product").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.searchProduct=function(n,u){var l=t.filter(c.allitems,function(t){var u=new RegExp(n,"ig");return t.item_name.match(u)});u(l)},c.getHardware=function(n,u){o.all("product").customGET().then(function(l){u(t.filter(l),{productType_id:n})})},c.getCategory=function(n){o.all("categories").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.getProductType=function(n){o.all("producttype").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.getAll=function(n){return o.all("filters").customGET("",{filter:"all",value:n}).then(function(n){return n},function(n){return n.data})},c.getAllPerson=function(n){o.all("persons").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.personDetail=function(n,t){o.all("persons/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getProductAttribute=function(n,t){o.all("product/"+n+"/attributes").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.saveCompany=function(n,t){o.all("companyinfo").customPOST(n).then(function(n){t(null,n)},function(n){t(n,null)})},c.getCompany=function(n){o.all("companyinfo").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.companyDetail=function(n,t){o.all("companyinfo/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.saveQuote=function(n,t){o.all("quoteinfo/").customPOST(n).then(function(n){t(null,n)},function(n){t(n,null)})},c.getQuoteDetail=function(n,t){o.all("quoteinfo/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getCountries=function(n){o.all("countries").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.getProdCateg=function(n,t){o.all("product/"+n+"/category").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getRelatedProduct=function(n,t){o.all("product/"+n+"/related").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getRelatedSolutions=function(n,t){o.all("product-bundle/"+n+"/related").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c}angular.module("tessaApp").factory("APIFactory",n),n.$inject=["$http","_","API_URL","API_VERSION","Restangular"]}();
!function(){"use strict";function e(e,t,r,n,o,a,u,s){return{authenticateAccount:function(e){return o.all("session").customPOST(e).then(function(e){return e},function(e){return e.data})},setUserToken:function(e){a.set("token",e)},getUserToken:function(){return a.get("token")},setCurrentUser:function(e){a.set("appuser",JSON.stringify(e))},getCurrentUser:function(){return a.get("appuser")},logout:function(){return o.all("session").customDELETE().then(function(e){return a.remove("Cart"),a.remove("label"),a.remove("hardtype"),a.remove("Payment"),a.remove("token"),a.remove("appuser"),s.signOut(),e},function(e){return e.data})}}}function t(e,t,r,n,o,a,u){return{request:function(e){if(e.headers=e.headers||{},e.headers.accesskey=o,a.get("token")){var t=a.get("token");JSON.parse(a.get("user"));e.headers.Authorization="Bearer "+t}return e},response:function(e){if(a.get("token")){var t=a.get("token");u.isTokenExpired(t)&&(a.remove("Cart"),a.remove("label"),a.remove("hardtype"),a.remove("Payment"),a.remove("token"),a.remove("appuser"),r.path("/login"))}return e},responseError:function(t){return 401===t.status&&(e.$broadcast("unauthorized"),r.path("/login")),t}}}function r(e,t){var r=0;return{request:function(n){return 1===++r&&t.$broadcast("loading:progress"),n||e.when(n)},response:function(n){return 0===--r&&t.$broadcast("loading:finish"),n||e.when(n)},responseError:function(n){return 0===--r&&t.$broadcast("loading:finish"),e.reject(n)}}}angular.module("tessaApp").factory("authInterceptor",t).factory("AuthFactory",e).factory("httpInterceptor",r),t.$inject=["$rootScope","$q","$location","$injector","ACCESSKEY","localStorageService","jwtHelper"],e.$inject=["$http","_","API_URL","API_VERSION","Restangular","localStorageService","$q","$frontierAnalytics"],r.$inject=["$q","$rootScope"]}();
!function(){"use strict";function n(n,t,u,l,a){return{shareExperience:function(n,t){a.all("sharer").customPOST(n).then(function(n){t(null,n)},function(n){t(n.data,null)})},htmltoPDF:function(n,t){a.all("htmltopdf").customPOST(n).then(function(n){t(null,n)},function(n){t(n.data,null)})},sendMail:function(n,t){a.all("sendMail").customPOST(n).then(function(n){t(null,n)},function(n){t(n.data,null)})}}}angular.module("tessaApp").factory("sharerFactory",n).factory("_",["$window",function(n){return n._}]),n.$inject=["$http","_","API_URL","API_VERSION","Restangular"]}();
!function(){function t(t,n,e){return{getAllAssets:function(){return t.all("assets").customGET().then(function(t){return t},function(t){return t.data})},deleteAssetFile:function(n){return t.all("assets").customDELETE(n).then(function(t){return t},function(t){return t.data})},trashAssetFile:function(n){return t.all("assets/"+n+"/trash").customDELETE().then(function(t){return t},function(t){return t.data})},starredAssetFile:function(n){return t.all("assets/"+n+"/starred").customPUT().then(function(t){return t},function(t){return t.data})},restoreAssetFile:function(n){return t.all("assets/"+n+"/restore").customPUT().then(function(t){return t},function(t){return t.data})},moveAssetFile:function(n,e){return t.all("assets/"+n+"/move/"+e).customPUT().then(function(t){return t},function(t){return t.data})},updateAssetFile:function(n,e){return t.all("assets/"+n).customPUT(e).then(function(t){return t},function(t){return t.data})},getFolderAssets:function(n){return t.all("assets_folders").customGET(n).then(function(t){return t},function(t){return t.data})},createFolder:function(n){return t.all("assets_folders").customPOST(n).then(function(t){return t},function(t){return t.data})},deleteFolder:function(n){return t.all("assets_folders").customDELETE(n).then(function(t){return t},function(t){return t.data})},trashFolder:function(n){return t.all("assets_folders/"+n+"/trash").customDELETE().then(function(t){return t},function(t){return t.data})},starredFolder:function(n){return t.all("assets_folders/"+n+"/starred").customPUT().then(function(t){return t},function(t){return t.data})},restoreFolder:function(n){return t.all("assets_folders/"+n+"/restore").customPUT().then(function(t){return t},function(t){return t.data})},moveFolder:function(n,e){return t.all("assets_folders/"+n+"/move/"+e).customPUT().then(function(t){return t},function(t){return t.data})},updateFolder:function(n,e){return t.all("assets_folders/"+n).customPUT(e).then(function(t){return t},function(t){return t.data})}}}angular.module("tessaApp").factory("assetsFctry",t),t.$inject=["Restangular","API_URL","toastr"]}();
!function(){"use strict";angular.module("tessaApp").factory("socket",["socketFactory","API_URL",function(t,o){var c=io.connect(o),e=t({ioSocket:c});return e}])}();
var isChrome=!!navigator.webkitGetUserMedia,DetectRTC={};!function(){var e;DetectRTC.screen={chromeMediaSource:"screen",getSourceId:function(t){if(!t)throw'"callback" parameter is mandatory.';e=t,window.postMessage("get-sourceId","*")},isChromeExtensionAvailable:function(e){if(e){if("desktop"==DetectRTC.screen.chromeMediaSource)return e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"==DetectRTC.screen.chromeMediaSource?!1:!0)},2e3)}},onMessageCallback:function(t){if("string"==typeof t||t.sourceId){if("PermissionDeniedError"==t){if(DetectRTC.screen.chromeMediaSource="PermissionDeniedError",e)return e("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==t&&(console.log('<strong>Great!</strong> <a href="https://chrome.google.com/webstore/detail/tessa-presentation/klaagnfcilpkdeicdamepejjmaoahple" target="_blank">Google chrome extension</a> is installed.'),DetectRTC.screen.chromeMediaSource="desktop"),t.sourceId&&(DetectRTC.screen.sourceId=t.sourceId,e&&e(DetectRTC.screen.sourceId))}},getChromeExtensionStatus:function(e){if(navigator.mozGetUserMedia)return e("not-chrome");var t=document.createElement("img");t.src="https://raw.githubusercontent.com/4LOOPph/desktopCapture-p2p/master/images/desktopCapture48.png",t.onload=function(){DetectRTC.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){DetectRTC.screen.notInstalled||e("installed-enabled")},2e3)},t.onerror=function(){DetectRTC.screen.notInstalled=!0,e("not-installed")}}},window.postMessage&&isChrome&&DetectRTC.screen.isChromeExtensionAvailable()}(),window.addEventListener("message",function(e){e.origin==window.location.origin&&DetectRTC.screen.onMessageCallback(e.data)});
!function(){function e(e,n){function u(n){return n.data.checkingPresence&&e.channels[n.userid]?void e.channels[n.userid].send({presenceDetected:!0}):n.data.presenceDetected&&e.peers[n.userid]?void(e.peers[n.userid].connected=!0):void("text"===n.data.type?ee.receive(n.data,n.userid,n.extra):e.autoTranslateText?(n.original=n.data,e.Translator.TranslateText(n.data,function(t){n.data=t,e.onmessage(n)})):e.onmessage(n))}function M(n){return e.skipOnNewSession||(n.session||(n.session={}),n.extra||(n.extra={}),e.sessionid&&n.sessionid!=e.sessionid)?void 0:e.onNewSession?(n.join=function(t){if(!t)return e.join(n);for(var i in t)n.session[i]=t[i];var o=e.dontCaptureUserMedia;e.dontCaptureUserMedia=!1,e.captureUserMedia(function(){e.dontCaptureUserMedia=!0,e.join(n),e.dontCaptureUserMedia=o},t)},n.extra||(n.extra={}),e.onNewSession(n)):void e.join(n)}function O(n){for(var t=0;t<e.localStreamids.length;t++){var i=e.localStreamids[t];e.streams[i]&&e.streams[i].sockets.push(n)}}function E(n){function t(n){return H||W||o(e.waitUntilRemoteStreamStartsFlowing)||!e.waitUntilRemoteStreamStartsFlowing?l(n):(n.numberOfTimes||(n.numberOfTimes=0),n.numberOfTimes++,n.mediaElement.readyState<=HTMLMediaElement.HAVE_CURRENT_DATA||n.mediaElement.paused||n.mediaElement.currentTime<=0?n.numberOfTimes>=60?U.send({failedToReceiveRemoteVideo:!0,streamid:n.stream.streamid}):void setTimeout(function(){m("Waiting for incoming remote stream to be started flowing: "+n.numberOfTimes+" seconds."),t(n)},900):l(n))}function d(){if(e.fakeDataChannels&&!e.channels[n.userid]&&!e.session.data){var t={send:function(e){U.send({fakeData:e})},readyState:"open"};e.channels[n.userid]={channel:t,send:function(e){this.channel.send(e)}},B.onopen(t)}}function l(t){var i=t.mediaElement,o=t.session,s=t.stream;s.onended=function(){a.mediaElement&&!a.mediaElement.parentNode&&document.getElementById(s.streamid)&&(a.mediaElement=document.getElementById(s.streamid)),g(a,e)};var a={mediaElement:i,stream:s,streamid:s.streamid,session:o||e.session,blobURL:W?"":i.mozSrcObject?URL.createObjectURL(s):i.src,type:"remote",extra:n.extra,userid:n.userid,isVideo:W?!!o.video:!!s.isVideo,isAudio:W?!!o.audio&&!o.video:!!s.isAudio,isScreen:!!s.isScreen,isInitiator:!!n.isInitiator,rtcMultiConnection:e,socket:U};if(e.streams[s.streamid]=e._getStream(a),e.onstream(a),!r(t.preMuted)&&(t.preMuted.audio||t.preMuted.video)){var d=b({},a);d.session=b(d.session,t.preMuted),d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!1,e.onmute(d)}m("on:add:stream",a),x(),e.onspeaking&&D({stream:s,streamedObject:a,connection:e})}function C(t){n.channel=t,e.channels[n.userid]={channel:n.channel,send:function(n){e.send(n,this.channel)}},e.onopen({extra:n.extra,userid:n.userid,channel:t});for(var o in e.fileQueue)e.send(e.fileQueue[o],t);i(e.session)&&x(),e.partOfScreen&&e.partOfScreen.sharing&&e.peers[n.userid].sharePartOfScreen(e.partOfScreen)}function R(){U.userid!=n.userid&&(U.userid=n.userid,K[n.socketIndex]=U,e.numberOfConnectedUsers++,e.peers[n.userid]={socket:U,peer:N,userid:n.userid,extra:n.extra,userinfo:n.userinfo,addStream:function(n){e.addStream(n,this.socket)},removeStream:function(n){return e.streams[n]?(this.peer.connection.removeStream(e.streams[n].stream),void this.renegotiate()):f("No such stream exists. Stream-id:",n)},renegotiate:function(n,t){e.renegotiate(n,t)},changeBandwidth:function(e){if(!e)throw"You MUST pass bandwidth object.";if(s(e))throw"Pass object for bandwidth instead of string; e.g. {audio:10, video:20}";this.peer.bandwidth=e,this.socket.send({changeBandwidth:!0,bandwidth:e})},sendCustomMessage:function(e){this.socket.send({customMessage:!0,message:e})},onCustomMessage:function(e){m('Received "private" message from',this.userid,s(e)?e:p(e))},drop:function(n){for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],t.userid==e.userid&&"local"==t.type&&(this.peer.connection.removeStream(t.stream),g(t,e)),"remote"==t.type&&t.userid==this.userid&&g(t,e));!n&&this.socket.send({drop:!0})},hold:function(n){return"answer"==N.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({hold:!0,holdMLine:n||"both"}),this.peer.hold=!0,void this.fireHoldUnHoldEvents({kind:n,isHold:!0,userid:e.userid,remoteUser:this.userid}))},unhold:function(n){return"answer"==N.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({unhold:!0,holdMLine:n||"both"}),this.peer.hold=!1,void this.fireHoldUnHoldEvents({kind:n,isHold:!1,userid:e.userid,remoteUser:this.userid}))},fireHoldUnHoldEvents:function(n){var t=n.isHold,i=n.kind,o=n.remoteUser||n.userid;for(var s in e.streams)-1==e._skip.indexOf(s)&&(s=e.streams[s],s.userid==o&&(t&&e.onhold(b({kind:i},s)),t||e.onunhold(b({kind:i},s))))},redial:function(){for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],n.userid==this.userid&&"remote"==n.type&&g(n,e));m("ReDialing..."),U.send({recreatePeer:!0}),N=new A,N.create("offer",B)},sharePartOfScreen:function(n){function t(){return i.stopPartOfScreenSharing?(i.stopPartOfScreenSharing=!1,void(e.onpartofscreenstopped&&e.onpartofscreenstopped())):i.pausePartOfScreenSharing?(e.onpartofscreenpaused&&e.onpartofscreenpaused(),setTimeout(t,n.interval||200)):void T({element:n.element,connection:e,callback:function(s){if(!e.channels[i.userid])throw"No such data channel exists.";s!=o&&(o=s,e.channels[i.userid].send({screenshot:s,isPartOfScreen:!0})),!n.once&&setTimeout(t,n.interval||200)}})}var i=this,o="";t()},getConnectionStats:function(n,t){function i(){re.prototype.getConnectionStats=window.getConnectionStats,N.connection&&N.connection.getConnectionStats(n,t)}if(!n)throw"callback is mandatory.";window.getConnectionStats?i():y(e.resources.getConnectionStats,i)},takeSnapshot:function(n){w({userid:this.userid,connection:e,callback:n})}})}function x(){if(e.isInitiator&&h(Z)&&h(Z)<=e.maxParticipantsAllowed&&(e.session.oneway||e.session.broadcast||ne.send({sessionid:e.sessionid,newParticipant:n.userid||U.channel,userData:{userid:n.userid||U.channel,extra:n.extra}})),"chrome"==n.userinfo.browser&&!n.renegotiatedOnce)for(var t in e.renegotiatedSessions)n.renegotiatedOnce=!0,e.renegotiatedSessions[t]&&e.renegotiatedSessions[t].stream&&e.peers[n.userid].renegotiate(e.renegotiatedSessions[t].stream,e.renegotiatedSessions[t].session)}function M(t){if(!te&&t.userid!=e.userid){if(t.sdp){n.userid=t.userid,n.extra=t.extra||{},n.renegotiate=t.renegotiate,n.streaminfo=t.streaminfo,n.isInitiator=t.isInitiator,n.userinfo=t.userinfo;var i=JSON.parse(t.sdp);"offer"==i.type&&(B.preferSCTP=!!t.preferSCTP,e.fakeDataChannels=!!t.fakeDataChannels),d(),E(i,t.labels)}if(t.candidate&&N&&N.addIceCandidate(JSON.parse(t.candidate)),t.streamid&&($.streamids||($.streamids={}),$.streamids[t.streamid]||($.streamids[t.streamid]=t.streamid,e.onstreamid(t))),t.mute||t.unmute)if(t.promptMuteUnmute){if(!e.privileges.canMuteRemoteStream)return void e.onstatechange({userid:t.userid,extra:t.extra,name:"mute-request-denied",reason:t.userid+' tried to mute your stream; however "privileges.canMuteRemoteStream" is "false".'});e.streams[t.streamid]&&(t.mute&&!e.streams[t.streamid].muted&&e.streams[t.streamid].mute(t.session),t.unmute&&e.streams[t.streamid].muted&&e.streams[t.streamid].unmute(t.session))}else{var o={};e.streams[t.streamid]&&(o=e.streams[t.streamid]);var s=t.session,r=b({},o);r.session=s,r.isAudio=!!r.session.audio&&!r.session.video,r.isVideo=!!r.session.video,r.isScreen=!!r.session.screen,t.mute&&e.onmute(r||t),t.unmute&&e.onunmute(r||t)}if(t.isVolumeChanged&&(m("Volume of stream: "+t.streamid+" has changed to: "+t.volume),e.streams[t.streamid])){var a=e.streams[t.streamid].mediaElement;a&&(a.volume=t.volume)}if(t.stopped&&e.streams[t.streamid]&&g(e.streams[t.streamid],e),t.promptStreamStop){if(!e.privileges.canStopRemoteStream)return void e.onstatechange({userid:t.userid,extra:t.extra,name:"stop-request-denied",reason:t.userid+' tried to stop your stream; however "privileges.canStopRemoteStream" is "false".'});f("Remote stream has been manually stopped!"),e.streams[t.streamid]&&e.streams[t.streamid].stop()}if(t.left){if(V){var u=t.userid;for(var l in e.streams)l=e.streams[l],l.userid==u&&(e.stopMediaStream(l),g(l,e))}if(N&&N.connection&&("closed"!=N.connection.signalingState&&-1==N.connection.iceConnectionState.search(/disconnected|failed/gi)&&N.connection.close(),N.connection=null),Z[t.userid]&&delete Z[t.userid],t.closeEntireSession)return e.onSessionClosed(t),void e.leave();e.remove(t.userid),S({userid:t.userid,extra:t.extra||{},entireSessionClosed:!!t.closeEntireSession},e)}if(t.playRoleOfBroadcaster&&(t.extra&&(e.extra=b(e.extra,t.extra)),t.participants&&(Z=t.participants,Z[e.userid]&&delete Z[e.userid],K[0]&&K[0].userid==t.userid&&(delete K[0],K=c(K)),X[t.userid]&&delete X[t.userid]),setTimeout(e.playRoleOfInitiator,2e3)),t.changeBandwidth){if(!e.peers[t.userid])throw"No such peer exists.";e.peers[t.userid].peer.bandwidth=t.bandwidth,e.peers[t.userid].renegotiate()}if(t.customMessage){if(!e.peers[t.userid])throw"No such peer exists.";if(t.message.ejected){if(e.sessionDescriptions[e.sessionid].userid!=t.userid)throw"only initiator can eject a user.";e.leave(),e.onSessionClosed({userid:t.userid,extra:t.extra||n.extra,isEjected:!0})}else e.peers[t.userid].onCustomMessage(t.message)}if(t.drop){if(!e.peers[t.userid])throw"No such peer exists.";e.peers[t.userid].drop(!0),e.peers[t.userid].renegotiate(),e.ondrop(t.userid)}if(t.hold||t.unhold){if(!e.peers[t.userid])throw"No such peer exists.";if(t.takeAction)return void e.peers[t.userid][t.hold?"hold":"unhold"](t.holdMLine);e.peers[t.userid].peer.hold=!!t.hold,e.peers[t.userid].peer.holdMLine=t.holdMLine,U.send({isRenegotiate:!0}),e.peers[t.userid].fireHoldUnHoldEvents({kind:t.holdMLine,isHold:!!t.hold,userid:t.userid})}t.isRenegotiate&&e.peers[t.userid].renegotiate(null,e.peers[t.userid].peer.session),t.fakeData&&B.onmessage(t.fakeData),t.recreatePeer&&(N=new A),t.failedToReceiveRemoteVideo&&(m("Remote peer hasn't received stream: "+t.streamid+". Renegotiating..."),e.peers[t.userid]&&e.peers[t.userid].renegotiate()),t.redial&&e.peers[t.userid]&&("disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState&&(n.redialing=!1),"disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState||n.redialing||(n.redialing=!0,f("Peer connection is closed.",p(e.peers[t.userid].peer.connection),"ReDialing.."),e.peers[t.userid].redial()))}}function E(t,o){function s(){N.recreateAnswer(t,r,function(n,t){L({sdp:n,socket:U,streaminfo:t}),e.detachStreams=[]})}if("answer"==t.type)return N.setRemoteDescription(t),void R();if(!n.renegotiate&&"offer"==t.type)return B.offerDescription=t,B.session=e.session,N||(N=new A),N.create("answer",B),void R();var r=n.renegotiate;if(P(o,N.connection),r.oneway||i(r))s(),delete n.renegotiate;else{if(n.capturing)return;n.capturing=!0,e.captureUserMedia(function(t){n.capturing=!1,N.addStream(t),e.renegotiatedSessions[JSON.stringify(n.renegotiate)]={session:n.renegotiate,stream:t},delete n.renegotiate,s()},n.renegotiate)}}var I={channel:n.channel,onmessage:M,onopen:function(t){t&&(U=t),F&&!N&&(B.session=e.session,N||(N=new A),N.create("offer",B)),n.socketIndex=U.index=K.length,X[I.channel]=U,K[n.socketIndex]=U,O(U),U.__push||(U.__push=U.send,U.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},U.__push(n)})}};I.callback=function(e){U=e,I.onopen()};var U=e.openSignalingChannel(I);U&&I.onopen(U);var N,F=n.isofferer,B={onopen:C,onicecandidate:function(n){if(!e.candidates)throw"ICE candidates are mandatory.";if(!e.iceProtocols)throw"At least one must be true; UDP or TCP.";var t=e.candidates,i=t.stun,s=t.turn;if(o(t.reflexive)||(i=t.reflexive),o(t.relay)||(s=t.relay),(t.host||!n.candidate.match(/a=candidate.*typ host/g))&&!(!s&&n.candidate.match(/a=candidate.*typ relay/g)||!i&&n.candidate.match(/a=candidate.*typ srflx/g))){var r=e.iceProtocols;(r.udp||!n.candidate.match(/a=candidate.* udp/g))&&(r.tcp||!n.candidate.match(/a=candidate.* tcp/g))&&(window.selfNPObject||(window.selfNPObject=n),U&&U.send({candidate:JSON.stringify({candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex})}))}},onmessage:function(t){if(t){var i=a(t);if(-1!=i.indexOf('"userid":'))i=JSON.parse(i),u(i);else if(t instanceof ArrayBuffer||t instanceof DataView){if(!e.enableFileSharing)throw'It seems that receiving data is either "Blob" or "File" but file sharing is disabled.';if(!$.fileBufferReader){var o=this;return void k(e,function(e){$.fileBufferReader=e,o.onmessage(t)})}var s=$.fileBufferReader;return void s.convertToObject(t,function(t){return t.maxChunks||t.readyForNextChunk?t.readyForNextChunk?void s.getNextChunk(t.uuid,function(e,n,t){$.send(e)}):void s.addChunk(t,function(e){$.send(e)}):void e.onmessage({data:t,userid:n.userid,extra:n.extra})})}}},onaddstream:function(o,s){function r(){setTimeout(function(){u.muted=!1,l({mediaElement:u,session:s,stream:o,preMuted:a})},3e3),u.removeEventListener("play",r)}if(s=s||n.renegotiate||e.session,!i(s)){s.screen&&(s.audio||s.video)&&(n.gotAudioOrVideo?(s.audio=!1,s.video=!1):(n.gotAudioOrVideo=!0,s.screen=!1));var a={};if(n.streaminfo){var d=n.streaminfo.split("----"),c=JSON.parse(d[d.length-1]);j||(o.streamid=c.streamid,o.isScreen=!!c.isScreen,o.isVideo=!!c.isVideo,o.isAudio=!!c.isAudio,a=c.preMuted),d.pop(),n.streaminfo=d.join("----")}var u=v(o,b({remote:!0},s));return e.setDefaultEventsForMediaElement&&e.setDefaultEventsForMediaElement(u,o.streamid),W||o.getVideoTracks().length?void t({mediaElement:u,session:s,stream:o,preMuted:a}):u.addEventListener("play",r,!1)}},onremovestream:function(n){n&&n.streamid?(n=e.streams[n.streamid],n&&(m("on:stream:ended via on:remove:stream",n),g(n,e))):m("on:remove:stream",n)},onclose:function(t){t.extra=n.extra,t.userid=n.userid,e.onclose(t),e.channels[t.userid]&&delete e.channels[t.userid]},onerror:function(t){t.extra=n.extra,t.userid=n.userid,e.onerror(t)},oniceconnectionstatechange:function(t){m("oniceconnectionstatechange",p(t)),N.connection&&"connected"==N.connection.iceConnectionState&&"complete"==N.connection.iceGatheringState&&"stable"==N.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onconnected({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),!e.isInitiator&&N.connection&&"connected"==N.connection.iceConnectionState&&"complete"==N.connection.iceGatheringState&&"stable"==N.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onstatechange({userid:n.userid,extra:n.extra,name:"connected-with-initiator",reason:"ICE connection state seems connected; gathering state is completed; and signaling state is stable."}),e.peers[n.userid]&&e.peers[n.userid].oniceconnectionstatechange&&e.peers[n.userid].oniceconnectionstatechange(t),e.peers[n.userid]&&"failed"==e.peers[n.userid].peer.connection.iceConnectionState&&e.onfailed({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),e.peers[n.userid]&&"disconnected"==e.peers[n.userid].peer.connection.iceConnectionState&&(!N.connection.renegotiate&&e.ondisconnected({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),N.connection.renegotiate=!1),e.autoReDialOnFailure&&e.peers[n.userid]&&("disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState&&(n.redialing=!1),"disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState||n.redialing||(n.redialing=!0,f("Peer connection is closed.",p(e.peers[n.userid].peer.connection),"ReDialing.."),e.peers[n.userid].socket.send({redial:!0}),e.streams.remove({remote:!0,userid:n.userid})))},onsignalingstatechange:function(e){m("onsignalingstatechange",p(e))},attachStreams:e.dontAttachStream?[]:e.attachStreams,iceServers:e.iceServers,rtcConfiguration:e.rtcConfiguration,bandwidth:e.bandwidth,sdpConstraints:e.sdpConstraints,optionalArgument:e.optionalArgument,disableDtlsSrtp:e.disableDtlsSrtp,dataChannelDict:e.dataChannelDict,preferSCTP:e.preferSCTP,onSessionDescription:function(e,n){L({sdp:e,socket:U,streaminfo:n})},trickleIce:e.trickleIce,processSdp:e.processSdp,sendStreamId:function(e){U&&U.send({streamid:e.streamid,isScreen:!!e.isScreen,isAudio:!!e.isAudio,isVideo:!!e.isVideo})},rtcMultiConnection:e};e.playRoleOfInitiator=function(){e.dontCaptureUserMedia=!0,e.open(),K=c(K),e.dontCaptureUserMedia=!1},e.askToShareParticipants=function(){ne&&ne.send({askToShareParticipants:!0})},e.shareParticipants=function(n){var t={joinUsers:Z,userid:e.userid,extra:e.extra};n&&(n.dontShareWith&&(t.dontShareWith=n.dontShareWith),n.shareWith&&(t.shareWith=n.shareWith)),ne.send(t)}}function P(n,t){if(n)for(var i=0;i<n.length;i++){var o=n[i];e.streams[o]&&t.removeStream(e.streams[o].stream)}}function L(n){n.socket.send({sdp:JSON.stringify({sdp:n.sdp.sdp,type:n.sdp.type}),renegotiate:!!n.renegotiate&&n.renegotiate,streaminfo:n.streaminfo||"",labels:n.labels||[],preferSCTP:!!e.preferSCTP,fakeDataChannels:!!e.fakeDataChannels,isInitiator:!!e.isInitiator,userinfo:{browser:V?"firefox":"chrome"}})}function F(n){var t=n.newParticipant;if(t&&!Z[t]&&t!=e.userid){var i=e.token();E({channel:i,extra:n.userData?n.userData.extra:n.extra,userid:n.userData?n.userData.userid:n.userid}),ne.send({participant:!0,targetUser:t,channel:i})}}function B(){e.numberOfConnectedUsers--;var n={left:!0,extra:e.extra||{},userid:e.userid,sessionid:e.sessionid};e.isInitiator&&(e.autoCloseEntireSession?n.closeEntireSession=!0:K[0]&&K[0].send({playRoleOfBroadcaster:!0,userid:e.userid,extra:e.extra,participants:Z})),K.forEach(function(e,t){e.send(n),X[e.channel]&&delete X[e.channel],delete K[t]}),K=c(K),e.refresh(),N.forEach(function(e){e.disconnect()}),N=[]}function _(){$.signalingReady||($.signalingReady=!0,setTimeout(n,1e3),e.isInitiator||ne&&ne.send({searchingForRooms:!0}))}function q(n){for(var t in n)Z[n[t]]||F({sessionid:e.sessionid,newParticipant:n[t],userid:e.userid,extra:e.extra})}function z(){return e.openSignalingChannel({onmessage:function(n){if(!te&&n.userid!=e.userid){if(n.sessionid&&n.userid&&(e.sessionDescriptions[n.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[n.sessionid]=n,e.isAcceptNewSession&&(e.dontOverrideSession||(e.session=n.session),M(n)))),n.newParticipant&&!e.isAcceptNewSession&&$.broadcasterid===n.userid&&n.newParticipant!=e.userid&&F(n),h(Z)<e.maxParticipantsAllowed&&n.targetUser==e.userid&&n.participant){if(e.peers[n.userid]&&!e.peers[n.userid].peer)return delete Z[n.userid],delete e.peers[n.userid],e.isAcceptNewSession=!0,Y(n);Z[n.userid]||Y(n)}if(n.acceptedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-accepted",reason:n.userid+" accepted your participation request."}),n.rejectedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-rejected",reason:n.userid+" rejected your participation request."}),n.customMessage)if(n.message.drop){e.ondrop(n.userid),e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),g(t,e)):g(t,e));n.message.renegotiate&&e.renegotiate()}else e.onCustomMessage&&e.onCustomMessage(n.message);if(e.isInitiator&&n.searchingForRooms&&ne&&ne.send({sessionDescription:e.sessionDescription,responseFor:n.userid}),n.sessionDescription&&n.responseFor==e.userid){var i=n.sessionDescription;e.sessionDescriptions[i.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[i.sessionid]=i)}e.isInitiator&&n.askToShareParticipants&&ne&&e.shareParticipants({shareWith:n.userid}),n.shareWith==e.userid&&n.dontShareWith!=e.userid&&n.joinUsers&&q(n.joinUsers),!n.shareWith&&n.joinUsers&&(n.dontShareWith?e.userid!=n.dontShareWith&&q(n.joinUsers):q(n.joinUsers)),n.messageFor==e.userid&&n.presenceState&&("checking"==n.presenceState&&(ne.send({messageFor:n.userid,presenceState:"available",_config:n._config}),m("participant asked for availability")),"available"==n.presenceState&&($.presenceState="available",e.onstatechange({userid:"browser",extra:{},name:"room-available",reason:"Initiator is available and room is active."}),J(n._config))),n.donotJoin&&n.messageFor==e.userid&&m(n.userid,"is not joining your room."),n.isDisconnectSockets&&(m("Disconnecting your sockets because initiator also disconnected his sockets."),e.disconnect())}},callback:function(e){e&&this.onopen(e)},onopen:function(n){n&&(ne=n),_&&_(),$.defaultSocket=ne,ne.__push||(ne.__push=ne.send,ne.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},ne.__push(n)})}})}function G(){var n=0;256!=e.maxParticipantsAllowed&&(n=e.maxParticipantsAllowed),"one-way"==e.direction&&(e.session.oneway=!0),"one-to-one"==e.direction&&(e.maxParticipantsAllowed=1),"one-to-many"==e.direction&&(e.session.broadcast=!0),"many-to-many"==e.direction&&(e.maxParticipantsAllowed&&1!=e.maxParticipantsAllowed||(e.maxParticipantsAllowed=256)),n&&1!=e.maxParticipantsAllowed&&(e.maxParticipantsAllowed=n)}function J(n,i){if(!$.donotJoin||$.donotJoin!=n.sessionid){e.dontOverrideSession||(e.session=n.session||{}),$.broadcasterid=n.userid,n.sessionid&&(e.sessionid=n.sessionid),e.isAcceptNewSession=!1;var o=t();E({channel:o,extra:n.extra||{},userid:n.userid});var s={};if(e.attachStreams.length){var a=e.attachStreams[e.attachStreams.length-1];a.getAudioTracks&&a.getAudioTracks().length&&(s.audio=!0),a.getVideoTracks().length&&(s.video=!0)}m(r(s)?"Seems data-only connection.":p(s)),e.onstatechange({userid:n.userid,extra:{},name:"connecting-with-initiator",reason:"Checking presence of the initiator; and the room."}),ne.send({participant:!0,channel:o,targetUser:n.userid,session:e.session,offers:{audio:!!s.audio,video:!!s.video}}),e.skipOnNewSession=!1,C(e)}}function Y(n){if($.requestsFrom||($.requestsFrom={}),!$.requestsFrom[n.userid]){var t={userid:n.userid,extra:n.extra,channel:n.channel||n.userid,session:n.session||e.session};if(n.offers){m(n.offers.audio&&n.offers.video?"target user has both audio/video streams.":n.offers.audio&&!n.offers.video?"target user has only audio stream.":!n.offers.audio&&n.offers.video?"target user has only video stream.":"target user has no stream; it seems one-way streaming or data-only connection.");var i=e.sdpConstraints.mandatory;o(i.OfferToReceiveAudio)&&(e.sdpConstraints.mandatory.OfferToReceiveAudio=!!n.offers.audio),o(i.OfferToReceiveVideo)&&(e.sdpConstraints.mandatory.OfferToReceiveVideo=!!n.offers.video),m("target user's SDP has?",p(e.sdpConstraints.mandatory))}$.requestsFrom[n.userid]=t,e.onRequest&&e.isInitiator?e.onRequest(t):Q(t)}}function Q(n){return $.captureUserMediaOnDemand?($.captureUserMediaOnDemand=!1,void e.captureUserMedia(function(){Q(n),C(e)})):(m("accepting request from",n.userid),Z[n.userid]=n.userid,void E({isofferer:!0,userid:n.userid,channel:n.channel,extra:n.extra||{},session:n.session||e.session}))}var X={},K=[],$=this,Z={};!$.fileBufferReader&&e.session.data&&e.enableFileSharing&&k(e,function(e){$.fileBufferReader=e});var ee=new I(e);e.remove=function(n){$.requestsFrom&&$.requestsFrom[n]&&delete $.requestsFrom[n],e.peers[n]&&(e.peers[n].peer&&e.peers[n].peer.connection&&("closed"!=e.peers[n].peer.connection.signalingState&&e.peers[n].peer.connection.close(),e.peers[n].peer.connection=null),delete e.peers[n]),Z[n]&&delete Z[n];for(var t in e.streams)t=e.streams[t],t.userid==n&&(g(t,e),delete e.streams[t]);X[n]&&delete X[n]},e.refresh=function(){e.isInitiator&&e.socket&&e.socket.remove&&e.socket.remove(),Z={};for(var n=0;n<e.attachStreams.length;n++)e.stopMediaStream(e.attachStreams[n]);de={streams:[],mutex:!1,queueRequests:[]},$.isOwnerLeaving=!0,e.isInitiator=!1,e.isAcceptNewSession=!0,e.attachMediaStreams=[],e.sessionDescription=null,e.sessionDescriptions={},e.localStreamids=[],e.preRecordedMedias={},e.snapshots={},e.numberOfConnectedUsers=0,e.numberOfSessions=0,e.attachStreams=[],e.detachStreams=[],e.fileQueue={},e.channels={},e.renegotiatedSessions={};for(var t in e.peers)t!=e.userid&&delete e.peers[t];for(var i in e.streams)-1==e._skip.indexOf(i)&&(g(e.streams[i],e),delete e.streams[i]);X={},K=[],Z={}},e.reject=function(n){s(n)||(n=n.userid),ne.send({rejectedRequestOf:n}),e.remove(n)},$.leaveHandler=function(n){return e.leaveOnPageUnload?o(n.keyCode)?B():void(116==n.keyCode&&B()):void 0},U("beforeunload",$.leaveHandler),U("keyup",$.leaveHandler),$.onLineOffLineHandler=function(){navigator.onLine?$.isOffLine&&($.isOffLine=!navigator.onLine):$.isOffLine=!0},U("load",$.onLineOffLineHandler),U("online",$.onLineOffLineHandler),U("offline",$.onLineOffLineHandler);var ne=z();$.defaultSocket=ne,ne&&_&&setTimeout(_,2e3),e.session.screen&&R(),e.getExternalIceServers&&x(function(n){e.iceServers=e.iceServers.concat(n)}),0==e.log&&e.skipLogs(),e.onlog&&(m=f=l=function(){var n={},t=0;Array.prototype.slice.call(arguments).forEach(function(e){n[t++]=p(e)}),p=function(e){return e},e.onlog(n)}),this.initSession=function(n){function t(){ne&&h(Z)<e.maxParticipantsAllowed&&!$.isOwnerLeaving&&ne.send(e.sessionDescription),e.transmitRoomOnce||$.isOwnerLeaving||setTimeout(t,e.interval||3e3)}$.isOwnerLeaving=!1,G(),Z={},$.isOwnerLeaving=!1,o(n.transmitRoomOnce)||(e.transmitRoomOnce=n.transmitRoomOnce),n.dontTransmit||t()},this.joinSession=function(n){function t(){ne.send({messageFor:n.userid,presenceState:$.presenceState,_config:{userid:n.userid,extra:n.extra||{},sessionid:n.sessionid,session:n.session||!1}})}function i(){"checking"==$.presenceState&&(f("Unable to reach initiator. Trying again..."),t(),setTimeout(function(){"checking"==$.presenceState&&(e.onstatechange({userid:n.userid,extra:n.extra||{},name:"room-not-available",reason:"Initiator seems absent. Waiting for someone to open the room."}),e.isAcceptNewSession=!0,setTimeout(i,2e3))},2e3))}return ne?(n=n||{},Z={},$.presenceState="checking",e.onstatechange({userid:n.userid,extra:n.extra||{},name:"detecting-room-presence",reason:"Checking presence of the room."}),t(),void setTimeout(i,3e3)):setTimeout(function(){f("Default-Socket is not yet initialized."),$.joinSession(n)},1e3)},e.donotJoin=function(n){$.donotJoin=n;var t=e.sessionDescriptions[n];t&&(ne.send({donotJoin:!0,messageFor:t.userid,sessionid:n}),Z={},e.isAcceptNewSession=!0,e.sessionid=null)},this.send=function(n,t){if(n instanceof ArrayBuffer||n instanceof DataView||(n=d({extra:e.extra,userid:e.userid,data:n})),t)return void("open"==t.readyState&&t.send(n));for(var i in e.channels){var o=e.channels[i].channel;"open"==o.readyState&&o.send(n)}},this.leave=function(){B()},this.addStream=function(n){function t(t){var o=t.socket;if(!o)return void f(t,"doesn't has socket.");if(O(o),!t||!t.peer)throw"No peer to renegotiate.";var s=t.peer;n.stream&&(s.attachStreams||(s.attachStreams=[]),s.attachStreams.push(n.stream)),P(e.detachStreams,s.connection),n.stream&&(i.audio||i.video||i.screen)&&s.addStream(n.stream),s.recreateOffer(i,function(n,t){L({sdp:n,socket:o,renegotiate:i,labels:e.detachStreams,streaminfo:t}),e.detachStreams=[]})}var i=n.renegotiate;if(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]||(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]={session:n.renegotiate,stream:n.stream}),n.socket)n.socket.userid!=e.userid&&t(e.peers[n.socket.userid]);else for(var o in e.peers)o!=e.userid&&t(e.peers[o])},e.request=function(n,t){e.captureUserMedia(function(){E({channel:e.userid,extra:t||{},userid:n}),ne.send({participant:!0,targetUser:n})})},e.accept=function(n){arguments.length>1&&s(arguments[0])&&(n={},arguments[0]&&(n.userid=arguments[0]),arguments[1]&&(n.extra=arguments[1]),arguments[2]&&(n.channel=arguments[2])),e.captureUserMedia(function(){Q(n)})};var te=!1;this.disconnect=function(){if(this.isOwnerLeaving=!0,!e.keepStreamsOpened){for(var n in e.localStreams)e.localStreams[n].stop();e.localStreams={},de={streams:[],mutex:!1,queueRequests:[]}}e.isInitiator&&ne.send({isDisconnectSockets:!0}),e.refresh(),$.defaultSocket=ne=null,te=!0,e.ondisconnected({userid:e.userid,extra:e.extra,peer:e.peers[e.userid],isSocketsDisconnected:!0}),e.close(),window.removeEventListener("beforeunload",$.leaveHandler),window.removeEventListener("keyup",$.leaveHandler),delete this,m("Disconnected your sockets, peers, streams and everything except RTCMultiConnection object.")}}function n(e){if(!e)throw"MediaStream is mandatory.";if(e.getVideoTracks&&!e.getVideoTracks().length)return e;var n=new AudioContext,t=n.createMediaStreamSource(e),i=n.createMediaStreamDestination();return t.connect(i),N.push(t),i.stream}function t(){if(window.crypto&&crypto.getRandomValues&&-1==navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,i=e.length;i>t;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function i(e){return!e.audio&&!e.video&&!e.screen&&e.data}function o(e){return"undefined"==typeof e}function s(e){return"string"==typeof e}function r(e){var n=0;for(var t in e)n++;return 0==n}function a(e){var n="";try{n=String.fromCharCode.apply(null,new Uint16Array(e))}catch(t){}return n}function d(e){s(e)||(e=JSON.stringify(e));for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),i=0,o=e.length;o>i;i++)t[i]=e.charCodeAt(i);return n}function c(e){for(var n=[],t=e.length,i=0;t>i;i++)e[i]&&e[i]!==!0&&n.push(e[i]);return n}function u(e,n){for(var t in e)n(e[t],t)}function m(){Y.log(arguments)}function l(){Y.error(arguments)}function f(){Y.warn(arguments)}function p(e){return JSON.stringify(e,function(e,n){return n&&n.sdp?(m(n.sdp.type,"\t",n.sdp.sdp),""):n},"\t")}function h(e){var n=0;for(var t in e)t&&n++;return n}function v(e,n){var t=document.createElement(e.isAudio?"audio":"video");if(t.id=e.streamid,W){var i=document.body||document.documentElement;return i.insertBefore(t,i.firstChild),setTimeout(function(){oe.attachMediaStream(t,e)},1e3),oe.attachMediaStream(t,e)}return t[V?"mozSrcObject":"src"]=V?e:(window.URL||window.webkitURL).createObjectURL(e),t.controls=!0,t.autoplay=!!n.remote,t.muted=!n.remote,V&&t.addEventListener("ended",function(){e.onended()},!1),t.play(),t}function g(e,n){(!e.mediaElement||e.mediaElement.parentNode)&&($[e.streamid]||($[e.streamid]=e,n.onstreamended(e)))}function S(e,n){Z[e.userid]||(Z[e.userid]=e,n.onleave(e))}function w(e){function n(n){var o=document.createElement("canvas");o.width=n.videoWidth||n.clientWidth,o.height=n.videoHeight||n.clientHeight;var s=o.getContext("2d");s.drawImage(n,0,0,o.width,o.height),i.snapshots[t]=o.toDataURL("image/png"),e.callback&&e.callback(i.snapshots[t])}var t=e.userid,i=e.connection;if(e.mediaElement)return n(e.mediaElement);for(var o in i.streams)o=i.streams[o],o.userid==t&&o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks().length&&n(o.mediaElement)}function C(e){e.onMediaCaptured&&(e.onMediaCaptured(),delete e.onMediaCaptured)}function b(e,n){if(e||(e={}),!n)return e;for(var t in n)e[t]=n[t];return e}function y(e,n){var t=document.createElement("script");t.src=e,t.onload=function(){m("loaded resource:",e),n&&n()},document.documentElement.appendChild(t)}function T(e){var n=e.connection,t=e.element;if(!window.html2canvas)return y(n.resources.html2canvas,function(){T(e)});if(s(t)&&(t=document.querySelector(t),t||(t=document.getElementById(t))),!t)throw"HTML DOM Element is not accessible!";html2canvas(t,{onrendered:function(n){e.callback(n.toDataURL())}})}function k(e,n){function t(e){return e.userid=e.extra.userid,e}if(!window.FileBufferReader)return void y(e.resources.FileBufferReader,function(){k(e,n)});var i=new FileBufferReader;i.onProgress=function(n){e.onFileProgress(t(n),n.uuid)},i.onBegin=function(n){e.onFileStart(t(n))},i.onEnd=function(n){e.onFileEnd(t(n))},n(i)}function R(e){if(DetectRTC.screen.extensionid==te&&!X){if(!e)return R(!0);X=!0;var n=document.createElement("iframe");n.onload=function(){n.isLoaded=!0,m("Screen Capturing frame is loaded.")},n.src="https://www.webrtc-experiment.com/getSourceId/",n.style.display="none",(document.body||document.documentElement).appendChild(n),Q={postMessage:function(){return n.isLoaded?void n.contentWindow.postMessage({
captureSourceId:!0},"*"):void setTimeout(Q.postMessage,100)}}}}function x(e,n){if(!K){if(!n)return x(e,!0);K=!0;var t=document.createElement("iframe");t.onload=function(){function n(t){t.data&&t.data.iceServers&&(e(t.data.iceServers),window.removeEventListener("message",n))}t.isLoaded=!0,U("message",n),t.contentWindow.postMessage("get-ice-servers","*")},t.src="https://cdn.webrtc-experiment.com/getIceServers/",t.style.display="none",(document.body||document.documentElement).appendChild(t)}}function M(e){var n=e.stream,t=e.root,i=e.session||{},o=e.enabled;if(i.audio||i.video||(i=s(i)?{audio:!0,video:!0}:b(i,{audio:!0,video:!0})),i.type){if("remote"==i.type&&"remote"!=t.type)return;if("local"==i.type&&"local"!=t.type)return}if(m(o?"Muting":"UnMuting","session",p(i)),"local"==t.type&&i.audio&&n.getAudioTracks){var r=n.getAudioTracks()[0];r&&(r.enabled=!o)}if("local"==t.type&&(i.video||i.screen)&&n.getVideoTracks){var a=n.getVideoTracks()[0];a&&(a.enabled=!o)}if(t.sockets.forEach(function(e){"local"==t.type&&e.send({streamid:t.streamid,mute:!!o,unmute:!o,session:i}),"remote"==t.type&&e.send({promptMuteUnmute:!0,streamid:t.streamid,mute:!!o,unmute:!o,session:i})}),"remote"!=t.type){var d=b({},t);d.session=i,d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!!d.session.screen,o&&(n.preMuted={audio:n.getAudioTracks().length&&!n.getAudioTracks()[0].enabled,video:n.getVideoTracks().length&&!n.getVideoTracks()[0].enabled},t.rtcMultiConnection.onmute(d)),o||(n.preMuted={},t.rtcMultiConnection.onunmute(d))}}function D(e){if(!window.hark)return void y(e.connection.resources.hark,function(){D(e)});var n=e.connection,t=e.streamedObject,i=e.stream,o={},s=hark(i,o);s.on("speaking",function(){n.onspeaking&&n.onspeaking(t)}),s.on("stopped_speaking",function(){n.onsilence&&n.onsilence(t)}),s.on("volume_change",function(e,i){n.onvolumechange&&n.onvolumechange(b({volume:e,threshold:i},t))})}function O(e){function n(n,o,s){s||(s=t()),i.localStreams[s]=n;var r=e.video;r&&(r[V?"mozSrcObject":"src"]=V?n:(window.URL||window.webkitURL).createObjectURL(n),r.play()),e.onsuccess(n,o,w,s),de.streams[w]={stream:n,streamid:s},de.mutex=!1,de.queueRequests.length&&O(de.queueRequests.shift())}if(W)return oe.getUserMedia?oe.getUserMedia(e.constraints||{audio:!0,video:!0},e.onsuccess,e.onerror):void setTimeout(function(){O(e)},1e3);if(de.mutex===!0)return void de.queueRequests.push(e);de.mutex=!0;var i=e.connection,o=e.mediaConstraints||{},s="boolean"==typeof o.video?o.video:o.video||o,a="boolean"==typeof o.audio?o.audio:o.audio||ae,d=navigator,u=e.constraints||{audio:ae,video:ae};u.video&&u.video.mozMediaSource&&(s={}),1==u.video&&(u.video=ae),1==u.audio&&(u.audio=ae),"boolean"==typeof a&&u.audio&&(u.audio=a),"boolean"==typeof s&&u.video&&(u.video=s);var h=a.mandatory;r(h)||(u.audio.mandatory=b(u.audio.mandatory,h));var v=s.mandatory;if(v){var g={};if(v.minWidth&&(g.minWidth=v.minWidth),v.minHeight&&(g.minHeight=v.minHeight),v.maxWidth&&(g.maxWidth=v.maxWidth),v.maxHeight&&(g.maxHeight=v.maxHeight),v.minAspectRatio&&(g.minAspectRatio=v.minAspectRatio),v.maxFrameRate&&(g.maxFrameRate=v.maxFrameRate),v.minFrameRate&&(g.minFrameRate=v.minFrameRate),g.minWidth&&g.minHeight){var S=["1920:1080","1280:720","960:720","640:360","640:480","320:240","320:180"];(-1==S.indexOf(g.minWidth+":"+g.minHeight)||-1==S.indexOf(g.maxWidth+":"+g.maxHeight))&&l('The min/max width/height constraints you passed "seems" NOT supported.',p(g)),(g.minWidth>g.maxWidth||g.minHeight>g.maxHeight)&&l("Minimum value must not exceed maximum value.",p(g)),g.minWidth>=1280&&g.minHeight>=720&&f("Enjoy HD video! min/"+g.minWidth+":"+g.minHeight+", max/"+g.maxWidth+":"+g.maxHeight)}u.video.mandatory=b(u.video.mandatory,g)}v&&(u.video.mandatory=b(u.video.mandatory,v)),s.optional&&s.optional instanceof Array&&s.optional.length&&(u.video.optional=u.video.optional?u.video.optional.concat(s.optional):s.optional),a.optional&&a.optional instanceof Array&&a.optional.length&&(u.audio.optional=u.audio.optional?u.audio.optional.concat(a.optional):a.optional),u.video.mandatory&&!r(u.video.mandatory)&&i._mediaSources.video&&(u.video.optional.forEach(function(e,n){e.sourceId==i._mediaSources.video&&delete u.video.optional[n]}),u.video.optional=c(u.video.optional),u.video.optional.push({sourceId:i._mediaSources.video})),u.audio.mandatory&&!r(u.audio.mandatory)&&i._mediaSources.audio&&(u.audio.optional.forEach(function(e,n){e.sourceId==i._mediaSources.audio&&delete u.audio.optional[n]}),u.audio.optional=c(u.audio.optional),u.audio.optional.push({sourceId:i._mediaSources.audio})),u.video&&!u.video.mozMediaSource&&u.video.optional&&u.video.mandatory&&!u.video.optional.length&&r(u.video.mandatory)&&(u.video=!0),H&&(u={audio:!!u.audio,video:!!u.video}),m("invoked getUserMedia with constraints:",p(u));var w=JSON.stringify(u);de.streams[w]?n(de.streams[w].stream,!0,de.streams[w].streamid):(d.getMedia=d.webkitGetUserMedia||d.mozGetUserMedia,d.getMedia(u,n,function(n){e.onerror(n,u)}))}function E(e){var n,t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return n={mandatory:t,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&J>34&&(n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),n}function A(){return{create:function(e,n){b(this,n);var t=this;return this.type=e,this.init(),this.attachMediaStreams(),V&&this.session.data?(this.session.data&&"offer"==e&&this.createDataChannel(),this.getLocalDescription(e),this.session.data&&"answer"==e&&this.createDataChannel()):t.getLocalDescription(e),this},getLocalDescription:function(e){function n(){t.connection["offer"==e?"createOffer":"createAnswer"](function(n){n.sdp=t.serializeSdp(n.sdp,e),t.connection.setLocalDescription(n),t.trickleIce&&t.onSessionDescription(n,t.streaminfo),"offer"==n.type&&m("offer sdp",n.sdp),t.prevCreateType=e},t.onSdpError,t.constraints)}m("(getLocalDescription) peer createType is",e),this.session.inactive&&o(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing)&&(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing=!1);var t=this;"answer"==e?this.setRemoteDescription(this.offerDescription,n):n()},serializeSdp:function(e,n){if(e=this.processSdp(e),V)return e;if(this.session.inactive&&!this.holdMLine&&(this.hold=!0,(this.session.screen||this.session.video)&&this.session.audio?this.holdMLine="both":this.session.screen||this.session.video?this.holdMLine="video":this.session.audio&&(this.holdMLine="audio")),e=this.setBandwidth(e),"both"==this.holdMLine){if(this.hold)this.prevSDP=e,e=e.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive");else if(this.prevSDP&&!this.session.inactive&&(e=this.prevSDP,35>=z))return e}else if("audio"==this.holdMLine||"video"==this.holdMLine){e=e.split("m=");var t="",i="";e[1]&&0==e[1].indexOf("audio")&&(t="m="+e[1]),e[2]&&0==e[2].indexOf("audio")&&(t="m="+e[2]),e[1]&&0==e[1].indexOf("video")&&(i="m="+e[1]),e[2]&&0==e[2].indexOf("video")&&(i="m="+e[2]),"audio"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")+i):this.prevSDP&&(e=this.prevSDP)),"video"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t+i.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")):this.prevSDP&&(e=this.prevSDP))}return!this.hold&&this.session.inactive&&(e="offer"==n?e.replace(/a=setup:passive|a=setup:active|a=setup:holdconn/g,"a=setup:actpass"):e.replace(/a=setup:actpass|a=setup:passive|a=setup:holdconn/g,"a=setup:active"),e=e.replace(/a=inactive/g,"a=sendrecv")),e},init:function(){function e(){return n.returnedSDP?void(n.returnedSDP=!1):(n.returnedSDP=!0,void n.onSessionDescription(n.connection.localDescription,n.streaminfo))}this.setConstraints(),this.connection=new re(this.iceServers,this.optionalArgument),this.session.data&&(m("invoked: createDataChannel"),this.createDataChannel()),this.connection.onicecandidate=function(t){return t.candidate?void(n.trickleIce&&n.onicecandidate(t.candidate)):void(n.trickleIce||e())},this.connection.onaddstream=function(e){m("onaddstream",W?e.stream:p(e.stream)),n.onaddstream(e.stream,n.session)},this.connection.onremovestream=function(e){n.onremovestream(e.stream)},this.connection.onsignalingstatechange=function(){n.connection&&n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,signalingState:n.connection.signalingState})},this.connection.oniceconnectionstatechange=function(){n.connection&&(n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,signalingState:n.connection.signalingState}),n.trickleIce||"complete"==n.connection.iceGatheringState&&(m("iceGatheringState",n.connection.iceGatheringState),e()))};var n=this},setBandwidth:function(e){if(H||V||!this.bandwidth)return e;var n=this.bandwidth;return this.session.screen&&(n.screen?n.screen<300&&f("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):f("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&this.session.screen&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video||n.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(this.session.screen?n.screen:n.video)+"\r\n")),n.data&&!this.preferSCTP&&(e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+n.data+"\r\n")),e},setConstraints:function(){var e=E({OfferToReceiveAudio:!!this.session.audio,OfferToReceiveVideo:!!this.session.video||!!this.session.screen});if(this.sdpConstraints.mandatory&&(e=E(this.sdpConstraints.mandatory)),this.constraints=e,this.constraints&&m("sdp-constraints",p(this.constraints)),this.optionalArgument={optional:this.optionalArgument.optional||[],mandatory:this.optionalArgument.mandatory||{}},this.preferSCTP||this.optionalArgument.optional.push({RtpDataChannels:!0}),m("optional-argument",p(this.optionalArgument)),o(this.iceServers))this.iceServers=null;else{var n=this.rtcMultiConnection.candidates,t=n.stun,i=n.turn,s=n.host;o(n.reflexive)||(t=n.reflexive),o(n.relay)||(i=n.relay),s||t||!i?s||t||i||(this.rtcConfiguration.iceTransports="none"):this.rtcConfiguration.iceTransports="relay",this.iceServers={iceServers:this.iceServers,iceTransports:this.rtcConfiguration.iceTransports}}m("rtc-configuration",p(this.iceServers))},onSdpError:function(e){var n=p(e);n&&-1!=n.indexOf("RTP/SAVPF Expects at least 4 fields")&&(n="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!"),l("onSdpError:",n)},onSdpSuccess:function(){m("sdp success")},onMediaError:function(e){l(p(e))},setRemoteDescription:function(e,n){if(!e)throw"Remote session description should NOT be NULL.";if(this.connection){m("setting remote description",e.type,e.sdp);var t=this;this.connection.setRemoteDescription(new ce(e),n||this.onSdpSuccess,function(e){-1==e.search(/STATE_SENTINITIATE|STATE_INPROGRESS/gi)&&t.onSdpError(e)})}},addIceCandidate:function(e){function n(n){t.connection.addIceCandidate(n,function(){m("added:",e.sdpMid,e.candidate)},function(){l("onIceFailure",arguments,e.candidate)})}var t=this;W?ue(e,function(e){n(e)}):n(new ue(e))},createDataChannel:function(e){if(!this.channels||!this.channels.length){var n=this;this.channels||(this.channels=[]);var t={};this.dataChannelDict&&(t=this.dataChannelDict),_&&!this.preferSCTP&&(t.reliable=!1),m("dataChannelDict",p(t)),("answer"==this.type||V)&&(this.connection.ondatachannel=function(e){n.setChannelEvents(e.channel)}),(_&&"offer"==this.type||V)&&this.setChannelEvents(this.connection.createDataChannel(e||"channel",t))}},setChannelEvents:function(e){var n=this;e.binaryType="arraybuffer",this.dataChannelDict.binaryType&&(e.binaryType=this.dataChannelDict.binaryType),e.onmessage=function(e){n.onmessage(e.data)};var t=0;e.onopen=function(){e.push=e.send,e.send=function(i){if("disconnected"!=n.connection.iceConnectionState&&-1==e.readyState.search(/closing|closed/g)&&-1!=e.readyState.search(/connecting|open/g)){if("connecting"==e.readyState)return t++,setTimeout(function(){if(!(20>t))throw"Number of times exceeded to wait for WebRTC data connection to be opened.";e.send(i)},1e3);try{e.push(i)}catch(o){if(t++,f("Data transmission failed. Re-transmitting..",t,p(o)),t>=20)throw"Number of times exceeded to resend data packets over WebRTC data channels.";setTimeout(function(){e.send(i)},100)}}},n.onopen(e)},e.onerror=function(e){n.onerror(e)},e.onclose=function(e){n.onclose(e)},this.channels.push(e)},addStream:function(e){e.streamid||j||(e.streamid=t()),m("attaching stream:",e.streamid,W?e:p(e)),this.connection.addStream(e),this.sendStreamId(e),this.getStreamInfo()},attachMediaStreams:function(){for(var e=this.attachStreams,n=0;n<e.length;n++)this.addStream(e[n])},getStreamInfo:function(){this.streaminfo="";for(var e=this.connection.getLocalStreams(),n=0;n<e.length;n++)0==n?this.streaminfo=JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}}):this.streaminfo+="----"+JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}})},recreateOffer:function(e,n){m("recreating offer"),this.type="offer",this.session=e,this.onSessionDescription=n,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("offer")},recreateAnswer:function(e,n,t){m("recreating answer"),this.type="answer",this.session=n,this.onSessionDescription=t,this.offerDescription=e,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("answer")}}}function P(e,n){var t=document.createElement("a");t.href=e,t.target="_blank",t.download=n||e,navigator.mozGetUserMedia&&(t.onclick=function(){(document.body||document.documentElement).removeChild(t)},(document.body||document.documentElement).appendChild(t));var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t.dispatchEvent(i),navigator.mozGetUserMedia||URL.revokeObjectURL(t.href)}function I(e){function n(n,i,o){var s=n.uuid;if(t[s]||(t[s]=[]),t[s].push(n.message),n.last){var r=t[s].join("");n.isobject&&(r=JSON.parse(r));var a=(new Date).getTime(),d=a-n.sendingTime,c={data:r,userid:i,extra:o,latency:d};r.preRecordedMediaChunk?(e.preRecordedMedias[r.streamerid]||e.shareMediaFile(null,null,r.streamerid),e.preRecordedMedias[r.streamerid].onData(r.chunk)):e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(n){c.data=n,e.onmessage(c)})):r.isPartOfScreen?e.onpartofscreen(r):e.onmessage(c),delete t[s]}}var t={};return{receive:n}}function U(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function L(e){function i(e,n){if(-1!=e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}e.userid=t(),e.session={audio:!0,video:!0},e.maxParticipantsAllowed=256,e.direction="many-to-many",e.mediaConstraints={mandatory:{},optional:[],audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}},e.candidates={host:!0,stun:!0,turn:!0},e.sdpConstraints={},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.privileges={canStopRemoteStream:!1,canMuteRemoteStream:!1},e.iceProtocols={tcp:!0,udp:!0},e.preferSCTP=!!(V||z>=32),e.chunkInterval=V||z>=32?100:500,e.chunkSize=V||z>=32?13e3:1e3,e.fakeDataChannels=!1,e.waitUntilRemoteStreamStartsFlowing=null,e.leaveOnPageUnload=!0,e.getExternalIceServers=_,e.UA={isFirefox:V,isChrome:_,isMobileDevice:H,version:_?z:J,isNodeWebkit:q,isSafari:B,isIE:j,isOpera:F},e.fileQueue={},e.renegotiatedSessions={},e.channels={},e.extra={},e.bandwidth={screen:300},e.caniuse={RTCPeerConnection:DetectRTC.isWebRTCSupported,getUserMedia:!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia,AudioContext:DetectRTC.isAudioContextSupported,ScreenSharing:DetectRTC.isScreenCapturingSupported,RtpDataChannels:DetectRTC.isRtpDataChannelsSupported,SctpDataChannels:DetectRTC.isSctpDataChannelsSupported},e.snapshots={},e._mediaSources={},e.devices={},e.language="en",e.autoTranslateText=!1,e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.localStreamids=[],e.localStreams={},e.preRecordedMedias={},e.attachStreams=[],e.detachStreams=[],e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300}],mandatory:{}},e.dataChannelDict={},e.dontAttachStream=!1,e.dontCaptureUserMedia=!1,e.preventSSLAutoAllowed=!1,e.autoReDialOnFailure=!0,e.isInitiator=!1,e.DetectRTC=DetectRTC,e.trickleIce=!0,e.sessionDescriptions={},e.sessionDescription=null,e.resources={RecordRTC:"https://cdn.webrtc-experiment.com/RecordRTC.js",PreRecordedMediaStreamer:"https://cdn.webrtc-experiment.com/PreRecordedMediaStreamer.js",customGetUserMediaBar:"https://cdn.webrtc-experiment.com/navigator.customGetUserMediaBar.js",html2canvas:"https://cdn.webrtc-experiment.com/screenshot.js",hark:"https://cdn.webrtc-experiment.com/hark.js",firebase:"https://cdn.webrtc-experiment.com/firebase.js",firebaseio:"https://webrtc-experiment.firebaseIO.com/",muted:"https://cdn.webrtc-experiment.com/images/muted.png",getConnectionStats:"https://cdn.webrtc-experiment.com/getConnectionStats.js",FileBufferReader:"https://cdn.webrtc-experiment.com/FileBufferReader.js"},e.body=document.body||document.documentElement,e.peers={},e.firebase="chat",e.numberOfSessions=0,e.numberOfConnectedUsers=0,e.enableFileSharing=!0,e.autoSaveToDisk=!1,e.processSdp=function(e){return e},e.onmessage=function(e){m("onmessage",p(e))},e.onopen=function(e){m("Data connection is opened between you and",e.userid)},e.onerror=function(e){l(onerror,p(e))},e.onclose=function(n){f("onclose",p(n)),e.streams.remove({userid:n.userid})};var a={};e.onFileStart=function(n){var t=document.createElement("div");t.title=n.name,t.innerHTML="<label>0%</label> <progress></progress>",e.body.insertBefore(t,e.body.firstChild),a[n.uuid]={div:t,progress:t.querySelector("progress"),label:t.querySelector("label")},a[n.uuid].progress.max=n.maxChunks},e.onFileProgress=function(e){var n=a[e.uuid];n&&(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,i(n.progress,n.label))},e.onFileEnd=function(n){a[n.uuid]&&(a[n.uuid].div.innerHTML='<a href="'+n.url+'" target="_blank" download="'+n.name+'">'+n.name+"</a>"),(e.onFileSent||e.onFileReceived)&&(e.onFileSent&&e.onFileSent(n,n.uuid),e.onFileReceived&&e.onFileReceived(n.name,n))},e.onstream=function(n){e.body.insertBefore(n.mediaElement,e.body.firstChild)},e.onstreamended=function(e){if(m("onStreamEndedHandler:",e),!e.mediaElement)return f("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode){if(e.mediaElement=document.getElementById(e.streamid),!e.mediaElement)return f("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode)return f("Event.mediElement.parentNode is null.",e)}e.mediaElement.parentNode.removeChild(e.mediaElement)},e.onSessionClosed=function(e){e.isEjected?f(e.userid,"ejected you."):f("Session has been closed.",e)},e.onmute=function(n){n.isVideo&&n.mediaElement&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",n.snapshot||e.resources.muted)),n.isAudio&&n.mediaElement&&(n.mediaElement.muted=!0)},e.onunmute=function(e){e.isVideo&&e.mediaElement&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),e.isAudio&&e.mediaElement&&(e.mediaElement.muted=!1)},e.onleave=function(e){m("onleave",p(e))},e.token=t,e.peers[e.userid]={drop:function(){e.drop()},renegotiate:function(){},addStream:function(){},hold:function(){},unhold:function(){},changeBandwidth:function(){},sharePartOfScreen:function(){}},e._skip=["stop","mute","unmute","_private","_selectStreams","selectFirst","selectAll","remove"],e.streams={mute:function(e){this._private(e,!0)},unmute:function(e){this._private(e,!1)},_private:function(n,t){function i(e,n,t){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||!(n.isScreen&&!e.isScreen||n.isAudio&&!e.isAudio||n.isVideo&&!e.isVideo||(t?!e.mute(n):!e.unmute(n)))}if(!n||s(n))for(var o in this)-1==e._skip.indexOf(o)&&this[o]._private(n,t);else for(var o in this)-1==e._skip.indexOf(o)&&i(this[o],n,t)},stop:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&e.stop(),n.audio&&e.isAudio&&e.stop(),n.video&&e.isVideo&&e.stop(),n.audio||n.video||n.screen||e.stop())}var i;for(var o in this)if(-1==e._skip.indexOf(o))if(i=this[o],n)if(s(n)){var r={};r[n]=!0,t(i,r)}else t(i,n);else i.stop()},remove:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&i(e),n.audio&&e.isAudio&&i(e),n.video&&e.isVideo&&i(e),n.audio||n.video||n.screen||i(e))}function i(n){g(n,e),delete e.streams[n.streamid]}var o;for(var r in this)if(-1==e._skip.indexOf(r))if(o=this[r],n)if(s(n)){var a={};a[n]=!0,t(o,a)}else t(o,n);else t(o,{local:!0,remote:!0})},selectFirst:function(e){return this._selectStreams(e,!1)},selectAll:function(e){return this._selectStreams(e,!0)},_selectStreams:function(n,t){if(!n||s(n)||r(n))throw"Invalid arguments.";o(n.local)&&o(n.remote)&&o(n.userid)&&(n.local=n.remote=!0),n.isAudio||n.isVideo||n.isScreen||(n.isAudio=n.isVideo=n.isScreen=!0);var i=[];for(var a in this)-1==e._skip.indexOf(a)&&(a=this[a])&&(n.local&&"local"==a.type||n.remote&&"remote"==a.type||n.userid&&a.userid==n.userid)&&(n.isVideo&&a.isVideo&&i.push(a),n.isAudio&&a.isAudio&&i.push(a),n.isScreen&&a.isScreen&&i.push(a));return t?i:i[0]}};var d=[];d.push({url:"stun:stun.l.google.com:19302"}),d.push({url:"stun:stun.anyfirewall.com:3478"}),d.push({url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"}),d.push({url:"turn:turn.anyfirewall.com:443?transport=tcp",credential:"webrtc",username:"webrtc"}),e.iceServers=d,e.rtcConfiguration={iceServers:null,iceTransports:"all",peerIdentity:!1},e.media={min:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.minWidth=n,e.mediaConstraints.video.mandatory.minHeight=t)},max:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.maxWidth=n,e.mediaConstraints.video.mandatory.maxHeight=t)}},e._getStream=function(n){function t(e,n,t){if(t){var i=t.onpause,o=t.onplay;t.onpause=t.onplay=function(){},n?t.pause():t.play(),t.onpause=i,t.onplay=o}}var i=b({sockets:n.socket?[n.socket]:[]},n);return i.stop=function(){var e=this;if(e.sockets.forEach(function(n){"local"==e.type&&n.send({streamid:e.streamid,stopped:!0}),"remote"==e.type&&n.send({promptStreamStop:!0,streamid:e.streamid})}),"remote"!=e.type){var n=e.stream;n&&e.rtcMultiConnection.stopMediaStream(n)}},i.mute=function(e){this.muted=!0,this._private(e,!0)},i.unmute=function(e){this.muted=!1,this._private(e,!1)},i._private=function(e,n){return e&&!o(e.sync)&&0==e.sync?void t(e,n,this.mediaElement):void M({root:this,session:e,enabled:n,stream:this.stream})},i.startRecording=function(n){var t=this;return n||(n={audio:!0,video:!0}),s(n)&&(n={audio:"audio"==n,video:"video"==n}),window.RecordRTC?(m("started recording session",n),t.videoRecorder=t.audioRecorder=null,V?t.stream.getAudioTracks().length&&t.stream.getVideoTracks().length?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.video?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})):_&&(isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50&&t.stream.getAudioTracks().length&&t.stream.getVideoTracks().length?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50?n.video?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})):(n.video&&(t.videoRecorder=RecordRTC(t.stream,{type:"video"})),n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})))),t.audioRecorder&&t.audioRecorder.startRecording(),void(t.videoRecorder&&t.videoRecorder.startRecording())):y(t.rtcMultiConnection.resources.RecordRTC,function(){t.startRecording(n)})},i.stopRecording=function(e,n){n||(n={audio:!0,video:!0}),s(n)&&(n={audio:"audio"==n,video:"video"==n}),m("stopped recording session",n);var t=this;n.audio&&t.audioRecorder?t.audioRecorder.stopRecording(function(){n.video&&t.videoRecorder?t.videoRecorder.stopRecording(function(){e({audio:t.audioRecorder.getBlob(),video:t.videoRecorder.getBlob()})}):e({audio:t.audioRecorder.getBlob()})}):n.video&&t.videoRecorder&&t.videoRecorder.stopRecording(function(){e({video:t.videoRecorder.getBlob()})})},i.takeSnapshot=function(n){w({mediaElement:this.mediaElement,userid:this.userid,connection:e,callback:n})},i.streamObject=i,i},e.set=function(e){for(var n in e)this[n]=e[n];return this},e.onMediaError=function(e){l("name",e.name),l("constraintName",p(e.constraintName)),l("message",e.message),l("original session",e.session)},e.takeSnapshot=function(n,t){w({userid:n,connection:e,callback:t})},e.saveToDisk=function(e,n){e.size&&e.type?me.SaveToDisk(URL.createObjectURL(e),n||e.name||e.type.replace("/","-")+e.type.split("/")[1]):me.SaveToDisk(e,n)},e.selectDevices=function(n,t){function i(n){n&&(e._mediaSources[n.kind]=n.id)}n&&i(this.devices[n]),t&&i(this.devices[t])},e.getDevices=function(n){return DetectRTC.MediaDevices.length?(DetectRTC.MediaDevices.forEach(function(n){e.devices[n.deviceId]=n}),void(n&&n(e.devices))):setTimeout(function(){e.getDevices(n)},1e3)},e.getMediaDevices=e.enumerateDevices=function(n){if(!n)throw"callback is mandatory.";e.getDevices(function(){n(e.DetectRTC.MediaDevices)})},e.onCustomMessage=function(e){m("Custom message",e)},e.ondrop=function(e){m("Media connection is dropped by "+e)},e.drop=function(n){n=n||{},e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),g(t,e)):g(t,e));e.sendCustomMessage({drop:!0,dontRenegotiate:!!o(n.renegotiate)||n.renegotiate})},e.Translator={TranslateText:function(n,t){var i=document.createElement("script");i.type="text/javascript";var o=encodeURIComponent(n),s="method"+e.token();window[s]=function(e){e.data&&e.data.translations[0]&&t&&t(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"==e.error.message&&(f('Text translation failed. Error message: "Daily Limit Exceeded."'),t(n))};var r="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+s+"&q="+o;i.src=r,document.getElementsByTagName("head")[0].appendChild(i)}},e.setDefaultEventsForMediaElement=function(n,t){n.onpause=function(){e.streams[t]&&!e.streams[t].muted&&e.streams[t].mute()},n.onplay=function(){e.streams[t]&&e.streams[t].muted&&e.streams[t].unmute()};var i=!1;n.onvolumechange=function(){i||(i=!0,e.streams[t]&&setTimeout(function(){var o=e.streams[t];e.streams[t].sockets.forEach(function(e){e.send({streamid:o.streamid,isVolumeChanged:!0,volume:n.volume})}),i=!1},2e3))}},e.onMediaFile=function(n){m("onMediaFile",n),e.body.appendChild(n.mediaElement)},e.shareMediaFile=function(n,t,i){return i=i||e.token(),PreRecordedMediaStreamer?PreRecordedMediaStreamer.shareMediaFile({file:n,video:t,streamerid:i,connection:e}):(y(e.resources.PreRecordedMediaStreamer,function(){e.shareMediaFile(n,t,i)}),i)},e.onpartofscreen=function(n){var t=document.createElement("img");t.src=n.screenshot,e.body.appendChild(t)},e.skipLogs=function(){m=l=f=function(){}},e.hold=function(n){for(var t in e.peers)e.peers[t].hold(n)},e.onhold=function(n){m("onhold",n),"audio"!=n.kind&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",n.screenshot||e.resources.muted)),"audio"==n.kind&&(n.mediaElement.muted=!0)},e.unhold=function(n){for(var t in e.peers)e.peers[t].unhold(n)},e.onunhold=function(e){m("onunhold",e),"audio"!=e.kind&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),"audio"!=e.kind&&(e.mediaElement.muted=!1)},e.sharePartOfScreen=function(n){function t(){(!e.partOfScreen||e.partOfScreen.sharing)&&T({element:n.element,connection:e,callback:function(o){if(o!=i){i=o;for(var s in e.channels)e.channels[s].send({screenshot:o,isPartOfScreen:!0})}!n.once&&setTimeout(t,n.interval||200)}})}var i="";t(),e.partOfScreen=b({sharing:!0},n)},e.pausePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.resumePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!1;e.partOfScreen&&(e.partOfScreen.sharing=!0)},e.stopPartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].stopPartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.takeScreenshot=function(n,t){if(!n||!t)throw"Invalid number of arguments.";if(!window.html2canvas)return y(e.resources.html2canvas,function(){e.takeScreenshot(n)});if(s(n)&&(n=document.querySelector(n),n||(n=document.getElementById(n))),!n)throw"HTML Element is inaccessible!";html2canvas(n,{onrendered:function(e){t(e.toDataURL())}})},e.onScreenCapturingExtensionAvailable=function(){m("It seems that screen capturing extension is installed and available on your system!")},!W&&DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable=function(){e.onScreenCapturingExtensionAvailable()}),e.changeBandwidth=function(n){for(var t in e.peers)e.peers[t].changeBandwidth(n)},e.convertToAudioStream=function(e){n(e)},e.onstatechange=function(e){m("on:state:change ("+e.userid+"):",e.name+":",e.reason||"")},e.onfailed=function(e){e.peer.numOfRetries||(e.peer.numOfRetries=0),e.peer.numOfRetries++,l("ICE connectivity check is failed. Renegotiating peer connection."),e.peer.numOfRetries<2&&e.peer.renegotiate(),e.peer.numOfRetries>=2&&(e.peer.numOfRetries=0)},e.onconnected=function(e){m("Peer connection has been established between you and",e.userid)},e.ondisconnected=function(n){l("Peer connection seems has been disconnected between you and",n.userid),r(e.channels)||e.channels[n.userid]&&(e.channels[n.userid].send({checkingPresence:!0}),setTimeout(function(){return e.peers[n.userid].connected?void delete e.peers[n.userid].connected:(e.streams.remove({remote:!0,userid:n.userid}),void e.remove(n.userid))},3e3))},e.onstreamid=function(e){m("got remote streamid",e.streamid,"from",e.userid)},e.stopMediaStream=function(n){if(!n)throw"MediaStream argument is mandatory.";if(e.keepStreamsOpened)return void(n.onended&&n.onended());e.localStreams[n.streamid]&&delete e.localStreams[n.streamid],V&&n.onended&&n.onended();var t=Boolean((n.getAudioTracks||n.getVideoTracks)&&(n.getAudioTracks()[0]&&!n.getAudioTracks()[0].stop||n.getVideoTracks()[0]&&!n.getVideoTracks()[0].stop));return!n.getAudioTracks||t?void(n.stop&&n.stop()):(n.getAudioTracks().length&&n.getAudioTracks()[0].stop&&n.getAudioTracks().forEach(function(e){e.stop()}),void(n.getVideoTracks().length&&n.getVideoTracks()[0].stop&&n.getVideoTracks().forEach(function(e){e.stop()})))},e.changeBandwidth=function(n){if(!n||s(n)||r(n))throw'Invalid "bandwidth" arguments.';u(e.peers,function(e){e.peer.bandwidth=n}),e.renegotiate()},e.openSignalingChannel=function(n){if(!window.Firebase)return y(e.resources.firebase,function(){e.openSignalingChannel(n)});var t=n.channel||e.channel;e.firebase&&(e.resources.firebaseio=e.resources.firebaseio.replace("//chat.","//"+e.firebase+"."));var i=new Firebase(e.resources.firebaseio+t);i.channel=t,i.on("child_added",function(e){n.onmessage(e.val())}),i.send=function(e){for(var n in e)(o(e[n])||"function"==typeof e[n])&&(e[n]=!1);this.push(e)},e.socket||(e.socket=i),i.onDisconnect().remove(),
setTimeout(function(){n.callback(i)},1)},e.Plugin=oe}window.RMCDefaultChannel=location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""),window.RTCMultiConnection=function(a){function d(n){return Q&&R(),w?n():void(w=new e(T,n))}function u(e,n){if(s(e)&&(T.skipOnNewSession=!0),!w)return m("Signaling channel is not ready. Connecting..."),void d(function(){m("Signaling channel is connected. Joining the session again..."),setTimeout(function(){u(e,n)},1e3)});if(s(e)){if(!T.sessionDescriptions[e])return setTimeout(function(){m("Session-Descriptions not found. Rechecking.."),u(e,n)},1e3);e=T.sessionDescriptions[e]}if(n)return h(function(){e.oneway=!0,u(e)},n);if(!e||!e.userid||!e.sessionid){t("missing arguments",arguments);var t='Invalid data passed over "connection.join" method.';throw T.onstatechange({userid:"browser",extra:{},name:"Unexpected data detected.",reason:t}),t}T.dontOverrideSession||(T.session=e.session);var o=T.extra||e.extra||{};e.oneway||i(e)?w.joinSession(e,o):h(function(){w.joinSession(e,o)})}function h(e,n,t){function o(t){if(t.data&&t.data.chromeMediaSourceId){window.removeEventListener("message",o);var i=t.data.chromeMediaSourceId;if(DetectRTC.screen.sourceId=i,DetectRTC.screen.chromeMediaSource="desktop","PermissionDeniedError"==i){var s={message:"https:"==location.protocol?"User denied to share content of his screen.":ne,name:"PermissionDeniedError",constraintName:u,session:d};return de.mutex=!1,DetectRTC.screen.sourceId=null,T.onMediaError(s)}h(e,n)}t.data&&t.data.chromeExtensionStatus&&(f("Screen capturing extension status is:",t.data.chromeExtensionStatus),DetectRTC.screen.chromeMediaSource="screen",h(e,n,!0))}function a(n,t,i,o){if(T.onstatechange({userid:"browser",extra:{},name:"fetching-usermedia",reason:"About to capture user-media with constraints: "+p(n)}),T.preventSSLAutoAllowed&&!o&&_)return navigator.customGetUserMediaBar?void navigator.customGetUserMediaBar(n,function(){a(n,t,i,!0)},function(){T.onMediaError({name:"PermissionDeniedError",message:"User denied permission.",constraintName:n,session:d})}):void y(T.resources.customGetUserMediaBar,function(){a(n,t,i,o)});var r={onsuccess:function(e,o,s,r){S(e,o,s,r,n,t,i,u,c,d)},onerror:function(n,t){if(V&&"PERMISSION_DENIED"==n&&(n={message:"",name:"PermissionDeniedError",constraintName:t,session:d}),V&&t.video&&t.video.mozMediaSource)return i={message:ee,name:n.name||"PermissionDeniedError",constraintName:t,session:d},void T.onMediaError(i);if(s(n))return T.onMediaError({message:"Unknown Error",name:n,constraintName:t,session:d});if(n.name&&("PermissionDeniedError"==n.name||"DevicesNotFoundError"==n.name)){var i="Either: ";i+="\n Media resolutions are not permitted.",i+="\n Another application is using same media device.",i+="\n Media device is not attached or drivers not installed.",i+="\n You denied access once and it is still denied.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:d},T.onMediaError(i),_&&(d.audio||d.video)&&DetectRTC.load(function(){d.audio&&!DetectRTC.hasMicrophone&&(f("It seems that you have no microphone attached to your device/system."),d.audio=d.audio=!1,d.video||(alert("It seems that you are capturing microphone and there is no device available or access is denied. Reloading..."),location.reload())),d.video&&!DetectRTC.hasWebcam&&(f("It seems that you have no webcam attached to your device/system."),d.video=d.video=!1,d.audio||(alert("It seems that you are capturing webcam and there is no device available or access is denied. Reloading..."),location.reload())),DetectRTC.hasMicrophone||DetectRTC.hasWebcam?T.getUserMediaPromptedOnce||(T.getUserMediaPromptedOnce=!0,h(e,d)):(alert("It seems that either both microphone/webcam are not available or access is denied. Reloading..."),location.reload())})}if(n.name&&"ConstraintNotSatisfiedError"==n.name){var i="Either: ";i+="\n You are prompting unknown media resolutions.",i+="\n You are using invalid media constraints.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:d},T.onMediaError(i)}d.screen&&(V?l(ee):"https:"!==location.protocol?q||"file:"!=location.protocol&&"http:"!=location.protocol||l("You cannot use HTTP or file protocol for screen capturing. You must either use HTTPs or chrome extension page or Node-Webkit page."):l('Unable to detect actual issue. Maybe "deprecated" screen capturing flag was not set using command line or maybe you clicked "No" button or maybe chrome extension returned invalid "sourceId". Please install chrome-extension: http://bit.ly/webrtc-screen-extension')),de.mutex=!1;var o=JSON.stringify(t);de.streams[o]&&delete de.streams[o]},mediaConstraints:T.mediaConstraints||{}};r.constraints=n||c,r.connection=T,O(r)}var d=n||T.session;if(r(d))return void(e&&e());if(T.dontCaptureUserMedia)return e();if(i(d)||!T.isInitiator&&d.oneway)return T.attachStreams=[],e();var c={audio:!!d.audio&&{mandatory:{},optional:[{chromeRenderToAssociatedSink:!0}]},video:!!d.video};if(T._mediaSources.audio&&c.audio.optional.push({sourceId:T._mediaSources.audio}),T._mediaSources.video&&(c.video={optional:[{sourceId:T._mediaSources.video}]}),!d.screen&&!c.audio&&!c.video)return e();var u={audio:!1,video:{mandatory:{chromeMediaSource:DetectRTC.screen.chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]}};if(V&&d.screen){if("https:"!==location.protocol)return l(ne);f(ee),u.video={mozMediaSource:"window",mediaSource:"window"},c.audio&&(u.audio=!0,c={}),delete u.video.chromeMediaSource}if(d.screen){if(_&&DetectRTC.screen.extensionid!=te&&(ie=!0),_&&!ie&&!t&&!DetectRTC.screen.sourceId)return U("message",o),Q||R(),void Q.postMessage();if(_&&ie&&!t&&"screen"==DetectRTC.screen.chromeMediaSource&&DetectRTC.screen.extensionid)return DetectRTC.screen.extensionid==te&&-1==document.domain.indexOf("webrtc-experiment.com")?h(e,n,!0):(m("checking if chrome extension is installed."),void DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"==t&&(DetectRTC.screen.chromeMediaSource="desktop"),h(e,n,!0),m("chrome extension is installed?","desktop"==DetectRTC.screen.chromeMediaSource)}));if(_&&ie&&"desktop"==DetectRTC.screen.chromeMediaSource&&!DetectRTC.screen.sourceId)return void DetectRTC.screen.getSourceId(function(t){if("PermissionDeniedError"==t){var i={message:"User denied to share content of his screen.",name:"PermissionDeniedError",constraintName:u,session:d};return de.mutex=!1,DetectRTC.screen.chromeMediaSource="desktop",T.onMediaError(i)}return"No-Response"==t?(l("Chrome extension seems not available. Make sure that manifest.json#L16 has valid content-script matches pointing to your URL."),DetectRTC.screen.chromeMediaSource="screen",h(e,n,!0)):void h(e,n,!0)});_&&"desktop"==DetectRTC.screen.chromeMediaSource&&(u.video.mandatory.chromeMediaSourceId=DetectRTC.screen.sourceId);var v=x;a(u,c.audio||c.video?function(){v&&(x=!0),a(c,e)}:e)}else a(c,e,d.audio&&!d.video)}function S(e,i,o,s,r,a,d,u,m,l){s||(s=t()),T.onstatechange({userid:"browser",extra:{},name:"usermedia-fetched",reason:"Captured user media using constraints: "+p(r)}),d&&(e=n(e)),T.localStreamids.push(s),e.onended=function(){h.mediaElement&&!h.mediaElement.parentNode&&document.getElementById(e.streamid)&&(h.mediaElement=document.getElementById(e.streamid)),T.attachStreams.forEach(function(n,t){n==e&&(delete T.attachStreams[t],T.attachStreams=c(T.attachStreams))}),g(h,T),T.streams[s]&&T.removeStream(s);var n=T.streams[s];n&&n.sockets.length&&n.sockets.forEach(function(e){e.send({streamid:n.streamid,stopped:!0})}),de.mutex=!1,de.streams[o]&&delete de.streams[o],DetectRTC.screen.sourceId=null},j||(e.streamid=s,e.isScreen=r==u,e.isVideo=r==m&&!!m.video,e.isAudio=r==m&&!!m.audio&&!m.video,e.preMuted={audio:e.getAudioTracks().length&&!e.getAudioTracks()[0].enabled,video:e.getVideoTracks().length&&!e.getVideoTracks()[0].enabled});var f=v(e,l);f.muted=!0;var h={stream:e,streamid:s,mediaElement:f,blobURL:f.mozSrcObject?URL.createObjectURL(e):f.src,type:"local",userid:T.userid,extra:T.extra,session:l,isVideo:!!e.isVideo,isAudio:!!e.isAudio,isScreen:!!e.isScreen,isInitiator:!!T.isInitiator,rtcMultiConnection:T};x&&T.attachStreams.push(e),x=!1,T.streams[s]=T._getStream(h),i||T.onstream(h),T.setDefaultEventsForMediaElement&&T.setDefaultEventsForMediaElement(f,s),a&&a(e,h),T.onspeaking&&D({stream:e,streamedObject:h,connection:T})}var w,T=this;T.channel=a||RMCDefaultChannel,T.isAcceptNewSession=!0,T.open=function(e){T.isAcceptNewSession=!1,T.isInitiator=!0;var n=!1;return e&&(s(e)?T.sessionid=e:(o(e.transmitRoomOnce)||(T.transmitRoomOnce=e.transmitRoomOnce),o(e.dontTransmit)||(n=e.dontTransmit),o(e.sessionid)||(T.sessionid=e.sessionid))),T.socket&&T.socket.remove&&T.socket.remove(),T.sessionid||(T.sessionid=T.channel),T.sessionDescription={sessionid:T.sessionid,userid:T.userid,session:T.session,extra:T.extra},T.sessionDescriptions[T.sessionDescription.sessionid]||(T.numberOfSessions++,T.sessionDescriptions[T.sessionDescription.sessionid]=T.sessionDescription),d(function(){w.captureUserMediaOnDemand=!!e&&!!e.captureUserMediaOnDemand,e&&e.onMediaCaptured&&(T.onMediaCaptured=e.onMediaCaptured),w.captureUserMediaOnDemand||h(function(){w.initSession({sessionDescription:T.sessionDescription,dontTransmit:n}),C(T)}),w.captureUserMediaOnDemand&&w.initSession({sessionDescription:T.sessionDescription,dontTransmit:n})}),T.sessionDescription},T.connect=function(e){return e&&(T.sessionid=e),d(function(){m("Signaling channel is ready.")}),this},T.join=u,T.send=function(e,n){if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.send(e,n)},1e3);if(!e)throw"No file, data or text message to share.";if(e instanceof Array&&!o(e[0].size)&&!o(e[0].type))for(var t=0;t<e.length;t++)e[t].size&&e[t].type&&T.send(e[t],n);else if(o(e.size)||o(e.type))le.send({text:e,channel:w,_channel:n,connection:T});else{if(!T.enableFileSharing)throw'"enableFileSharing" boolean MUST be "true" to support file sharing.';if(!w.fileBufferReader)return void k(T,function(t){w.fileBufferReader=t,T.send(e,n)});var i=b({userid:T.userid},e.extra||T.extra);w.fileBufferReader.readAsArrayBuffer(e,function(e){w.fileBufferReader.getNextChunk(e,function(e,t,i){n?n.send(e):w.send(e)})},i)}},T.disconnect=function(){w&&w.disconnect(),w=null};var x=!0;T.captureUserMedia=h,T.leave=function(e){return w?(x=!0,e?void T.eject(e):void w.leave()):void 0},T.eject=function(e){if(!T.isInitiator)throw"Only session-initiator can eject a user.";if(!T.peers[e])throw"You ejected invalid user.";T.peers[e].sendCustomMessage({ejected:!0})},T.close=function(){T.autoCloseEntireSession=!0,T.leave()},T.renegotiate=function(e,n){return T.numberOfConnectedUsers<=0?void setTimeout(function(){T.renegotiate(e,n)},1e3):void w.addStream({renegotiate:n||b({oneway:!0},T.session),stream:e})},T.attachExternalStream=function(e,n){var t={};e.getAudioTracks&&e.getAudioTracks().length&&(t.audio=!0),e.getVideoTracks&&e.getVideoTracks().length&&(t.video=!0);var i={video:{chromeMediaSource:"fake"}},o=n?i:t;S(e,!1,"",null,o,!1,!1,i,t,t)},T.addStream=function(e,n){function t(t){w.addStream({stream:t,renegotiate:e||T.session,socket:n})}if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.addStream(e,n)},1e3);if(e){var i;!T.isInitiator&&e.oneway&&(e.oneway=!1,i=!0),h(function(n){i&&(e.oneway=!0),t(n)},e)}else t()},T.removeStream=function(e,n){function t(e,n){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&T.detachStreams.push(e.streamid),n.audio&&e.isAudio&&T.detachStreams.push(e.streamid),n.video&&e.isVideo&&T.detachStreams.push(e.streamid),n.audio||n.video||n.screen||T.detachStreams.push(e.streamid),-1!=T.detachStreams.indexOf(e.streamid)&&(m("removing stream",e.streamid),g(e,T),n.stop&&T.stopMediaStream(e.stream)))}if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.removeStream(e,n)},1e3);if(e||(e="all"),!s(e)||-1!=e.search(/all|audio|video|screen/gi)){for(var i in T.streams)if(-1==T._skip.indexOf(i))if(_stream=T.streams[i],"all"==e)t(_stream,{audio:!0,video:!0,screen:!0});else if(s(e)){var o={};o[e]=!0,t(_stream,o)}else t(_stream,e);return void(!n&&T.detachStreams.length&&T.renegotiate())}var i=T.streams[e];return i?(T.detachStreams.push(i.streamid),m("removing stream",i.streamid),g(i,T),void(n||T.renegotiate())):f("No such stream exists. Stream-id:",e)},T.switchStream=function(e){return T.numberOfConnectedUsers<=0?void setTimeout(function(){T.switchStream(e)},1e3):(T.removeStream("all",!0),void T.addStream(e))},T.sendCustomMessage=function(e){return w&&w.defaultSocket?void w.defaultSocket.send({customMessage:!0,message:e}):setTimeout(function(){T.sendCustomMessage(e)},1e3)},L(T)};var N=[],F=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,V="undefined"!=typeof window.InstallTrigger,B=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,_=!!window.chrome&&!F,j=!!document.documentMode,W=B||j,H=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),q=!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]);window.MediaStream=window.MediaStream||window.webkitMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext;var z=50,G=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);_&&G&&G[2]&&(z=parseInt(G[2],10));var J=50;G=navigator.userAgent.match(/Firefox\/(.*)/),V&&G&&G[1]&&(J=parseInt(G[1],10));var Y=window.console||{log:function(){},error:function(){},warn:function(){}};if(_||V||B)var m=Y.log.bind(Y),l=Y.error.bind(Y),f=Y.warn.bind(Y);var Q,X,K,$={},Z={},ee='Make sure that you are using Firefox Nightly and you enabled: media.getusermedia.screensharing.enabled flag from about:config page. You also need to add your domain in "media.getusermedia.screensharing.allowed_domains" flag. If you are using WinXP then also enable "media.getusermedia.screensharing.allow_on_old_platforms" flag. NEVER forget to use "only" HTTPs for screen capturing!',ne="HTTPs i.e. SSL-based URI is mandatory to use screen capturing.",te="ajhifddimkapgcifgcodmmfdlknahffk",ie=-1!=document.domain.indexOf("webrtc-experiment.com");attachEventListener=function(e,n,t,i){e.addEventListener(n,t,i)};var oe=window.PluginRTC||{};window.onPluginRTCInitialized=function(e){oe=e,MediaStreamTrack=oe.MediaStreamTrack,re=oe.RTCPeerConnection,ue=oe.RTCIceCandidate,ce=oe.RTCSessionDescription,m(W?"Java-Applet":"ActiveX","plugin has been loaded.")},r(oe)||window.onPluginRTCInitialized(oe),W&&y("https://cdn.webrtc-experiment.com/Plugin.EveryWhere.js");var se=window.MediaStream;"undefined"==typeof se&&"undefined"!=typeof webkitMediaStream&&(se=webkitMediaStream),"undefined"==typeof se||"stop"in se.prototype||(se.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop()}),this.getVideoTracks().forEach(function(e){e.stop()})});var re,ae={mandatory:{},optional:[]},de={streams:[],mutex:!1,queueRequests:[]},ce=window.RTCSessionDescription||window.mozRTCSessionDescription,ue=window.RTCIceCandidate||window.mozRTCIceCandidate;"undefined"!=typeof mozRTCPeerConnection?re=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?re=webkitRTCPeerConnection:"undefined"!=typeof window.RTCPeerConnection?re=window.RTCPeerConnection:Y.error("WebRTC 1.0 (RTCPeerConnection) API seems NOT available in this browser.");var me={SaveToDisk:P},le={send:function(e){function n(e,t){var s={type:"text",uuid:m,sendingTime:l};e&&(t=e,s.packets=parseInt(t.length/d)),t.length>d?s.message=t.slice(0,d):(s.message=t,s.last=!0,s.isobject=u),o.send(s,r),c=t.slice(s.message.length),c.length&&setTimeout(function(){n(null,c)},i.chunkInterval||100)}var i=e.connection;if(e.text instanceof ArrayBuffer||e.text instanceof DataView)return e.channel.send(e.text,e._channel);var o=e.channel,r=e._channel,a=e.text,d=i.chunkSize||1e3,c="",u=!1;s(a)||(u=!0,a=JSON.stringify(a));var m=t(),l=(new Date).getTime();n(a)}};!function(){"use strict";function e(){var e,n,t,i=(o.appVersion,o.userAgent),s=o.appName,a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10);return-1!==(n=i.indexOf("Opera"))?(s="Opera",a=i.substring(n+6),-1!==(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!==(n=i.indexOf("MSIE"))?(s="IE",a=i.substring(n+5)):-1!==(n=i.indexOf("Chrome"))?(s="Chrome",a=i.substring(n+7)):-1!==(n=i.indexOf("Safari"))?(s="Safari",a=i.substring(n+7),-1!==(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!==(n=i.indexOf("Firefox"))?(s="Firefox",a=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(s=i.substring(e,n),a=i.substring(n+1),s.toLowerCase()===s.toUpperCase()&&(s=o.appName)),r&&(s="Edge",a=parseInt(o.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10)),-1!==(t=a.indexOf(";"))&&(a=a.substring(0,t)),-1!==(t=a.indexOf(" "))&&(a=a.substring(0,t)),d=parseInt(""+a,10),isNaN(d)&&(a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10)),{fullVersion:a,version:d,name:s}}function n(e){t(function(n){e(n.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+n:"Public: "+n)})}function t(e){function n(n){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,o=i.exec(n)[1];void 0===t[o]&&e(o),t[o]=!0}var t={},i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,o=!!window.webkitRTCPeerConnection;if(!i){var s=document.getElementById("iframe");if(!s)throw"NOTE: you need to have an iframe in the page right above the script tag.";var r=s.contentWindow;i=r.RTCPeerConnection||r.mozRTCPeerConnection||r.webkitRTCPeerConnection,o=!!r.webkitRTCPeerConnection}var a,d={optional:[{RtpDataChannels:!0}]};o&&(a={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof v&&v.browser.isFirefox&&v.browser.version<=38&&(a[0]={url:a[0].urls}));var c=new i(a,d);c.onicecandidate=function(e){e.candidate&&n(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&n(e)})},1e3)}function i(e){return!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices?(m=[],void o.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var t in e)n[t]=e[t];var i;m.forEach(function(e){e.id===n.id&&(i=!0)}),i||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label||(n.label="Please invoke getUserMedia once.",g||(n.label="HTTPs is required to get label of this "+n.kind+" device.")),("audioinput"===n.kind||"audio"===n.kind)&&(f=!0),"audiooutput"===n.kind&&(p=!0),("videoinput"===n.kind||"video"===n.kind)&&(h=!0),m.push(n))}),"undefined"!=typeof v&&(v.MediaDevices=m,v.hasMicrophone=f,v.hasSpeakers=p,v.hasWebcam=h),e&&e()})):void(e&&e())}var o=window.navigator;o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){o.mediaDevices.enumerateDevices().then(e)}),"undefined"!=typeof o?("undefined"!=typeof o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),"undefined"!=typeof o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){}};var s=!!o.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),r=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),a={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows()},getOsName:function(){var e="Unknown OS";return a.Android()&&(e="Android"),a.BlackBerry()&&(e="BlackBerry"),a.iOS()&&(e="iOS"),a.Opera()&&(e="Opera Mini"),a.Windows()&&(e="Windows"),e}},d="Unknown OS";a.any()?d=a.getOsName():(-1!==o.appVersion.indexOf("Win")&&(d="Windows"),-1!==o.appVersion.indexOf("Mac")&&(d="MacOS"),-1!==o.appVersion.indexOf("X11")&&(d="UNIX"),-1!==o.appVersion.indexOf("Linux")&&(d="Linux"));var c=!1,u=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(c=!0),e in document.createElement("video")&&(u=!0)});var m=[],l=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?l=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(l=!0);var f=l,p=l,h=l;i();var v={};v.browser=e(),v.browser["is"+v.browser.name]=!0;var g="https:"===location.protocol,S=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){e in window&&(S=!0)}),v.isWebRTCSupported=S,v.isORTCSupported="undefined"!=typeof RTCIceGatherer;var w=!1;v.browser.isChrome&&v.browser.version>=35?w=!0:v.browser.isFirefox&&v.browser.version>=34&&(w=!0),g||(w=!1),v.isScreenCapturingSupported=w;var C={};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){C.isSupported&&C.isCreateMediaStreamSourceSupported||e in window&&(C.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(C.isCreateMediaStreamSourceSupported=!0))}),v.isAudioContextSupported=C.isSupported,v.isCreateMediaStreamSourceSupported=C.isCreateMediaStreamSourceSupported;var b=!1;v.browser.isChrome&&v.browser.version>31&&(b=!0),v.isRtpDataChannelsSupported=b;var y=!1;if(v.browser.isFirefox&&v.browser.version>28?y=!0:v.browser.isChrome&&v.browser.version>25?y=!0:v.browser.isOpera&&v.browser.version>=11&&(y=!0),v.isSctpDataChannelsSupported=y,v.isMobileDevice=s,v.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,v.isWebSocketsBlocked="Checking",v.isWebSocketsSupported){var T=new WebSocket("wss://echo.websocket.org:443/");T.onopen=function(){v.isWebSocketsBlocked=!1,v.loadCallback&&v.loadCallback()},T.onerror=function(){v.isWebSocketsBlocked=!0,v.loadCallback&&v.loadCallback()}}var k=!1;o.getUserMedia?k=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(k=!0),v.browser.isChrome&&v.browser.version>=47&&!g&&(v.isGetUserMediaSupported="Requires HTTPs"),v.isGetUserMediaSupported=k,v.osName=d,v.isCanvasSupportsStreamCapturing=c,v.isVideoSupportsStreamCapturing=u,v.DetectLocalIPAddress=n,v.load=function(e){this.loadCallback=e,i(e)},v.MediaDevices=m,v.hasMicrophone=f,v.hasSpeakers=p,v.hasWebcam=h;var R=!1;"setSinkId"in document.createElement("video")&&(R=!0),v.isSetSinkIdSupported=R;var x=!1;v.browser.isFirefox?"getSenders"in mozRTCPeerConnection.prototype&&(x=!0):v.browser.isChrome&&"getSenders"in webkitRTCPeerConnection.prototype&&(x=!0),v.isRTPSenderReplaceTracksSupported=x;var M=!1;v.browser.isFirefox&&v.browser.version>38&&(M=!0),v.isRemoteStreamProcessingSupported=M;var D=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(D=!0),v.isApplyConstraintsSupported=D;var O=!1;v.browser.isFirefox&&v.browser.version>=43&&(O=!0),v.isMultiMonitorScreenCapturingSupported=O,window.DetectRTC=v}();var fe;DetectRTC.screen={chromeMediaSource:"screen",extensionid:te,getSourceId:function(e){function n(n){return"installed-enabled"==n?(fe=e,void window.postMessage("get-sourceId","*")):(DetectRTC.screen.chromeMediaSource="screen",void e("No-Response"))}if(!e)throw'"callback" parameter is mandatory.';DetectRTC.screen.status?n(DetectRTC.screen.status):DetectRTC.screen.getChromeExtensionStatus(n)},onMessageCallback:function(e){if(s(e)||e.sourceId){if(m("chrome message",e),"PermissionDeniedError"==e){if(DetectRTC.screen.chromeMediaSource="PermissionDeniedError",fe)return fe("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(DetectRTC.screen.chromeMediaSource="desktop",DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable(),DetectRTC.screen.onScreenCapturingExtensionAvailable=null)),e.sourceId&&(DetectRTC.screen.sourceId=e.sourceId,fe&&fe(DetectRTC.screen.sourceId))}},getChromeExtensionStatus:function(e,n){function t(e){DetectRTC.screen.status=e,n(e)}if(V)return t("not-chrome");2!=arguments.length&&(n=e,e=this.extensionid);var i=document.createElement("img");i.src="chrome-extension://"+e+"/icon.png",i.onload=function(){DetectRTC.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){t("screen"==DetectRTC.screen.chromeMediaSource?"desktop"==DetectRTC.screen.chromeMediaSource?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},i.onerror=function(){t("not-installed")}}},window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.addEventListener("message",function(e){e.origin==window.location.origin&&DetectRTC.screen.onMessageCallback(e.data)})}();
!function(){"use strict";angular.module("tessa-presentation",["angular-uuid","ng.deviceDetector"]).constant("WS_URL","localhost:3000").constant("API_URL","http://localhost:3000").config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(t,e,o){o.setPrefix("tessaP").setStorageType("sessionStorage").setNotify(!0,!0)}])}();
function AngularUUID(){"use strict";function n(n){function r(n,r,e){var u=r&&e||0,a=0;for(r=r||[],n.toLowerCase().replace(/[0-9a-f]{2}/g,function(n){a<16&&(r[u+a++]=g[n])});a<16;)r[u+a++]=0;return r}function e(n,r){var e=r||0,u=v;return u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]}function u(n,r,u){var a=r&&u||0,o=r||[];n=n||{};var t=null!=n.clockseq?n.clockseq:p,f=null!=n.msecs?n.msecs:(new Date).getTime(),l=null!=n.nsecs?n.nsecs:h+1,c=f-U+(l-h)/1e4;if(c<0&&null==n.clockseq&&(t=t+1&16383),(c<0||f>U)&&null==n.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");U=f,h=l,p=t,f+=122192928e5;var i=(1e4*(268435455&f)+l)%4294967296;o[a++]=i>>>24&255,o[a++]=i>>>16&255,o[a++]=i>>>8&255,o[a++]=255&i;var s=f/4294967296*1e4&268435455;o[a++]=s>>>8&255,o[a++]=255&s,o[a++]=s>>>24&15|16,o[a++]=s>>>16&255,o[a++]=t>>>8|128,o[a++]=255&t;for(var d=n.node||y,v=0;v<6;v++)o[a+v]=d[v];return r?r:e(o)}function a(n,r,u){var a=r&&u||0;"string"==typeof n&&(r="binary"===n?new d(16):null,n=null),n=n||{};var t=n.random||(n.rng||o)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,r)for(var f=0;f<16;f++)r[a+f]=t[f];return r||e(t)}var o,t,f,l=n.crypto||n.msCrypto;if(!o&&l&&l.getRandomValues)try{var c=new Uint8Array(16);f=o=function(){return l.getRandomValues(c),c},o()}catch(i){}if(!o){var s=new Array(16);t=o=function(){for(var n,r=0;r<16;r++)0===(3&r)&&(n=4294967296*Math.random()),s[r]=n>>>((3&r)<<3)&255;return s},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}for(var d="function"==typeof Buffer?Buffer:Array,v=[],g={},m=0;m<256;m++)v[m]=(m+256).toString(16).substr(1),g[v[m]]=m;var w=o(),y=[1|w[0],w[1],w[2],w[3],w[4],w[5]],p=16383&(w[6]<<8|w[7]),U=0,h=0,A=a;return A.v1=u,A.v4=a,A.parse=r,A.unparse=e,A.BufferClass=d,A._rng=o,A._mathRNG=t,A._whatwgRNG=f,A}angular.module("angular-uuid",[]).factory("uuid",["$window",n])}"undefined"!=typeof module&&module.exports?module.exports=new AngularUUID:"undefined"!=typeof define&&define.amd?define(function(){return new AngularUUID}):AngularUUID();
!function(){"use strict";angular.module("tessa-presentation").controller("GlobalCtrl",["$scope","uuid","localStorageService","socket","deviceDetector","$interval","$sce","$timeout","API_URL","$state",function(e,t,o,s,i,n,r,a,c,l){var u=o.get("uuid");if(!u){var u=t.v4();console.log(u),o.set("uuid",u)}e.hash=u,e.deviceDetector=i,e.isConnected=!1,e.pdfName="",e.file_type="",e.audio=null,e.asset_file={},e.roomId="",e.userId="",e.disablePreview=!1,e.config={};var p,d=document.querySelector("#frames-container");e.init=function(){e.stop(),p=n(function(){s.emit("pair:deviceUUID",{browser:i.browser,browser_version:i.browser_version,device:i.device,os:i.os,os_version:i.os_version,deviceType:"presentation",deviceUUID:u})},1e3)},e.stop=function(){n.cancel(p)},e.init(),e.loadFile=function(t){e.file_type=t.asset_mimetype,"audio"==t.asset_type?(e.audio=!0,a(function(){e.$apply(function(){e.config={autoPlay:!0,sources:[{src:r.trustAsResourceUrl(t.asset_url),type:t.asset_mimetype}],theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}}})},10)):"video"==t.asset_type?(e.audio=!1,a(function(){e.$apply(function(){e.config={autoPlay:!0,sources:[{src:r.trustAsResourceUrl(t.asset_url),type:t.asset_mimetype}],theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}}})},10)):(e.audio=null,e.pdfName=t.media_name,"application/pdf"==t.asset_mimetype?a(function(){e.$apply(function(){e.pdfUrl=r.trustAsResourceUrl(t.asset_url)})},10):"text/plain"==t.asset_mimetype?a(function(){e.$apply(function(){e.pdfUrl=r.trustAsResourceUrl("https://docs.google.com/gview?url="+t.asset_url+"&embedded=true")})},10):a(function(){e.$apply(function(){e.pdfUrl=r.trustAsResourceUrl("https://view.officeapps.live.com/op/view.aspx?src="+t.asset_url)})},10))},s.on("pair:init",function(){console.log("pair:init")}),s.on("pair:connected",function(t){console.log("pair:connected: ",t),e.isConnected=!0,e.stop(),e.roomId=c,e.userId=t.asset_file.deviceUUID,e.asset_file=t.asset_file}),s.on("pair:closePresentation",function(){a(function(){e.$apply(function(){e.isConnected=!1,e.config={},e.pdfUrl={},l.reload()})},10)}),s.on("pair:fail",function(){e.isConnected=!1,e.init()}),s.on("pair:screenshotR",function(t){console.log("screenshotR: ",t),e.isConnected=!0,d.innerHTML="";var o=document.createElement("img"),s=(new XMLSerializer).serializeToString(t),i="data:image/svg+xml;base64,"+btoa(s);o.src=i,o.style.top=0,o.style.bottom=0,o.style.right=0,o.style.left=0,o.style.width="100%",o.style.height="100%",d.appendChild(o)})}])}();