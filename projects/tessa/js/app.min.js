!function(){"use strict";angular.module("tessaApp",["ui.router","restangular","ngSanitize","ui.bootstrap","ui.select","ngTouch","ngAnimate","angularjs-dropdown-multiselect","toastr","LocalStorageModule","angucomplete-alt","ngFrontier","angularMoment","ngDialog","angularSpinner","angular-loading-bar","angular.filter","textAngular","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster","com.2fdevs.videogular.plugins.buffering","angular-jwt","infinite-scroll","io.dennis.contextmenu","bootstrapLightbox","angularTreeview","angularFileUpload","btford.socket-io","tessa-presentation"]).constant("ACCESSKEY","jeJMH2vWAQocOrat0bu1yqLJg1X0xdYZ").constant("API_URL","http://54.206.38.223:5002").constant("API_VERSION","/api/1.0/")}();
!function(){"use strict";angular.module("tessaApp").run(["$location","APIFactory","$rootScope","$window","$state","localStorageService","$frontierAnalytics","usSpinnerService","AuthFactory","jwtHelper","API_URL",function(e,n,t,i,r,o,a,c,s,u,l){t._=window._,window.API_URL=l,t.allproducts=[],t.cartItems=[],t.cartItems=_.isEmpty(o.get("Cart"))?[]:JSON.parse(o.get("Cart")),a.debugMode(!1),a.allowPageTracking(!1),a.allowEventTracking(!1),a.allowViewTracking(!1),a.allowAppTracking(!1),a.allowDeviceTracking(!1),a.Initialize({accessCode:"958441082755103",trackerName:"project-tessa",encoding:"utf-8"});var p=function(){async.waterfall([function(e){n.getArticles(function(n){_.each(n.response.result,function(e){e.type="Experience"}),_.each(n.response.result,function(e){e.name=e.title,e.id=e.article_id}),e(null,n.response.result)})},function(e,t){n.getProductBundle(function(n){_.each(n.response.result,function(e){e.type="Solutions"}),_.each(n.response.result,function(e){e.name=e.bundle_name,e.id=e.pb_id}),t(null,n.response.result,e)})},function(e,t,i){var r=[];n.getProduct(function(n,o){r=_.filter(o.response.result,function(e){return"Hardware"==e.product_type}),_.each(r,function(e){e.type="Hardware"}),_.each(r,function(e){e.name=e.item_name,e.id=e.p_id}),i(null,r,e,t)})},function(e,n,i,r){var o=[];_.each(e,function(e){1==e.is_published&&0==e.is_archived&&o.push(e)}),_.each(n,function(e){1==e.is_published&&0==e.is_archived&&o.push(e)}),_.each(i,function(e){1==e.is_active&&o.push(e)}),t.allproducts=o}])};s.getCurrentUser()&&p(),t.$on("InitializeData",function(){p()}),t.$on("loading:progress",function(){c.spin("spinner-1")}),t.$on("loading:finish",function(){c.stop("spinner-1")}),t.goBack=function(){i.history.back()},t.$on("$stateChangeStart",function(n,t,i,c,l){if(_.isNull(s.getCurrentUser()))"login"!==t.name&&(n.preventDefault(),r.go("login"));else{var p=s.getUserToken(),f=JSON.parse(o.get("appuser"));a.setUserId(_.toString(f.uc_id)),u.isTokenExpired(p)?s.logout().then(function(){e.path("/login")}):"login"==t.name&&(n.preventDefault(),r.go("main.experience"))}}),t.$on("$stateChangeSuccess",function(e,n,i,r,o){t.currentUser=s.getCurrentUser(),t.label="Solutions"})}])}();
!function(){"use strict";angular.module("tessaApp").config(["$stateProvider","$httpProvider","RestangularProvider","$urlRouterProvider","API_URL","API_VERSION","$provide","usSpinnerConfigProvider","localStorageServiceProvider",function(t,e,r,l,a,o,n,i,s){e.interceptors.push("authInterceptor"),e.interceptors.push("httpInterceptor"),n.value("baseURL",a),r.setBaseUrl(a+o),i.setDefaults({color:"#004D7F",radius:20,width:8,length:16}),s.setPrefix("tessa"),t.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl"}).state("presentation",{url:"/presentation",templateUrl:"presentation/templates/main.html",controller:"GlobalCtrl"}).state("main",{url:"/main",templateUrl:"views/main.html",controller:"MainCtrl"}).state("main.experience",{url:"/experience",templateUrl:"views/experience.html",controller:"expCtrl"}).state("priceBook",{url:"/priceBook",templateUrl:"views/priceBook.html"}).state("main.productCatalogue",{url:"/productCatalogue",templateUrl:"views/catalogue-page.html",controller:"productCtrl"}).state("main.articlePage",{url:"/articlePage/:selected_id",templateUrl:"views/article.page.html",controller:"ModalInstanceCtrl"}).state("main.customerQuotes",{url:"/customerQuotes",templateUrl:"views/customerQuotes.html"}).state("main.quoteProfile",{url:"/quoteProfile/:quote_id",templateUrl:"views/quoteProfile.html",controller:"QuoteCtrl"}).state("main.search",{url:"/search?value",templateUrl:"views/search.html",controller:"searchCtrl"}).state("main.quote",{url:"/quote",templateUrl:"views/quote.html",controller:"QuoteCtrl"}).state("main.productDetailsSolution",{url:"/productCatalogue/productDetailsSolution/:selected_id",templateUrl:"views/productDetailsSolution.html",controller:"detailSolutionCtrl"}).state("main.productDetailsHardware",{url:"/productCatalogue/productDetailsHardware/:selected_id",templateUrl:"views/productDetailsHardware.html",controller:"hardwareDetailsCtrl"}).state("main.presentation",{url:"/presentation",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.assetGallery",{url:"/assetGallery",templateUrl:"views/presentation/asset-gallery.html",controller:"presentationCtrl"}).state("main.presentation_starred",{url:"/presentation/starred",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.presentation_trash",{url:"/presentation/trash",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.openfolder",{url:"/presentation/folder/:_id",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}).state("main.opensubfolder",{url:"/presentation/folder/:_id/s/:sub_id",templateUrl:"views/presentation/presentation.html",controller:"presentationCtrl"}),l.otherwise("/login")}])}();
!function(){"use strict";function t(t,e,o,r,a,c,i,p,s,l,u){i.user=a.isEmpty(l.get("appuser"))?[]:JSON.parse(l.get("appuser"))}angular.module("tessaApp").controller("MainCtrl",t),t.$inject=["$http","$scope","APIFactory","$location","_","$state","$rootScope","$filter","$uibModal","localStorageService","$timeout"]}();
!function(){"use strict";function n(n,e,s,t,r,o,i,c,u,a){n.user={},n.login=function(){u.spin("spinner-login"),e.authenticateAccount(n.user).then(function(n){400!=n.statusCode||n.response.success?n.success?(a.success(n.msg),e.setCurrentUser(n.result.user),e.setUserToken(n.result.token),u.stop("spinner-login"),i.go("main.experience",null,{reload:!0})):(a.warning(n.msg,"Warning"),u.stop("spinner-login")):(o.each(n.response.result,function(n){a.warning(n.msg,"Warning")}),u.stop("spinner-login"))})}}angular.module("tessaApp").controller("loginCtrl",n),n.$inject=["$scope","AuthFactory","$location","$stateParams","$filter","_","$state","localStorageService","usSpinnerService","toastr"]}();
!function(){"use strict";function e(e,t,l,i,r,a,n,c,s,o,d,u){function p(e){return a.map(e,function(e){if("location"==e.type){var t=e.label.replace(/[\s]/g,"");return{label:t.toLowerCase(),type:e.type,index:e.sortindex}}if("configuration"==e.type){e.label.replace(/[\s]/g,"");return{label:e.label,type:e.type,index:e.sortindex}}return"Family"==e.type?{label:e.label,type:e.type,index:e.sortindex}:"Products"==e.type?{label:e.label,type:e.type,index:e.sortindex}:void 0})}e.shows=!0,e.DisplayTab="All",e.allproducts=c.allproducts,e.searchkeyword=i.value,e.bundles=[],e.experience=[],e.location=[],e.configuration=[],e.filterProduct=[],e.filtersearch=[],e.copy=[],e.typeselected=[],e.typeselected2=[],e.typeselected3=[],e.typeselected4=[],e.experiencedata=[{id:1,label:"Eze Impress",type:"Family"},{id:2,label:"Eze Wifi",type:"Family"}],e.producttypedata=[{id:4,label:"Hardware",type:"Products"},{id:6,label:"Experience",type:"Products"},{id:7,label:"Solution",type:"Products"}],e.location=[{id:8,label:"Indoor",type:"location"},{id:9,label:"Outdoor",type:"location"},{id:10,label:"Semi Outdoor",type:"location"}],e.config=[{id:11,label:"Wall Mounted",type:"configuration"},{id:12,label:"Floor Mounted",type:"configuration"}],e.dynamicPopover={templateUrl:"productType.html",templateUrl2:"ezefamily.html",templateUrl3:"location.html",templateUrl4:"configuration.html"},c.$watch("allproducts",function(t){e.allproducts=t}),i.value&&(async.waterfall([function(e){t.getProduct(function(t,l){e(null,l.response.result)})},function(e,l){t.getProductBundle(function(t){l(null,e,t.response.result)})},function(l,n,c){t.getAll(i.value).then(function(t){if(200==t.statusCode&&t.response.success){var l=[];l=a.filter(t.response.result.values,function(e){return"Services"!==e.type}),a.each(l,function(t){if(!a.isEmpty(e.allproducts)){var l=a.find(e.allproducts,{id:t.id});a.isUndefined(l)||(l.p_id?(t.is_archived=l.is_archived,t.img_default=l.img_default,t.is_published=l.is_published,t.tags=l.tags):l.pb_id?(t.product_images=l.product_images,t.is_archived=l.is_archived,t.is_published=l.is_published,t.product_bundle_category=l.product_bundle_category):l.article_id&&(t.mediafiles=l.mediafiles,t.is_active=l.is_active,t.type=l.type))}})}var i=[],c=r("filter")(l,{self:"articles"});e.articles=a.filter(c,function(e){return 1==e.is_active});var s=r("filter")(l,{self:"products"});e.products=a.filter(s,function(e){return 1==e.is_published&&0==e.is_archived});var d=r("filter")(l,{self:"bundles"});a.each(d,function(t){var l=a.find(n,{pb_id:t.id});a.isUndefined(l)||(l.pb_id==t.id&&(l.self=t.self,l.type="Solution",l.product_bundle_category.length>0&&(l.category_label=l.product_bundle_category[0].category_label)),e.bundles.push(l))}),e.bundles=a.filter(e.bundles,function(e){return 1==e.is_published&&0==e.is_archived}),i.push(e.articles),i.push(e.products),i.push(e.bundles),e.filtersearch=a.flattenDeep(i),e.copy=angular.copy(e.filtersearch),e.filterProduct=angular.copy(e.filtersearch),a.isEmpty(e.filtersearch)&&o(function(){e.noresult="NO RESULT FOUND"},700)})}]),u.trackEvent("Global Search","search",i.value,e.filtersearch.length)),e.activeTab=function(t){e.DisplayTab=t},e.detail=function(t,l){e.selected=t},e.openModal=function(t){var l=s.open({animation:!0,templateUrl:"./views/search.detail.modal.html",size:"md",controller:"searchDetailControl",backdrop:!0,windowClass:"xd-modal",backdropClass:"modal-backdrop fade in",resolve:{search:function(){return t}}});l.result.then(function(t){e.selected=t},function(){console.info("Modal dismissed at: "+new Date)})},e.filterCheck=function(){e.typeselected&&e.typeselected.length<1?(e.filterProduct=angular.copy(e.copy),e.filtersearch=angular.copy(e.filterProduct)):e.typeselected2&&e.typeselected2.length<1?e.filtersearch=angular.copy(e.filterProduct):e.typeselected3&&e.typeselected3.length<1?e.filtersearch=angular.copy(e.filterFamily):e.typeselected4&&e.typeselected4.length<1&&(e.filtersearch=angular.copy(e.filterLocation)),e.articles=r("filter")(e.filtersearch,{self:"articles"}),e.products=r("filter")(e.filtersearch,{self:"products"}),e.bundles=r("filter")(e.filtersearch,{self:"bundles"}),c.$broadcast("loading:finish")},e.toggleSelectedType=function(t,l){e.bundleTags=[];var i=[];e.filtersearch=[],c.$broadcast("loading:progress"),o(function(){n()},600);var n=function(){if(e.typeselected.indexOf(t)==-1?(t.sortindex=l,e.typeselected.push(t)):e.typeselected=a.filter(e.typeselected,function(e){return e.id!=t.id}),e.typeselected=a.sortBy(e.typeselected,["sortindex"]),i=p(e.typeselected),i&&i.length>0){var n=[];a.map(e.copy,function(t){a.each(t.tags,function(t){a.isEmpty(t.tags)||e.bundleTags.push(t)})});a.each(i,function(t){var l=[],i=[],c=[];l=a.filter(e.copy,{type:t.label}),i=a.filter(e.copy,{category_label:t.label}),c=r("filter")(e.bundleTags,{tags:t.label}),l&&l.length>0&&a.each(l,function(t){var l=a.find(e.copy,{_id:t._id});a.isUndefined(l)||n.push(l)}),i&&i.length>0&&a.each(i,function(t){var l=a.find(e.copy,{_id:t._id});a.isUndefined(l)||n.push(l)}),c&&c.length>0&&a.each(c,function(t){if(t.pb_id){var l=a.find(e.copy,{pb_id:t.pb_id});a.isUndefined(l)||n.push(l)}else{var l=a.find(e.copy,{p_id:t.p_id});a.isUndefined(l)||n.push(l)}})}),e.filterProduct=a.uniqBy(n,function(e){return e._id})}else e.filterProduct=angular.copy(e.copy);e.filtersearch=angular.copy(e.filterProduct),e.articles=r("filter")(e.filtersearch,{self:"articles"}),e.products=r("filter")(e.filtersearch,{self:"products"}),e.bundles=r("filter")(e.filtersearch,{self:"bundles"}),c.$broadcast("loading:finish"),a.isEmpty(e.filtersearch)&&o(function(){e.noresult="NO RESULT FOUND"},700)}}}angular.module("tessaApp").controller("searchCtrl",e),e.$inject=["$scope","APIFactory","$location","$stateParams","$filter","_","$state","$rootScope","$uibModal","$timeout","usSpinnerService","$frontierAnalytics"]}();
!function(){"use strict";function e(e,s,l,t,n,a){console.log("selected:",l),e.selected=l,e.images=e.selected.mediafiles,e.cancel=function(){s.dismiss("cancel")},e.viewDetails=function(e){"products"==e.self?(n.go("main.productDetailsHardware",{selected_id:e.id},{reload:!0}),s.dismiss("cancel")):(n.go("main.productDetailsSolution",{selected_id:e.pb_id},{reload:!0}),s.dismiss("cancel"))},e.openShareModal=function(){var s=t.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return e.selected},param:function(){return"articles"==e.selected.self?"article":"bundles"==e.selected.self?"bundle":"products"==e.selected.self?"product":void 0}}});s.result.then(function(s){e.selected=s},function(){console.info("Modal dismissed at: "+new Date)})}}angular.module("tessaApp").controller("searchDetailControl",e),e.$inject=["$scope","$uibModalInstance","search","$uibModal","$state","$sce"]}();
!function(){"use strict";function e(e,t,a,r,i,c,n,o,s,l,d){function u(e){return i.map(e,function(e){if("location"==e.type){var t=e.label.replace(/[\s]/g,"");return{label:t.toLowerCase(),type:e.type,index:e.sortindex}}if("configuration"==e.type)return{label:e.label,type:e.type,index:e.sortindex}})}function p(e,t,a,c){var n=[],o=[],s=[];return e.att_id?(i.each(t,function(e){n=r("filter")(a,{value:e.value}),n&&n.length>0&&i.each(n,function(e){o=i.find(c,{p_id:e.p_id}),i.isUndefined(o)||s.push(o)})}),s):(i.each(t,function(e){n=r("filter")(a,{tags:e.label}),n.length>0&&i.each(n,function(e){o=i.find(c,{pb_id:e.pb_id}),i.isUndefined(o)||s.push(o)})}),s)}e.solutionTypes="EzeImpress",e.prodTypeLabel=i.isEmpty(s.get("label"))?"Solution":JSON.parse(s.get("label")),d.trackView("Product Catalogue/",e.prodTypeLabel,"/",e.solutionTypes),e.txtSearch="",e.bundles=[],e.productDetails=[],e.seemore=!0,e.products=[],e.productscopy=[],e.ezewificopy=[],e.categoryWifi=[],e.screens=[],e.Screens=[],e.ScreenSize=[],e.media=[],e.MediaPlayer=[],e.Mediacopy=[],e.bundleTags=[],e.searchcopy=[],e.filtercopy=[],e.typeselected=[],e.tagselected=[],e.productsAttributesValue=[],e.hardwareType=i.isEmpty(s.get("hardtype"))?"Screens":JSON.parse(s.get("hardtype")),e.location=[{id:8,label:"Indoor",type:"location"},{id:9,label:"Outdoor",type:"location"},{id:10,label:"Semi Outdoor",type:"location"}],e.config=[{id:11,label:"Wall Mounted",type:"configuration"},{id:12,label:"Floor Mounted",type:"configuration"}],e.dynamicPopover={location:"location.html",mounting:"configuration.html",screensize:"screens.html",brightness:"brightness.html",bezel:"bezel.html",usage:"usage.html",displaytechno:"displaytechno.html",weight:"weight.html",dimensions:"dimensions.html",orientation:"orientation.html",displayinterface:"displayinterface.html",vesa:"vesa.html",screentype:"screentype.html",resolution:"resolution.html",templateUrl7:"wifi.html",templateUrl8:"ram.html",templateUrl9:"displaytechno.html",templateUrlStorage:"storage.html",templateUrlGraphics:"graphics.html",templateUrlResolution:"resolutions.html"},e.infiniteScrollData={},e.infiniteScrollData.numToAdd=10,e.infiniteScrollData.currentItems=10,e.resetInfScroll=function(){e.infiniteScrollData.currentItems=e.infiniteScrollData.numToAdd},e.addMoreItems=function(){e.infiniteScrollData.currentItems+=e.infiniteScrollData.numToAdd};var f=function(){t.getProductBundle(function(t){var a=[],c=[];i.map(t.response.result,function(t){1==t.is_published&&0==t.is_archived&&(i.isUndefined(t)||e.products.push(t))}),c=i.map(e.products,function(e){return void 0!=e.product_bundle_category[0]&&a.push(e.product_bundle_category[0]),e.products.length>0||(e.weekly=0),e.products});var n=i.flattenDeep(c),o=i.map(n,function(e){return e.product_detail});i.each(n,function(e){var t=i.find(o,{p_id:e.product_id});i.isUndefined(t)||(e.productType_id=t.productType_id,e.sell_price=t.sell_price,t.product_category.length>0&&(e.category_id=t.product_category[0].category_id))});var s=i.groupBy(n,"pb_id");if(i.map(s,function(t,a){var c=r("filter")(t,{productType_id:18}),n=r("filter")(t,{productType_id:17}),o=r("filter")(t,{productType_id:20});if(parseInt(a)==parseInt(a)){if((n.length>0||c.length>0)&&(e.resulthardwaresum=i.sum(i.map(n,function(e){return e.sell_price*e.quantity})),e.softwaresum=i.sum(i.map(c,function(e){return e.sell_price*e.quantity}))),o.length>0){var s=r("filter")(o,{category_id:87}),l=r("filter")(o,{category_id:90});(s.length>0||l.length>0)&&(e.deploymentservice=i.sum(i.map(s,function(e){return e.sell_price*e.quantity})),e.supportservice=i.sum(i.map(l,function(e){return e.sell_price*e.quantity}))),e.servicesum=i.sum(i.map(o,function(e){return e.sell_price*e.quantity}))}void 0==e.deploymentservice&&void 0==e.supportservice?(e.deploymentservice=0,e.supportservice=0):(e.deploymentservice,e.supportservice);var d=e.deploymentservice+e.softwaresum+e.resulthardwaresum;e.weekly=12*(31.111*d/1e3+e.supportservice)/52}i.each(e.products,function(t){t.pb_id==parseInt(a)&&(t.weekly=e.weekly)})}),i.each(e.products,function(e){i.find(a,function(t){e.pb_id==t.bundle_id&&(e.category_label=t.category_label,e.category_id=t.category_id)})}),e.categoryWifi=i.filter(e.products,function(e){return 101==e.category_id}),e.categoryWifi&&e.categoryWifi.length>0){var l=i.flattenDeep(i.map(e.categoryWifi,function(e){return e.products})),d=i.map(l,function(e){return e.product_detail});i.each(d,function(e){i.each(e.product_category,function(t){"CMS"==t.category_label&&(e.category_label=t.category_label)})}),e.categWifi=r("filter")(d,{category_label:"CMS"})}e.alength=e.products.length,e.productscopy=angular.copy(e.products),e.ezewificopy=angular.copy(e.categoryWifi)}),async.waterfall([function(a){t.getProduct(function(t,c){e.allproducts=c.response.result,e.hardware=i.filter(e.allproducts,function(e){return"Hardware"===e.product_type}),e.prodCateg=[];for(var n=0;n<e.hardware.length;n++)for(var o=0;o<e.hardware[n].product_category.length;o++)e.prodCateg.push(e.hardware[n].product_category[o]);i.each(e.hardware,function(t){i.find(e.prodCateg,function(e){t.p_id==e.product_id&&(t.category_id=e.category_id)})});var s=r("filter")(e.hardware,{category_id:80}),l=r("filter")(e.hardware,{category_id:83});a(null,s,l)})},function(e,a,r){async.each(e,function(e,a){t.getProductAttribute(e.p_id,function(t,r){if(200==r.statusCode&&r.response.success&&e.p_id==r.response.result.p_id){var i=r.response.result.attribute_values;i&&i.length>0?e.attributes=r.response.result:e.attributes=null,a()}})},function(t,i){var c=e;r(null,e,a,c)})},function(e,a,r,i){async.each(a,function(e,a){t.getProductAttribute(e.p_id,function(t,r){if(200==r.statusCode&&r.response.success&&e.p_id==r.response.result.p_id){var i=r.response.result.attribute_values;i&&i.length>0?e.attributes=r.response.result:e.attributes=null,a()}})},function(t,c){var n=a;i(null,e,a,r,n)})},function(t,a,c,n,o){if(c&&c.length>0){e.Screens=c,e.Screenscopy=angular.copy(c);var s=[];i.each(c,function(e){i.isNull(e.attributes)||s.push(e.attributes.attribute_values)}),s=i.flattenDeep(s),e.attribute_values=angular.copy(s),e.ScreenSize=r("filter")(s,{attribute:"Screen Size"}),e.Brightness=r("filter")(s,{attribute:"Brightness"}),e.Bezel=r("filter")(s,{attribute:"Bezel Size"}),e.Usage=r("filter")(s,{attribute:"Usage"}),e.Displaytechno=r("filter")(s,{attribute:"Display Technology"}),e.weight=r("filter")(s,{attribute:"Weight"}),e.dimensions=r("filter")(s,{attribute:"Dimensions"}),e.orientation=r("filter")(s,{attribute:"Orientation"}),e.displayinterface=r("filter")(s,{attribute:"Display Interface"}),e.vesa=r("filter")(s,{attribute:"Vesa"}),e.screentype=r("filter")(s,{attribute:"Screen type"}),e.resolution=r("filter")(s,{attribute:"Resolution"})}if(n&&n.length>0){e.MediaPlayer=n,e.Mediacopy=angular.copy(n);var s=[];i.each(n,function(e){i.isNull(e.attributes)||s.push(e.attributes.attribute_values)}),s=i.flattenDeep(s),e.Mediaattribute_values=angular.copy(s),e.Ram=r("filter")(s,{attribute:"RAM"}),e.Storage=r("filter")(s,{attribute:"Storage"}),e.Graphics=r("filter")(s,{attribute:"Graphics"}),e.Resolution=r("filter")(s,{attribute:"Maximum Resolution"})}}])};e.activateTab=function(t){e.solutionTypes=t,d.trackView("Product Catalogue/",e.prodTypeLabel,"/",t)},e.toggleSelectedType=function(t){var a=[];if(o.$broadcast("loading:progress"),t.att_id)if("MediaPlayer"==e.hardwareType)if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchmedia)if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.Mediaattribute_values,e.searchmedia),l(function(){e.MediaPlayer=c,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else l(function(){e.MediaPlayer=angular.copy(e.searchmedia),o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.Mediaattribute_values,e.Mediacopy),l(function(){e.MediaPlayer=c,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else e.MediaPlayer=angular.copy(e.Mediacopy),l(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchscreen)if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.attribute_values,e.searchscreen),e.Screens=angular.copy(c),e.filterScreens=angular.copy(r),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.searchscreen),e.filterScreens=angular.copy(e.Screens),l(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var r=[],c=[];c=p(t,e.tagselected,e.attribute_values,e.Screenscopy),e.Screens=c,e.filterScreens=angular.copy(r),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.Screenscopy),e.filterScreens=angular.copy(e.Screens),o.$broadcast("loading:finish");else{l(function(){n()},600);var n=function(){if(e.typeselected.indexOf(t)==-1?e.typeselected.push(t):e.typeselected=i.filter(e.typeselected,function(e){return e.id!=t.id}),a=u(e.typeselected),i.isEmpty(e.searchcopy)){if(a&&a.length>0){i.map(e.productscopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),c=p(t,a,e.bundleTags,e.productscopy),e.filterProduct=i.uniqBy(c,function(e){return e._id}),console.log("$scope.filterProduct:",e.filterProduct),o.$broadcast("loading:finish")}else e.filterProduct=angular.copy(e.productscopy),o.$broadcast("loading:finish");e.products=angular.copy(e.filterProduct),e.filtercopy=angular.copy(e.filterProduct),o.$broadcast("loading:finish")}else{if(a&&a.length>0){i.map(e.searchcopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),c=p(t,a,e.bundleTags,e.searchcopy),e.filterProduct=i.uniqBy(c,function(e){return e._id}),l(function(){o.$broadcast("loading:finish")},600)}else e.filterProduct=angular.copy(e.searchcopy),l(function(){o.$broadcast("loading:finish")},600);e.products=angular.copy(e.filterProduct),e.filtercopy=angular.copy(e.filterProduct)}}}},e.refresh=function(){o.$broadcast("loading:progress"),l(function(){f()},600),o.$broadcast("loading:finish")},e.uncheck=function(t,a){var r=[];if(t.checked)if(t.att_id)if(i.each(e.tagselected,function(e){e._id==t._id&&(e.checked=!1)}),"MediaPlayer"==e.hardwareType)if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchmedia)if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.Mediaattribute_values,e.searchmedia),l(function(){e.MediaPlayer=n,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else l(function(){e.MediaPlayer=angular.copy(e.searchmedia),o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.Mediaattribute_values,e.Mediacopy),l(function(){e.MediaPlayer=n,e.filterMedia=angular.copy(e.MediaPlayer),o.$broadcast("loading:finish")},600)}else e.MediaPlayer=angular.copy(e.Mediacopy),l(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.indexOf(t)==-1?e.tagselected.push(t):e.tagselected=i.filter(e.tagselected,function(e){return e._id!=t._id}),!i.isEmpty(e.txtSearch)&&e.searchscreen)if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.attribute_values,e.searchscreen),e.Screens=n,e.filterScreens=angular.copy(c),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.searchscreen),e.filterScreens=angular.copy(e.Screens),l(function(){o.$broadcast("loading:finish")},600);else if(e.tagselected.length>0){var c=[],n=[];n=p(t,e.tagselected,e.attribute_values,e.Screenscopy),e.Screens=n,e.filterScreens=angular.copy(c),o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.Screenscopy),e.filterScreens=angular.copy(e.Screens),o.$broadcast("loading:finish");else if(!i.isEmpty(e.filtercopy)&&(i.each(e.typeselected,function(e){e.id==t.id&&(e.checked=!1)}),e.typeselected.splice(a,1),r=u(e.typeselected),"EzeImpress"==e.solutionTypes))if(i.isEmpty(e.searchcopy)){if(r&&r.length>0){var c=[],n=[];i.map(e.productscopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),n=p(t,r,e.bundleTags,e.productscopy),e.filterProduct=i.uniqBy(n,function(e){return e._id})}else e.filterProduct=angular.copy(e.productscopy);e.products=angular.copy(e.filterProduct),e.filtercopy=angular.copy(e.filterProduct)}else{if(r&&r.length>0){var c=[];i.map(e.searchcopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),n=p(t,r,e.bundleTags,e.searchcopy),e.filterProduct=i.uniqBy(n,function(e){return e._id}),e.products=angular.copy(e.filterProduct),o.$broadcast("loading:finish")}else e.filterProduct=angular.copy(e.filtercopy),e.products=angular.copy(e.filterProduct),o.$broadcast("loading:finish");e.products=angular.copy(e.filterProduct),e.filtercopy=angular.copy(e.filterProduct)}},e.searchData=function(){if(o.$broadcast("loading:progress"),"Solution"==e.prodTypeLabel){l(function(){t()},600);var t=function(){if(i.isEmpty(e.txtSearch))if(e.searchcopy=[],"EzeImpress"==e.solutionTypes)if(i.isEmpty(e.typeselected))e.products=angular.copy(e.productscopy),o.$broadcast("loading:finish");else{var t=[],a=[];if(e.typeselected&&e.typeselected.length>0){var c=[];i.map(e.productscopy,function(t){i.each(t.tags,function(t){i.isEmpty(t.tags)||e.bundleTags.push(t)})}),i.each(e.typeselected,function(n){t=r("filter")(e.bundleTags,n.label),t&&t.length>0&&i.each(t,function(t){a=i.find(e.productscopy,{pb_id:t.pb_id}),i.isUndefined(a)||c.push(a)})}),e.filterProduct=i.uniqBy(c,function(e){return e._id}),e.products=angular.copy(e.filterProduct),o.$broadcast("loading:finish")}}else e.categoryWifi=angular.copy(e.ezewificopy),o.$broadcast("loading:finish");else i.isEmpty(e.typeselected)&&"EzeImpress"==e.solutionTypes?l(function(){e.products=r("filter")(e.productscopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.products.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.typeselected)&&"EzeWifi"==e.solutionTypes?l(function(){e.categoryWifi=r("filter")(e.ezewificopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.categoryWifi.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.typeselected)||"EzeImpress"!=e.solutionTypes?i.isEmpty(e.typeselected)||"EzeWifi"!=e.solutionTypes||l(function(){e.products=r("filter")(e.filtercopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.products.length),o.$broadcast("loading:finish")},300):l(function(){e.products=r("filter")(e.filtercopy,e.txtSearch),e.searchcopy=angular.copy(e.products),d.trackEvent("Category Search","search",e.txtSearch,e.products.length),o.$broadcast("loading:finish")},300)}}else{l(function(){t()},600);var t=function(){if(i.isEmpty(e.txtSearch))if("MediaPlayer"==e.hardwareType)i.isEmpty(e.tagselected)?(e.MediaPlayer=e.Mediacopy,o.$broadcast("loading:finish")):(e.MediaPlayer=angular.copy(e.filterMedia),o.$broadcast("loading:finish"));else if(i.isEmpty(e.tagselected))e.Screens=e.Screenscopy,o.$broadcast("loading:finish");else{var t=[],a=[];if(e.tagselected&&e.tagselected.length>0){var c=[];i.each(e.tagselected,function(n){t=r("filter")(e.attribute_values,{value:n.value}),t&&t.length>0&&i.each(t,function(t){a=i.find(e.Screenscopy,{p_id:t.p_id}),i.isUndefined(a)||c.push(a)})}),e.Screens=c,o.$broadcast("loading:finish")}else e.Screens=angular.copy(e.Screenscopy),o.$broadcast("loading:finish")}else i.isEmpty(e.tagselected)&&"Screens"==e.hardwareType?l(function(){e.Screens=r("filter")(e.Screenscopy,e.txtSearch),e.searchscreen=angular.copy(e.Screens),d.trackEvent("Category Search","search",e.txtSearch,e.Screens.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.tagselected)&&"MediaPlayer"==e.hardwareType?l(function(){e.MediaPlayer=r("filter")(e.Mediacopy,e.txtSearch),e.searchmedia=angular.copy(e.MediaPlayer),d.trackEvent("Category Search","search",e.txtSearch,e.MediaPlayer.length),o.$broadcast("loading:finish")},300):i.isEmpty(e.tagselected)||"Screens"!=e.hardwareType?i.isEmpty(e.tagselected)||"MediaPlayer"!=e.hardwareType||l(function(){e.MediaPlayer=r("filter")(e.filterMedia,e.txtSearch),e.copymedia=angular.copy(e.MediaPlayer),d.trackEvent("Category Search","search",e.txtSearch,e.MediaPlayer.length),o.$broadcast("loading:finish")},300):l(function(){e.Screens=r("filter")(e.filterScreens,e.txtSearch),e.copyscreens=angular.copy(e.Screens),d.trackEvent("Category Search","search",e.txtSearch,e.Screens.length),o.$broadcast("loading:finish")},300)}}},e.clear=function(){"Solution"==e.prodTypeLabel?i.isEmpty(e.txtSearch)&&i.isEmpty(e.typeselected)||(e.txtSearch="",i.forEach(e.typeselected,function(e){e.checked=!1}),e.typeselected.splice(e.typeselected),e.refresh()):"MediaPlayer"==e.hardwareType?i.isEmpty(e.txtSearch)&&i.isEmpty(e.tagselected)||(e.txtSearch="",i.forEach(e.tagselected,function(e){e.checked=!1}),e.tagselected.splice(e.tagselected),e.refresh()):i.isEmpty(e.txtSearch)&&i.isEmpty(e.tagselected)||(e.txtSearch="",i.forEach(e.tagselected,function(e){e.checked=!1}),e.tagselected.splice(e.tagselected),e.refresh())},e.activeProd=function(t){e.prodTypeLabel=t,"Hardware"==t?(e.txtSearch="",e.seemore=!0,d.trackView("Product Catalogue/",t,"/",e.hardwareType)):(e.txtSearch="",e.seemore=!0,d.trackView("Product Catalogue/",t,"/",e.solutionTypes)),s.set("label",JSON.stringify(e.prodTypeLabel))},e.activeHard=function(t){e.hardwareType=t,e.txtSearch="",s.set("hardtype",JSON.stringify(e.hardwareType)),d.trackView("Product Catalogue/",e.prodTypeLabel,"/",t)},e.togglemodal=function(e){var t=c.open({animation:!0,templateUrl:"./views/share.modal.html",controller:"articleCtrl",size:"sm",resolve:{article:function(){return e}}});t.result.then(function(){n.reload()},function(){console.info("Modal dismissed")})},e.refresh()}angular.module("tessaApp").controller("productCtrl",e),e.$inject=["$scope","APIFactory","$location","$filter","_","$uibModal","$state","$rootScope","localStorageService","$timeout","$frontierAnalytics"]}();
!function(){"use strict";function e(e,t,r,o,a,c,s,i,n,d){e.slides=[],e.allproduct=[],e.hardware_category=[],e.service_category=[],e.hardwarecategories=[],e.servicecategories=[],e.service=[],e.hardwares=[],e.softwares=[],e.relatedProductHardware=[],e.relatedProductSoftware=[],s.cartItems=[],s.cartItems=c.isEmpty(n.get("Cart"))?[]:JSON.parse(n.get("Cart")),o.selected_id&&async.waterfall([function(r){t.getProduct(function(t,o){e.allproduct=o.response.result,r(null,o.response.result)})},function(r,o){t.getCategory(function(t,a){e.allcategory=a.response.result,o(null,r,a.response.result)})},function(r,s,i){t.getDetailSolution(o.selected_id,function(t,o){if(200==o.statusCode&&o.response.success){var n=0;e.details=o.response.result,c.each(e.details.product_images,function(t){e.slides.push({image:t.image_path,index:n}),n++}),i(null,r,s,o.response.result),e.products=e.details.products,c.isNull(e.products)&&(e.details.upfront=0),c.map(e.products,function(e){e.product_detail&&(e.productType_id=e.product_detail.productType_id,e.product_category=e.product_detail.product_category,e.sell_price=e.product_detail.sell_price,e.category_id=e.product_detail.product_category[0].category_id,e.item_name=e.product_detail.item_name,e.category_label=e.product_detail.product_category[0].category_label)}),e.services=a("filter")(e.products,{productType_id:20}),e.hardware=a("filter")(e.products,{productType_id:17}),e.software=a("filter")(e.products,{productType_id:18}),e.softwarePrice=c.map(e.software,function(e){return e.sell_price*e.quantity}),e.hardwareCategory=c.filter(e.hardware,function(e){return e.product_category.length>=1}),console.log("$scope.hardwareCategory:",e.hardwareCategory),c.isNull(e.software)||(c.map(e.software,function(t){void 0!=t.product_category[0]&&e.softwares.push(t.product_category[0])}),c.each(e.software,function(t){c.find(e.softwares,function(e){t.product_id==e.product_id&&(t.category_label=e.category_label)})})),c.isNull(e.hardware)||(c.map(e.hardware,function(t){void 0!=t.product_category[0]&&e.hardwares.push(t.product_category[0])}),c.each(e.hardware,function(t){c.find(e.hardwares,function(e){t.p_id==e.product_id&&(t.category_label=e.category_label)})})),c.isNull(e.services)||(c.map(e.services,function(t){void 0!==t.product_category[0]&&e.service.push(t.product_category[0])}),c.each(e.services,function(t){c.find(e.service,function(e){t.p_id==e.product_id&&(t.category_id=e.category_id)})}),e.deployment=a("filter")(e.services,{category_id:87}),e.support=a("filter")(e.services,{category_id:90}),e.hardwarePrice=c.map(e.hardware,function(e){return e.sell_price*e.quantity}),e.deploymentPrice=c.map(e.deployment,function(e){return e.sell_price*e.quantity}),e.upfront=c.sum(e.deploymentPrice)+c.sum(e.hardwarePrice)+c.sum(e.softwarePrice),e.weekly=31.111*e.upfront/1e3*12/52,e.supportPrice=c.map(e.support,function(e){return e.sell_price*e.quantity}),e.spPrice=c.sum(e.supportPrice))}else d.error(o.response.msg,"Error")})},function(r,a,s,i){t.getRelatedSolutions(o.selected_id,function(t,o){if(200==o.statusCode&&o.response.success){var n=o.response.result;i(null,r,a,s,o.response.result),c.each(n,function(t){"Hardware"==t.ref_product.product_type&&e.relatedProductHardware.push(t),"Software"==t.ref_product.product_type&&e.relatedProductSoftware.push(t)})}else d.error(o.response.msg,"Error")})}]),e.openProductModal=function(t){var r=i.open({animation:!0,templateUrl:"./views/productCatalogue.modal.html",size:"md",controller:"detailControl",windowClass:"xd-modal",backdropClass:"modal-backdrop fade in",resolve:{product:function(){return t}}});r.result.then(function(t){e.selected=t})},e.next=function(){console.log("NEXT")},e.addToCart=function(t){if(0==e.upfront)d.error("Cannot add product when the values are 0","Error");else if(t.upfront=e.upfront,t.spPrice=e.spPrice,t.quantity=1,s.cartItems.length>=0){var r=c.filter(s.cartItems,{pb_id:t.pb_id});r.length>0?(r[0].quantity++,c.each(s.cartItems,function(e){e.pb_id==r[0].pb_id&&(e.quantity=r[0].quantity)}),d.success("Quantity Added","Success"),n.set("Cart",JSON.stringify(s.cartItems))):(d.success("Successfully Added","Success"),s.cartItems.push(t),n.set("Cart",JSON.stringify(s.cartItems)))}},e.openShareModal=function(){if(o.selected_id){var t=i.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return{bundle_name:e.details.bundle_name,product_images:e.details.product_images,bundle_description:e.details.bundle_description,products:e.details.products,upfront:e.upfront.toFixed(2),spPrice:e.spPrice.toFixed(2),opex:(36*e.upfront/1e3).toFixed(2),weekly:e.weekly.toFixed(2)}},param:function(){return"bundle"}}});t.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})}}}function t(e,t,r){e.selected=r,e.cancel=function(){t.dismiss("cancel")}}angular.module("tessaApp").controller("detailSolutionCtrl",e).controller("detailControl",t),e.$inject=["$scope","APIFactory","$location","$stateParams","$filter","_","$rootScope","$uibModal","localStorageService","toastr"],t.$inject=["$scope","$uibModalInstance","product"]}();
!function(){"use strict";function e(e,t,s,r,a,c,o,u,i,n,l){u.cartItems=[],e.attributevalues=[],e.SolutionPack=[],e.products=[],e.slides=[],e.relatedProductHardware=[],e.relatedProductSoftware=[],u.cartItems=c.isEmpty(i.get("Cart"))?[]:JSON.parse(i.get("Cart")),r.selected_id&&(async.waterfall([function(s){t.getProductDetail(r.selected_id,function(t,r){if(200==r.statusCode&&r.response.success){e.productDetails=r.response.result;var a=0;e.productDetails.product_images.length>0?c.each(e.productDetails.product_images,function(t){e.slides.push({image:t.image_path,index:a}),a++}):(e.slides.push({image:e.productDetails.img_default,index:a}),a++),s(null,r.response.result)}})},function(s,a){t.getProdCateg(r.selected_id,function(t,r){200==r.statusCode&&r.response.success&&(e.category=r.response.result,a(null,s,r.response.result))})},function(s,a,o){t.getProductBundle(function(t){200==t.statusCode&&t.response.success&&(o(null,s,a,t.response.result),c.each(t.response.result,function(t){c.each(t.products,function(s){s.product_id==r.selected_id&&e.SolutionPack.push(t)})}))})},function(s,a,c,o){t.getProductAttribute(r.selected_id,function(t,r){if(200==r.statusCode&&r.response.success){o(null,s,a,c,r.response.result),e.attributes=r.response.result,e.attributevalues=e.attributes.attribute_values;e.attributes.attribute_values}})}]),async.waterfall([function(s){t.getProduct(function(t,r){200==r.statusCode&&r.response.success&&(e.products=r.response.result,s(null,r.response.result))})},function(s,a){t.getRelatedProduct(r.selected_id,function(t,r){if(200==r.statusCode&&r.response.success){var a=r.response.result;c.each(a,function(t){c.each(s,function(e){e.p_id==t.main_id&&(t.img_default=e.img_default)}),"Hardware"==t.ref_product.product_type&&e.relatedProductHardware.push(t),"Software"==t.ref_product.product_type&&e.relatedProductSoftware.push(t)})}else n.error(r.response.msg,"Error")})}])),e.addToCart=function(t){if(t.upfront=e.productDetails.sell_price,t.quantity=1,u.cartItems.length>=0){var s=c.filter(u.cartItems,{p_id:t.p_id});s.length>0?(s[0].quantity++,c.each(u.cartItems,function(e){e.p_id==s[0].p_id&&(e.quantity=s[0].quantity)}),n.success("Quantity Added","Success"),i.set("Cart",JSON.stringify(u.cartItems))):(n.success("Successfully Added","Success"),u.cartItems.push(t),i.set("Cart",JSON.stringify(u.cartItems)))}},e.openDetail=function(e){l.go("main.productDetailsHardware",{selected_id:e},{reload:!0})},e.openShareModal=function(){if(r.selected_id){var t=o.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return{item_name:e.productDetails.item_name,img_default:e.productDetails.img_default,item_description:e.productDetails.item_description,sell_price:e.productDetails.sell_price.toFixed(2)}},param:function(){return"product"}}});t.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})}}}function t(e,t,s){e.selected=s,e.cancel=function(){t.dismiss("cancel")}}angular.module("tessaApp").controller("hardwareDetailsCtrl",e).controller("hardwareCtrl",t),e.$inject=["$scope","APIFactory","$location","$stateParams","$filter","_","$uibModal","$rootScope","localStorageService","toastr","$state"],t.$inject=["$scope","$uibModalInstance","product"]}();
!function(){"use strict";function e(e,t,i,a,l,s,r,n,d,u){e.detail=[],e.bundles=[],e.slides=[],e.relatedExperience=[],d.selected_id&&(async.waterfall([function(e){n.getArticles(function(t){200==t.statusCode&&t.response.result&&e(null,t.response.result)})},function(t,i){n.getArticleDetail(d.selected_id,function(a){if(200==a.statusCode&&a.response.success){e.detail=a.response.result;var l=0;i(null,t,a.response.result),_.isEmpty(e.detail.mediafiles)||(_.each(e.detail.mediafiles,function(e){if(e){if(console.log("row:",e),"video/mp4"==e.media_mimetype)return e.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-flv"==e.media_mimetype)return e.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-msvideo"==e.media_mimetype)return e.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-ms-wmv"==e.media_mimetype)return e.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/quicktime"==e.media_mimetype)return e.url="http://www.videogular.com/styles/themes/default/latest/videogular.css"}return e.index=l++}),_.each(e.detail.mediafiles,function(t){"image/png"==t.media_mimetype||"image/jpeg"==t.media_mimetype?(e.slides.push({media_name:t.media_name,media_mimetype:t.media_mimetype,image:t.media_path,index:l}),l++):"video/mp4"==t.media_mimetype&&(e.slides.push({media_name:t.media_name,media_mimetype:t.media_mimetype,image:t.media_path,url:t.url,index:l}),l++)}))}})},function(e,t,i){n.getArticleTags(t.article_id,function(a){if(200==a.statusCode&&a.response.success){var l=[];_.map(a.response.result,function(e){"Article"!=e.tags&&"Portfolio"!=e.tags&&l.push(e)}),i(null,e,t,l)}})},function(t,i,a,l){var s=[],r=_.flattenDeep(_.map(t,function(e){return e.tags}));if(_.map(a,function(e){_.each(r,function(t){e.tags==t.tags&&s.push(t)})}),_.each(t,function(t){_.each(s,function(i){t.article_id==i.article_id&&e.relatedExperience.push(t)})}),!_.isEmpty(e.relatedExperience)){var d=_.uniq(e.relatedExperience);e.relatedExperiences=_.filter(d,function(e){return i.article_id!=e.article_id}),_.each(e.relatedExperiences,function(e){if(e.mediafiles.length>0&&(e.image=e.mediafiles[0].media_path),!_.isNull(e.thumbnail_media)){var t=e.article_thumbnail;if(t){if("video/mp4"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-flv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-msvideo"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-ms-wmv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/quicktime"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css"}}})}n.getProductBundle(function(t){var a=t.response.result;i.article_features.length>0?_.each(i.article_features,function(t){var i=_.find(a,{pb_id:t.bundle_id});e.bundles.push(i)}):e.norelated="No related solutions"})}]),e.openShareModal=function(){var t=u.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",backdrop:!1,windowClass:"sharemodal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return e.detail},param:function(){return"article"}}});t.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})},e.select=function(e){r.hash("article_page"),t.go("main.articlePage",{selected_id:e},{reload:!0})})}angular.module("tessaApp").controller("ModalInstanceCtrl",e),e.$inject=["$scope","$state","sharerFactory","toastr","$window","$anchorScroll","$location","APIFactory","$stateParams","$uibModal"]}();
!function(){"use strict";function e(e,t,s,a,i,c,r,d){e.data={},e.data.from="support@engagis-tessa.com.au",e.date=new Date,e.param=a,e.selected={},"article"==a?(e.selected.title=s.title,s.mediafiles&&s.mediafiles.length>0?e.selected.mediafiles=s.mediafiles[0].media_path:e.selected.mediafiles="",e.selected.description=s.description):"bundle"==a?(e.selected.bundle_name=s.bundle_name,s.product_images&&s.product_images.length>0?e.selected.product_images=s.product_images[0].media_path:e.selected.product_images="",e.selected.bundle_description=s.bundle_description,e.selected.products=s.products,e.selected.others={upfront:s.upfront,spPrice:s.spPrice,opex:s.opex,weekly:s.weekly}):"product"==a?(e.selected.item_name=s.item_name,e.selected.img_default=s.img_default,e.selected.item_description=s.item_description,e.selected.sell_price=s.sell_price):"quote"==a&&(e.selected=s),e.spprice=_.sum(_.map(e.selected.quote_item_list,function(e){return e.spprices*e.quantity})),e.subtotal=_.sum(_.map(e.selected.quote_item_list,function(e){var t=e.price*e.quantity;return t})),e.subtotalOpex=_.sum(_.map(e.selected.quote_item_list,function(e){_.isUndefined(e.spprices)&&(e.spprices=0);var t=(31.11*e.price/1e3+e.spprices)*e.quantity;return t})),console.log("$scope.subtotalOpex:",e.subtotalOpex),e.send=function(){"article"==a?(e.data.subject="ENGAGIS-TESSA Articles",e.data.message=$("#printarticle").html()):"bundle"==a?(e.data.subject="ENGAGIS-TESSA Bundle",e.data.message=$("#printbundle").html()):"product"==a?(e.data.subject="ENGAGIS-TESSA Product",e.data.message=$("#printproduct").html()):"quote"==a&&(e.data.subject="ENGAGIS-TESSA Quotes",e.data.message=$("#printquote").html(),e.data.pdf=$("#printpdfquote").html(),e.data._id=e.selected._id),i.shareExperience(e.data,function(s,a){return 200==a.statusCode&&a.response.success?(c.success(a.response.msg,"Success"),e.data.email="",t.dismiss("cancel"),r.go(r.current,null,{reload:!0}),void 0):400===a.statusCode&&!a.response.success&&_.isArray(a.response.result)?void _.each(a.response.result,function(e){c.warning(e.msg,"Warning")}):void c.error(a.response.msg,"Error")}),t.dismiss("send")},e.cancel=function(){t.dismiss("cancel")}}angular.module("tessaApp").controller("ShareModalInstanceCtrl",e),e.$inject=["$scope","$uibModalInstance","article","param","sharerFactory","toastr","$state","localStorageService"]}();
!function(){"use strict";function t(t,e,o,i,n,a,s,c,r){function l(t){_.each(n.cartItems,function(e){e.pb_id==t.pb_id&&e.p_id==t.p_id&&(e.quantity=t.quantity)}),a.set("Cart",JSON.stringify(n.cartItems))}if(n.cartItems=[],t.details=[],t.quantity=1,t.customers=[],t.companies=[],t.company={},t.countries=[],t.cart="items",t.radioModel,t.detail={},t.detail.quote_date=new Date,n.cartItems=_.isEmpty(a.get("Cart"))?[]:JSON.parse(a.get("Cart")),!_.isEmpty(n.cartItems)){t.details=n.cartItems;var p=_.map(t.details,function(t){return t.spPrice});t.spprice=_.sum(p),_.map(t.details,function(t){t.p_id&&(t.spPrice=0)}),a.set("Products",JSON.stringify(t.details)),async.waterfall([function(e){s.getCountries(function(o,i){200==i.statusCode&&i.response.success&&(t.countries=i.response.result,e(null,i.response.result))})},function(e,o){s.getAllPerson(function(i,n){t.customers=_.filter(n.response.result,function(t){return"Customer"==t.person_type}),o(null,e,n.response.result)})},function(e,o,i){s.getCompany(function(e,o){t.companies=o.response.result})}])}t.getCompanyDetail=function(e){console.log("value:",e.originalObject),e.originalObject.company_id?s.companyDetail(e.description.company_id,function(e,o){200==o.statusCode&&o.response.success&&(t.company=o.response.result,t.companycopy=angular.copy(o.response.result))}):t.company.name=e.originalObject},t.getCustomer=function(e){console.log("value:",e),e.originalObject.person_id?(t.company.customer_id=e.originalObject.person_id,t.company.customer=e.originalObject):t.company.customer=e.originalObject},t.inputProductChanged=function(e){t.searchinput=e},t.useBillingAddress=function(e){e?t.company&&(t.company.ship_name=t.company.bill_name,t.company.ship_address=t.company.bill_address,t.company.ship_city=t.company.bill_city,t.company.ship_state=t.company.bill_state,t.company.ship_zipcode=t.company.bill_zipcode,t.company.ship_country=t.company.bill_country):(t.company.ship_address=t.companycopy.ship_address,t.company.ship_city=t.companycopy.ship_city,t.company.ship_state=t.companycopy.ship_state,t.company.ship_zipcode=t.companycopy.ship_zipcode,t.company.ship_country=t.companycopy.ship_country)},t.proceed=function(){t.cart="payment"},t.back=function(){t.cart="items"},t.next=function(){t.cart="customer"},t.monthly=function(){return t.spprice=_.sum(_.map(t.details,function(t){return t.spPrice*t.quantity})),t.spprice},t.total=function(){return t.totals=0,_.forEach(t.details,function(e){t.totals+=e.upfront*e.quantity}),t.totals},t.detail.sub_total=t.total(),t.minusbutton=function(t){t.quantity<=1?(t.quantity=1,l(t)):(t.quantity--,l(t))},t.addbutton=function(t){t.quantity++,l(t)},t.reset=function(){_.each(n.cartItems,function(t){return n.cartItems.splice(n.cartItems,1)}),a.set("Cart",JSON.stringify(n.cartItems))},t.remove=function(t){var e=_.findIndex(n.cartItems,function(e){return e.pb_id==t.pb_id});n.cartItems.splice(e,1),a.set("Cart",JSON.stringify(n.cartItems))},t.cancel=function(){e.dismiss("cancel")},t.confirmation=function(){t.modal={title:"Archive Product?",message:"Are you sure to archive this selected products?"},c.openConfirm({templateUrl:"views/dialog.html",scope:t,className:"ngdialog-theme-default"}).then(function(){var c=JSON.parse(a.get("appuser")),l=new Date;t.detail.quoteproduct_list=[],_.each(n.cartItems,function(e){e.p_id?t.detail.quoteproduct_list.push({item_name:e.item_name,quantity:e.quantity,price:e.upfront,product_id:e.p_id,bundle_id:null,discount:0,total:0}):e.pb_id&&t.detail.quoteproduct_list.push({item_name:e.bundle_name,quantity:e.quantity,price:e.upfront,product_id:null,bundle_id:e.pb_id,discount:0,total:0})});var p=Math.floor(1e3*Math.random()+1);t.detail.quote_number="1000"+p,t.detail.quote_status="P",t.detail.staff_id=c.uc_id,t.detail.customer=t.company.customer,t.detail.other_fee=0,t.detail.tax=0,t.detail.tax=0,t.detail.total_fee=110,t.detail.valid_until=new Date,t.detail.valid_until=new Date(l.setDate(l.getDate()+30)),t.detail.bill_to_address=t.company.bill_address,t.detail.bill_to_city=t.company.bill_city,t.detail.bill_to_country=t.company.bill_country,t.detail.bill_to_state=t.company.bill_state,t.detail.bill_to_zipcode=t.company.bill_zipcode,t.detail.comments=t.company.comments,t.detail.customer_id=t.company.customer_id,t.detail.ship_to_address=t.company.ship_address,t.detail.ship_to_city=t.company.ship_city,t.detail.ship_to_country=t.company.ship_country,t.detail.ship_to_state=t.company.ship_state,t.detail.ship_to_zipcode=t.company.ship_zipcode,t.detail.ship_to=t.company.customer_id,t.detail.bill_to_name=t.company.bill_name,t.detail.ship_to_name=t.company.ship_name,console.log("$scope.detail:",t.detail),console.log("$scope.company:",t.company),s.saveQuote(t.detail,function(s,c){console.log("data:",c),console.log("err:",s),200==c.statusCode&&c.response.success&&(_.isEmpty(n.cartItems)||a.remove("Cart"),e.close(),i(function(){o.go("main.quoteProfile",{quote_id:c.response.result},{reload:!0}),a.set("Company",JSON.stringify(t.company)),a.remove("Customer"),a.remove("Payment"),a.remove("Cart"),r.trackEvent("Quote Generation","generate quote","$scope.detail.quote_number",c.response.result)},300))})},function(t){console.log("Modal promise close: ")})}}angular.module("tessaApp").controller("CartCtrl",t),t.$inject=["$scope","$uibModalInstance","$state","$timeout","$rootScope","localStorageService","APIFactory","ngDialog","$frontierAnalytics"]}();
!function(){"use strict";function t(t,e,s,i,o,r,a,n,u,c){o.user=_.isEmpty(r.get("User"))?[]:JSON.parse(r.get("User")),t.products=_.isEmpty(r.get("Products"))?[]:JSON.parse(r.get("Products")),t.company=_.isEmpty(r.get("Company"))?[]:JSON.parse(r.get("Company")),t.companyname=o.user.company_name,t.details={},t.radioModel="Capex",u.quote_id&&n.getQuoteDetail(u.quote_id,function(e,s){200==s.statusCode&&s.response.success&&(t.details=s.response.result,t.details.type=t.radioModel,t.details.customer=t.details.bill_qoute_info,t.details.date_created=moment(t.details.date_created).format("YYYY-MM-DD"),t.details.valid_until=moment(t.details.valid_until).format("YYYY-MM-DD"),n.getProductBundle(function(e){t.result=[],200==e.statusCode&e.response.success&&(_.each(t.details.quote_item_list,function(t){_.find(e.response.result,function(e){t.bundle_id==e.pb_id&&(_.each(e.products,function(t){t.category_id=t.product_detail.product_category[0].category_id,t.sell_price=t.product_detail.sell_price}),t.products=e.products)})}),t.items=_.map(t.details.quote_item_list,function(e){return e.products&&_.each(e.products,function(e){t.result.push(e)}),_.each(t.products,function(t){e.bundle_id==t.pb_id&&(e.spprices=t.spPrice)}),e.product_id?e:e}),t.totalupfront=_.sum(_.map(t.items,function(t){return t.price*t.quantity})),t.totalupfrontopex=_.sum(_.map(t.items,function(t){return t.price})),t.opexquantity=_.sum(_.map(t.items,function(t){return t.quantity})),t.subtotalOpex=_.sum(_.map(t.items,function(t){_.isUndefined(t.spprices)&&(t.spprices=0);var e=(31.111*t.price/1e3+t.spprices)*t.quantity;return e})),t.spprice=_.sum(_.map(t.items,function(t){return t.spprices*t.quantity})))}))}),t.newvalue=function(){t.details.type=t.radioModel},t.printQoute=function(t){i.print()},t.openShareModal=function(){a.open({animation:!0,templateUrl:"./views/share.modal.html",size:"md",windowClass:"share-modal",controller:"ShareModalInstanceCtrl",resolve:{article:function(){return t.details},param:function(){return"quote"}}})}}angular.module("tessaApp").controller("QuoteCtrl",t),t.$inject=["$scope","sharerFactory","toastr","$window","$rootScope","localStorageService","$uibModal","APIFactory","$stateParams","$filter"]}();
!function(){"use strict";function e(e,t,n,a,o,c,r,s,i,l,u,d,p){t.seemore=!0,t.date=new Date,t.msg="hello",t.shows=!1,t.value="",r.cartItems=o.isEmpty(l.get("Cart"))?[]:JSON.parse(l.get("Cart")),r.user=o.isEmpty(l.get("User"))?[]:JSON.parse(l.get("User")),t.seemore=!t.custom,t.searchinput=u.value,angular.element(document).ready(function(){$("#trigger-sidebar").click(function(){function e(){var e=$(window).width();e<700?$("#myBar, .acc-menu li a").css({"min-width":"0"}):e>700&&$("#myBar, .acc-menu li a").css({"min-width":"56px"})}$(".collapsible").toggle(),$(".collapsible").is(":visible")?$("#myBar, .acc-menu li a").css({"min-width":"245px"}):(e(),$(window).resize(e))}),$("#trigger-close-search, #srch-pop, .exit").click(function(){$("#toolbar-search").hide()}),$("#trigger-toolbar-search,#srch-pop").click(function(){$("#toolbar-search").show()}),$(document).on("click",".btn-checkbox",function(e){e.stopPropagation(),$(this).toggleClass("btn-checkbox-active")})});var h=function(){async.waterfall([function(e){n.getArticles(function(t){o.each(t.response.result,function(e){e.type="Experience"}),o.each(t.response.result,function(e){e.name=e.title,e.id=e.article_id}),e(null,t.response.result)})},function(e,t){n.getProductBundle(function(n){o.each(n.response.result,function(e){e.type="Solutions"}),o.each(n.response.result,function(e){e.name=e.bundle_name,e.id=e.pb_id}),t(null,n.response.result,e)})},function(e,t,a){var c=[];n.getProduct(function(n,r){c=o.filter(r.response.result,function(e){return"Hardware"==e.product_type}),o.each(c,function(e){e.type="Hardware"}),o.each(c,function(e){e.name=e.item_name,e.id=e.p_id}),a(null,c,e,t)})},function(e,n,a,c){var r=[];o.each(e,function(e){1==e.is_published&&0==e.is_archived&&r.push(e)}),o.each(n,function(e){1==e.is_published&&0==e.is_archived&&r.push(e)}),o.each(a,function(e){1==e.is_active&&r.push(e)}),t.allproducts=r}])};h(),t.signout=function(){d.logout().then(function(e){200==e.statusCode&&e.response.success&&(p.success(e.response.msg,"Success"),c.reload())})},t.clear=function(e){e?$("#searchBar").val($("#searchBar").val().slice(0,-1)):$("#searchBar").val("")},t.resetCart=function(){for(var e=t.customers.length;e--;){var n=t.customers[e];"expired"==n.status&&t.customers.splice(e,1)}},t.refreshDelay=function(e){t.search=e,t.allSearch=[],angular.isUndefined(e)||null==e||""==e?t.allSearch=[]:n.getAll(e).then(function(n){if(200==n.statusCode&&n.response.success){o.each(n.response.result.values,function(e){return"Services"==e.type?null:void t.allSearch.push(e)}),o.each(t.allSearch,function(e){"articles"==e.self&&(e.group="Experience"),"bundles"==e.self&&(e.group="Solutions"),"products"==e.self&&(e.group="Hardware")});var a=t.allSearch.slice();return e&&a.indexOf(e)===-1&&a.unshift(e),a}})},t.cartModal=function(){var e=i.open({animation:!0,templateUrl:"./views/cart.modal.html",size:"md",controller:"CartCtrl",windowClass:"xd-modal"});e.result.then(function(e){t.selected=e},function(){console.info("Modal dismissed at: "+new Date),l.remove("Payment")})},t.compareModal=function(){var e=i.open({animation:!0,templateUrl:"./views/compare.modal.html",size:"lg",windowClass:"xd-modal"});e.result.then(function(){},function(){console.info("Modal dismissed at: "+new Date)})},t.inputProductChanged=function(e){t.searchinput=e},t.dataSelected=function(e){console.log("selected:",e),e&&(c.go("main.search",{value:e.originalObject},{reload:!1}),e.originalObject&&c.go("main.search",{value:e.originalObject},{reload:!1}),e.title&&c.go("main.search",{value:e.title},{reload:!1}))},t.clearInput=function(e){e?t.$broadcast("angucomplete-alt:clearInput",e):t.$broadcast("angucomplete-alt:clearInput")}}function t(e,t,n,a){e.product=function(){console.log("product():"),a.remove("label"),a.remove("hardtype"),n.go("main.productCatalogue")}}angular.module("tessaApp").controller("headerCtrl",e).controller("sidebarCtrl",t),e.$inject=["$http","$scope","APIFactory","$location","_","$state","$rootScope","$filter","$uibModal","localStorageService","$stateParams","AuthFactory","toastr"],t.$inject=["$scope","$location","$state","localStorageService"]}();
!function(){"use strict";function e(e,t,i,a,s,l,r,c,n,o,u){t.seemore=!0,t.date=new Date,r.user=s.isEmpty(o.get("User"))?[]:JSON.parse(o.get("User")),t.selectedItem=[],t.articlesList=[],t.lists=[],t.tags=[],t.tagscopy=[],t.selectedTag=[],t.tagselected=[],t.expFilter="all",t.infiniteScrollData={},t.infiniteScrollData.numToAdd=1,t.infiniteScrollData.currentItems=10,t.dynamicPopover={templateUrl:"myPopoverTemplate.html"},t.resetInfScroll=function(){t.infiniteScrollData.currentItems=t.infiniteScrollData.numToAdd},t.addMoreItems=function(){t.infiniteScrollData.currentItems!==t.lists.length&&(t.infiniteScrollData.currentItems+=t.infiniteScrollData.numToAdd,t.articlesList=t.lists,t.articlesList.length=t.infiniteScrollData.currentItems)},t.generateArticles=function(){t.articlesList=[],t.tags=[],t.tagscopy=[],t.lists=[],t.selectedTag=[],i.getArticles(function(e){if(200==e.statusCode&&e.response.success){s.each(e.response.result,function(e){e.name=e.title,e.type="Experience"}),s.map(e.response.result,function(e){e.tags.length>=1&&1==e.is_active&&t.articlesList.push(e)}),t.articlesList=s.map(s.orderBy(t.articlesList,"date_created")).reverse();for(var i=0;i<t.articlesList.length;i++)for(var a=0;a<t.articlesList[a].tags.length;a++)t.articlesList[i].tags[a]&&t.tags.push(t.articlesList[i].tags[a]);s.each(t.articlesList,function(e){if(e.mediafiles.length>0&&(e.image=e.mediafiles[0].media_path),!s.isNull(e.thumbnail_media)){var t=e.article_thumbnail;if(t){if("video/mp4"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-flv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-msvideo"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/x-ms-wmv"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css";if("video/quicktime"==t.media_mimetype)return e.article_thumbnail.url="http://www.videogular.com/styles/themes/default/latest/videogular.css"}}}),t.tagscopy=angular.copy(t.tags),t.tagscopy=s.uniqBy(t.tagscopy,function(e){return e.tags}),t.tagscopy=s.filter(t.tagscopy,function(e){if("Article"!==e.tags&&"Portfolio"!==e.tags)return e}),t.lists=angular.copy(t.articlesList)}})},t.product=function(){o.remove("label"),o.remove("hardtype"),l.go("main.productCatalogue")},t.toggleSelectedTag=function(e){t.tagselected.indexOf(e)==-1?t.tagselected.push(e):t.tagselected=s.filter(t.tagselected,function(t){return t.tags_id!=e.tags_id})},t.isTagSelected=function(e){return t.tagselected.indexOf(e)!==-1},t.isOnSelectedTag=function(){return function(e){if(!(t.tagselected.length>0))return!0;var i=!1,a=s.map(t.tagselected,"tags_id");s.forEach(e.tags,function(e){a.indexOf(e.tags_id)!==-1&&(i=!0)});return i}},t.filterArticle=function(e){if(t.expFilter=e,"all"==e)t.articlesList=angular.copy(t.lists);else{t.articlesList=[];var i=c("filter")(t.tags,{tags:e});s.each(i,function(e){var i=s.find(t.lists,{article_id:e.article_id});t.articlesList.push(i)})}},t.$on("$stateChangeSuccess",function(e,i,a,s,l){"main.experience"==i.name&&(t.tagselected=[],t.generateArticles())})}angular.module("tessaApp").controller("expCtrl",e),e.$inject=["$http","$scope","APIFactory","$location","_","$state","$rootScope","$filter","$uibModal","localStorageService","$timeout"]}();
!function(){"use strict";function e(e,s,t,o,r,i,a,l,n,c,d,m,f){function u(e,s){if(0==e)return"0 Byte";var t=1024,o=s+1||3,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(o))+" "+r[i]}function p(s){if(200==s.statusCode&&s.response.success){e.items=s.response.result,e.assets=angular.copy(s.response.result),e.isLoading=!1,e.showBread=!0,e.disableToolNewFolder=!1,console.log("$state.current.name:",i.current.name),"main.presentation"==i.current.name?(e.activeAllFiles=!0,e.showToolNewFolder=!0,e.showToolNewUpload=!0,e.assets.folders=_.filter(e.assets.folders,function(e){return 0==e.isDeleted}),e.assets.assets=_.filter(e.assets.assets,function(e){return 0==e.isDeleted}),e.assets.assets=_.filter(e.assets.assets,function(e){return null==e.folder_id}),e.assets.folderscopy=angular.copy(e.assets.folders),e.assets.assetscopy=angular.copy(e.assets.assets)):"main.presentation_starred"==i.current.name?(e.activeStarredFiles=!0,e.showToolNewFolder=!1,e.showToolNewUpload=!1,e.showBarDelete=!1,e.assets.folders=_.filter(e.assets.folders,function(e){return 0==e.isDeleted&&1==e.isStarred}),e.assets.assets=_.filter(e.assets.assets,function(e){return 0==e.isDeleted&&1==e.isStarred}),e.starred.folderscopy=angular.copy(e.assets.folders),e.starred.assetscopy=angular.copy(e.assets.assets)):"main.presentation_trash"==i.current.name?(e.activeTrashFiles=!0,e.showToolNewFolder=!1,e.showToolNewUpload=!1,e.showBarDelete=!1,e.showBarRestore=!0,e.showBarShare=!1,e.showToolPreview=!1,e.showToolOpen=!1,e.showBarMore=!1,e.assets.folders=_.filter(e.assets.folders,function(e){return 1==e.isDeleted}),e.assets.assets=_.filter(e.assets.assets,function(e){return 1==e.isDeleted}),e.trash.folderscopy=angular.copy(e.assets.folders),e.trash.assetscopy=angular.copy(e.assets.assets)):"main.openfolder"==i.current.name?(e.assets.folders=_.filter(e.assets.folders,function(e){return 0==e.isDeleted}),e.assets.assets=_.filter(e.assets.assets,function(e){return 0==e.isDeleted})):e.showToolBar=!1,_.each(e.assets.folders,function(e){var s=_.sumBy(e.files,function(e){return e.asset_filesize});e.folder_filesize=u(s),e.isActive=!1,e.isFolder=!0}),_.each(e.assets.assets,function(e){e.asset_filesize=u(e.asset_filesize),e.isActive=!1,e.isFolder=!1}),e.assets.folders&&e.assets.assets&&(e.assets.folders.length>0&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length>0&&e.assets.assets.length<1?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length<1&&(e.showFiles=!1)),_.each(e.assets.folders,function(e){e.files.length>0&&_.each(e.files,function(e){if("video/mp4"==e.asset_mimetype||"video/x-flv"==e.asset_mimetype||"video/x-msvideo"==e.asset_mimetype||"video/x-ms-wmv"==e.asset_mimetype||"video/quicktime"==e.asset_mimetype)return e.url="http://www.videogular.com/styles/themes/default/latest/videogular.css"})}),e.presentationfolders=e.assets.folders,e.toppresentation=_.find(e.presentationfolders,{folder_name:"Top 10 Presentations"});var t=_.find(e.assets.folders,{folder_name:"About Engagis"});t&&(e.aboutengagis=_.each(t.files,function(e){"image/png"==e.asset_mimetype&&(e.asset_name=e.asset_name.slice(0,-4))})),console.log("$scope.assets:",e.assets),e.foldercopy=angular.copy(e.assets.folders),e.assetcopy=angular.copy(e.assets.assets)}}console.log("presentationCtrl"),e.items={},e.assets={},e.trash={},e.starred={},e.DeSelectAll=!1,e.selectedText="Select All",e.selectedFile={},e.presentationfolders=[],e.isList="null"!=s.get("isList")&&0!=s.get("isList"),e.isLoading=!0,e.showBread=!1,e.showFiles=!1,e.disableToolNewFolder=!0,e.showToolNewFolder=!0,e.showToolNewUpload=!0,e.showToolMakeCopy=!1,e.showToolPreview=!1,e.showToolOpen=!1,e.showToolBar=!0,e.showBarDelete=!1,e.showBarRestore=!1,e.showBarShare=!1,e.showBarMore=!1,e.activeAllFiles=!1,e.activeSharedFiles=!1,e.activeStarredFiles=!1,e.activeTrashFiles=!1,e.mirrorFile=!1,e.mirrorDevice={},e.activeDevices=[],f.on("pair:init",function(){console.log("pair:init tessa")}),f.on("pair:sendCode",function(s){_.find(e.activeDevices,{deviceUUID:s.deviceUUID})||e.activeDevices.push(s)}),e.changeDisplay=function(){e.isList=!e.isList,s.set("isList",e.isList),e.isPreso=!e.isPreso,s.set("isPreso",e.isPreso)},e.refreshAssets=function(){e.assets={},e.items={},"main.presentation"==i.current.name?e.activePage="Assets":"main.presentation_starred"==i.current.name?e.activePage="Favorites":"main.presentation_trash"==i.current.name&&(e.activePage="Trash"),r._id&&_.isUndefined(r.sub_id)?(e.isLoading=!0,o.getFolderAssets(r._id).then(p)):r._id&&r.sub_id?(e.showToolNewFolder=!1,e.isLoading=!0,o.getFolderAssets(r.sub_id).then(p)):o.getAllAssets().then(p)},e.refreshAssets(),e.showAllFiles=function(){console.log("$state.current.name:",i.current.name),"main.presentation"==i.current.name?(e.activePage="Assets",e.refreshAssets()):i.go("main.presentation")},e.showAllTrash=function(){console.log("$state.current.name:",i.current.name),"main.presentation_trash"==i.current.name?(e.activePage="Trash",e.refreshAssets()):i.go("main.presentation_trash")},e.showAllStarred=function(){"main.presentation_starred"==i.current.name?(e.activePage="Favorites",e.refreshAssets()):i.go("main.presentation_starred")},e.castModal=function(){var s=t.open({animation:!0,templateUrl:"./views/folder/cast.html",windowClass:"xd-modal",controller:"assetsMirrorModalCtrl",resolve:{activeDevices:function(){return e.activeDevices},asset_file:function(){return e.selectedFile}}});s.result.then(function(s){e.selectedFile&&("mirror"==s.msg&&(e.mirrorFile=!0,e.mirrorDevice=s.device),e.selectedFile.isFolder?e.openFolder(e.selectedFile):e.openFile(e.selectedFile))})},e.newFolder=function(){var e=t.open({animation:!0,templateUrl:"./views/folder/new-item.html",size:"sm",windowClass:"xd-modal",controller:"presentationFolderModalCtrl"});e.result.then(function(e){e&&i.reload()})},e.newUploader=function(){var s=t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/uploader.html",size:"lg",controller:"assetsUploadModalCtrl"});s.result.then(function(s){s&&e.refreshAssets()})},e.copySelected=function(){var e=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/copy.html",controller:"modalpresentation"});e.result.then(function(e){},function(){console.info("Modal dismissed at: "+new Date)})},e.shareToOthers=function(){var s=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/share.html",controller:"assetsShareModalCtrl",resolve:{asset_file:function(){return e.selectedFile}}});s.result.then(function(e){},function(){console.info("Modal dismissed at: "+new Date)})},e.renameSelected=function(){var s=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/rename.html",controller:"assetsRenameModalCtrl",resolve:{asset_file:function(){return e.selectedFile}}});s.result.then(function(e){e&&i.reload()})},e.deleteSelected=function(){function s(e){200==e.statusCode&&e.response.success&&(a.success(e.response.msg,"Success"),l(function(){i.reload()},200))}console.log("deleteSelected"),e.modal={title:"Remove?",message:"Are you sure to remove this?"},c.openConfirm({templateUrl:"./views/folder/customDialog.html",scope:e,className:"ngdialog-theme-default"}).then(function(){_.isEmpty(e.selectedFile)||(e.selectedFile.isFolder?e.selectedFile.isDeleted?o.deleteFolder(e.selectedFile._id).then(s):o.trashFolder(e.selectedFile._id).then(s):e.selectedFile.isDeleted?o.deleteAssetFile(e.selectedFile._id).then(s):o.trashAssetFile(e.selectedFile._id).then(s))})},e.moveSelected=function(){var s=t.open({animation:!0,windowClass:"xd-modal",templateUrl:"./views/folder/move.html",controller:"assetsMoveModalCtrl",resolve:{asset_file:function(){return e.selectedFile}}});s.result.then(function(e){e&&i.reload()})},e.previewSelected=function(){e.selectedFile&&(e.selectedFile.isFolder?(e.openFolder(e.selectedFile),m.trackEvent("Presentation Assets","View",e.selectedFile.folder_name,e.selectedFile.folder_id)):(e.openFile(e.selectedFile),m.trackEvent("Presentation Assets","View",e.selectedFile.asset_name,e.selectedFile.asset_id)))},e.imagepreview=function(s){e.openFile(s)},e.imageCast=function(s){t.open({animation:!0,templateUrl:"./views/folder/cast.html",windowClass:"xd-modal",controller:"assetsMirrorModalCtrl",resolve:{activeDevices:function(){return e.activeDevices},asset_file:function(){return s}}})},e.starredSelected=function(){function s(e){200==e.statusCode&&e.response.success&&(a.success(e.response.msg,"Success"),l(function(){i.reload()},200))}e.selectedFile&&(e.selectedFile.isFolder?o.starredFolder(e.selectedFile._id).then(s):o.starredAssetFile(e.selectedFile._id).then(s))},e.restoreSelected=function(){function s(e){200==e.statusCode&&e.response.success&&(a.success(e.response.msg,"Success"),l(function(){i.reload()},200))}e.selectedFile&&(e.selectedFile.isFolder?o.restoreFolder(e.selectedFile._id).then(s):o.restoreAssetFile(e.selectedFile._id).then(s))},e.openLightboxModal=function(s){e.image_file={url:s.asset_url,caption:s.asset_name,thumbUrl:s.asset_url};var o=t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/lightbox-modal.html",windowClass:"modal-img-fullscreen xd-modal",scope:e,size:"lg",resolve:{files:function(){return s},type:function(){return"video"}}});e.cancel=function(){o.dismiss("cancel")}},e.openVideoModal=function(s){console.log("files:",s),console.log("$scope.mirrorDevice:",e.mirrorDevice),t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/media.html",controller:"assetsMediaModalCtrl",windowClass:"xd-modal",size:"lg",resolve:{files:function(){return s},type:function(){return"video"},mirrorFile:function(){return e.mirrorFile},mirrorDevice:function(){return e.mirrorDevice}}}).result.then(function(){e.mirrorFile=!1})},e.openAudioModal=function(s){t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/media.html",controller:"assetsMediaModalCtrl",windowClass:"xd-modal",size:"md",resolve:{files:function(){return s},type:function(){return"audio"},mirrorFile:function(){return e.mirrorFile},mirrorDevice:function(){return e.mirrorDevice}}}).result.then(function(){e.mirrorFile=!1,e.mirrorDevice={}})},e.openDocsModal=function(s){t.open({animation:!0,backdrop:"static",templateUrl:"./views/folder/preview.html",controller:"assetsDocsModalCtrl",size:"lg",windowClass:"modal-fullscreen xd-modal",resolve:{files:function(){return s},mirrorFile:function(){return e.mirrorFile},mirrorDevice:function(){return e.mirrorDevice}}}).result.then(function(){e.mirrorFile=!1,e.mirrorDevice={}})},e.openFolder=function(s){console.log("folder:",s),s.isFolder&&("main.presentation_trash"!==i.current.name?r._id?i.go("main.opensubfolder",{_id:r._id,sub_id:s._id}):(console.log("SULod"),i.go("main.openfolder",{_id:s._id})):(e.modal={title:"This folder is in your trash",message:"To view this folder, youll need to restore it from your trash. Restore folder?"},c.openConfirm({templateUrl:"./views/folder/customDialog.html",scope:e,className:"ngdialog-theme-default"}).then(function(){o.restoreFolder(s._id).then(function(e){200==e.statusCode&&e.response.success&&(a.success(e.response.msg,"Success"),l(function(){i.reload()},200))})})))},e.openFile=function(s){if("image/jpeg"==s.asset_mimetype||"image/jpg"==s.asset_mimetype||"image/gif"==s.asset_mimetype||"image/x-ms-bmp"==s.asset_mimetype||"image/png"==s.asset_mimetype)e.openLightboxModal(s);else if("audio/mp3"==s.asset_mimetype||"audio/mp4"==s.asset_mimetype)e.openAudioModal(s);else if("video/mp4"==s.asset_mimetype||"video/x-flv"==s.asset_mimetype||"video/x-msvideo"==s.asset_mimetype||"video/x-ms-wmv"==s.asset_mimetype||"video/quicktime"==s.asset_mimetype||"video/3gpp"==s.asset_mimetype)e.openVideoModal(s);else if("application/pdf"==s.asset_mimetype)e.openDocsModal(s);else if("text/plain"==s.asset_mimetype)e.openDocsModal(s);else if("application/msword"==s.asset_mimetype||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==s.asset_mimetype)e.openDocsModal(s);else if("text/csv"==s.asset_mimetype||"application/vnd.ms-excel"==s.asset_mimetype||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==s.asset_mimetype)e.openDocsModal(s);else{if("application/vnd.openxmlformats-officedocument.presentationml.presentation"!=s.asset_mimetype&&"application/vnd.ms-powerpoint"!=s.asset_mimetype)return void a.warning("No available tools to open","Failed");e.openDocsModal(s)}_.isNull(s.folder_id)?m.trackEvent("Presentation Assets","Click",s.asset_name,s.asset_id):m.trackEvent("Presentation Assets","Click",s.folder_name,s.files)},e.deleteFile=function(s){e.modal={title:"Remove File",message:"Are you sure to remove the file?"},c.openConfirm({templateUrl:"./views/folder/customDialog.html",scope:e,className:"ngdialog-theme-default"}).then(function(){o.deleteAssetFile(s._id).then(function(e){200==e.statusCode&&e.response.success&&(a.success(e.response.msg,"Success"),l(function(){i.reload()},200))})})},e.clearSelection=function(){e.selectedFile={},e.showBarDelete=!1,e.showBarRestore=!1,e.showBarShare=!1,e.showBarMore=!1,e.showToolPreview=!1,e.showToolOpen=!1,_.each(e.assets.folders,function(e){e.isActive=!1}),_.each(e.assets.assets,function(e){e.isActive=!1})},e.searchData=function(){_.isEmpty(e.txtSearch)||"main.presentation_trash"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.presentation_trash"==i.current.name?(e.assets.folders=e.trash.folderscopy,e.assets.assets=e.trash.assetscopy):_.isEmpty(e.txtSearch)||"main.presentation_starred"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.presentation_starred"==i.current.name?(e.assets.folders=e.starred.folderscopy,e.assets.assets=e.starred.assetscopy):_.isEmpty(e.txtSearch)||"main.presentation"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.presentation"==i.current.name?(e.assets.folders=e.assets.folderscopy,e.assets.assets=e.assets.assetscopy):_.isEmpty(e.txtSearch)||"main.opensubfolder"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.opensubfolder"==i.current.name?(e.assets.folders=e.foldercopy,e.assets.assets=e.assetcopy):_.isEmpty(e.txtSearch)||"main.openfolder"!=i.current.name?_.isEmpty(e.txtSearch)&&"main.openfolder"==i.current.name&&(e.assets.folders=e.foldercopy,e.assets.assets=e.assetcopy):(e.assets.folders=d("filter")(e.foldercopy,e.txtSearch),e.assets.assets=d("filter")(e.assetcopy,e.txtSearch)):(e.assets.folders=d("filter")(e.foldercopy,e.txtSearch),e.assets.assets=d("filter")(e.assetcopy,e.txtSearch)):(e.assets.folders=d("filter")(e.assets.folderscopy,e.txtSearch),e.assets.assets=d("filter")(e.assets.assetscopy,e.txtSearch)):(e.assets.folders=d("filter")(e.starred.folderscopy,e.txtSearch),e.assets.assets=d("filter")(e.starred.assetscopy,e.txtSearch)):(e.assets.folders=d("filter")(e.trash.folderscopy,e.txtSearch),e.assets.assets=d("filter")(e.trash.assetscopy,e.txtSearch)),_.each(e.assets.folders,function(e){var s=_.sumBy(e.files,function(e){return e.asset_filesize});e.folder_filesize=u(s),e.isActive=!1,e.isFolder=!0}),_.each(e.assets.assets,function(e){e.asset_filesize=_.isInteger(e.asset_filesize)?u(e.asset_filesize):e.asset_filesize,e.isActive=!1,e.isFolder=!1}),e.assets.folders&&e.assets.assets&&(e.assets.folders.length>0&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length>0&&e.assets.assets.length<1?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length>0?e.showFiles=!0:e.assets.folders.length<1&&e.assets.assets.length<1&&(e.showFiles=!1))},e.selectAll=function(){0==e.DeSelectAll?(e.showBarDelete=!0,e.showBarRestore=!1,e.showBarShare=!0,e.showBarMore=!0,_.each(e.assets.folders,function(e){e.isActive=!0}),_.each(e.assets.assets,function(e){e.isActive=!0}),e.DeSelectAll=!0,e.selectedText="Deselect All"):(e.showBarDelete=!1,e.showBarRestore=!0,e.showBarShare=!1,e.showBarMore=!1,_.each(e.assets.folders,function(e){e.isActive=!1}),_.each(e.assets.assets,function(e){e.isActive=!1}),e.DeSelectAll=!1,e.selectedText="Select All")},e.activeSelected=function(s){e.DeSelectAll=!1,e.selectedText="Select All",s&&(s.isActive=!0,"main.presentation_trash"==i.current.name?(e.showBarDelete=!0,e.showBarRestore=!0,e.showBarShare=!1,e.showBarMore=!1,e.showToolPreview=!1,e.showToolOpen=!1,e.showToolMakeCopy=!1):"main.presentation_starred"==i.current.name?(e.showBarDelete=!1,e.showBarRestore=!1,e.showBarShare=!0,e.showBarMore=!0,s.isFolder?(e.showToolPreview=!1,e.showToolOpen=!0,e.showToolMakeCopy=!1):(e.showToolPreview=!0,e.showToolOpen=!1,e.showToolMakeCopy=!0)):(e.showBarDelete=!0,e.showBarRestore=!1,e.showBarShare=!0,e.showBarMore=!0,s.isFolder?(e.showToolPreview=!1,e.showToolOpen=!0,e.showToolMakeCopy=!1):(e.showToolPreview=!0,e.showToolOpen=!1,e.showToolMakeCopy=!0)),e.selectedFile=s,e.presentationfolders&&_.each(e.presentationfolders,function(e){_.each(e.files,function(e){e._id!==s._id&&(e.isActive=!1)})}),e.toppresentation&&_.each(e.toppresentation.files,function(e){e._id!==s._id&&(e.isActive=!1)}),_.each(e.assets.folders,function(e){e._id!==s._id&&(e.isActive=!1)}),_.each(e.assets.assets,function(e){e._id!==s._id&&(e.isActive=!1)}))}}angular.module("tessaApp").controller("presentationCtrl",e),e.$inject=["$scope","localStorageService","$uibModal","assetsFctry","$stateParams","$state","toastr","$timeout","Lightbox","ngDialog","$filter","$frontierAnalytics","socket"]}();
!function(){"use strict";function s(s,e,n,r,t,o){s.folder={},s.create=function(){r._id&&(s.folder.parent_id=r._id),o.createFolder(s.folder).then(function(s){200==s.statusCode&&s.response.success?(t.success(s.response.msg,"Success"),n(function(){e.close("save")},100)):400===s.statusCode&&!s.response.success&&_.isArray(s.response.result)?_.each(s.response.result,function(s){t.warning(s.msg,"Warning")}):t.error(s.response.msg,"Error")})},s.cancel=function(){e.dismiss("cancel")}}angular.module("tessaApp").controller("presentationFolderModalCtrl",s),s.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry"]}();
!function(){"use strict";function e(e,t,s,i,c,n,l,o,a,r,u){function m(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()}function d(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,t=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;t?m(document.documentElement):e&&m(document.documentElement)}function p(){document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function v(){t.reload()}function f(e){console.log("Error: ",e)}console.log("mirrorDevice:",u),e.audio="audio"==n,e.mirrorFile=r,e.mirrorDevice=u,e.onReady=function(e){e.autoPlay=!0},e.config={autoPlay:!0,sources:[{src:c.trustAsResourceUrl(i.asset_url),type:i.asset_mimetype}],theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}},e.device={},e.asset_file=i,e.displayInstallPlugin=!1,e.activeDevices=[],l.on("pair:sendCode",function(t){_.find(e.activeDevices,{deviceUUID:t.deviceUUID})||e.activeDevices.push(t)}),DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"!=t&&(DetectRTC.screen.chromeMediaSource="desktop",a(function(){e.$apply(function(){e.displayInstallPlugin=!0})},10))}),e.selectDevice=function(t){console.log("selectDevice"),e.device=t,e.device?(e.device.connected=!0,"audio/mp3"==e.asset_file.asset_mimetype||"audio/mp4"==e.asset_file.asset_mimetype?e.asset_file.asset_type="audio":"video/mp4"==e.asset_file.asset_mimetype||"video/x-flv"==e.asset_file.asset_mimetype||"video/x-msvideo"==e.asset_file.asset_mimetype||"video/x-ms-wmv"==e.asset_file.asset_mimetype||"video/quicktime"==e.asset_file.asset_mimetype||"video/3gpp"==e.asset_file.asset_mimetype?e.asset_file.asset_type="video":e.asset_file.asset_type="none",e.asset_file.deviceUUID=e.device.deviceUUID,e.asset_file.url=window.location.origin+window.location.pathname+"presentation.html?s=tEs$@486759",e.device.asset_file=e.asset_file,screenCapture.captureDesktop(),l.emit("pair:getCode",e.device)):d()},e.castScreen=function(){e.mirrorDevice&&screenCapture.captureDesktop()},e.starredSelected=function(){function t(t){200==t.statusCode&&t.response.success&&(toastr.success(t.response.msg,"Success"),e.asset_file.isStarred=1)}e.asset_file&&(e.asset_file.isFolder?o.starredFolder(e.asset_file._id).then(t):o.starredAssetFile(e.asset_file._id).then(t))},e.cancel=function(){e.device?l.emit("pair:closePresent",{deviceUUID:e.device.deviceUUID}):l.emit("pair:closePresent",{}),p(),s.dismiss("cancel")},e.installPlugin=function(){!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.webstore.install("https://chrome.google.com/webstore/detail/tessa-presentation/klaagnfcilpkdeicdamepejjmaoahple",v,f)}}function t(e,t,s,i,c,n,l,o,a,r,u,m,d){function p(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()}function v(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,t=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;t?p(document.documentElement):e&&p(document.documentElement)}function f(){document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function F(){t.reload()}function w(e){console.log("Error: ",e)}e.pdfName=c.media_name,e.file_type=c.asset_mimetype,e.device={},e.activeDevices=[],e.onMouseMoveResult="",e.displayInstallPlugin=!1,e.mirrorFile=u,e.mirrorDevice=m;var y,D=e.asset_file=c;if(DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"!=t&&(DetectRTC.screen.chromeMediaSource="desktop",r(function(){e.$apply(function(){e.displayInstallPlugin=!0})},10))}),"application/pdf"==c.asset_mimetype)e.pdfUrl=i.trustAsResourceUrl(c.asset_url);else if("text/plain"==c.asset_mimetype)e.pdfUrl=i.trustAsResourceUrl("https://docs.google.com/gview?url="+c.asset_url+"&embedded=true");else{var U=encodeURI(c.asset_url);e.pdfUrl=i.trustAsResourceUrl("https://view.officeapps.live.com/op/view.aspx?src="+U)}e.stop=function(){a.cancel(y)},e.selectDevice=function(t){e.device=t,e.device?(e.device.connected=!0,"audio/mp3"==D.asset_mimetype||"audio/mp4"==D.asset_mimetype?D.asset_type="audio":"video/mp4"==D.asset_mimetype||"video/x-flv"==D.asset_mimetype||"video/x-msvideo"==D.asset_mimetype||"video/x-ms-wmv"==D.asset_mimetype||"video/quicktime"==D.asset_mimetype||"video/3gpp"==D.asset_mimetype?D.asset_type="video":D.asset_type="none",D.deviceUUID=e.device.deviceUUID,D.url=window.location.origin+window.location.pathname+"presentation.html?s=tEs$@486759",e.device.asset_file=D,d.captureDesktop(),l.emit("pair:getCode",e.device)):v()},e.castScreen=function(){e.mirrorDevice&&d.captureDesktop()},e.cancel=function(){e.device?l.emit("pair:closePresent",{deviceUUID:e.device.deviceUUID}):l.emit("pair:closePresent",{}),e.stop(),f(),s.dismiss("cancel")},e.installPlugin=function(){!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.webstore.install("https://chrome.google.com/webstore/detail/tessa-presentation/klaagnfcilpkdeicdamepejjmaoahple",F,w)},l.on("pair:sendCode",function(t){_.find(e.activeDevices,{deviceUUID:t.deviceUUID})||e.activeDevices.push(t)})}angular.module("tessaApp").controller("assetsMediaModalCtrl",e).controller("assetsDocsModalCtrl",t),e.$inject=["$scope","$state","$uibModalInstance","files","$sce","type","socket","assetsFctry","$timeout","mirrorFile","mirrorDevice"],t.$inject=["$scope","$state","$uibModalInstance","$sce","files","localStorageService","socket","$window","$interval","$timeout","mirrorFile","mirrorDevice","screenCapture"]}();
!function(){"use strict";function e(e,s,o,t,i,l,a){e.files={},e.treedata=[],e.asset_file=a,e.isLoading=!0,e.treedata.push({label:"Main Files",_id:null,folder_id:null}),l.getAllAssets().then(function(s){200==s.statusCode&&s.response.success&&(e.files=s.response.result,_.each(e.files.folders,function(s){var o={label:s.folder_name,_id:s._id,folder_id:s.folder_id,children:[]};_.each(s.sub_folders,function(e){o.children.push({label:e.folder_name,_id:s._id,folder_id:s.folder_id})}),e.treedata.push(o)}),e.isLoading=!1,console.log("$scope.treedata: ",e.treedata))}),e.Move=function(){function t(e){200==e.statusCode&&e.response.success&&(i.success(e.response.msg,"Success"),o(function(){s.close("save")},100))}if(!e.abc||!angular.isObject(e.abc.currentNode))return void i.warning("Please select directory where the files/folder to move","WARNING");var a=e.abc.currentNode;if(e.asset_file.isFolder){if(e.asset_file._id==a._id)return void i.warning("Unable to move folder on same folder source","WARNING");if(e.asset_file.parent_id==a._id)return void i.warning("Unable to move folder on root folder source","WARNING");l.moveFolder(e.asset_file._id,a._id).then(t)}else l.moveAssetFile(e.asset_file._id,a._id).then(t)},e.cancel=function(){s.dismiss("cancel")}}angular.module("tessaApp").controller("assetsMoveModalCtrl",e),e.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","asset_file"]}();
!function(){"use strict";function e(e,s,n,i,l,t,a){e.file={},e.file=a,e.file.isFolder?e.file.foldername=e.file.folder_name:e.file.filename=e.file.asset_name,e.Rename=function(){function i(e){200==e.statusCode&&e.response.success?(l.success(e.response.msg,"Success"),n(function(){s.close("save")},100)):400===e.statusCode&&!e.response.success&&_.isArray(e.response.result)?_.each(e.response.result,function(e){l.warning(e.msg,"Warning")}):l.error(e.response.msg,"Error")}e.file.isFolder?t.updateFolder(e.file._id,{folder_name:e.file.foldername}).then(i):t.updateAssetFile(e.file._id,{file_name:e.file.filename}).then(i)},e.cancel=function(){s.dismiss("cancel")}}angular.module("tessaApp").controller("assetsRenameModalCtrl",e),e.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","asset_file"]}();
!function(){"use strict";function s(s,e,n,r,a,t,o,i,c,u){s.sharer={},s.persons=[],s.company=[],s.items=[],async.waterfall([function(s){o.getCompany(function(e,n){if(200==n.statusCode&&n.response.success){var r=n.response.result;s(null,r)}else s(null,[])})},function(s,e){o.getAllPerson(function(n,r){if(200==r.statusCode&&r.response.success){var a=r.response.result;e(null,s,a)}else e(null,[])})},function(e,n,r){s.persons=angular.copy(n),s.company=angular.copy(e),s.persons=_.filter(s.persons,function(s){if("Customer"==s.person_type&&0==s.isSubscriber)return s}),_.each(s.persons,function(e){s.items.push({displayName:e.displayName,email:e.email||"",_id:e._id})}),_.each(s.company,function(e){s.items.push({displayName:e.name,email:e.email_address||"",_id:e._id})})}]),s.tagTransform=function(s){return{email:s}},s.clearInput=function(s){s.search=""},s.deleteEmail=function(s){console.log("deleteEmail: ",s)},s.sendMail=function(){s.sharer.from="support@engagis-tessa.com.au",s.sharer.subject="ENGAGIS-TESSA Presentation",s.sharer.message=$("#printasset").html(),s.sharer.attachment=c.asset_url||"",s.sharer.email=_.map(s.sharer.email,function(s){return s.email}),i.sendMail(s.sharer,function(s,n){return 200==n.statusCode&&n.response.success?(a.success(n.response.msg,"Success"),e.dismiss("send"),u.go(u.current,null,{reload:!0}),void 0):400===n.statusCode&&!n.response.success&&_.isArray(n.response.result)?void _.each(n.response.result,function(s){a.warning(s.msg,"Warning")}):void a.error(n.response.msg,"Error")})},s.cancel=function(){e.dismiss("cancel")}}angular.module("tessaApp").controller("assetsShareModalCtrl",s),s.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","APIFactory","sharerFactory","asset_file","$state"]}();
!function(){"use strict";function e(e,o,s,l,t,n,i,a,c,u,d,r){console.log("assetsUploadModalCtrl: ",u),e.item={},e.isUploadAll=!0,e.isClose=!1;var f=(JSON.parse(d.get("user")),e.uploader=new l({url:t+n+"assets",method:"POST",headers:{Authorization:"Bearer "+c.getUserToken(),accesskey:i}}));f.filters.push({name:"customFilter",fn:function(e,o){return this.queue.length<10}}),f.onBeforeUploadItem=function(e){e.alias="files",u._id&&_.isUndefined(u.sub_id)?e.formData=[{parent_id:u._id}]:u._id&&u.sub_id&&(e.formData=[{parent_id:u.sub_id}])},f.onSuccessItem=function(e,o,s,l){r.success(o.response.msg,"Success")},f.onWhenAddingFileFailed=function(e,o,s){console.log("item:",e),console.log("filter:",o),console.log("options:",s)},f.onAfterAddingFile=function(e){console.log("onAfterAddingFile:",e)},f.onCompleteAll=function(e){r.success("Media / File upload complete","Success"),a(function(){s.close("success")},1300)},e.uploadAll=function(){f.uploadAll(),e.isUploadAll=!1,e.isClose=!0},e.cancel=function(){s.dismiss("cancel")}}angular.module("tessaApp").controller("assetsUploadModalCtrl",e),e.$inject=["$scope","$state","$uibModalInstance","FileUploader","API_URL","API_VERSION","ACCESSKEY","$timeout","AuthFactory","$stateParams","localStorageService","toastr"]}();
!function(){"use strict";function e(e,t,i,s,c,n,a,o,l,d,m){e.device={},e.activeDevices=[],e.activeDevices=angular.copy(o),e.enableCasting=!0,e.displayInstallPlugin=!1,DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"!=t&&(DetectRTC.screen.chromeMediaSource="desktop",i(function(){e.$apply(function(){e.displayInstallPlugin=!0})},10))}),e.installPlugin=function(){!!navigator.webkitGetUserMedia&&!!window.chrome&&!!chrome.webstore&&!!chrome.webstore.install&&chrome.webstore.install("https://chrome.google.com/webstore/detail/tessa-presentation/klaagnfcilpkdeicdamepejjmaoahple",successCallback,failureCallback)},e.selectDevice=function(t){_.each(e.activeDevices,function(e){return e.selected=!1}),e.enableCasting=!1,t.selected=!0,e.device=t},e.connectDevice=function(){e.device&&(e.device.connected=!0,"audio/mp3"==l.asset_mimetype||"audio/mp4"==l.asset_mimetype?l.asset_type="audio":"video/mp4"==l.asset_mimetype||"video/x-flv"==l.asset_mimetype||"video/x-msvideo"==l.asset_mimetype||"video/x-ms-wmv"==l.asset_mimetype||"video/quicktime"==l.asset_mimetype||"video/3gpp"==l.asset_mimetype?l.asset_type="video":l.asset_type="none",l.deviceUUID=e.device.deviceUUID,l.url=window.location.origin+"/presentation.html?s=tEs$@486759",e.device.asset_file=l,t.close({device:e.device,msg:"mirror"}))},e.cancel=function(){t.dismiss("cancel")},a.on("pair:sendCode",function(t){_.find(e.activeDevices,{deviceUUID:t.deviceUUID})||e.activeDevices.push(t)}),a.on("disconnect",function(e){console.log("disconnect: ",e)})}angular.module("tessaApp").controller("assetsMirrorModalCtrl",e),e.$inject=["$scope","$uibModalInstance","$timeout","$stateParams","toastr","assetsFctry","socket","activeDevices","asset_file","API_URL","$window"]}();
!function(){"use strict";var r=function(r){return function(t,n){return r.uniqBy(t,function(r){return r[n]})}},t=function(){return function(r,t){for(var n="test",e=0;e<r.length;e++);return n}};angular.module("tessaApp").filter("duplicates",["_",r]).filter("count",[t]).filter("ellipsis",function(){return function(r,t,n,e){if(!r)return"";if(n=parseInt(n,10),!n)return r;if(r.length<=n)return r;if(r=r.substr(0,n),t){var u=r.lastIndexOf(" ");u!=-1&&("."!=r.charAt(u-1)&&","!=r.charAt(u-1)||(u-=1),r=r.substr(0,u))}return r+(e||" ")}}).filter("propsFilter",function(){return function(r,t){var n=[];return angular.isArray(r)?r.forEach(function(r){for(var e=!1,u=Object.keys(t),i=0;i<u.length;i++){var f=u[i],o=t[f].toLowerCase();if(r[f].toString().toLowerCase().indexOf(o)!==-1){e=!0;break}}e&&n.push(r)}):n=r,n}})}();
!function(){"use strict";angular.module("tessaApp").directive("errSrc",function(){return{transclude:!0,link:function(n,t,e){n.$watch(function(){return e.ngSrc},function(n){n||t.attr("src",e.errSrc)}),t.bind("error",function(){t.attr("src",e.errSrc)})}}}).directive("ngPrint",function(){function n(n,r,i){r.on("click",function(){var n=document.getElementById(i.printElementId);n&&t(n)}),window.onafterprint=function(){e.innerHTML=""}}function t(n){var t=n.cloneNode(!0);e.innerHTML="",e.appendChild(t),window.print()}var e=document.getElementById("printSection");return e||(e=document.createElement("div"),e.id="printSection",document.body.appendChild(e)),{link:n,restrict:"A"}}).directive("appHeader",function(){return{restrict:"AE",replace:!0,templateUrl:"./views/header.html",controller:"headerCtrl"}}).directive("imageonload",function(){return{restrict:"AE",link:function(n,t,e){t.on("load",function(){t.removeClass("spinner-hide"),t.addClass("spinner-show"),t.parent().find("span").remove()}),n.$watch("ngSrc",function(){t.addClass("spinner-hide")})}}}).directive("lightboxDirective",function(){return{restrict:"E",transclude:!0,template:"<section ng-transclude></section>"}}).directive("ngScrollEvent",["$parse","$window",function(n,t){return function(e,r,i){var c,o,l=n(i.ngScrollEvent),d=r[0],u="scroll",a={x:0,y:0},s=function(){o=function(n){a.x=d.scrollLeft,a.y=d.scrollTop,f(n),p(),v(n,!1)},r.bind(u,o)},f=function(n){c=t.setInterval(function(){a.x==d.scrollLeft&&a.y==d.scrollTop?(t.clearInterval(c),s(),v(n,!0)):(a.x=d.scrollLeft,a.y=d.scrollTop)},INTERVAL_DELAY)},p=function(){r.unbind(u,o)},v=function(n,t){e.$apply(function(){l(e,{$event:n,isEndEvent:t})})};s()}}])}();
angular.module("infinite-scroll",[]).value("THROTTLE_MILLISECONDS",null).directive("infiniteScroll",["$rootScope","$window","$interval","THROTTLE_MILLISECONDS",function(n,e,t,i){return{scope:{infiniteScroll:"&",infiniteScrollContainer:"=",infiniteScrollDistance:"=",infiniteScrollDisabled:"=",infiniteScrollUseDocumentBottom:"=",infiniteScrollListenForEvent:"@"},link:function(l,o,r){var c,u,f,a,d,s,m,S,p,g,$,v,w,D,h,E,T,y,C;return C=angular.element(e),D=null,h=null,f=null,a=null,$=!0,y=!1,T=null,u=!1,g=function(n){return n=n[0]||n,isNaN(n.offsetHeight)?n.document.documentElement.clientHeight:n.offsetHeight},v=function(n){if(n[0].getBoundingClientRect&&!n.css("none"))return n[0].getBoundingClientRect().top+w(n)},w=function(n){return n=n[0]||n,isNaN(window.pageYOffset)?n.document.documentElement.scrollTop:n.ownerDocument.defaultView.pageYOffset},p=function(){var e,i,r,c,d;return a===C?(e=g(a)+w(a[0].document.documentElement),r=v(o)+g(o)):(e=g(a),i=0,void 0!==v(a)&&(i=v(a)),r=v(o)-i+g(o)),y&&(r=g((o[0].ownerDocument||o[0].document).documentElement)),c=r-e,d=c<=g(a)*D+1,d?(f=!0,h?l.$$phase||n.$$phase?l.infiniteScroll():l.$apply(l.infiniteScroll):void 0):(u&&t.cancel(u),f=!1)},E=function(n,e){var i,l,o;return o=null,l=0,i=function(){return l=(new Date).getTime(),t.cancel(o),o=null,n.call()},function(){var r,c;return r=(new Date).getTime(),c=e-(r-l),c<=0?(t.cancel(o),o=null,l=r,n.call()):o?void 0:o=t(i,c,1)}},null!=i&&(p=E(p,i)),l.$on("$destroy",function(){if(a.unbind("scroll",p),null!=T&&(T(),T=null),u)return t.cancel(u)}),m=function(n){return D=parseFloat(n)||0},l.$watch("infiniteScrollDistance",m),m(l.infiniteScrollDistance),s=function(n){if(h=!n,h&&f)return f=!1,p()},l.$watch("infiniteScrollDisabled",s),s(l.infiniteScrollDisabled),S=function(n){return y=n},l.$watch("infiniteScrollUseDocumentBottom",S),S(l.infiniteScrollUseDocumentBottom),c=function(n){if(null!=a&&a.unbind("scroll",p),a=n,null!=n)return a.bind("scroll",p)},c(C),l.infiniteScrollListenForEvent&&(T=n.$on(l.infiniteScrollListenForEvent,p)),d=function(n){if(null!=n&&0!==n.length){if(n.nodeType&&1===n.nodeType?n=angular.element(n):"function"==typeof n.append?n=angular.element(n[n.length-1]):"string"==typeof n&&(n=angular.element(document.querySelector(n))),null!=n)return c(n);throw new Error("invalid infinite-scroll-container attribute.")}},l.$watch("infiniteScrollContainer",d),d(l.infiniteScrollContainer||[]),null!=r.infiniteScrollParent&&c(angular.element(o.parent())),null!=r.infiniteScrollImmediateCheck&&($=l.$eval(r.infiniteScrollImmediateCheck)),u=t(function(){return $&&p(),t.cancel(u)})}}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="infinite-scroll");
!function(){"use strict";function n(n,t,u,l,o){var c={};return c.articleItems=[],c.allitems=[],c.getArticles=function(n){o.all("articleinfo").customGET().then(function(t){n(t)})},c.getArticleDetail=function(n,t){o.all("articleinfo").customGET(n).then(function(n){t(n)})},c.getArticleTags=function(n,t){o.all("article/"+n+"/tags").customGET().then(function(n){t(n)})},c.getProductBundle=function(n){o.all("product-bundle").customGET().then(function(t){n(t)})},c.getAllTags=function(n){o.all("tags").customGET().then(function(t){n(t)})},c.getDetailSolution=function(n,t){o.all("product-bundle/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getProductDetail=function(n,t){o.all("product/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getProduct=function(n){o.all("product").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.searchProduct=function(n,u){var l=t.filter(c.allitems,function(t){var u=new RegExp(n,"ig");return t.item_name.match(u)});u(l)},c.getHardware=function(n,u){o.all("product").customGET().then(function(l){u(t.filter(l),{productType_id:n})})},c.getCategory=function(n){o.all("categories").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.getProductType=function(n){o.all("producttype").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.getAll=function(n){return o.all("filters").customGET("",{filter:"all",value:n}).then(function(n){return n},function(n){return n.data})},c.getAllPerson=function(n){o.all("persons").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.personDetail=function(n,t){o.all("persons/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getProductAttribute=function(n,t){o.all("product/"+n+"/attributes").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.saveCompany=function(n,t){o.all("companyinfo").customPOST(n).then(function(n){t(null,n)},function(n){t(n,null)})},c.getCompany=function(n){o.all("companyinfo").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.companyDetail=function(n,t){o.all("companyinfo/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.saveQuote=function(n,t){o.all("quoteinfo/").customPOST(n).then(function(n){t(null,n)},function(n){t(n,null)})},c.getQuoteDetail=function(n,t){o.all("quoteinfo/"+n).customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getCountries=function(n){o.all("countries").customGET().then(function(t){n(null,t)},function(t){n(t,null)})},c.getProdCateg=function(n,t){o.all("product/"+n+"/category").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getRelatedProduct=function(n,t){o.all("product/"+n+"/related").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c.getRelatedSolutions=function(n,t){o.all("product-bundle/"+n+"/related").customGET().then(function(n){t(null,n)},function(n){t(n,null)})},c}angular.module("tessaApp").factory("APIFactory",n),n.$inject=["$http","_","API_URL","API_VERSION","Restangular"]}();
!function(){"use strict";function e(e,t,r,n,o,a,u,s){return{authenticateAccount:function(e){return o.all("session").customPOST(e).then(function(e){return e},function(e){return e.data})},setUserToken:function(e){a.set("token",e)},getUserToken:function(){return a.get("token")},setCurrentUser:function(e){a.set("appuser",JSON.stringify(e))},getCurrentUser:function(){return a.get("appuser")},logout:function(){return o.all("session").customDELETE().then(function(e){return a.remove("Cart"),a.remove("label"),a.remove("hardtype"),a.remove("Payment"),a.remove("token"),a.remove("appuser"),s.signOut(),e},function(e){return e.data})}}}function t(e,t,r,n,o,a,u){return{request:function(e){if(e.headers=e.headers||{},e.headers.accesskey=o,a.get("token")){var t=a.get("token");JSON.parse(a.get("user"));e.headers.Authorization="Bearer "+t}return e},response:function(e){if(a.get("token")){var t=a.get("token");u.isTokenExpired(t)&&(a.remove("Cart"),a.remove("label"),a.remove("hardtype"),a.remove("Payment"),a.remove("token"),a.remove("appuser"),r.path("/login"))}return e},responseError:function(t){return 401===t.status&&(e.$broadcast("unauthorized"),r.path("/login")),t}}}function r(e,t){var r=0;return{request:function(n){return 1===++r&&t.$broadcast("loading:progress"),n||e.when(n)},response:function(n){return 0===--r&&t.$broadcast("loading:finish"),n||e.when(n)},responseError:function(n){return 0===--r&&t.$broadcast("loading:finish"),e.reject(n)}}}angular.module("tessaApp").factory("authInterceptor",t).factory("AuthFactory",e).factory("httpInterceptor",r),t.$inject=["$rootScope","$q","$location","$injector","ACCESSKEY","localStorageService","jwtHelper"],e.$inject=["$http","_","API_URL","API_VERSION","Restangular","localStorageService","$q","$frontierAnalytics"],r.$inject=["$q","$rootScope"]}();
!function(){"use strict";function n(n,t,u,l,a){return{shareExperience:function(n,t){a.all("sharer").customPOST(n).then(function(n){t(null,n)},function(n){t(n.data,null)})},htmltoPDF:function(n,t){a.all("htmltopdf").customPOST(n).then(function(n){t(null,n)},function(n){t(n.data,null)})},sendMail:function(n,t){a.all("sendMail").customPOST(n).then(function(n){t(null,n)},function(n){t(n.data,null)})}}}angular.module("tessaApp").factory("sharerFactory",n).factory("_",["$window",function(n){return n._}]),n.$inject=["$http","_","API_URL","API_VERSION","Restangular"]}();
!function(){function t(t,n,e){return{getAllAssets:function(){return t.all("assets").customGET().then(function(t){return t},function(t){return t.data})},deleteAssetFile:function(n){return t.all("assets").customDELETE(n).then(function(t){return t},function(t){return t.data})},trashAssetFile:function(n){return t.all("assets/"+n+"/trash").customDELETE().then(function(t){return t},function(t){return t.data})},starredAssetFile:function(n){return t.all("assets/"+n+"/starred").customPUT().then(function(t){return t},function(t){return t.data})},restoreAssetFile:function(n){return t.all("assets/"+n+"/restore").customPUT().then(function(t){return t},function(t){return t.data})},moveAssetFile:function(n,e){return t.all("assets/"+n+"/move/"+e).customPUT().then(function(t){return t},function(t){return t.data})},updateAssetFile:function(n,e){return t.all("assets/"+n).customPUT(e).then(function(t){return t},function(t){return t.data})},getFolderAssets:function(n){return t.all("assets_folders").customGET(n).then(function(t){return t},function(t){return t.data})},createFolder:function(n){return t.all("assets_folders").customPOST(n).then(function(t){return t},function(t){return t.data})},deleteFolder:function(n){return t.all("assets_folders").customDELETE(n).then(function(t){return t},function(t){return t.data})},trashFolder:function(n){return t.all("assets_folders/"+n+"/trash").customDELETE().then(function(t){return t},function(t){return t.data})},starredFolder:function(n){return t.all("assets_folders/"+n+"/starred").customPUT().then(function(t){return t},function(t){return t.data})},restoreFolder:function(n){return t.all("assets_folders/"+n+"/restore").customPUT().then(function(t){return t},function(t){return t.data})},moveFolder:function(n,e){return t.all("assets_folders/"+n+"/move/"+e).customPUT().then(function(t){return t},function(t){return t.data})},updateFolder:function(n,e){return t.all("assets_folders/"+n).customPUT(e).then(function(t){return t},function(t){return t.data})}}}angular.module("tessaApp").factory("assetsFctry",t),t.$inject=["Restangular","API_URL","toastr"]}();
!function(){"use strict";angular.module("tessaApp").factory("socket",["socketFactory","API_URL",function(t,o){var c=io.connect(o),e=t({ioSocket:c});return e}])}();
!function(){function C(){return function(){}}function la(){return"x"+ ++ca+ +new Date}function G(){return+new Date}function qa(e,n){var t=e.join(ia),r=[];return n?(N(n,function(e,n){var t="object"==typeof n?JSON.stringify(n):n;"undefined"!=typeof n&&n!=z&&0<encodeURIComponent(t).length&&r.push(e+"="+encodeURIComponent(t))}),t+="?"+r.join(ja)):t}function ra(e,n){function t(){a+n>G()?(clearTimeout(r),r=setTimeout(t,n)):(a=G(),e())}var r,a=0;return t}function sa(e,n){var t=[];return N(e||[],function(e){n(e)&&t.push(e)}),t}function ta(e,n){return e.replace(ka,function(e,t){return n[t]||e})}function pa(e){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)});return e&&e(n),n}function N(e,n){if(e&&n)if(e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length))for(var t=0,r=e.length;t<r;)n.call(e[t],e[t],t++);else for(t in e)e.hasOwnProperty&&e.hasOwnProperty(t)&&n.call(e[t],t,e[t])}function ua(e,n){var t=[];return N(e||[],function(e,r){t.push(n(e,r))}),t}function va(e,n){var t=[];return N(e,function(e,r){n?0>e.search("-pnpres")&&r.f&&t.push(e):r.f&&t.push(e)}),t.sort()}function wa(){setTimeout(function(){fa||(fa=1,N(ga,function(e){e()}))},D)}function ya(e,n){var t,r,a="";if(n){if(t=e[15],16<t)throw"Decryption error: Maybe bad key";if(16==t)return"";for(r=0;r<16-t;r++)a+=String.fromCharCode(e[r])}else for(r=0;16>r;r++)a+=String.fromCharCode(e[r]);return a}function za(e,n){var t,r=[];if(!n)try{e=unescape(encodeURIComponent(e))}catch(a){throw"Error on UTF-8 encode"}for(t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}function Aa(e,n){var t,r=12<=T?3:2,a=[],i=[],a=[],i=[],o=e.concat(n);for(a[0]=GibberishAES.l.m(o),i=a[0],t=1;t<r;t++)a[t]=GibberishAES.l.m(a[t-1].concat(o)),i=i.concat(a[t]);return a=i.slice(0,4*U),i=i.slice(4*U,4*U+16),{key:a,i:i}}function Ba(e,n,t){var r,n=Ca(n),a=Math.ceil(e.length/16),i=[],o=[];for(r=0;r<a;r++){var c=i,u=r,s=e.slice(16*r,16*r+16),f=[],l=v,l=v;for(16>s.length&&(l=16-s.length,f=[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l]),l=0;l<s.length;l++)f[l]=s[l];c[u]=f}for(0===e.length%16&&i.push([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),r=0;r<i.length;r++)i[r]=0===r?Da(i[r],t):Da(i[r],o[r-1]),o[r]=Ea(i[r],n);return o}function Fa(e,n,t,r){var a,n=Ca(n),i=e.length/16,o=[],c=[],u="";for(a=0;a<i;a++)o.push(e.slice(16*a,16*(a+1)));for(a=o.length-1;0<=a;a--)c[a]=Ga(o[a],n),c[a]=0===a?Da(c[a],t):Da(c[a],o[a-1]);for(a=0;a<i-1;a++)u+=ya(c[a]);var s,u=u+ya(c[a],y);if(r)s=u;else try{s=decodeURIComponent(escape(u))}catch(f){throw"Bad Key"}return s}function Ea(e,n){xa=A;var t,r=La(e,n,0);for(t=1;t<T+1;t++)r=Ma(r),r=Na(r),t<T&&(r=Oa(r)),r=La(r,n,t);return r}function Ga(e,n){xa=y;var t,r=La(e,n,T);for(t=T-1;-1<t;t--)r=Na(r),r=Ma(r),r=La(r,n,t),0<t&&(r=Oa(r));return r}function Ma(e){var n,t=xa?Pa:Qa,r=[];for(n=0;16>n;n++)r[n]=t[e[n]];return r}function Na(e){var n,t=[],r=xa?[0,13,10,7,4,1,14,11,8,5,2,15,12,9,6,3]:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11];for(n=0;16>n;n++)t[n]=e[r[n]];return t}function Oa(e){var n,t=[];if(xa)for(n=0;4>n;n++)t[4*n]=Ta[e[4*n]]^Ua[e[1+4*n]]^Za[e[2+4*n]]^$a[e[3+4*n]],t[1+4*n]=$a[e[4*n]]^Ta[e[1+4*n]]^Ua[e[2+4*n]]^Za[e[3+4*n]],t[2+4*n]=Za[e[4*n]]^$a[e[1+4*n]]^Ta[e[2+4*n]]^Ua[e[3+4*n]],t[3+4*n]=Ua[e[4*n]]^Za[e[1+4*n]]^$a[e[2+4*n]]^Ta[e[3+4*n]];else for(n=0;4>n;n++)t[4*n]=ab[e[4*n]]^bb[e[1+4*n]]^e[2+4*n]^e[3+4*n],t[1+4*n]=e[4*n]^ab[e[1+4*n]]^bb[e[2+4*n]]^e[3+4*n],t[2+4*n]=e[4*n]^e[1+4*n]^ab[e[2+4*n]]^bb[e[3+4*n]],t[3+4*n]=bb[e[4*n]]^e[1+4*n]^e[2+4*n]^ab[e[3+4*n]];return t}function La(e,n,t){var r,a=[];for(r=0;16>r;r++)a[r]=e[r]^n[t][r];return a}function Da(e,n){var t,r=[];for(t=0;16>t;t++)r[t]=e[t]^n[t];return r}function Ca(e){var n,t,r=[],a=[],i=[];for(n=0;n<U;n++)t=[e[4*n],e[4*n+1],e[4*n+2],e[4*n+3]],r[n]=t;for(n=U;n<4*(T+1);n++){for(r[n]=[],e=0;4>e;e++)a[e]=r[n-1][e];if(0===n%U){for(e=a[0],t=v,t=0;4>t;t++)a[t]=a[t+1];a[3]=e,a=cb(a),a[0]^=db[n/U-1]}else 6<U&&4==n%U&&(a=cb(a));for(e=0;4>e;e++)r[n][e]=r[n-U][e]^a[e]}for(n=0;n<T+1;n++)for(i[n]=[],a=0;4>a;a++)i[n].push(r[4*n+a][0],r[4*n+a][1],r[4*n+a][2],r[4*n+a][3]);return i}function cb(e){for(var n=0;4>n;n++)e[n]=Qa[e[n]];return e}function eb(e,n){var t=[];for(i=0;i<e.length;i+=n)t[i/n]=parseInt(e.substr(i,n),16);return t}function fb(e){for(var n=[],t=0;256>t;t++){for(var r=e,a=t,i=v,o=v,i=o=0;8>i;i++)o=1==(1&a)?o^r:o,r=127<r?283^r<<1:r<<1,a>>>=1;n[t]=o}return n}var CryptoJS=CryptoJS||function(e,n){var t={},r=t.lib={},a=function(){},i=r.Base={extend:function(e){a.prototype=this;var n=new a;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=n?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var n=this.words,t=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var a=0;a<e;a++)n[r+a>>>2]|=(t[a>>>2]>>>24-8*(a%4)&255)<<24-8*((r+a)%4);else if(65535<t.length)for(a=0;a<e;a+=4)n[r+a>>>2]=t[a>>>2];else n.push.apply(n,t);return this.sigBytes+=e,this},clamp:function(){var n=this.words,t=this.sigBytes;n[t>>>2]&=4294967295<<32-8*(t%4),n.length=e.ceil(t/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(n){for(var t=[],r=0;r<n;r+=4)t.push(4294967296*e.random()|0);return new o.init(t,n)}}),c=t.enc={},u=c.Hex={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],r=0;r<e;r++){var a=n[r>>>2]>>>24-8*(r%4)&255;t.push((a>>>4).toString(16)),t.push((15&a).toString(16))}return t.join("")},parse:function(e){for(var n=e.length,t=[],r=0;r<n;r+=2)t[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(t,n/2)}},s=c.Latin1={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],r=0;r<e;r++)t.push(String.fromCharCode(n[r>>>2]>>>24-8*(r%4)&255));return t.join("")},parse:function(e){for(var n=e.length,t=[],r=0;r<n;r++)t[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new o.init(t,n)}},f=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(n){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(n){var t=this._data,r=t.words,a=t.sigBytes,i=this.blockSize,c=a/(4*i),c=n?e.ceil(c):e.max((0|c)-this._minBufferSize,0);if(n=c*i,a=e.min(4*n,a),n){for(var u=0;u<n;u+=i)this._doProcessBlock(r,u);u=r.splice(0,n),t.sigBytes-=a}return new o.init(u,a)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(n,t){return new e.init(t).finalize(n)}},_createHmacHelper:function(e){return function(n,t){return new b.HMAC.init(e,t).finalize(n)}}});var b=t.algo={};return t}(Math);!function(e){for(var n=CryptoJS,t=n.lib,r=t.WordArray,a=t.Hasher,t=n.algo,i=[],o=[],c=function(e){return 4294967296*(e-(0|e))|0},u=2,s=0;64>s;){var f;e:{f=u;for(var l=e.sqrt(f),b=2;b<=l;b++)if(!(f%b)){f=!1;break e}f=!0}f&&(8>s&&(i[s]=c(e.pow(u,.5))),o[s]=c(e.pow(u,1/3)),s++),u++}var d=[],t=t.SHA256=a.extend({_doReset:function(){this._hash=new r.init(i.slice(0))},_doProcessBlock:function(e,n){for(var t=this._hash.words,r=t[0],a=t[1],i=t[2],c=t[3],u=t[4],s=t[5],f=t[6],l=t[7],b=0;64>b;b++){if(16>b)d[b]=0|e[n+b];else{var h=d[b-15],p=d[b-2];d[b]=((h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3)+d[b-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+d[b-16]}h=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&s^~u&f)+o[b]+d[b],p=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&a^r&i^a&i),l=f,f=s,s=u,u=c+h|0,c=i,i=a,a=r,r=h+p|0}t[0]=t[0]+r|0,t[1]=t[1]+a|0,t[2]=t[2]+i|0,t[3]=t[3]+c|0,t[4]=t[4]+u|0,t[5]=t[5]+s|0,t[6]=t[6]+f|0,t[7]=t[7]+l|0},_doFinalize:function(){var n=this._data,t=n.words,r=8*this._nDataBytes,a=8*n.sigBytes;return t[a>>>5]|=128<<24-a%32,t[(a+64>>>9<<4)+14]=e.floor(r/4294967296),t[(a+64>>>9<<4)+15]=r,n.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=a._createHelper(t),n.HmacSHA256=a._createHmacHelper(t)}(Math),function(){var e=CryptoJS,n=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,a=4*r;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),c=i.words,u=o.words,s=0;s<r;s++)c[s]^=1549556828,u[s]^=909522486;i.sigBytes=o.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var n=this._hasher;return e=n.finalize(e),n.reset(),n.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,n=e.lib.WordArray;e.enc.Base64={stringify:function(e){var n=e.words,t=e.sigBytes,r=this._map;e.clamp(),e=[];for(var a=0;a<t;a+=3)for(var i=(n[a>>>2]>>>24-8*(a%4)&255)<<16|(n[a+1>>>2]>>>24-8*((a+1)%4)&255)<<8|n[a+2>>>2]>>>24-8*((a+2)%4)&255,o=0;4>o&&a+.75*o<t;o++)e.push(r.charAt(i>>>6*(3-o)&63));if(n=r.charAt(64))for(;e.length%4;)e.push(n);return e.join("")},parse:function(e){var t=e.length,r=this._map,a=r.charAt(64);a&&(a=e.indexOf(a),-1!=a&&(t=a));for(var a=[],i=0,o=0;o<t;o++)if(o%4){var c=r.indexOf(e.charAt(o-1))<<2*(o%4),u=r.indexOf(e.charAt(o))>>>6-2*(o%4);a[i>>>2]|=(c|u)<<24-8*(i%4),i++}return n.create(a,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();var v=void 0,y=!0,z=null,A=!1;window.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(e){return z}}function d(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var n=q[e];return"string"==typeof n?n:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function b(e,n){var t,r,i,o,c,u=f,s=n[e];switch(s&&"object"==typeof s&&(s=a.call(s)),"function"==typeof m&&(s=m.call(n,e,s)),typeof s){case"string":return d(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(f+=p,c=[],"[object Array]"===Object.prototype.toString.apply(s)){for(o=s.length,t=0;t<o;t+=1)c[t]=b(t,s)||"null";return i=0===c.length?"[]":f?"[\n"+f+c.join(",\n"+f)+"\n"+u+"]":"["+c.join(",")+"]",f=u,i}if(m&&"object"==typeof m)for(o=m.length,t=0;t<o;t+=1)r=m[t],"string"==typeof r&&(i=b(r,s))&&c.push(d(r)+(f?": ":":")+i);else for(r in s)Object.hasOwnProperty.call(s,r)&&(i=b(r,s))&&c.push(d(r)+(f?": ":":")+i);return i=0===c.length?"{}":f?"{\n"+f+c.join(",\n"+f)+"\n"+u+"}":"{"+c.join(",")+"}",f=u,i}}window.JSON||(window.JSON={});var c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,p,q={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,n,t){var r;if(p=f="","number"==typeof t)for(r=0;r<t;r+=1)p+=" ";else"string"==typeof t&&(p=t);if((m=n)&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw Error("JSON.stringify");return b("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a){return eval("("+a+")")})}();var ca=1,fa=A,ga=[],ha="-pnpres",D=1e3,ia="/",ja="&",ka=/{([\w\-]+)}/g,ma,na=Math.floor(20*Math.random());ma=function(e,n){return 0<e.indexOf("pubsub.")&&e.replace("pubsub","ps"+(n?pa().split("-")[0]:20>++na?na:na=1))||e};var O,T=14,U=8,xa=A,Qa=eb("637c777bf26b6fc53001672bfed7ab76ca82c97dfa5947f0add4a2af9ca472c0b7fd9326363ff7cc34a5e5f171d8311504c723c31896059a071280e2eb27b27509832c1a1b6e5aa0523bd6b329e32f8453d100ed20fcb15b6acbbe394a4c58cfd0efaafb434d338545f9027f503c9fa851a3408f929d38f5bcb6da2110fff3d2cd0c13ec5f974417c4a77e3d645d197360814fdc222a908846eeb814de5e0bdbe0323a0a4906245cc2d3ac629195e479e7c8376d8dd54ea96c56f4ea657aae08ba78252e1ca6b4c6e8dd741f4bbd8b8a703eb5664803f60e613557b986c11d9ee1f8981169d98e949b1e87e9ce5528df8ca1890dbfe6426841992d0fb054bb16",2),Pa,gb=Qa,hb=[];for(i=0;i<gb.length;i++)hb[gb[i]]=i;Pa=hb;var db=eb("01020408102040801b366cd8ab4d9a2f5ebc63c697356ad4b37dfaefc591",2),ab=fb(2),bb=fb(3),$a=fb(9),Ua=fb(11),Za=fb(13),Ta=fb(14),ib,jb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kb=jb.split("");if("function"==typeof Array.indexOf&&(jb=kb),ib={encode:function(e){var n,t=[],r="";for(n=0;n<16*e.length;n++)t.push(e[Math.floor(n/16)][n%16]);for(n=0;n<t.length;n+=3)r+=kb[t[n]>>2],r+=kb[(3&t[n])<<4|t[n+1]>>4],r=t[n+1]!==v?r+kb[(15&t[n+1])<<2|t[n+2]>>6]:r+"=",r=t[n+2]!==v?r+kb[63&t[n+2]]:r+"=";for(e=r.slice(0,64),n=1;n<Math.ceil(r.length/64);n++)e+=r.slice(64*n,64*n+64)+(Math.ceil(r.length/64)==n+1?"":"\n");return e},decode:function(e){var n,e=e.replace(/\n/g,""),t=[],r=[],a=[];for(n=0;n<e.length;n+=4)r[0]=jb.indexOf(e.charAt(n)),r[1]=jb.indexOf(e.charAt(n+1)),r[2]=jb.indexOf(e.charAt(n+2)),r[3]=jb.indexOf(e.charAt(n+3)),a[0]=r[0]<<2|r[1]>>4,a[1]=(15&r[1])<<4|r[2]>>2,a[2]=(3&r[2])<<6|r[3],t.push(a[0],a[1],a[2]);return t=t.slice(0,t.length-t.length%16)}},O={size:function(e){switch(e){case 128:T=10,U=4;break;case 192:T=12,U=6;break;case 256:T=14,U=8;break;default:throw"Invalid Key Size Specified:"+e}},h2a:function(e){var n=[];return e.replace(/(..)/g,function(e){n.push(parseInt(e,16))}),n},expandKey:Ca,encryptBlock:Ea,decryptBlock:Ga,Decrypt:xa,s2a:za,rawEncrypt:Ba,rawDecrypt:Fa,dec:function(e,n,t){var e=ib.q(e),r=e.slice(8,16),r=Aa(za(n,t),r),n=r.key,r=r.i,e=e.slice(16,e.length);return e=Fa(e,n,r,t)},openSSLKey:Aa,a2h:function(e){var n,t="";for(n=0;n<e.length;n++)t+=(16>e[n]?"0":"")+e[n].toString(16);return t},enc:function(e,n,t){var r;r=[];var a;for(a=0;8>a;a++)r=r.concat(Math.floor(256*Math.random()));return a=Aa(za(n,t),r),n=a.key,a=a.i,r=[[83,97,108,116,101,100,95,95].concat(r)],e=za(e,t),e=Ba(e,n,a),e=r.concat(e),ib.s(e)},Hash:{MD5:function(e){function n(e,n){var t,r,a,i,o;return a=2147483648&e,i=2147483648&n,t=1073741824&e,r=1073741824&n,o=(1073741823&e)+(1073741823&n),t&r?2147483648^o^a^i:t|r?1073741824&o?3221225472^o^a^i:1073741824^o^a^i:o^a^i}function t(e,t,r,a,i,o,c){return e=n(e,n(n(t&r|~t&a,i),c)),n(e<<o|e>>>32-o,t)}function r(e,t,r,a,i,o,c){return e=n(e,n(n(t&a|r&~a,i),c)),n(e<<o|e>>>32-o,t)}function a(e,t,r,a,i,o,c){return e=n(e,n(n(t^r^a,i),c)),n(e<<o|e>>>32-o,t)}function i(e,t,r,a,i,o,c){return e=n(e,n(n(r^(t|~a),i),c)),n(e<<o|e>>>32-o,t)}function o(e){var n,t,r=[];for(t=0;3>=t;t++)n=e>>>8*t&255,r=r.concat(n);return r}var c,u,s,f,l,b,d,h,p=[],g=eb("67452301efcdab8998badcfe10325476d76aa478e8c7b756242070dbc1bdceeef57c0faf4787c62aa8304613fd469501698098d88b44f7afffff5bb1895cd7be6b901122fd987193a679438e49b40821f61e2562c040b340265e5a51e9b6c7aad62f105d02441453d8a1e681e7d3fbc821e1cde6c33707d6f4d50d87455a14eda9e3e905fcefa3f8676f02d98d2a4c8afffa39428771f6816d9d6122fde5380ca4beea444bdecfa9f6bb4b60bebfbc70289b7ec6eaa127fad4ef308504881d05d9d4d039e6db99e51fa27cf8c4ac5665f4292244432aff97ab9423a7fc93a039655b59c38f0ccc92ffeff47d85845dd16fa87e4ffe2ce6e0a30143144e0811a1f7537e82bd3af2352ad7d2bbeb86d391",8),p=e.length;for(c=p+8,u=16*((c-c%64)/64+1),s=[],l=f=0;l<p;)c=(l-l%4)/4,f=8*(l%4),s[c]|=e[l]<<f,l++;for(c=(l-l%4)/4,s[c]|=128<<8*(l%4),s[u-2]=p<<3,s[u-1]=p>>>29,p=s,l=g[0],b=g[1],d=g[2],h=g[3],e=0;e<p.length;e+=16)c=l,u=b,s=d,f=h,l=t(l,b,d,h,p[e+0],7,g[4]),h=t(h,l,b,d,p[e+1],12,g[5]),d=t(d,h,l,b,p[e+2],17,g[6]),b=t(b,d,h,l,p[e+3],22,g[7]),l=t(l,b,d,h,p[e+4],7,g[8]),h=t(h,l,b,d,p[e+5],12,g[9]),d=t(d,h,l,b,p[e+6],17,g[10]),b=t(b,d,h,l,p[e+7],22,g[11]),l=t(l,b,d,h,p[e+8],7,g[12]),h=t(h,l,b,d,p[e+9],12,g[13]),d=t(d,h,l,b,p[e+10],17,g[14]),b=t(b,d,h,l,p[e+11],22,g[15]),l=t(l,b,d,h,p[e+12],7,g[16]),h=t(h,l,b,d,p[e+13],12,g[17]),d=t(d,h,l,b,p[e+14],17,g[18]),b=t(b,d,h,l,p[e+15],22,g[19]),l=r(l,b,d,h,p[e+1],5,g[20]),h=r(h,l,b,d,p[e+6],9,g[21]),d=r(d,h,l,b,p[e+11],14,g[22]),b=r(b,d,h,l,p[e+0],20,g[23]),l=r(l,b,d,h,p[e+5],5,g[24]),h=r(h,l,b,d,p[e+10],9,g[25]),d=r(d,h,l,b,p[e+15],14,g[26]),b=r(b,d,h,l,p[e+4],20,g[27]),l=r(l,b,d,h,p[e+9],5,g[28]),h=r(h,l,b,d,p[e+14],9,g[29]),d=r(d,h,l,b,p[e+3],14,g[30]),b=r(b,d,h,l,p[e+8],20,g[31]),l=r(l,b,d,h,p[e+13],5,g[32]),h=r(h,l,b,d,p[e+2],9,g[33]),d=r(d,h,l,b,p[e+7],14,g[34]),b=r(b,d,h,l,p[e+12],20,g[35]),l=a(l,b,d,h,p[e+5],4,g[36]),h=a(h,l,b,d,p[e+8],11,g[37]),d=a(d,h,l,b,p[e+11],16,g[38]),b=a(b,d,h,l,p[e+14],23,g[39]),l=a(l,b,d,h,p[e+1],4,g[40]),h=a(h,l,b,d,p[e+4],11,g[41]),d=a(d,h,l,b,p[e+7],16,g[42]),b=a(b,d,h,l,p[e+10],23,g[43]),l=a(l,b,d,h,p[e+13],4,g[44]),h=a(h,l,b,d,p[e+0],11,g[45]),d=a(d,h,l,b,p[e+3],16,g[46]),b=a(b,d,h,l,p[e+6],23,g[47]),l=a(l,b,d,h,p[e+9],4,g[48]),h=a(h,l,b,d,p[e+12],11,g[49]),d=a(d,h,l,b,p[e+15],16,g[50]),b=a(b,d,h,l,p[e+2],23,g[51]),l=i(l,b,d,h,p[e+0],6,g[52]),h=i(h,l,b,d,p[e+7],10,g[53]),d=i(d,h,l,b,p[e+14],15,g[54]),b=i(b,d,h,l,p[e+5],21,g[55]),l=i(l,b,d,h,p[e+12],6,g[56]),h=i(h,l,b,d,p[e+3],10,g[57]),d=i(d,h,l,b,p[e+10],15,g[58]),b=i(b,d,h,l,p[e+1],21,g[59]),l=i(l,b,d,h,p[e+8],6,g[60]),h=i(h,l,b,d,p[e+15],10,g[61]),d=i(d,h,l,b,p[e+6],15,g[62]),b=i(b,d,h,l,p[e+13],21,g[63]),l=i(l,b,d,h,p[e+4],6,g[64]),h=i(h,l,b,d,p[e+11],10,g[65]),d=i(d,h,l,b,p[e+2],15,g[66]),b=i(b,d,h,l,p[e+9],21,g[67]),l=n(l,c),b=n(b,u),d=n(d,s),h=n(h,f);return o(l).concat(o(b),o(d),o(h))}},Base64:ib},!window.PUBNUB){var lb=function(e,n){return CryptoJS.HmacSHA256(e,n).toString(CryptoJS.enc.Base64)},mb=function(e){return document.getElementById(e)},nb=function(e){console.error(e)},pb=function(e,n){var t=[];return N(e.split(/\s+/),function(e){N((n||document).getElementsByTagName(e),function(e){t.push(e)})}),t},qb=function(e,n,t){N(e.split(","),function(e){function r(e){e||(e=window.event),t(e)||(e.cancelBubble=y,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())}n.addEventListener?n.addEventListener(e,r,A):n.attachEvent?n.attachEvent("on"+e,r):n["on"+e]=r})},rb=function(){return pb("head")[0]},V=function(e,n,t){return t?void e.setAttribute(n,t):e&&e.getAttribute&&e.getAttribute(n)},sb=function(e,n){for(var t in n)if(n.hasOwnProperty(t))try{e.style[t]=n[t]+(0<"|width|height|top|left|".indexOf(t)&&"number"==typeof n[t]?"px":"")}catch(r){}},tb=function(e){return document.createElement(e)},zb=function(){return ub||$()?0:la()},Ab=function(e){function n(e,n){v||(v=1,g.onerror=z,clearTimeout(m),e||!n||w(n),setTimeout(function(){e&&_();var n=mb(y),t=n&&n.parentNode;t&&t.removeChild(n)},D))}if(ub||$()){e:{var t,r,a=function(){if(!o){o=1,clearTimeout(u);try{r=JSON.parse(t.responseText)}catch(e){return d(1)}i=1,l(r)}},i=0,o=0,c=e.timeout||1e4,u=setTimeout(function(){d(1,{message:"timeout"})},c),s=e.b||C(),f=e.data||{},l=e.c||C(),b=!e.h,d=function(e,n){i||(i=1,clearTimeout(u),t&&(t.onerror=t.onload=z,t.abort&&t.abort(),t=z),e&&s(n))};try{t=$()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,t.onerror=t.onabort=function(){d(1,t.responseText||{error:"Network Connection Error"})},t.onload=t.onloadend=a,t.onreadystatechange=function(){if(t&&4==t.readyState)switch(t.status){case 401:case 402:case 403:try{r=JSON.parse(t.responseText),d(1,r)}catch(e){return d(1,t.responseText)}}};var h=qa(e.url,f);t.open("GET",h,b),b&&(t.timeout=c),t.send()}catch(p){d(0),ub=0,e=Ab(e);break e}e=d}return e}var g=tb("script"),a=e.a,y=la(),v=0,m=setTimeout(function(){n(1,{message:"timeout"})},e.timeout||1e4),_=e.b||C(),c=e.data||{},w=e.c||C();return window[a]=function(e){n(0,e)},e.h||(g[Bb]=Bb),g.onerror=function(){n(1)},g.src=qa(e.url,c),V(g,"id",y),rb().appendChild(g),n},Cb=function(){return"onLine"in navigator?navigator.onLine:1},$=function(){if(!Db||!Db.get)return 0;var e={id:$.id++,send:C(),abort:function(){e.id={}},open:function(n,t){$[e.id]=e,Db.get(e.id,t)}};return e},Bb="async",ub=-1==navigator.userAgent.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||C());var Eb,Fb=window.localStorage;Eb={get:function(e){try{return Fb?Fb.getItem(e):-1==document.cookie.indexOf(e)?z:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||z}catch(n){}},set:function(e,n){try{if(Fb)return Fb.setItem(e,n)&&0;document.cookie=e+"="+n+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(t){}}};var Gb={list:{},unbind:function(e){Gb.list[e]=[]},bind:function(e,n){(Gb.list[e]=Gb.list[e]||[]).push(n)},fire:function(e,n){N(Gb.list[e]||[],function(e){e(n)})}},Ib=mb("pubnub")||0,Jb=function(e){function t(){}function r(e,n){function t(n){n&&(q=G()-(n/1e4+(G()-r)/2),e&&e(q))}var r=G();n&&t(n)||ge.time(t)}function a(e,n){Q&&Q(e,n),Q=z}function i(){ge.time(function(e){r(C(),e),e||a(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),setTimeout(i,T)})}function o(){fe()||a(1,{error:"Offline. Please check your network settings. "}),setTimeout(o,D)}function c(e,n){n("object"==typeof e&&e.error&&e.message&&e.payload?{message:e.message,payload:e.payload}:e)}function u(e,n,t){if("object"==typeof e){if(e.error&&e.message&&e.payload)return void t({message:e.message,payload:e.payload});if(e.payload)return void n(e.payload)}n(e)}function s(e){var n=0;return N(va(Y),function(t){(t=Y[t])&&(n++,(e||C())(t))}),n}function f(e){if(ie){if(!H.length)return}else{if(e&&(H.j=0),H.j||!H.length)return;H.j=1}ce(H.shift())}function l(){!ae&&b()}function b(){clearTimeout(ne),!re||500<=re||1>re||!va(Y,y).length?ae=A:(ae=y,ge.presence_heartbeat({callback:function(){ne=setTimeout(b,re*D)},error:function(e){se&&se("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),ne=setTimeout(b,re*D)}}))}function d(e,n){return pe.decrypt(e,n||de)||pe.decrypt(e,de)||e}function h(e,n,t){var r=A;if("number"==typeof e)r=5<e||0==e?A:y;else{if("boolean"==typeof e)return e?30:0;r=y}return r?(t&&t("Presence Heartbeat value invalid. Valid range ( x > 5 or x = 0). Current Value : "+(n||5)),n||5):e}function p(e){var n="",t=[];N(e,function(e){t.push(e)});var r,a=t.sort();for(r in a){var i=a[r],n=n+(i+"="+encodeURIComponent(e[i]));r!=a.length-1&&(n+="&")}return n}function g(e){return e||(e={}),N(ue,function(n,t){n in e||(e[n]=t)}),e}function v(e){return Jb(e)}function m(e){function n(e,n){var t=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(t>>16)<<16|65535&t}function t(e,n){return e>>>n|e<<32-n}var r;r=e.replace(/\r\n/g,"\n");for(var e="",a=0;a<r.length;a++){var i=r.charCodeAt(a);128>i?e+=String.fromCharCode(i):(127<i&&2048>i?e+=String.fromCharCode(i>>6|192):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128)),e+=String.fromCharCode(63&i|128))}for(a=e,r=[],i=0;i<8*a.length;i+=8)r[i>>5]|=(255&a.charCodeAt(i/8))<<24-i%32;var o,c,u,s,f,l,b,d,h,p,g,y=8*e.length,a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],i=Array(64);for(r[y>>5]|=128<<24-y%32,r[(y+64>>9<<4)+15]=y,d=0;d<r.length;d+=16){for(y=e[0],o=e[1],c=e[2],u=e[3],s=e[4],f=e[5],l=e[6],b=e[7],h=0;64>h;h++)i[h]=16>h?r[h+d]:n(n(n(t(i[h-2],17)^t(i[h-2],19)^i[h-2]>>>10,i[h-7]),t(i[h-15],7)^t(i[h-15],18)^i[h-15]>>>3),i[h-16]),p=n(n(n(n(b,t(s,6)^t(s,11)^t(s,25)),s&f^~s&l),a[h]),i[h]),g=n(t(y,2)^t(y,13)^t(y,22),y&o^y&c^o&c),b=l,l=f,f=s,s=n(u,p),u=c,c=o,o=y,y=n(p,g);e[0]=n(y,e[0]),e[1]=n(o,e[1]),e[2]=n(c,e[2]),e[3]=n(u,e[3]),e[4]=n(s,e[4]),e[5]=n(f,e[5]),e[6]=n(l,e[6]),e[7]=n(b,e[7])}for(r="",a=0;a<4*e.length;a++)r+="0123456789abcdef".charAt(e[a>>2]>>8*(3-a%4)+4&15)+"0123456789abcdef".charAt(e[a>>2]>>8*(3-a%4)&15);return r}e.jsonp&&(ub=0);var _=e.subscribe_key||"";e.uuid||Eb.get(_+"uuid");var w=e.leave_on_unload||0;e.xdr=Ab,e.db=Eb,e.error=e.error||nb,e._is_online=Cb,e.jsonp_cb=zb,e.hmac_SHA256=lb,O.size(256);var S=O.s2a("0123456789012345");e.crypto_obj={encrypt:function(e,n){if(!n)return e;var t=O.s2a(m(n).slice(0,32)),r=O.s2a(JSON.stringify(e)),t=O.rawEncrypt(r,t,S);return O.Base64.encode(t)||e},decrypt:function(e,n){if(!n)return e;var t=O.s2a(m(n).slice(0,32));try{var r=O.Base64.decode(e),a=O.rawDecrypt(r,t,S,A);return JSON.parse(a)}catch(i){}}},e.params={pnsdk:"PubNub-JS-Web/3.6.7"};var x=+e.windowing||10,M=(+e.timeout||310)*D,T=(+e.keepalive||60)*D,U=e.noleave||0,B=e.publish_key||"demo",j=e.subscribe_key||"demo",E=e.auth_key||"",P=e.secret_key||"",I=e.hmac_SHA256,J=e.ssl?"s":"",L="http"+J+"://"+(e.origin||"pubsub.pubnub.com"),R=ma(L),K=ma(L),H=[],q=0,$=0,F=0,Q=0,W=e.restore||0,Z=0,X=A,Y={},ee={},ne=z,te=h(e.heartbeat||e.pnexpires||0,e.error),re=e.heartbeat_interval||te-3,ae=A,ie=e.no_wait_for_pending,oe=e["compatible_3.5"]||A,ce=e.xdr,ue=e.params||{},se=e.error||C(),fe=e._is_online||function(){return 1},le=e.jsonp_cb||function(){return 0},be=e.db||{get:C(),set:C()},de=e.cipher_key,he=e.uuid||be&&be.get(j+"uuid")||"",pe=e.crypto_obj||{encrypt:function(e){return e},decrypt:function(e){return e}},ge={LEAVE:function(e,n,t,r){var a={uuid:he,auth:E},i=ma(L),t=t||C(),o=r||C(),r=le();return 0<e.indexOf(ha)?y:oe&&(!J||"0"==r)||U?A:("0"!=r&&(a.callback=r),ce({h:n||J,timeout:2e3,a:r,data:g(a),c:function(e){u(e,t,o)},b:function(e){c(e,o)},url:[i,"v2","presence","sub_key",j,"channel",encodeURIComponent(e),"leave"]}),y)},set_resumed:function(e){X=e},get_cipher_key:function(){return de},set_cipher_key:function(e){de=e},raw_encrypt:function(e,n){return pe.encrypt(e,n||de)||e},raw_decrypt:function(e,n){return d(e,n)},get_heartbeat:function(){return te},set_heartbeat:function(e){te=h(e,re,se),re=1<=te-3?te-3:1,t(),b()},get_heartbeat_interval:function(){return re},set_heartbeat_interval:function(e){re=e,b()},get_version:function(){return"3.6.7"},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var n={aps:{badge:1,alert:""}};for(k in e)k[n]=e[k];return n},newPnMessage:function(){var e={};gcm&&(e.pn_gcm=gcm),apns&&(e.pn_apns=apns);for(k in n)e[k]=n[k];return e},_add_param:function(e,n){ue[e]=n},history:function(e,n){var n=e.callback||n,t=e.count||e.limit||100,r=e.reverse||"false",a=e.error||C(),i=e.auth_key||E,o=e.cipher_key,u=e.channel,s=e.start,f=e.end,l=e.include_token,b={},h=le();return u?n?j?(b.stringtoken="true",b.count=t,b.reverse=r,b.auth=i,h&&(b.callback=h),s&&(b.start=s),f&&(b.end=f),l&&(b.include_token="true"),void ce({a:h,data:g(b),c:function(e){if("object"==typeof e&&e.error)a({message:e.message,payload:e.payload});else{for(var t=e[0],r=[],i=0;i<t.length;i++){var c=d(t[i],o);try{r.push(JSON.parse(c))}catch(u){r.push(c)}}n([r,e[1],e[2]])}},b:function(e){c(e,a)},url:[R,"v2","history","sub-key",j,"channel",encodeURIComponent(u)]})):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},replay:function(e,n){var n=n||e.callback||C(),t=e.auth_key||E,r=e.source,a=e.destination,i=e.stop,o=e.start,c=e.end,s=e.reverse,f=e.limit,l=le(),b={};return r?a?B?j?("0"!=l&&(b.callback=l),i&&(b.stop="all"),s&&(b.reverse="true"),o&&(b.start=o),c&&(b.end=c),f&&(b.count=f),b.auth=t,void ce({a:l,c:function(e){u(e,n,err)},b:function(){n([0,"Disconnected"])},url:[R,"v1","replay",B,j,r,a],data:g(b)})):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Destination Channel"):se("Missing Source Channel")},auth:function(e){E=e,t()},time:function(e){var n=le();ce({a:n,data:g({uuid:he,auth:E}),timeout:5*D,url:[R,"time",n],c:function(n){e(n[0])},b:function(){e(0)}})},publish:function(e,n){var t=e.message;if(!t)return se("Missing Message");var n=n||e.callback||t.callback||C(),r=e.channel||t.channel,a=e.auth_key||E,i=e.cipher_key,o=e.error||t.error||C(),s=e.post||A,l="store_in_history"in e?e.store_in_history:y,b=le(),d="push";return e.prepend&&(d="unshift"),r?B?j?(t.getPubnubMessage&&(t=t.getPubnubMessage()),t=JSON.stringify(pe.encrypt(t,i||de)||t),t=[R,"publish",B,j,0,encodeURIComponent(r),b,encodeURIComponent(t)],ue={uuid:he,auth:a},l||(ue.store="0"),H[d]({a:b,timeout:5*D,url:t,data:g(ue),b:function(e){c(e,o),f(1)},c:function(e){u(e,n,o),f(1)},mode:s?"POST":"GET"}),void f()):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Channel")},unsubscribe:function(e,n){var r=e.channel,n=n||e.callback||C(),a=e.error||C();Z=0,r=ua((r.join?r.join(","):""+r).split(","),function(e){if(Y[e])return e+","+e+ha}).join(","),N(r.split(","),function(e){var t=y;e&&(fa&&(t=ge.LEAVE(e,0,n,a)),t||n({action:"leave"}),Y[e]=0,e in ee&&delete ee[e])}),t()},subscribe:function(e,n){function r(e){e?setTimeout(t,D):(R=ma(L,1),K=ma(L,1),setTimeout(function(){ge.time(r)},D)),s(function(n){return e&&n.d?(n.d=0,n.p(n.name)):void(!e&&!n.d&&(n.d=1,n.o(n.name)))})}function i(){var e=le(),n=va(Y).join(",");if(n){a();var o=g({uuid:he,auth:u});2<JSON.stringify(ee).length&&(o.state=JSON.stringify(ee)),te&&(o.heartbeat=te),l(),Q=ce({timeout:k,a:e,b:function(e){c(e,p),ge.time(r)},data:g(o),url:[K,"subscribe",j,encodeURIComponent(n),e,Z],c:function(e){if(!e||"object"==typeof e&&"error"in e&&e.error)return p(e.error),setTimeout(t,D);if(y(e[1]),Z=!Z&&W&&be.get(j)||e[1],s(function(e){e.g||(e.g=1,e.n(e.name))}),X&&!W)Z=0,X=A,be.set(j,0);else{_&&(Z=1e4,_=0),be.set(j,e[1]);var n,r=(2<e.length?e[2]:ua(va(Y),function(n){return ua(Array(e[0].length).join(",").split(","),function(){return n})}).join(",")).split(",");n=function(){var e=r.shift()||F;return[(Y[e]||{}).a||$,e.split(ha)[0]]};var a=G()-q-+e[1]/1e4;N(e[0],function(t){var r=n(),t=d(t,Y[r[1]]?Y[r[1]].cipher_key:z);r[0](t,e,r[1],a)})}setTimeout(i,S)}})}}var o=e.channel,n=(n=n||e.callback)||e.message,u=e.auth_key||E,f=e.connect||C(),b=e.reconnect||C(),h=e.disconnect||C(),p=e.error||C(),y=e.idle||C(),v=e.presence||0,m=e.noheresync||0,_=e.backfill||0,w=e.timetoken||0,k=e.timeout||M,S=e.windowing||x,O=e.state,T=e.heartbeat||e.pnexpires,U=e.restore||W;return W=U,Z=w,o?n?j?((T||0===T)&&ge.set_heartbeat(T),N((o.join?o.join(","):""+o).split(","),function(t){var r=Y[t]||{};Y[F=t]={name:t,g:r.g,d:r.d,f:1,a:$=n,cipher_key:e.cipher_key,n:f,o:h,p:b},O&&(ee[t]=t in O?O[t]:O),v&&(ge.subscribe({channel:t+ha,callback:v,restore:U}),!r.f&&!m&&ge.here_now({channel:t,callback:function(e){N("uuids"in e?e.uuids:[],function(n){v({action:"join",uuid:n,timestamp:Math.floor(G()/1e3),occupancy:e.occupancy||1},e,t)})}}))}),t=function(){a(),setTimeout(i,S)},fa?void t():ga.push(t)):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},here_now:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.auth_key||E,a=e.channel,i=le(),o=e.state,r={uuid:he,auth:r};return("uuids"in e?e.uuids:1)||(r.disable_uuids=1),o&&(r.state=1),n?j?(o=[R,"v2","presence","sub_key",j],a&&o.push("channel")&&o.push(encodeURIComponent(a)),"0"!=i&&(r.callback=i),void ce({a:i,data:g(r),c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:o})):se("Missing Subscribe Key"):se("Missing Callback")},where_now:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.auth_key||E,a=le(),i=e.uuid||he,r={auth:r};return n?j?("0"!=a&&(r.callback=a),void ce({a:a,data:g(r),c:function(e){u(e,n,t)},b:function(e){c(e,t)},
url:[R,"v2","presence","sub_key",j,"uuid",encodeURIComponent(i)]})):se("Missing Subscribe Key"):se("Missing Callback")},state:function(e,n){var n=e.callback||n||C(),t=e.error||C(),r=e.auth_key||E,a=le(),i=e.state,o=e.uuid||he,s=e.channel,r=g({auth:r});return j?o?s?("0"!=a&&(r.callback=a),Y[s]&&Y[s].f&&i&&(ee[s]=i),r.state=JSON.stringify(i),i=i?[R,"v2","presence","sub-key",j,"channel",encodeURIComponent(s),"uuid",o,"data"]:[R,"v2","presence","sub-key",j,"channel",encodeURIComponent(s),"uuid",encodeURIComponent(o)],void ce({a:a,data:g(r),c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:i})):se("Missing Channel"):se("Missing UUID"):se("Missing Subscribe Key")},grant:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.channel,a=le(),i=e.ttl,o=e.read?"1":"0",s=e.write?"1":"0",f=e.auth_key;if(!n)return se("Missing Callback");if(!j)return se("Missing Subscribe Key");if(!B)return se("Missing Publish Key");if(!P)return se("Missing Secret Key");var l=j+"\n"+B+"\ngrant\n",o={w:s,r:o,timestamp:Math.floor((new Date).getTime()/1e3)};"undefined"!=r&&r!=z&&0<r.length&&(o.channel=r),"0"!=a&&(o.callback=a),(i||0===i)&&(o.ttl=i),f&&(o.auth=f),o=g(o),f||delete o.auth,l+=p(o),r=I(l,P),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),o.signature=r,ce({a:a,data:o,c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:[R,"v1","auth","grant","sub-key",j]})},audit:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.channel,a=e.auth_key,i=le();if(!n)return se("Missing Callback");if(!j)return se("Missing Subscribe Key");if(!B)return se("Missing Publish Key");if(!P)return se("Missing Secret Key");var o=j+"\n"+B+"\naudit\n",s={timestamp:Math.floor((new Date).getTime()/1e3)};"0"!=i&&(s.callback=i),"undefined"!=r&&r!=z&&0<r.length&&(s.channel=r),a&&(s.auth=a),s=g(s),a||delete s.auth,o+=p(s),r=I(o,P),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),s.signature=r,ce({a:i,data:s,c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:[R,"v1","auth","audit","sub-key",j]})},revoke:function(e,n){e.read=A,e.write=A,ge.grant(e,n)},set_uuid:function(e){he=e,t()},get_uuid:function(){return he},presence_heartbeat:function(e){var n=e.callback||C(),t=e.error||C(),e=le(),r={uuid:he,auth:E};2<JSON.stringify(ee).length&&(r.state=JSON.stringify(ee)),0<te&&320>te&&(r.heartbeat=te),"0"!=e&&(r.callback=e);var a=ce,r=g(r),i=5*D,o=R,s=j,f=va(Y,y).join(",");a({a:e,data:r,timeout:i,url:[o,"v2","presence","sub-key",s,"channel",encodeURIComponent(f),"heartbeat"],c:function(e){u(e,n,t)},b:function(e){c(e,t)}})},xdr:ce,ready:wa,db:be,uuid:pa,map:ua,each:N,"each-channel":s,grep:sa,offline:function(){a(1,{message:"Offline. Please check your network settings."})},supplant:ta,now:G,unique:la,updater:ra};he||(he=ge.uuid()),be.set(j+"uuid",he),setTimeout(o,D),setTimeout(i,T),ne=setTimeout(l,(re-3)*D),r();var ye,_=ge;for(ye in _)_.hasOwnProperty(ye)&&(v[ye]=_[ye]);return v.css=sb,v.$=mb,v.create=tb,v.bind=qb,v.head=rb,v.search=pb,v.attr=V,v.events=Gb,v.init=v,v.secure=v,qb("beforeunload",window,function(){return w&&v["each-channel"](function(e){v.LEAVE(e.name,0)}),y}),e.notest?v:(qb("offline",window,v.offline),qb("offline",document,v.offline),v)};Jb.init=Jb,Jb.secure=Jb,"complete"===document.readyState?setTimeout(wa,0):qb("load",window,function(){setTimeout(wa,0)});var Kb=Ib||{};PUBNUB=Jb({notest:1,publish_key:V(Kb,"pub-key"),subscribe_key:V(Kb,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==V(Kb,"ssl"),origin:V(Kb,"origin"),uuid:V(Kb,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=Jb),"undefined"!=typeof module&&(module.exports=PUBNUB)&&wa();var Db=mb("pubnubs")||0;Ib&&(sb(Ib,{position:"absolute",top:-D}),("opera"in window||V(Ib,"flash"))&&(Ib.innerHTML="<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(e,n){return n?($[e].responseText=unescape(n),void $[e].onload()):$[e].onerror()},$.id=D)}var Mb=PUBNUB.ws=function(e,n){if(!(this instanceof Mb))return new Mb(e,n);var t=this,e=t.url=e||"";t.protocol=n||"Sec-WebSocket-Protocol";var r=e.split("/"),r={ssl:"wss:"===r[0],origin:r[2],publish_key:r[3],subscribe_key:r[4],channel:r[5]};return t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,t.CLOSE_NORMAL=1e3,t.CLOSE_GOING_AWAY=1001,t.CLOSE_PROTOCOL_ERROR=1002,t.CLOSE_UNSUPPORTED=1003,t.CLOSE_TOO_LARGE=1004,t.CLOSE_NO_STATUS=1005,t.CLOSE_ABNORMAL=1006,t.onclose=t.onerror=t.onmessage=t.onopen=t.onsend=C(),t.binaryType="",t.extensions="",t.bufferedAmount=0,t.trasnmitting=A,t.buffer=[],t.readyState=t.CONNECTING,e?(t.e=PUBNUB.init(r),t.e.k=r,t.k=r,void t.e.subscribe({restore:A,channel:r.channel,disconnect:t.onerror,reconnect:t.onopen,error:function(){t.onclose({code:t.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:A})},callback:function(e){t.onmessage({data:e})},connect:function(){t.readyState=t.OPEN,t.onopen()}})):(t.readyState=t.CLOSED,t.onclose({code:t.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:y}),t)};Mb.prototype.send=function(e){var n=this;n.e.publish({channel:n.e.k.channel,message:e,callback:function(e){n.onsend({data:e})}})}}();
"use strict";!function(){function e(e,i){function c(e){w.deletePeer(e)}function f(e){if(w.socketAutoReConnect=!0,w.socket)return void(e&&e(w.socket));if("undefined"==typeof n)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}console.log("SocketConnection: ",w),new n(w,function(n){e&&e(w.socket)})}function l(e,n){w.closeBeforeUnload&&(w.isInitiator===!0&&w.dontMakeMeModerator(),w.peers.getAllParticipants().forEach(function(e){S.onNegotiationNeeded({userLeft:!0},e),w.peers[e]&&w.peers[e].peer&&w.peers[e].peer.close(),delete w.peers[e]}),n||w.closeSocket(),w.broadcasters=[],w.isInitiator=!1)}function v(e,n){return e?(n.audio&&e.getAudioTracks().forEach(function(e){e.applyConstraints(n.audio)}),void(n.video&&e.getVideoTracks().forEach(function(e){e.applyConstraints(n.video)}))):void(w.enableLogs&&console.error("No stream to applyConstraints."))}function g(e,n,t){return n?void S.replaceTrack(e,n,t):void w.peers.getAllParticipants().forEach(function(n){S.replaceTrack(e,n,t)})}function h(){if(w.isInitiator&&!w.session.oneway&&!w.session.broadcast&&"many-to-many"===w.direction){var e=w.broadcasters[0],n=[];w.broadcasters.forEach(function(t){t!==e&&n.push(t)}),w.autoCloseEntireSession||w.shiftModerationControl(e,n,!0)}}i=i||{useDefaultDevices:!0};var w=this;w.channel=w.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var S=new t(w);S.onGettingLocalMedia=function(e){e.type="local",w.setStreamEndHandler(e),s(e,function(n){n.id=e.streamid,n.muted=!0,n.volume=0,w.attachStreams.indexOf(e)===-1&&w.attachStreams.push(e),"undefined"!=typeof se&&se.setHandlers(e,!0,w),w.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:n,userid:w.userid,extra:w.extra,streamid:e.streamid,blobURL:n.src||URL.createObjectURL(e),isAudioMuted:!0},o(w,w.streamEvents[e.streamid]),r(w,w.streamEvents[e.streamid]),w.onstream(w.streamEvents[e.streamid])},w)},S.onGettingRemoteMedia=function(e,n){e.type="remote",w.setStreamEndHandler(e,"remote-stream"),s(e,function(t){t.id=e.streamid,"undefined"!=typeof se&&se.setHandlers(e,!1,w),w.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:w.peers[n]?w.peers[n].extra:{},mediaElement:t,streamid:e.streamid,blobURL:t.src||URL.createObjectURL(e)},r(w,w.streamEvents[e.streamid]),w.onstream(w.streamEvents[e.streamid])},w)},S.onRemovingRemoteMedia=function(e,n){var t=w.streamEvents[e.streamid];t||(t={stream:e,type:"remote",userid:n,extra:w.peers[n]?w.peers[n].extra:{},streamid:e.streamid,mediaElement:w.streamEvents[e.streamid]?w.streamEvents[e.streamid].mediaElement:null}),w.onstreamended(t),delete w.streamEvents[e.streamid]},S.onNegotiationNeeded=function(e,n,t){f(function(){w.socket.emit(w.socketMessageEvent,"password"in e?e:{remoteUserId:e.remoteUserId||n,message:e,sender:w.userid},t||function(){})})},S.onUserLeft=c,S.disconnectWith=function(e,n){w.socket&&w.socket.emit("disconnect-with",e,n||function(){}),w.deletePeer(e)},w.broadcasters=[],w.socketOptions={transport:"polling"},w.openOrJoin=function(e,n){w.checkPresence(e,function(t,i){if("function"==typeof n&&(n(t,i),n=null),t){w.sessionid=i;var o=!1,r=!1,a=!!w.session.oneway,s=u(w.session);r={OfferToReceiveAudio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:w.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:a?!!w.session.audio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a?!!w.session.video||!!w.session.screen:w.sdpConstraints.mandatory.OfferToReceiveVideo};var d={remoteUserId:w.sessionid,message:{newParticipationRequest:!0,isOneWay:a,isDataOnly:s,localPeerSdpConstraints:o,remotePeerSdpConstraints:r},sender:w.userid,password:n||!1};return void S.onNegotiationNeeded(d)}w.userid;w.userid=w.sessionid=e||w.sessionid,w.userid+="",w.socket.emit("changed-uuid",w.userid),n&&w.socket.emit("set-password",n),w.isInitiator=!0,u(w.session)||w.captureUserMedia()})},w.open=function(e,n){w.userid;return w.userid=w.sessionid=e||w.sessionid,w.userid+="",w.isInitiator=!0,f(function(){w.socket.emit("changed-uuid",w.userid),1==n&&w.becomePublicModerator()}),u(w.session)?void("function"==typeof n&&n()):void w.captureUserMedia("function"==typeof n?n:null)},w.becomePublicModerator=function(){w.isInitiator&&w.socket.emit("become-a-public-moderator")},w.dontMakeMeModerator=function(){w.socket.emit("dont-make-me-moderator")},w.deletePeer=function(e){if(e){if(w.onleave({userid:e,extra:w.peers[e]?w.peers[e].extra:{}}),w.peers[e]){w.peers[e].streams.forEach(function(e){e.stop()});var n=w.peers[e].peer;if(n&&"closed"!==n.iceConnectionState)try{n.close()}catch(t){}w.peers[e]&&(w.peers[e].peer=null,delete w.peers[e])}if(w.broadcasters.indexOf(e)!==-1){var i=[];w.broadcasters.forEach(function(n){n!==e&&i.push(n)}),w.broadcasters=i,h()}}},w.rejoin=function(e){if(!w.isInitiator&&e&&Object.keys(e).length){var n={};w.peers[e.remoteUserId]&&(n=w.peers[e.remoteUserId].extra,w.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(w.join(e.remoteUserId),w.onReConnecting({userid:e.remoteUserId,extra:n}))}},w.join=w.connect=function(e,n){w.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||w.sessionid,w.sessionid+="";var t=!1,i=!1,o=!1,r=!1;if(e&&e.session||!e||"string"==typeof e){var a=e?e.session||w.session:w.session;o=!!a.oneway,r=u(a),i={OfferToReceiveAudio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:w.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:o?!!w.session.audio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o?!!w.session.video||!!w.session.screen:w.sdpConstraints.mandatory.OfferToReceiveVideo}}n=n||{};var s=function(){};"function"==typeof n&&(s=n,n={}),"undefined"!=typeof n.localPeerSdpConstraints&&(t=n.localPeerSdpConstraints),"undefined"!=typeof n.remotePeerSdpConstraints&&(i=n.remotePeerSdpConstraints),"undefined"!=typeof n.isOneWay&&(o=n.isOneWay),"undefined"!=typeof n.isDataOnly&&(r=n.isDataOnly);var d={remoteUserId:w.sessionid,message:{newParticipationRequest:!0,isOneWay:o,isDataOnly:r,localPeerSdpConstraints:t,remotePeerSdpConstraints:i},sender:w.userid,password:!1};return f(function(){w.peers[w.sessionid]||(S.onNegotiationNeeded(d),s())}),d},w.connectWithAllParticipants=function(e){S.onNegotiationNeeded("connectWithAllParticipants",e||w.sessionid)},w.removeFromBroadcastersList=function(e){S.onNegotiationNeeded("removeFromBroadcastersList",e||w.sessionid),w.peers.getAllParticipants(e||w.sessionid).forEach(function(e){S.onNegotiationNeeded("dropPeerConnection",e),w.deletePeer(e)}),w.attachStreams.forEach(function(e){e.stop()})},w.getUserMedia=w.captureUserMedia=function(e,n){e=e||function(){};var t=n||w.session;return w.dontCaptureUserMedia||u(t)?void e():void((t.audio||t.video||t.screen)&&(t.screen?w.getScreenConstraints(function(i,o){if(i)throw i;w.invokeGetUserMedia({audio:!!m(w)&&p(o),video:o,isScreen:!0},function(i){if((t.audio||t.video)&&!m(w)){var o={};for(var r in t)"screen"!==r&&(o[r]=t[r]);return void w.invokeGetUserMedia(n,e,o)}e(i)})}):(t.audio||t.video)&&w.invokeGetUserMedia(n,e,t)))},w.closeBeforeUnload=!0,window.addEventListener("beforeunload",l,!1),w.userid=a(),w.changeUserId=function(e,n){w.userid=e||a(),w.socket.emit("changed-uuid",w.userid,n||function(){})},w.extra={},w.attachStreams=[],w.session={audio:!0,video:!0},w.enableFileSharing=!1,w.bandwidth={screen:512,audio:128,video:512},w.codecs={audio:"opus",video:"VP9"},w.processSdp=function(e){return V||I?e:(e=X.setApplicationSpecificBandwidth(e,w.bandwidth,!!w.session.screen),e=X.setVideoBitrates(e,{min:8*w.bandwidth.video*1024,max:8*w.bandwidth.video*1024}),e=X.setOpusAttributes(e,{maxaveragebitrate:8*w.bandwidth.audio*1024,maxplaybackrate:8*w.bandwidth.audio*1024,stereo:1,maxptime:3}),"VP9"===w.codecs.video&&(e=X.preferVP9(e)),"H264"===w.codecs.video&&(e=X.removeVPX(e)),"G722"===w.codecs.audio&&(e=X.removeNonG722(e)),e)},"undefined"!=typeof X&&(w.BandwidthHandler=w.CodecsHandler=X),w.mediaConstraints={audio:{mandatory:{},optional:[{bandwidth:8*w.bandwidth.audio*1024||1048576}]},video:{mandatory:{},optional:[{bandwidth:8*w.bandwidth.video*1024||1048576},{facingMode:"user"}]}},I&&(w.mediaConstraints={audio:!0,video:!0}),i.useDefaultDevices||V||DetectRTC.load(function(){var e,n;if(DetectRTC.MediaDevices.forEach(function(t){"audioinput"===t.kind&&w.mediaConstraints.audio!==!1&&(e=t),"videoinput"===t.kind&&w.mediaConstraints.video!==!1&&(n=t)}),e){if(I)return void(w.mediaConstraints.audio!==!0?w.mediaConstraints.audio.deviceId=e.id:w.mediaConstraints.audio={deviceId:e.id});1==w.mediaConstraints.audio&&(w.mediaConstraints.audio={mandatory:{},optional:[]}),w.mediaConstraints.audio.optional||(w.mediaConstraints.audio.optional=[]);var t=[{sourceId:e.id}];w.mediaConstraints.audio.optional=t.concat(w.mediaConstraints.audio.optional)}if(n){if(I)return void(w.mediaConstraints.video!==!0?w.mediaConstraints.video.deviceId=n.id:w.mediaConstraints.video={deviceId:n.id});1==w.mediaConstraints.video&&(w.mediaConstraints.video={mandatory:{},optional:[]}),w.mediaConstraints.video.optional||(w.mediaConstraints.video.optional=[]);var t=[{sourceId:n.id}];w.mediaConstraints.video.optional=t.concat(w.mediaConstraints.video.optional)}}),w.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},w.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},w.iceServers=K.getIceServers(w),w.candidates={host:!0,stun:!0,turn:!0},w.iceProtocols={tcp:!0,udp:!0},w.onopen=function(e){w.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},w.onclose=function(e){w.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},w.onerror=function(e){w.enableLogs&&console.error(e.userid,"data-error",e)},w.onmessage=function(e){w.enableLogs&&console.debug("data-message",e.userid,e.data)},w.send=function(e,n){w.peers.send(e,n)},w.close=w.disconnect=w.leave=function(){l(!1,!0)},w.closeEntireSession=function(e){e=e||function(){},w.socket.emit("close-entire-session",function n(){return w.getAllParticipants().length?void setTimeout(n,100):(w.onEntireSessionClosed({sessionid:w.sessionid,userid:w.userid,extra:w.extra}),void w.changeUserId(null,function(){w.close(),e()}))})},w.onEntireSessionClosed=function(e){w.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},w.onstream=function(e){var n=w.videosContainer;n.insertBefore(e.mediaElement,n.firstChild),e.mediaElement.play(),setTimeout(function(){e.mediaElement.play()},5e3)},w.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},w.direction="many-to-many",w.removeStream=function(e){var n;return w.attachStreams.forEach(function(t){t.id===e&&(n=t)}),n?(w.peers.getAllParticipants().forEach(function(e){var t=w.peers[e];try{t.peer.removeStream(n)}catch(i){}}),void w.renegotiate()):void console.warn("No such stream exists.",e)},w.addStream=function(e,n){function t(t){e.streamCallback&&e.streamCallback(t),w.renegotiate(n)}return e.getAudioTracks?(w.attachStreams.indexOf(e)===-1&&(e.streamid||(e.streamid=e.id),w.attachStreams.push(e)),void w.renegotiate(n)):u(e)?void w.renegotiate(n):void((e.audio||e.video||e.screen)&&(e.screen?w.getScreenConstraints(function(n,i){return n?alert(n):void w.invokeGetUserMedia({audio:!!m(w)&&p(i),video:i,isScreen:!0},!e.audio&&!e.video||m(w)?t:w.invokeGetUserMedia(null,t))}):(e.audio||e.video)&&w.invokeGetUserMedia(null,t)))},w.invokeGetUserMedia=function(e,n,t){t||(t=w.session),e||(e=w.mediaConstraints),T({onGettingLocalMedia:function(t){var i=e.video;i&&(i.mediaSource||i.mozMediaSource?t.isScreen=!0:i.mandatory&&i.mandatory.chromeMediaSource&&(t.isScreen=!0)),t.isScreen||(t.isVideo=t.getVideoTracks().length,t.isAudio=!t.isVideo&&t.getAudioTracks().length),S.onGettingLocalMedia(t),n&&n(t)},onLocalMediaError:function(e,n){S.onLocalMediaError(e,n)},localMediaConstraints:e||{audio:!!t.audio&&e.audio,video:!!t.video&&e.video}})},w.applyConstraints=function(e,n){if(!_||!_.prototype.applyConstraints)return void alert("track.applyConstraints is NOT supported in your browser.");if(n){var t;return w.streamEvents[n]&&(t=w.streamEvents[n].stream),void v(t,e)}w.attachStreams.forEach(function(n){v(n,e)})},w.replaceTrack=function(e,n,t){function i(i){w.replaceTrack(i,n,t||e.video||e.screen)}if(e=e||{},!j.prototype.getSenders)return void w.addStream(e);if(e instanceof _)return void g(e,n,t);if(e instanceof q)return e.getVideoTracks().length&&g(e.getVideoTracks()[0],n,!0),void(e.getAudioTracks().length&&g(e.getAudioTracks()[0],n,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?w.getScreenConstraints(function(n,t){return n?alert(n):void w.invokeGetUserMedia({audio:!!m(w)&&p(t),video:t,isScreen:!0},!e.audio&&!e.video||m(w)?i:w.invokeGetUserMedia(null,i))}):(e.audio||e.video)&&w.invokeGetUserMedia(null,i))},w.resetTrack=function(e,n){e||(e=w.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var t=w.peers[e].peer;"undefined"!=typeof n&&n!==!0||!t.lastVideoTrack||w.replaceTrack(t.lastVideoTrack,e,!0),"undefined"!=typeof n&&n!==!1||!t.lastAudioTrack||w.replaceTrack(t.lastAudioTrack,e,!1)})},w.renegotiate=function(e){return e?void S.renegotiatePeer(e):void w.peers.getAllParticipants().forEach(function(e){S.renegotiatePeer(e)})},w.setStreamEndHandler=function(e,n){e&&e.addEventListener&&(n=!!n,e.alreadySetEndHandler||(e.alreadySetEndHandler=!0,e.addEventListener("ended",function(){e.idInstance&&ae.remove(e.idInstance),n||delete w.attachStreams[w.attachStreams.indexOf(e)];var t=w.streamEvents[e.streamid];t||(t={stream:e,streamid:e.streamid,type:n?"remote":"local",userid:w.userid,extra:w.extra,mediaElement:w.streamEvents[e.streamid]?w.streamEvents[e.streamid].mediaElement:null}),t.userid===w.userid&&"remote"===t.type||(w.onstreamended(t),delete w.streamEvents[e.streamid])},!1)))},w.onMediaError=function(e,n){w.enableLogs&&console.error(e,n)},w.addNewBroadcaster=function(e,n){w.broadcasters.length&&setTimeout(function(){S.connectNewParticipantWithAllBroadcasters(e,n,w.broadcasters.join("|-,-|"))},1e4),w.session.oneway||w.session.broadcast||"many-to-many"!==w.direction||w.broadcasters.indexOf(e)!==-1||(w.broadcasters.push(e),h())},w.autoCloseEntireSession=!1,w.filesContainer=w.videosContainer=document.body||document.documentElement,w.isInitiator=!1,w.shareFile=S.shareFile,"undefined"!=typeof le&&le.handle(w),"undefined"!=typeof me&&me.handle(w),w.token=a,w.onNewParticipant=function(e,n){w.acceptParticipationRequest(e,n)},w.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),S.createNewPeer(e,n)},w.onShiftedModerationControl=function(e,n){w.acceptModerationControl(e,n)},w.acceptModerationControl=function(e,n){w.isInitiator=!0,w.broadcasters=n,w.peers.getAllParticipants().forEach(function(n){S.onNegotiationNeeded({changedUUID:e,oldUUID:w.userid,newUUID:e},n)}),w.userid=e,w.socket.emit("changed-uuid",w.userid)},w.shiftModerationControl=function(e,n,t){S.onNegotiationNeeded({shiftedModerationControl:!0,broadcasters:n,firedOnLeave:!!t},e)},"undefined"!=typeof se&&(w.StreamsHandler=se),w.onleave=function(e){},w.invokeSelectFileDialog=function(e){var n=new FileSelector;n.selectSingleFile(e)},w.getPublicModerators=function(e,n){"function"==typeof e&&(n=e),f(function(){w.socket.emit("get-public-moderators","string"==typeof e?e:"",n)})},w.onmute=function(e){e&&e.mediaElement&&("both"===e.muteType||"video"===e.muteType?(e.mediaElement.src=null,e.mediaElement.pause(),e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"):"audio"===e.muteType&&(e.mediaElement.muted=!0))},w.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.src=URL.createObjectURL(e.stream),e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},w.onExtraDataUpdated=function(e){e.status="online",w.onUserStatusChanged(e,!0)},w.onJoinWithPassword=function(e){console.warn(e,"is password protected. Please join with password.")},w.onInvalidPassword=function(e,n){console.warn(e,"is password protected. Please join with valid password. Your old password",n,"is wrong.")},w.onPasswordMaxTriesOver=function(e){console.warn(e,"is password protected. Your max password tries exceeded the limit.")},w.getAllParticipants=function(e){return w.peers.getAllParticipants(e)},"undefined"!=typeof se&&(se.onSyncNeeded=function(e,n,t){w.peers.getAllParticipants().forEach(function(i){S.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:t||"both"},i)})}),w.connectSocket=function(e){f(e)},w.socketAutoReConnect=!0,w.closeSocket=function(){try{io.sockets={}}catch(e){}w.socket&&(w.socketAutoReConnect=!1,"function"==typeof w.socket.disconnect&&w.socket.disconnect(),w.socket=null)},w.getSocket=function(e){return w.socket?e&&e(w.socket):f(e),w.socket},w.getRemoteStreams=S.getRemoteStreams;var C=["selectFirst","selectAll","forEach"];if(w.streamEvents={selectFirst:function(e){if(!e){var n;for(var t in w.streamEvents)C.indexOf(t)!==-1||n||(n=w.streamEvents[t]);return n}},selectAll:function(){}},w.socketURL="/",w.socketMessageEvent="RTCMultiConnection-Message",w.socketCustomEvent="RTCMultiConnection-Custom-Message",w.DetectRTC=DetectRTC,w.onUserStatusChanged=function(e,n){w.enableLogs&&!n&&console.info(e.userid,e.status)},w.getUserMediaHandler=T,w.multiPeersHandler=S,w.enableLogs=!0,w.setCustomSocketHandler=function(e){"undefined"!=typeof n&&(n=e)},w.chunkSize=65e3,w.maxParticipantsAllowed=1e3,w.disconnectWith=S.disconnectWith,w.checkPresence=function(e,n){return w.socket?void w.socket.emit("check-presence",(e||w.sessionid)+"",n):void w.connectSocket(function(){w.checkPresence(e,n)})},w.onReadyForOffer=function(e,n){w.multiPeersHandler.createNewPeer(e,n)},w.setUserPreferences=function(e){return w.dontAttachStream&&(e.dontAttachLocalStream=!0),w.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},w.updateExtraData=function(){w.socket.emit("extra-data-updated",w.extra)},w.enableScalableBroadcast=!1,w.maxRelayLimitPerUser=3,w.dontCaptureUserMedia=!1,w.dontAttachStream=!1,w.dontGetRemoteStream=!1,w.onReConnecting=function(e){w.enableLogs&&console.info("ReConnecting with",e.userid,"...")},w.beforeAddingStream=function(e){return e},w.beforeRemovingStream=function(e){return e},"undefined"!=typeof x&&(w.checkIfChromeExtensionAvailable=x),"undefined"!=typeof R&&(w.checkIfChromeExtensionAvailable=R),"undefined"!=typeof O&&(w.getChromeExtensionStatus=O),w.getScreenConstraints=function(e,n){m(w,n)&&(n=!0),M(function(n,t){n||(t=w.modifyScreenConstraints(t),e(n,t))},n)},w.modifyScreenConstraints=function(e){return e},w.onPeerStateChanged=function(e){w.enableLogs&&e.iceConnectionState.search(/closed|failed/gi)!==-1&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},w.isOnline=!0,d("online",function(){w.isOnline=!0}),d("offline",function(){w.isOnline=!1}),w.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(w.isLowBandwidth=navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g)!==-1,w.isLowBandwidth)){if(w.bandwidth={audio:30,video:30,screen:30},w.mediaConstraints.audio&&w.mediaConstraints.audio.optional&&w.mediaConstraints.audio.optional.length){var y=[];w.mediaConstraints.audio.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&y.push(e)}),w.mediaConstraints.audio.optional=y}if(w.mediaConstraints.video&&w.mediaConstraints.video.optional&&w.mediaConstraints.video.optional.length){var y=[];w.mediaConstraints.video.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&y.push(e)}),w.mediaConstraints.video.optional=y}}w.getExtraData=function(e){if(!e)throw"remoteUserId is required.";return w.peers[e]?w.peers[e].extra:{}},i.autoOpenOrJoin&&w.openOrJoin(w.sessionid),w.onUserIdAlreadyTaken=function(e,n){w.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",n),w.join(e)},w.trickleIce=!0}function n(e,n){console.log("connection: ",e);var t="";t+="?userid="+e.userid,t+="&msgEvent="+e.socketMessageEvent,t+="&socketCustomEvent="+e.socketCustomEvent,e.enableScalableBroadcast&&(t+="&enableScalableBroadcast=true",t+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2));try{io.sockets={}}catch(i){}try{e.socket=io((e.socketURL||"/")+t)}catch(i){e.socket=io.connect((e.socketURL||"/")+t,e.socketOptions)}var o=e.multiPeersHandler;e.socket.on("extra-data-updated",function(n,t){e.peers[n]&&(e.peers[n].extra=t,e.onExtraDataUpdated({userid:n,extra:t}))}),e.socket.on(e.socketMessageEvent,function(n){if(n.remoteUserId==e.userid){if(e.peers[n.sender]&&e.peers[n.sender].extra!=n.extra&&(e.peers[n.sender].extra=n.extra,e.onExtraDataUpdated({userid:n.sender,extra:n.extra})),n.message.streamSyncNeeded&&e.peers[n.sender]){var t=e.streamEvents[n.message.streamid];if(!t||!t.stream)return;var i=n.message.action;if("ended"===i||"stream-removed"===i)return void e.onstreamended(t);var r="both"!=n.message.type?n.message.type:null;return void t.stream[i](r)}if("connectWithAllParticipants"===n.message)return e.broadcasters.indexOf(n.sender)===-1&&e.broadcasters.push(n.sender),void o.onNegotiationNeeded({allParticipants:e.getAllParticipants(n.sender)},n.sender);if("removeFromBroadcastersList"===n.message)return void(e.broadcasters.indexOf(n.sender)!==-1&&(delete e.broadcasters[e.broadcasters.indexOf(n.sender)],e.broadcasters=c(e.broadcasters)));if("dropPeerConnection"===n.message)return void e.deletePeer(n.sender);if(n.message.allParticipants)return n.message.allParticipants.indexOf(n.sender)===-1&&n.message.allParticipants.push(n.sender),void n.message.allParticipants.forEach(function(n){o[e.peers[n]?"renegotiatePeer":"createNewPeer"](n,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:u(e.session)})});if(n.message.newParticipant){if(n.message.newParticipant==e.userid)return;if(e.peers[n.message.newParticipant])return;return void o.createNewPeer(n.message.newParticipant,n.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:u(e.session)})}if((n.message.readyForOffer||n.message.addMeAsBroadcaster)&&e.addNewBroadcaster(n.sender),n.message.newParticipationRequest&&n.sender!==e.userid){e.peers[n.sender]&&e.deletePeer(n.sender);var a={extra:n.extra||{},localPeerSdpConstraints:n.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:n.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:"undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:"undefined"!=typeof n.message.isDataOnly?n.message.isDataOnly:u(e.session),dontGetRemoteStream:"undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!n.message.dontGetRemoteStream,connectionDescription:n,successCallback:function(){("undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction)&&e.addNewBroadcaster(n.sender,a),(e.session.oneway||"one-way"===e.direction||u(e.session))&&e.addNewBroadcaster(n.sender,a)}};return void e.onNewParticipant(n.sender,a)}return n.message.shiftedModerationControl?void e.onShiftedModerationControl(n.sender,n.message.broadcasters):(n.message.changedUUID&&e.peers[n.message.oldUUID]&&(e.peers[n.message.newUUID]=e.peers[n.message.oldUUID],delete e.peers[n.message.oldUUID]),n.message.userLeft?(o.onUserLeft(n.sender),void(n.message.autoCloseEntireSession&&e.leave())):void o.addNegotiatedMessage(n.message,n.sender))}}),e.socket.on("user-left",function(n){onUserLeft(n),e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]?e.peers[n].extra||{}:{}}),e.onleave({userid:n,extra:{}})}),e.socket.on("connect",function(){return e.socketAutoReConnect?(e.enableLogs&&console.info("socket.io connection is opened."),e.socket.emit("extra-data-updated",e.extra),void(n&&n(e.socket))):void(e.socket=null)}),e.socket.on("disconnect",function(){return e.socketAutoReConnect?void(e.enableLogs&&(console.info("socket.io connection is closed"),console.warn("socket.io reconnecting"))):void(e.socket=null)}),e.socket.on("join-with-password",function(n){e.onJoinWithPassword(n)}),e.socket.on("invalid-password",function(n,t){e.onInvalidPassword(n,t)}),e.socket.on("password-max-tries-over",function(n){e.onPasswordMaxTriesOver(n)}),e.socket.on("user-disconnected",function(n){n!==e.userid&&(e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]?e.peers[n].extra||{}:{}}),e.deletePeer(n))}),e.socket.on("user-connected",function(n){n!==e.userid&&e.onUserStatusChanged({userid:n,status:"online",extra:e.peers[n]?e.peers[n].extra||{}:{}})}),e.socket.on("closed-entire-session",function(n,t){e.leave(),e.onEntireSessionClosed({sessionid:n,userid:n,extra:t})}),e.socket.on("userid-already-taken",function(n,t){e.isInitiator=!1,e.userid=t,e.onUserIdAlreadyTaken(n,t)}),e.socket.on("logs",function(n){e.enableLogs&&console.debug("server-logs",n)})}function t(e){function n(n,t,o){var r={};e.attachStreams.forEach(function(e){r[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=r,i.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},o)}function t(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(n){e.onFileProgress(n)},e.fbr.onBegin=function(n){e.onFileStart(n)},e.fbr.onEnd=function(n){e.onFileEnd(n)}}var i=this,o=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peers={getLength:function(){var e=0;for(var n in this)o.indexOf(n)==-1&&e++;return e},selectFirst:function(){var e;for(var n in this)o.indexOf(n)==-1&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var t in this)o.indexOf(t)==-1&&t!=e&&n.push(t);return n},forEach:function(n){this.getAllParticipants().forEach(function(t){n(e.peers[t])})},send:function(n,t){var o=this;if(!f(n.size)&&!f(n.type))return void i.shareFile(n,t);if(!("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView))return void fe.send({text:n,channel:this,connection:e,remoteUserId:t});if("text"===n.type&&(n=JSON.stringify(n)),t){var r=e.peers[t];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(n)}):(e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){o.send(n,t)},3e3))}this.getAllParticipants().forEach(function(t){return o[t].channels.length?void o[t].channels.forEach(function(e){e.send(n)}):(e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){o[t].channels.forEach(function(e){e.send(n)})},3e3))})}},this.uuid=e.userid,this.getLocalConfig=function(n,o,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:o,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){i.onNegotiationNeeded(e,o)},onLocalCandidate:function(n){n=Y.processCandidates(e,n),n&&i.onNegotiationNeeded(n,o)},remoteSdp:n,onDataChannelMessage:function(n){if(!e.fbr&&e.enableFileSharing&&t(),"string"==typeof n||!e.enableFileSharing)return void i.onDataChannelMessage(n,o);var r=this;return n instanceof ArrayBuffer||n instanceof DataView?void e.fbr.convertToObject(n,function(e){r.onDataChannelMessage(e)}):n.readyForNextChunk?void e.fbr.getNextChunk(n.uuid,function(n,t){e.peers[o].channels.forEach(function(e){e.send(n)})},o):void e.fbr.addChunk(n,function(n){e.peers[o].peer.channel.send(n)})},onDataChannelError:function(e){i.onDataChannelError(e,o)},onDataChannelOpened:function(e){i.onDataChannelOpened(e,o)},onDataChannelClosed:function(e){i.onDataChannelClosed(e,o)},onRemoteStream:function(n){if(e.peers[o].streams.push(n),W&&window.PluginRTC){var t=document.createElement("video"),r=e.videosContainer;return r.insertBefore(t,r.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(t,n)},3e3)}i.onGettingRemoteMedia(n,o)},onRemoteStreamRemoved:function(e){i.onRemovingRemoteMedia(e,o)},onPeerStateChanged:function(e){i.onPeerStateChanged(e),"new"===e.iceConnectionState&&i.onNegotiationStarted(o,e),"connected"===e.iceConnectionState&&i.onNegotiationCompleted(o,e),e.iceConnectionState.search(/closed|failed/gi)!==-1&&(i.onUserLeft(o),i.disconnectWith(o))}}},this.createNewPeer=function(n,t){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(t=t||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!t.streamsToShare&&(t.isOneWay=!1,t.isDataOnly=!1,t.session=e.session),!t.isOneWay&&!t.isDataOnly)return t.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:t},n);t=e.setUserPreferences(t,n);var i=this.getLocalConfig(null,n,t);e.peers[n]=new h(i)}},this.createAnsweringPeer=function(n,t,i){i=e.setUserPreferences(i||{},t);var o=this.getLocalConfig(n,t,i);e.peers[t]=new h(o)},this.renegotiatePeer=function(n,t,i){if(!e.peers[n])return void(e.enableLogs&&console.error("This peer ("+n+") does not exists. Renegotiation skipped."));t||(t={}),t.renegotiatingPeer=!0,t.peerRef=e.peers[n].peer,t.channels=e.peers[n].channels;var o=this.getLocalConfig(i,n,t);e.peers[n]=new h(o)},this.replaceTrack=function(n,t,i){if(!e.peers[t])throw"This peer ("+t+") does not exists.";var o=e.peers[t].peer;return o.getSenders&&"function"==typeof o.getSenders&&o.getSenders().length?void o.getSenders().forEach(function(o){i&&o.track instanceof VideoStreamTrack&&(e.peers[t].peer.lastVideoTrack=o.track,o.replaceTrack(n)),!i&&o.track instanceof AudioStreamTrack&&(e.peers[t].peer.lastAudioTrack=o.track,o.replaceTrack(n))}):(console.warn("RTPSender.replaceTrack is NOT supported."),void this.renegotiatePeer(t))},this.onNegotiationNeeded=function(e,n){},this.addNegotiatedMessage=function(t,o){function r(e){n(e,t,o)}if(t.type&&t.sdp)return"answer"==t.type&&e.peers[o]&&e.peers[o].addRemoteSdp(t),"offer"==t.type&&(t.renegotiatingPeer?this.renegotiatePeer(o,null,t):this.createAnsweringPeer(t,o)),void(e.enableLogs&&console.log("Remote peer's sdp:",t.sdp));if(t.candidate)return e.peers[o]&&e.peers[o].addRemoteCandidate(t),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",t.candidate));
if(t.enableMedia){if(e.attachStreams.length||e.dontCaptureUserMedia){var a={};return e.attachStreams.forEach(function(e){a[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=a,void i.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},o)}var s={},d=t.userPreferences;d.localPeerSdpConstraints.OfferToReceiveAudio&&(s.audio=e.mediaConstraints.audio),d.localPeerSdpConstraints.OfferToReceiveVideo&&(s.video=e.mediaConstraints.video);var c=d.session||e.session;c.oneway&&c.audio&&"two-way"===c.audio&&(c={audio:!0}),(c.audio||c.video||c.screen)&&(c.screen?e.getScreenConstraints(function(n,t){e.invokeGetUserMedia({audio:!!m(e)&&p(t),video:t,isScreen:!0},!c.audio&&!c.video||m(e)?r:e.invokeGetUserMedia(null,r))}):(c.audio||c.video)&&e.invokeGetUserMedia(null,r,c))}t.readyForOffer&&e.onReadyForOffer(o,t.userPreferences)},this.connectNewParticipantWithAllBroadcasters=function(e,n,t){if(t=t.split("|-,-|"),t.length){var o=t[0];i.onNegotiationNeeded({newParticipant:e,userPreferences:n||!1},o),delete t[0];var r=[];t.forEach(function(e){e&&r.push(e)}),setTimeout(function(){i.connectNewParticipantWithAllBroadcasters(e,n,r.join("|-,-|"))},1e4)}},this.onGettingRemoteMedia=function(e,n){},this.onRemovingRemoteMedia=function(e,n){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(n,t){e.onMediaError(n,t)},this.shareFile=function(n,i){if(!e.enableFileSharing)throw'"connection.enableFileSharing" is false.';t(),e.fbr.readAsArrayBuffer(n,function(n){var t=e.getAllParticipants();i&&(t=[i]),t.forEach(function(t){e.fbr.getNextChunk(n,function(n){e.peers[t].channels.forEach(function(e){e.send(n)})},t)})},{userid:e.userid,chunkSize:I?15e3:e.chunkSize||0})};var r=new A(e);this.onDataChannelMessage=function(n,t){r.receive(JSON.parse(n),t,e.peers[t]?e.peers[t].extra:{})},this.onDataChannelClosed=function(n,t){n.userid=t,n.extra=e.peers[t]?e.peers[t].extra:{},e.onclose(n)},this.onDataChannelError=function(n,t){n.userid=t,event.extra=e.peers[t]?e.peers[t].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,t){return e.peers[t].channels.length?void(e.peers[t].channels=[n]):(e.peers[t].channels.push(n),void e.onopen({userid:t,extra:e.peers[t]?e.peers[t].extra:{},channel:n}))},this.onPeerStateChanged=function(n){e.onPeerStateChanged(n)},this.onNegotiationStarted=function(e,n){},this.onNegotiationCompleted=function(e,n){},this.getRemoteStreams=function(n){return n=n||e.peers.getAllParticipants()[0],e.peers[n]?e.peers[n].streams:[]},this.isPluginRTC=e.isPluginRTC=W}function i(e,n,t){if("undefined"!=typeof CustomEvent){var i={arguments:t,__exposedProps__:t},o=new CustomEvent(n,i);e.dispatchEvent(o)}}function o(e,n){if(!e||!n)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(n.stream,{onspeaking:function(){e.onspeaking(n)},onsilence:function(){e.onsilence(n)},onvolumechange:function(t,i){e.onvolumechange&&e.onvolumechange(merge({volume:t,threshold:i},n))}})}}function r(e,n){n.stream&&n.stream&&n.stream.addEventListener&&(n.stream.addEventListener("mute",function(t){t=e.streamEvents[n.streamid],t.session={audio:"audio"===t.muteType,video:"video"===t.muteType},e.onmute(t)},!1),n.stream.addEventListener("unmute",function(t){t=e.streamEvents[n.streamid],t.session={audio:"audio"===t.unmuteType,video:"video"===t.unmuteType},e.onunmute(t)},!1))}function a(){if(window.crypto&&window.crypto.getRandomValues&&navigator.userAgent.indexOf("Safari")===-1){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,i=e.length;t<i;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function s(e,n,t){var i=!1;e.getVideoTracks&&!e.getVideoTracks().length&&(i=!0);var o=document.createElement(i?"audio":"video");return W&&window.PluginRTC?(t.videosContainer.insertBefore(o,t.videosContainer.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(o,e),n(o)},1e3)):(o[I?"mozSrcObject":"src"]=I?e:window.URL.createObjectURL(e),o.controls=!0,I&&o.addEventListener("ended",function(){if(ae.remove(e.idInstance),"local"===e.type){se.onSyncNeeded(e.streamid,"ended"),t.attachStreams.forEach(function(n,i){e.streamid===n.streamid&&delete t.attachStreams[i]});var n=[];t.attachStreams.forEach(function(e){e&&n.push(e)}),t.attachStreams=n;var i=t.streamEvents[e.streamid];if(i)return void t.onstreamended(i);this.parentNode&&this.parentNode.removeChild(this)}},!1),o.play(),void n(o))}function d(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function c(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function f(e){return"undefined"==typeof e}function l(e){return"string"==typeof e}function m(e,n){return(!e.session.audio||"two-way"!==e.session.audio)&&(!(!I||n===!1)||!(!L||B<50)&&(typeof n===!0||!("undefined"!=typeof n||!e.session.audio||!e.session.screen||e.session.video)&&(n=!0,!0)))}function p(e){return!!I||!!L&&{mandatory:{chromeMediaSource:e.mandatory.chromeMediaSource,chromeMediaSourceId:e.mandatory.chromeMediaSourceId}}}function v(){if("iOS"===DetectRTC.osName&&"undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),e.registerGlobals()}}function g(e){var n,t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return n={mandatory:t,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&G>34&&(n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),n}function h(e){function n(n){n.binaryType="arraybuffer",n.onmessage=function(n){e.onDataChannelMessage(n.data)},n.onopen=function(){e.onDataChannelOpened(n)},n.onerror=function(n){e.onDataChannelError(n)},n.onclose=function(n){e.onDataChannelClosed(n)},n.internalSend=n.send,n.send=function(e){"open"===n.readyState&&n.internalSend(e)},a.channel=n}if(!j)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var t=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:t.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription;var o=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var r={};z.sdpConstraints=g({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var a,s=!!e.renegotiatingPeer;e.remoteSdp&&(s=!!e.remoteSdp.renegotiatingPeer);var d=[];if(t.attachStreams.forEach(function(e){e&&d.push(e)}),s)a=e.peerRef;else{var c="all";(t.candidates.turn||t.candidates.relay)&&(t.candidates.stun||t.candidates.reflexive||t.candidates.host||(c="relay")),a=new j(navigator.onLine?{iceServers:t.iceServers,iceTransports:c}:null,window.PluginRTC?null:t.optionalArgument)}a.onicecandidate=function(n){if(n.candidate)t.trickleIce&&e.onLocalCandidate({candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex});else if(!t.trickleIce){var i=a.localDescription;e.onLocalSdp({type:i.type,sdp:i.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:o.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:m,isFirefoxOffered:I})}};var u=!I;e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.isFirefoxOffered&&(u=!0),d.forEach(function(n){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(n=t.beforeAddingStream(n),n&&(a.getLocalStreams().forEach(function(e){e.id==n.id&&(n=null)}),n&&a.addStream(n)))}),a.oniceconnectionstatechange=a.onsignalingstatechange=function(){var n=o.extra;t.peers[o.userid]&&(n=t.peers[o.userid].extra||n),a&&e.onPeerStateChanged({iceConnectionState:a.iceConnectionState,iceGatheringState:a.iceGatheringState,signalingState:a.signalingState,extra:n,userid:o.userid})};var f={OfferToReceiveAudio:!!d.length,OfferToReceiveVideo:!!d.length};e.localPeerSdpConstraints&&(f=e.localPeerSdpConstraints),z.sdpConstraints=g(f),a.onaddstream=function(n){var t={};e.remoteSdp&&e.remoteSdp.streamsToShare?t=e.remoteSdp.streamsToShare:e.streamsToShare&&(t=e.streamsToShare);var o=t[n.stream.id];o&&(n.stream.isAudio=o.isAudio,n.stream.isVideo=o.isVideo,n.stream.isScreen=o.isScreen),n.stream.streamid=n.stream.id,n.stream.stop||(n.stream.stop=function(){I&&i(this,"ended")}),r[n.stream.id]=n.stream,e.onRemoteStream(n.stream)},a.onremovestream=function(n){n.stream.streamid=n.stream.id,r[n.stream.id]&&delete r[n.stream.id],e.onRemoteStreamRemoved(n.stream)},this.addRemoteCandidate=function(e){a.addIceCandidate(new J(e))},this.addRemoteSdp=function(e,n){e.sdp=t.processSdp(e.sdp),a.setRemoteDescription(new H(e),n||function(){},function(n){t.enableLogs&&console.error(JSON.stringify(n,null,"\t"),"\n",e.type,e.sdp)})};var l=!0;e.remoteSdp&&(l=!1),this.createDataChannel=function(){var e=a.createDataChannel("sctp",{});n(e)},t.session.data!==!0||s||(l?this.createDataChannel():a.ondatachannel=function(e){var t=e.channel;n(t)}),e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(f=e.remoteSdp.remotePeerSdpConstraints),z.sdpConstraints=g(f),this.addRemoteSdp(e.remoteSdp)),"two-way"!=t.session.audio&&"two-way"!=t.session.video&&"two-way"!=t.session.screen||(z.sdpConstraints=g({OfferToReceiveAudio:"two-way"==t.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==t.session.video||"two-way"==t.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var m={};a.getLocalStreams().forEach(function(e){m[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),a[l?"createOffer":"createAnswer"](function(n){n.sdp=t.processSdp(n.sdp),a.setLocalDescription(n),t.trickleIce&&e.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:o.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:m,isFirefoxOffered:I})},function(e){t.enableLogs&&console.error("sdp-error",e)},z.sdpConstraints),a.nativeClose=a.close,a.close=function(){if(a){try{a.iceConnectionState.search(/closed|failed/gi)===-1&&a.getRemoteStreams().forEach(function(e){e.stop()}),a.nativeClose()}catch(e){}a=null,o.peer=null}},this.peer=a}function w(e,n){if(!$){if(!n)return w(e,!0);$=!0;var t=document.createElement("iframe");t.onload=function(){function n(t){t.data&&t.data.iceServers&&(e(t.data.iceServers),window.removeEventListener("message",n))}t.isLoaded=!0,d("message",n),t.contentWindow.postMessage("get-ice-servers","*")},t.src="https://cdn.webrtc-experiment.com/getIceServers/",t.style.display="none",(document.body||document.documentElement).appendChild(t)}}function S(e){var n="urls";W&&(n="url");var t={};return t[n]=e,t}function C(e,n,t){var i="urls";W&&(i="url");var o={username:n,credential:t};return o[i]=e,o}function y(){var e=[];return window.RMCExternalIceServers.forEach(function(n){n.urls||(n.urls=n.url),n.urls.search("stun|stuns")!==-1&&e.push(S(n.urls)),n.urls.search("turn|turns")!==-1&&e.push(C(n.urls,n.username,n.credential))}),e}function b(e){return new Promise(function(n,t){Q(e,n,t)})}function k(e,n){e.mandatory&&e.mandatory.chromeMediaSource?n.isScreen=!0:e.mozMediaSource||e.mediaSource?n.isScreen=!0:e.video?n.isVideo=!0:e.audio&&(n.isAudio=!0)}function T(e){function n(n,i){k(e.localMediaConstraints,n),e.onGettingLocalMedia(n,i),n.addEventListener("ended",function(){delete ae.streams[t],ae.mutex=!1,ae.queueRequests.indexOf(e)&&(delete ae.queueRequests[ae.queueRequests.indexOf(e)],ae.queueRequests=c(ae.queueRequests))},!1),ae.streams[t]={stream:n},ae.mutex=!1,ae.queueRequests.length&&T(ae.queueRequests.shift())}if(ae.mutex===!0)return void ae.queueRequests.push(e);ae.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(ae.streams[t])n(ae.streams[t].stream,!0);else{if(W&&window.PluginRTC){document.createElement("video");return void window.PluginRTC.getUserMedia({audio:!0,video:!0},function(e){e.streamid=e.id||a(),n(e)},function(e){})}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=t,n(e)})["catch"](function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}}function P(e){if("PermissionDeniedError"==e){if(ue="PermissionDeniedError",ce)return ce("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(ue="desktop"),e.sourceId&&ce&&ce(de=e.sourceId)}function x(e){if(e){if(I)return R(e);if("desktop"==ue)return e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"==ue?!1:!0)},2e3)}}function R(e){function n(i){var o=i.data;o&&"undefined"!=typeof o.isScreenCapturingEnabled&&(t=!0,e(o.isScreenCapturingEnabled===!0?!0:!1),window.removeEventListener("message",n,!1))}if(e){if(!I)return x(e);var t=!1;window.addEventListener("message",n,!1),window.postMessage({checkIfScreenCapturingEnabled:!0,domains:[document.domain]},"*"),setTimeout(function(){t||e(!0)},2e3)}}function E(e,n){if(!e)throw'"callback" parameter is mandatory.';return de?(e(de),void(de=null)):(ce=e,n?void window.postMessage("audio-plus-tab","*"):void window.postMessage("get-sourceId","*"))}function O(e,n){if(2!=arguments.length&&(n=e,e=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),I)return n("not-chrome");var t=document.createElement("img");t.src="https://raw.githubusercontent.com/4LOOPph/desktopCapture-p2p/master/images/desktopCapture48.png",t.onload=function(){ue="screen",window.postMessage("are-you-there","*"),setTimeout(function(){n("screen"==ue?e==e?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},t.onerror=function(){n("not-installed")}}function M(e,n){var t={mozMediaSource:"window",mediaSource:"window",width:29999,height:8640};return I?e(null,t):void x(function(t){var i={mandatory:{chromeMediaSource:ue,maxWidth:29999,maxHeight:8640,minFrameRate:30,maxFrameRate:128,minAspectRatio:1.77},optional:[]};return"desktop"!=ue||de?("desktop"==ue&&(i.mandatory.chromeMediaSourceId=de),void e(null,i)):void E(function(){i.mandatory.chromeMediaSourceId=de,e("PermissionDeniedError"==de?de:null,i),de=null},n)})}function A(e){function n(n,i,o){var r=n.uuid;if(t[r]||(t[r]=[]),t[r].push(n.message),n.last){var a=t[r].join("");n.isobject&&(a=JSON.parse(a));var s=(new Date).getTime(),d=s-n.sendingTime,c={data:a,userid:i,extra:o,latency:d};e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(n){c.data=n,e.onmessage(c)})):e.onmessage(c),delete t[r]}}var t={};return{receive:n}}var D=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,I="undefined"!=typeof window.InstallTrigger,U=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,L=!!window.chrome&&!D,N=!!document.documentMode,V=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);"undefined"!=typeof cordova&&(V=!0,L=!0),navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1&&(V=!0,L=!0);var W=!V&&(U||N);W&&"undefined"!=typeof URL&&(URL.createObjectURL=function(){});var B=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),50),F=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);L&&F&&F[2]&&(B=parseInt(F[2],10));var G=50;F=navigator.userAgent.match(/Firefox\/(.*)/),I&&F&&F[1]&&(G=parseInt(F[1],10)),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.attachEventListener=function(e,n,t,i){e.addEventListener(n,t,i)};var q=window.MediaStream;"undefined"==typeof q&&"undefined"!=typeof webkitMediaStream&&(q=webkitMediaStream),"undefined"!=typeof q&&("getVideoTracks"in q.prototype||(q.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(n){n.kind.toString().indexOf("video")!==-1&&e.push(n)}),e},q.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(n){n.kind.toString().indexOf("audio")!==-1&&e.push(n)}),e}),"stop"in q.prototype||(q.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})})),function(){function e(){var e,n,t,i=(d.appVersion,d.userAgent),o=d.appName,r=""+parseFloat(d.appVersion),a=parseInt(d.appVersion,10);if(f){o="Opera";try{r=d.userAgent.split("OPR/")[1].split(" ")[0],a=r.split(".")[0]}catch(s){r="0.0.0.0",a=0}}else v?(n=i.indexOf("MSIE"),o="IE",r=i.substring(n+5)):p?(n=i.indexOf("Chrome"),o="Chrome",r=i.substring(n+7)):m?(n=i.indexOf("Safari"),o="Safari",r=i.substring(n+7),(n=i.indexOf("Version"))!==-1&&(r=i.substring(n+8))):l?(n=i.indexOf("Firefox"),o="Firefox",r=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(o=i.substring(e,n),r=i.substring(n+1),o.toLowerCase()===o.toUpperCase()&&(o=d.appName));return u&&(o="Edge",r=parseInt(d.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),(t=r.indexOf(";"))!==-1&&(r=r.substring(0,t)),(t=r.indexOf(" "))!==-1&&(r=r.substring(0,t)),a=parseInt(""+r,10),isNaN(a)&&(r=""+parseFloat(d.appVersion),a=parseInt(d.appVersion,10)),{fullVersion:r,version:a,name:o,isPrivateBrowsing:!1}}function n(e,n){var t=0,i=50,o=!1,r=window.setInterval(function(){e()&&(window.clearInterval(r),n(o)),t++>i&&(window.clearInterval(r),o=!0,n(o))},10)}function t(e){var n=e.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var t=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(t&&parseInt(t[1],10)>=10)}function i(e){var i;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){i=!1},function(e){console.log(e),i=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var o;try{o=window.indexedDB.open("test")}catch(r){i=!0}"undefined"==typeof i&&n(function(){return"done"===o.readyState},function(e){e||(i=!o.result)})}else if(t(window.navigator.userAgent)){i=!1;try{window.indexedDB||(i=!0)}catch(r){i=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(r){i=!0}"undefined"==typeof i&&(i=!1,window.localStorage.removeItem("test"))}n(function(){return"undefined"!=typeof i},function(n){e(i)})}function o(){var e="-",n=d.appVersion,t=d.userAgent,i=e,o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var r in o){var a=o[r];if(a.r.test(t)){i=a.s;break}}var s=e;switch(/Windows/.test(i)&&(/Windows (.*)/.test(i)&&(s=/Windows (.*)/.exec(i)[1]),i="Windows"),i){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(t)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(t)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(t)&&(s=/Android ([\.\_\d]+)/.exec(t)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(t)&&(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(n),s=s[1]+"."+s[2]+"."+(0|s[3]))}return{osName:i,osVersion:s}}function r(e){D.isWebRTCSupported&&(D.isORTCSupported||a(function(n){e(n.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+n:"Public: "+n)}))}function a(e){function n(n){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,o=i.exec(n);if(!o)return void console.warn("Could not match IP address in",n);var r=o[1];void 0===t[r]&&e(r),t[r]=!0}var t={},i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,o=!!window.webkitRTCPeerConnection;if(!i){var r=document.getElementById("iframe");if(!r)throw"NOTE: you need to have an iframe in the page right above the script tag.";var a=r.contentWindow;i=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection,o=!!a.webkitRTCPeerConnection}if(i){var s,d={optional:[{RtpDataChannels:!0}]};o&&(s={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof D&&D.browser.isFirefox&&D.browser.version<=38&&(s[0]={url:s[0].urls}));var c=new i(s,d);c.onicecandidate=function(e){e.candidate&&n(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&n(e)})},1e3)}}function s(e){if(x){if(!d.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(d.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!d.enumerateDevices&&d.enumerateDevices&&(d.enumerateDevices=d.enumerateDevices.bind(d)),!d.enumerateDevices)return void(e&&e());b=[],k=[],T=[],P=[],d.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var t in e)n[t]=e[t];"audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput");var i;b.forEach(function(e){e.id===n.id&&e.kind===n.kind&&(i=!0)}),i||(n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||A||(A=!0),"audioinput"!==n.kind||M||(M=!0)):(n.label="Please invoke getUserMedia once.","https:"!==location.protocol&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(R=!0,k.indexOf(n)===-1&&k.push(n)),"audiooutput"===n.kind&&(E=!0,T.indexOf(n)===-1&&T.push(n)),"videoinput"===n.kind&&(O=!0,P.indexOf(n)===-1&&P.push(n)),b.indexOf(n)===-1&&b.push(n))}),"undefined"!=typeof D&&(D.MediaDevices=b,D.hasMicrophone=R,D.hasSpeakers=E,D.hasWebcam=O,D.isWebsiteHasWebcamPermissions=A,D.isWebsiteHasMicrophonePermissions=M,D.audioInputDevices=k,D.audioOutputDevices=T,D.videoInputDevices=P),e&&e()})}}var d=window.navigator;"undefined"!=typeof d?("undefined"!=typeof d.webkitGetUserMedia&&(d.getUserMedia=d.webkitGetUserMedia),"undefined"!=typeof d.mozGetUserMedia&&(d.getUserMedia=d.mozGetUserMedia)):d={getUserMedia:function(){},userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45"};var c=!!d.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),u=!(d.userAgent.indexOf("Edge")===-1||!d.msSaveOrOpenBlob&&!d.msSaveBlob),f=!!window.opera||d.userAgent.indexOf(" OPR/")>=0,l="undefined"!=typeof window.InstallTrigger,m=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,p=!!window.chrome&&!f,v=!!document.documentMode&&!u,g={Android:function(){return d.userAgent.match(/Android/i)},BlackBerry:function(){return d.userAgent.match(/BlackBerry/i)},iOS:function(){return d.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return d.userAgent.match(/Opera Mini/i)},Windows:function(){return d.userAgent.match(/IEMobile/i)},any:function(){return g.Android()||g.BlackBerry()||g.iOS()||g.Opera()||g.Windows()},getOsName:function(){var e="Unknown OS";return g.Android()&&(e="Android"),g.BlackBerry()&&(e="BlackBerry"),g.iOS()&&(e="iOS"),g.Opera()&&(e="Opera Mini"),g.Windows()&&(e="Windows"),e}},h="Unknown OS",w="Unknown OS Version";if(g.any())h=g.getOsName();else{var S=o();h=S.osName,w=S.osVersion}var C=!1,y=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){!C&&e in document.createElement("canvas")&&(C=!0),!y&&e in document.createElement("video")&&(y=!0)});var b=[],k=[],T=[],P=[];d.mediaDevices&&d.mediaDevices.enumerateDevices&&(d.enumerateDevices=function(e){d.mediaDevices.enumerateDevices().then(e)});var x=!1;"undefined"!=typeof _&&"getSources"in _?x=!0:d.mediaDevices&&d.mediaDevices.enumerateDevices&&(x=!0);var R=!1,E=!1,O=!1,M=!1,A=!1;s();var D=window.DetectRTC||{};D.browser=e(),i(function(e){D.browser.isPrivateBrowsing=!!e}),D.browser["is"+D.browser.name]=!0;var I=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){I||e in window&&(I=!0)}),D.isWebRTCSupported=I,D.isORTCSupported="undefined"!=typeof RTCIceGatherer;var U=!1;D.browser.isChrome&&D.browser.version>=35?U=!0:D.browser.isFirefox&&D.browser.version>=34&&(U=!0),"https:"!==location.protocol&&(U=!1),D.isScreenCapturingSupported=U;var L={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){L.isSupported||e in window&&(L.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(L.isCreateMediaStreamSourceSupported=!0))}),D.isAudioContextSupported=L.isSupported,D.isCreateMediaStreamSourceSupported=L.isCreateMediaStreamSourceSupported;var N=!1;D.browser.isChrome&&D.browser.version>31&&(N=!0),D.isRtpDataChannelsSupported=N;var V=!1;D.browser.isFirefox&&D.browser.version>28?V=!0:D.browser.isChrome&&D.browser.version>25?V=!0:D.browser.isOpera&&D.browser.version>=11&&(V=!0),D.isSctpDataChannelsSupported=V,D.isMobileDevice=c;var W=!1;d.getUserMedia?W=!0:d.mediaDevices&&d.mediaDevices.getUserMedia&&(W=!0),D.browser.isChrome&&D.browser.version>=46&&"https:"!==location.protocol&&(D.isGetUserMediaSupported="Requires HTTPs"),D.isGetUserMediaSupported=W,D.osName=h,D.osVersion=w;var B="";if(screen.width){var F=screen.width?screen.width:"",G=screen.height?screen.height:"";B+=""+F+" x "+G}D.displayResolution=B,D.isCanvasSupportsStreamCapturing=C,D.isVideoSupportsStreamCapturing=y,D.DetectLocalIPAddress=r,D.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,D.isWebSocketsBlocked=!D.isWebSocketsSupported,D.checkWebSocketsSupport=function(e){e=e||function(){};try{var n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){D.isWebSocketsBlocked=!1,e(),n.close(),n=null},n.onerror=function(){D.isWebSocketsBlocked=!0,e()}}catch(t){D.isWebSocketsBlocked=!0,e()}},D.load=function(e){e=e||function(){},s(e)},D.MediaDevices=b,D.hasMicrophone=R,D.hasSpeakers=E,D.hasWebcam=O,D.isWebsiteHasWebcamPermissions=A,D.isWebsiteHasMicrophonePermissions=M,D.audioInputDevices=k,D.audioOutputDevices=T,D.videoInputDevices=P;var q=!1;"setSinkId"in document.createElement("video")&&(q=!0),D.isSetSinkIdSupported=q;var j=!1;D.browser.isFirefox?"getSenders"in mozRTCPeerConnection.prototype&&(j=!0):D.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(j=!0),D.isRTPSenderReplaceTracksSupported=j;var z=!1;D.browser.isFirefox&&D.browser.version>38&&(z=!0),D.isRemoteStreamProcessingSupported=z;var H=!1;"undefined"!=typeof _&&"applyConstraints"in _.prototype&&(H=!0),D.isApplyConstraintsSupported=H;var J=!1;D.browser.isFirefox&&D.browser.version>=43&&(J=!0),D.isMultiMonitorScreenCapturingSupported=J,window.DetectRTC=D}(),document.addEventListener("deviceready",v,!1),v();var j,z={};"undefined"!=typeof mozRTCPeerConnection?j=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?j=webkitRTCPeerConnection:"undefined"!=typeof window.RTCPeerConnection&&(j=window.RTCPeerConnection);var H=window.RTCSessionDescription||window.mozRTCSessionDescription,J=window.RTCIceCandidate||window.mozRTCIceCandidate,_=window.MediaStreamTrack;window.onPluginRTCInitialized=function(){_=window.PluginRTC.MediaStreamTrack,j=window.PluginRTC.RTCPeerConnection,J=window.PluginRTC.RTCIceCandidate,H=window.PluginRTC.RTCSessionDescription},"undefined"!=typeof window.PluginRTC&&window.onPluginRTCInitialized();var X=function(){function e(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtpmap:100 VP8/90000\r\n",""),e=e.replace("a=rtpmap:101 VP9/90000\r\n",""),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 100/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 101/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 100([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 101([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace("a=rtcp-fb:120 nack\r\n",""),e=e.replace("a=rtcp-fb:120 nack pli\r\n",""),e=e.replace("a=rtcp-fb:120 ccm fir\r\n",""),e=e.replace("a=rtcp-fb:101 nack\r\n",""),e=e.replace("a=rtcp-fb:101 nack pli\r\n",""),e=e.replace("a=rtcp-fb:101 ccm fir\r\n","")}function n(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtcp-fb:126 nack\r\n",""),e=e.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),e=e.replace("a=rtcp-fb:97 nack\r\n",""),e=e.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")}function t(e,n){if(n&&n.getSenders&&n.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";n.getSenders().forEach(function(n){for(var t=n.getParameters(),i=0;i<t.codecs.length;i++)if(t.codecs[i].mimeType==e){t.codecs.unshift(t.codecs.splice(i,1));break}n.setParameters(t)})}}function i(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function o(e,n,t){return n?"undefined"!=typeof I&&I?e:l?e:(t&&(n.screen?n.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&t&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video||n.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(t?n.screen:n.video)+"\r\n")),e):e}function r(e,n,t){return a(e,0,-1,n,t)}function a(e,n,t,i,o){for(var r=t!==-1?t:e.length,a=n;a<r;++a)if(0===e[a].indexOf(i)&&(!o||e[a].toLowerCase().indexOf(o.toLowerCase())!==-1))return a;return null}function s(e){var n=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=e.match(n);return t&&2===t.length?t[1]:null}function d(e,n){if(l)return e;n=n||{};var t,i=n.min,o=n.max,a=e.split("\r\n"),d=r(a,"a=rtpmap","VP8/90000");if(d&&(t=s(a[d])),!t)return e;var c,u=r(a,"a=rtpmap","rtx/90000");if(u&&(c=s(a[u])),!u)return e;var f=r(a,"a=fmtp:"+c.toString());if(null!==f){var m="\r\n";m+="a=fmtp:"+t+" x-google-min-bitrate="+(i||"228")+"; x-google-max-bitrate="+(o||"228"),a[f]=a[f].concat(m),e=a.join("\r\n")}return e}function c(e,n){if(l)return e;n=n||{};var t,i=e.split("\r\n"),o=r(i,"a=rtpmap","opus/48000");if(o&&(t=s(i[o])),!t)return e;var a=r(i,"a=fmtp:"+t.toString());if(null===a)return e;var d="";return d+="; stereo="+("undefined"!=typeof n.stereo?n.stereo:"1"),d+="; sprop-stereo="+("undefined"!=typeof n["sprop-stereo"]?n["sprop-stereo"]:"1"),
"undefined"!=typeof n.maxaveragebitrate&&(d+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),"undefined"!=typeof n.maxplaybackrate&&(d+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),"undefined"!=typeof n.cbr&&(d+="; cbr="+("undefined"!=typeof n.cbr?n.cbr:"1")),"undefined"!=typeof n.useinbandfec&&(d+="; useinbandfec="+n.useinbandfec),"undefined"!=typeof n.usedtx&&(d+="; usedtx="+n.usedtx),"undefined"!=typeof n.maxptime&&(d+="\r\na=maxptime:"+n.maxptime),i[a]=i[a].concat(d),e=i.join("\r\n")}function u(e){return e.indexOf("SAVPF 100 101")===-1||e.indexOf("VP9/90000")===-1?e:e.replace("SAVPF 100 101","SAVPF 101 100")}function f(e){for(var n=e.split("\r\n"),t=null,i=0;i<n.length;i++)if(n[i].search("opus/48000")!==-1){var o=extractSdp(n[i],/:(\d+) opus\/48000/i);break}for(var i=0;i<n.length;i++)if(n[i].search("a=fmtp")!==-1){var r=extractSdp(n[i],/a=fmtp:(\d+)/);if(r===o){t=i;break}}return null===t?e:(n[t]=n[t].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"))}var l=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);return"undefined"!=typeof cordova&&(l=!0),navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1&&(l=!0),{removeVPX:e,disableNACK:n,prioritize:t,removeNonG722:i,setApplicationSpecificBandwidth:function(e,n,t){return o(e,n,t)},setVideoBitrates:function(e,n){return d(e,n)},setOpusAttributes:function(e,n){return c(e,n)},preferVP9:u,forceStereoAudio:f}}();window.BandwidthHandler=X;var $,Y=function(){function e(e,n){var t=n.candidate,i=e.candidates,o=i.stun,r=i.turn;if(f(i.reflexive)||(o=i.reflexive),f(i.relay)||(r=i.relay),(i.host||!t.match(/typ host/g))&&(r||!t.match(/typ relay/g))&&(o||!t.match(/typ srflx/g))){var a=e.iceProtocols;if((a.udp||!t.match(/ udp /g))&&(a.tcp||!t.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",t),{candidate:t,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}}}return{processCandidates:e}}();"undefined"!=typeof window.getExternalIceServers&&1==window.getExternalIceServers&&w(function(e){e&&e.length&&(window.RMCExternalIceServers=e,window.iceServersLoadCallback&&"function"==typeof window.iceServersLoadCallback&&window.iceServersLoadCallback(e))});var K=function(){function e(e){var n=[];return n.push(S("stun:stun.l.google.com:19302")),n.push(C("turn:webrtcweb.com:80","muazkh","muazkh")),n.push(C("turn:webrtcweb.com:443","muazkh","muazkh")),window.RMCExternalIceServers?n=n.concat(y()):"undefined"!=typeof window.getExternalIceServers&&1==window.getExternalIceServers&&(e.iceServers=n,window.iceServersLoadCallback=function(){e.iceServers=e.iceServers.concat(y())}),n}return{getIceServers:e}}(),Q=null,Z=null,ee=null,ne=null,te=window.webrtcUtils||{};if(te.enableLogs||(te.enableLogs=!0),te.log||(te.log=function(){te.enableLogs&&("undefined"!=typeof module||"function"==typeof require&&"function"==typeof define||console.log.apply(console,arguments))}),te.extractVersion||(te.extractVersion=function(e,n,t){var i=e.match(n);return i&&i.length>=t&&parseInt(i[t],10)}),"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(e){"mozSrcObject"in this?this.mozSrcObject=e:(this._srcObject=e,this.src=e?URL.createObjectURL(e):null)}}),Q=window.navigator&&window.navigator.getUserMedia),"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){if(Z="firefox",ee=te.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),ne=31,Q=function(e,n,t){var i=function(e){if("object"!=typeof e||e.require)return e;var n=[];return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var i=e[t]="object"==typeof e[t]?e[t]:{ideal:e[t]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||n.push(t),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[t]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof i.ideal?o[t]={min:i.ideal,max:i.ideal}:o[t]=i.ideal,e.advanced.push(o),delete i.ideal,Object.keys(i).length||delete e[t]}}}),n.length&&(e.require=n),e};return ee<38&&(te.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=i(e.audio)),e.video&&(e.video=i(e.video)),te.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,n,t)},navigator.getUserMedia=Q,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:b,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var n=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(n)})},ee<41){var ie=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return ie().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){Z="chrome",ee=te.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),ne=38;var oe=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var n={};return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var i="object"==typeof e[t]?e[t]:{ideal:e[t]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,n){return e?e+n.charAt(0).toUpperCase()+n.slice(1):"deviceId"===n?"sourceId":n};if(void 0!==i.ideal){n.optional=n.optional||[];var r={};"number"==typeof i.ideal?(r[o("min",t)]=i.ideal,n.optional.push(r),r={},r[o("max",t)]=i.ideal,n.optional.push(r)):(r[o("",t)]=i.ideal,n.optional.push(r))}void 0!==i.exact&&"number"!=typeof i.exact?(n.mandatory=n.mandatory||{},n.mandatory[o("",t)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(n.mandatory=n.mandatory||{},n.mandatory[o(e,t)]=i[e])})}}),e.advanced&&(n.optional=(n.optional||[]).concat(e.advanced)),n};if(Q=function(e,n,t){return e.audio&&(e.audio=oe(e.audio)),e.video&&(e.video=oe(e.video)),te.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,n,t)},navigator.getUserMedia=Q,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:b}),navigator.mediaDevices.getUserMedia){var re=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return te.log("spec:   "+JSON.stringify(e)),e.audio=oe(e.audio),e.video=oe(e.video),te.log("chrome: "+JSON.stringify(e)),re(e)}}else navigator.mediaDevices.getUserMedia=function(e){return b(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){te.log("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){te.log("Dummy mediaDevices.removeEventListener called.")})}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(te.log("This appears to be Edge"),Z="edge",ee=te.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),ne=12):te.log("Browser does not appear to be WebRTC-capable");else Z="not a browser";"undefined"!=typeof module?module.exports={getUserMedia:Q,webrtcDetectedBrowser:Z,webrtcDetectedVersion:ee,webrtcMinimumVersion:ne,webrtcUtils:te}:"function"==typeof require&&"function"==typeof define&&define([],function(){return{getUserMedia:Q,webrtcDetectedBrowser:Z,webrtcDetectedVersion:ee,webrtcMinimumVersion:ne,webrtcUtils:te}}),"undefined"!=typeof te&&(te.enableLogs=!1);var ae={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){n=n.stream;var t=n.currentUserMediaRequestOptions;this.queueRequests.indexOf(t)&&(delete this.queueRequests[this.queueRequests.indexOf(t)],this.queueRequests=c(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}},se=function(){function e(e){if(e)return"string"==typeof e||"undefined"==typeof e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}function n(n,o,r){function a(){if(r.streamEvents[n.streamid].mediaElement){var e=r.streamEvents[n.streamid].mediaElement;e.volume=0,t(200,5,function(){e.volume+=.2})}}n&&n.addEventListener&&("undefined"!=typeof o&&1!=o||n.addEventListener("ended",function(){se.onSyncNeeded(this.streamid,"ended")},!1),n.mute=function(t,a){t=e(t),"undefined"!=typeof a&&(o=a),"undefined"!=typeof t&&"audio"!=t||n.getAudioTracks().forEach(function(e){e.enabled=!1,r.streamEvents[n.streamid].isAudioMuted=!0}),"undefined"!=typeof t&&"video"!=t||n.getVideoTracks().forEach(function(e){e.enabled=!1}),"undefined"!=typeof o&&1!=o||se.onSyncNeeded(n.streamid,"mute",t),r.streamEvents[n.streamid].muteType=t||"both",i(n,"mute",t)},n.unmute=function(t,s){t=e(t),"undefined"!=typeof s&&(o=s),a(),"undefined"!=typeof t&&"audio"!=t||n.getAudioTracks().forEach(function(e){e.enabled=!0,r.streamEvents[n.streamid].isAudioMuted=!1}),"undefined"!=typeof t&&"video"!=t||(n.getVideoTracks().forEach(function(e){e.enabled=!0}),"undefined"!=typeof t&&"video"==t&&r.streamEvents[n.streamid].isAudioMuted&&!function d(e){e||(e=0),e++,e<100&&r.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout(function(){d(e)},50))}()),"undefined"!=typeof o&&1!=o||se.onSyncNeeded(n.streamid,"unmute",t),r.streamEvents[n.streamid].unmuteType=t||"both",i(n,"unmute",t)})}function t(e,n,i,o){o=(o||0)+1,o>=n||setTimeout(function(){i(),t(e,n,i,o)},e)}return{setHandlers:n,onSyncNeeded:function(e,n,t){}}}();window.addEventListener("message",function(e){e.origin==window.location.origin&&P(e.data)});var de,ce,ue="screen",fe={send:function(e){function n(e,r){var a={type:"text",uuid:u,sendingTime:f};e&&(r=e,a.packets=parseInt(r.length/s)),r.length>s?a.message=r.slice(0,s):(a.message=r,a.last=!0,a.isobject=c),i.send(a,o),d=r.slice(a.message.length),d.length&&setTimeout(function(){n(null,d)},t.chunkInterval||100)}var t=e.connection,i=e.channel,o=e.remoteUserId,r=e.text,s=t.chunkSize||1e3,d="",c=!1;l(r)||(c=!0,r=JSON.stringify(r));var u=a(),f=(new Date).getTime();n(r)}},le=function(){function e(e){function n(e,n){if(e.position!==-1){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}var t={};e.onFileStart=function(n){var i=document.createElement("div");return i.title=n.name,i.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(i.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(i,e.filesContainer.firstChild),n.remoteUserId?(t[n.uuid]||(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:i,progress:i.querySelector("progress"),label:i.querySelector("label")},void(t[n.uuid][n.remoteUserId].progress.max=n.maxChunks)):(t[n.uuid]={div:i,progress:i.querySelector("progress"),label:i.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks))},e.onFileProgress=function(e){var i=t[e.uuid];i&&(e.remoteUserId&&!(i=t[e.uuid][e.remoteUserId])||(i.progress.value=e.currentPosition||e.maxChunks||i.progress.max,n(i.progress,i.label)))},e.onFileEnd=function(e){var n=t[e.uuid];if(!n)return void console.error("No such progress-helper element exists.",e);if(!e.remoteUserId||(n=t[e.uuid][e.remoteUserId])){var i=n.div;e.type.indexOf("image")!=-1?i.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':i.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}}return{handle:e}}(),me=function(){function e(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,t){var i=document.createElement("script");i.type="text/javascript";var o=encodeURIComponent(n),r="method"+e.token();window[r]=function(e){e.data&&e.data.translations[0]&&t&&t(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"===e.error.message&&(warn('Text translation failed. Error message: "Daily Limit Exceeded."'),t(n))};var a="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+o;i.src=a,document.getElementsByTagName("head")[0].appendChild(i)}}}return{handle:e}}();window.RTCMultiConnection=e}();
var CodecsHandler=function(){function e(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtpmap:100 VP8/90000\r\n",""),e=e.replace("a=rtpmap:101 VP9/90000\r\n",""),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 100/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 101/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 100([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 101([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace("a=rtcp-fb:120 nack\r\n",""),e=e.replace("a=rtcp-fb:120 nack pli\r\n",""),e=e.replace("a=rtcp-fb:120 ccm fir\r\n",""),e=e.replace("a=rtcp-fb:101 nack\r\n",""),e=e.replace("a=rtcp-fb:101 nack pli\r\n",""),e=e.replace("a=rtcp-fb:101 ccm fir\r\n","")}function r(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtcp-fb:126 nack\r\n",""),e=e.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),e=e.replace("a=rtcp-fb:97 nack\r\n",""),e=e.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")}function n(e,r){if(r&&r.getSenders&&r.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";r.getSenders().forEach(function(r){for(var n=r.getParameters(),a=0;a<n.codecs.length;a++)if(n.codecs[a].mimeType==e){n.codecs.unshift(n.codecs.splice(a,1));break}r.setParameters(n)})}}function a(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function t(e,r,n){return r?"undefined"!=typeof isFirefox&&isFirefox?e:u?e:(n&&(r.screen?r.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),r.screen&&n&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+r.screen+"\r\n")),(r.audio||r.video||r.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),r.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+r.audio+"\r\n")),r.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(n?r.screen:r.video)+"\r\n")),e):e}function i(e,r,n){return o(e,0,-1,r,n)}function o(e,r,n,a,t){for(var i=n!==-1?n:e.length,o=r;o<i;++o)if(0===e[o].indexOf(a)&&(!t||e[o].toLowerCase().indexOf(t.toLowerCase())!==-1))return o;return null}function c(e){var r=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(r);return n&&2===n.length?n[1]:null}function d(e,r){if(u)return e;r=r||{};var n,a=r.min,t=r.max,o=e.split("\r\n"),d=i(o,"a=rtpmap","VP8/90000");if(d&&(n=c(o[d])),!n)return e;var p,f=i(o,"a=rtpmap","rtx/90000");if(f&&(p=c(o[f])),!f)return e;var s=i(o,"a=fmtp:"+p.toString());if(null!==s){var l="\r\n";l+="a=fmtp:"+n+" x-google-min-bitrate="+(a||"228")+"; x-google-max-bitrate="+(t||"228"),o[s]=o[s].concat(l),e=o.join("\r\n")}return e}function p(e,r){if(u)return e;r=r||{};var n,a=e.split("\r\n"),t=i(a,"a=rtpmap","opus/48000");if(t&&(n=c(a[t])),!n)return e;var o=i(a,"a=fmtp:"+n.toString());if(null===o)return e;var d="";return d+="; stereo="+("undefined"!=typeof r.stereo?r.stereo:"1"),d+="; sprop-stereo="+("undefined"!=typeof r["sprop-stereo"]?r["sprop-stereo"]:"1"),"undefined"!=typeof r.maxaveragebitrate&&(d+="; maxaveragebitrate="+(r.maxaveragebitrate||1048576)),"undefined"!=typeof r.maxplaybackrate&&(d+="; maxplaybackrate="+(r.maxplaybackrate||1048576)),"undefined"!=typeof r.cbr&&(d+="; cbr="+("undefined"!=typeof r.cbr?r.cbr:"1")),"undefined"!=typeof r.useinbandfec&&(d+="; useinbandfec="+r.useinbandfec),"undefined"!=typeof r.usedtx&&(d+="; usedtx="+r.usedtx),"undefined"!=typeof r.maxptime&&(d+="\r\na=maxptime:"+r.maxptime),a[o]=a[o].concat(d),e=a.join("\r\n")}function f(e){return e.indexOf("SAVPF 100 101")===-1||e.indexOf("VP9/90000")===-1?e:e.replace("SAVPF 100 101","SAVPF 101 100")}var u=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);return"undefined"!=typeof cordova&&(u=!0),navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1&&(u=!0),{removeVPX:e,disableNACK:r,prioritize:n,removeNonG722:a,setApplicationSpecificBandwidth:function(e,r,n){return t(e,r,n)},setVideoBitrates:function(e,r){return d(e,r)},setOpusAttributes:function(e,r){return p(e,r)},preferVP9:f}}();window.BandwidthHandler=CodecsHandler;
var isChrome=!!navigator.webkitGetUserMedia,DetectRTC={};!function(){var e;DetectRTC.screen={chromeMediaSource:"screen",getSourceId:function(t){if(!t)throw'"callback" parameter is mandatory.';e=t,window.postMessage("get-sourceId","*")},isChromeExtensionAvailable:function(e){if(e){if("desktop"==DetectRTC.screen.chromeMediaSource)return e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"==DetectRTC.screen.chromeMediaSource?!1:!0)},2e3)}},onMessageCallback:function(t){if("string"==typeof t||t.sourceId){if("PermissionDeniedError"==t){if(DetectRTC.screen.chromeMediaSource="PermissionDeniedError",e)return e("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==t&&(console.log('<strong>Great!</strong> <a href="https://chrome.google.com/webstore/detail/tessa-presentation/klaagnfcilpkdeicdamepejjmaoahple" target="_blank">Google chrome extension</a> is installed.'),DetectRTC.screen.chromeMediaSource="desktop"),t.sourceId&&(DetectRTC.screen.sourceId=t.sourceId,e&&e(DetectRTC.screen.sourceId))}},getChromeExtensionStatus:function(e){if(navigator.mozGetUserMedia)return e("not-chrome");var t=document.createElement("img");t.src="https://raw.githubusercontent.com/4LOOPph/desktopCapture-p2p/master/images/desktopCapture48.png",t.onload=function(){DetectRTC.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){DetectRTC.screen.notInstalled||e("installed-enabled")},2e3)},t.onerror=function(){DetectRTC.screen.notInstalled=!0,e("not-installed")}}},window.postMessage&&isChrome&&DetectRTC.screen.isChromeExtensionAvailable()}(),window.addEventListener("message",function(e){e.origin==window.location.origin&&DetectRTC.screen.onMessageCallback(e.data)});
!function(){"use strict";angular.module("tessaApp").factory("screenCapture",[function(){function e(e){e.getAudioTracks().length||(u=!1),i=new RTCMultiConnection,i.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:2457600},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},i.channel=i.sessionid=i.userid,c&&c.length&&(i.channel=i.sessionid=i.userid=c),i.autoReDialOnFailure=!0,i.getExternalIceServers=!1,t(i),i.session={audio:!!u&&l>=50,video:!0,oneway:!0},i.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},i.onstream=i.onstreamended=function(e){try{e.mediaElement.pause(),delete e.mediaElement}catch(t){}},i.dontCaptureUserMedia=!0,i.attachStreams.push(e),d&&d.length&&(i.onRequest=function(e){return e.extra.password!==d?(i.reject(e),void console.log("data:text/html,<h1>A user tried to join your room with invalid password. His request is rejected. He tried password: "+e.extra.password+" </h2>")):void i.accept(e)});var o={},a="pub-c-3c0fc243-9892-4858-aa38-1445e58b4ecb",r="sub-c-d0c386c6-7263-11e2-8b02-12313f022c90";WebSocket=PUBNUB.ws;var s=new WebSocket("wss://pubsub.pubnub.com/"+a+"/"+r+"/"+i.channel),h="-";!function g(){i&&(i.isInitiator||(h+=" -",h.length>6&&(h="-"),setTimeout(g,500)))}();var p=0;i.ondisconnected=function(){p--},s.onmessage=function(e){data=JSON.parse(e.data),"received-your-screen"===data&&p++,data.sender!=i.userid&&o[data.channel]&&o[data.channel](data.message)},s.push=s.send,s.send=function(e){e.sender=i.userid,s.push(JSON.stringify(e))},i.openSignalingChannel=function(e){var t=e.channel||this.channel;return o[t]=e.onmessage,e.onopen&&setTimeout(e.onopen,1e3),{send:function(e){s.send({sender:i.userid,channel:t,message:e})},channel:t}},s.onerror=function(){i&&i.attachStreams.length&&chrome.windows.create({url:"data:text/html,<h1>Failed connecting the Screen. Please click screen icon to try again.</h1>",type:"popup",width:screen.width/2,height:170}),n(),chrome.runtime.reload()},s.onclose=function(){i&&i.attachStreams.length&&console.log("data:text/html,<p style='font-size:25px;'><span style='color:red;'>Unable to reach the Screen</span>. WebSockets is required/used to help opening media ports between your system and target users' systems (for p2p-streaming).<br><br>Please <span style='color:green;'>click screen icon</span> to share again.</p>"),n(),chrome.runtime.reload()},s.onopen=function(){console.info("Screen Sharing is opened.");var e=i.open({dontTransmit:!0});console.log("sessionDescription: ",e);var t=window.location.origin+window.location.pathname+"presentation.html?s=tEs$@486759";d&&d.length&&(t+="&p="+d);console.log("<title>Unique Room URL</title><h1 style='text-align:center'>Copy following private URL:</h1><input type='text' value='"+t+"' style='text-align:center;width:100%;font-size:1.2em;'><p style='text-align:center'>You can share this private-session URI with fellows using email or social networks.</p>")}}function t(e){e.bandwidth={},e.bandwidth.video=e.bandwidth.screen=s,e.bandwidth.audio=128,e.processSdp=function(t){return DetectRTC.isMobileDevice||"Firefox"===DetectRTC.browser.name?t:(t=CodecsHandler.setApplicationSpecificBandwidth(t,e.bandwidth,!!e.session.screen),t=CodecsHandler.setVideoBitrates(t,{min:8*e.bandwidth.video*1024,max:8*e.bandwidth.video*1024}),t=CodecsHandler.setOpusAttributes(t,{maxaveragebitrate:8*e.bandwidth.audio*1024,maxplaybackrate:8*e.bandwidth.audio*1024,stereo:1,maxptime:3}),t=CodecsHandler.preferVP9(t))}}function n(){i&&(i.close(),i.attachStreams=[])}function o(){function t(t){function o(){if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}return t?(t.onended=function(){n()},t.getVideoTracks()[0].onended=t.onended,t.getAudioTracks().length&&(t.getAudioTracks()[0].onended=t.onended),function a(){return o()===!1?void t.onended():void setTimeout(a,1e3)}(),void e(t)):(n(),void console.log("<h1>Internal error occurred while capturing the screen.</h1>: "))}function o(e){n();({url:"<h1>getUserMediaError: "+JSON.stringify(e,null,"<br>")+"</h1><br>Constraints used:<br><pre>"+JSON.stringify(r,null,"<br>")+"</pre>",type:"popup",width:screen.width/2,height:170});console.log("getUserMediaError: ",e)}var a={};a={maxWidth:1920,maxHeight:1080},r={audio:!1,video:{mandatory:{chromeMediaSource:DetectRTC.screen.chromeMediaSource,maxWidth:a.maxWidth,maxHeight:a.maxHeight,minFrameRate:30,maxFrameRate:64,minAspectRatio:1.77},optional:[{bandwidth:8*a.maxWidth*1024}]}},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.webkitGetUserMedia(r,t,o)}function a(){return i&&i.attachStreams[0]?(n(),void i.attachStreams[0].stop()):void o()}var i,r,s=1048,d="",c="",u=!1,l=49,h=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return h&&h[2]&&(l=parseInt(h[2],10)),{captureDesktop:a}}])}();
!function(){"use strict";angular.module("tessa-presentation",["angular-uuid","ng.deviceDetector"]).constant("WS_URL","localhost:3000").constant("API_URL","http://localhost:3000").config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(t,e,o){o.setPrefix("tessaP").setStorageType("sessionStorage").setNotify(!0,!0)}])}();
function AngularUUID(){"use strict";function n(n){function r(n,r,e){var u=r&&e||0,a=0;for(r=r||[],n.toLowerCase().replace(/[0-9a-f]{2}/g,function(n){a<16&&(r[u+a++]=g[n])});a<16;)r[u+a++]=0;return r}function e(n,r){var e=r||0,u=v;return u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+"-"+u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]+u[n[e++]]}function u(n,r,u){var a=r&&u||0,o=r||[];n=n||{};var t=null!=n.clockseq?n.clockseq:p,f=null!=n.msecs?n.msecs:(new Date).getTime(),l=null!=n.nsecs?n.nsecs:h+1,c=f-U+(l-h)/1e4;if(c<0&&null==n.clockseq&&(t=t+1&16383),(c<0||f>U)&&null==n.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");U=f,h=l,p=t,f+=122192928e5;var i=(1e4*(268435455&f)+l)%4294967296;o[a++]=i>>>24&255,o[a++]=i>>>16&255,o[a++]=i>>>8&255,o[a++]=255&i;var s=f/4294967296*1e4&268435455;o[a++]=s>>>8&255,o[a++]=255&s,o[a++]=s>>>24&15|16,o[a++]=s>>>16&255,o[a++]=t>>>8|128,o[a++]=255&t;for(var d=n.node||y,v=0;v<6;v++)o[a+v]=d[v];return r?r:e(o)}function a(n,r,u){var a=r&&u||0;"string"==typeof n&&(r="binary"===n?new d(16):null,n=null),n=n||{};var t=n.random||(n.rng||o)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,r)for(var f=0;f<16;f++)r[a+f]=t[f];return r||e(t)}var o,t,f,l=n.crypto||n.msCrypto;if(!o&&l&&l.getRandomValues)try{var c=new Uint8Array(16);f=o=function(){return l.getRandomValues(c),c},o()}catch(i){}if(!o){var s=new Array(16);t=o=function(){for(var n,r=0;r<16;r++)0===(3&r)&&(n=4294967296*Math.random()),s[r]=n>>>((3&r)<<3)&255;return s},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}for(var d="function"==typeof Buffer?Buffer:Array,v=[],g={},m=0;m<256;m++)v[m]=(m+256).toString(16).substr(1),g[v[m]]=m;var w=o(),y=[1|w[0],w[1],w[2],w[3],w[4],w[5]],p=16383&(w[6]<<8|w[7]),U=0,h=0,A=a;return A.v1=u,A.v4=a,A.parse=r,A.unparse=e,A.BufferClass=d,A._rng=o,A._mathRNG=t,A._whatwgRNG=f,A}angular.module("angular-uuid",[]).factory("uuid",["$window",n])}"undefined"!=typeof module&&module.exports?module.exports=new AngularUUID:"undefined"!=typeof define&&define.amd?define(function(){return new AngularUUID}):AngularUUID();
!function(){"use strict";angular.module("tessa-presentation").controller("GlobalCtrl",["$scope","uuid","localStorageService","socket","deviceDetector","$interval","$sce","$timeout","API_URL","$state",function(e,t,o,s,i,n,r,a,c,l){var u=o.get("uuid");if(!u){var u=t.v4();console.log(u),o.set("uuid",u)}e.hash=u,e.deviceDetector=i,e.isConnected=!1,e.pdfName="",e.file_type="",e.audio=null,e.asset_file={},e.roomId="",e.userId="",e.disablePreview=!1,e.config={};var p,d=document.querySelector("#frames-container");e.init=function(){e.stop(),p=n(function(){s.emit("pair:deviceUUID",{browser:i.browser,browser_version:i.browser_version,device:i.device,os:i.os,os_version:i.os_version,deviceType:"presentation",deviceUUID:u})},1e3)},e.stop=function(){n.cancel(p)},e.init(),e.loadFile=function(t){e.file_type=t.asset_mimetype,"audio"==t.asset_type?(e.audio=!0,a(function(){e.$apply(function(){e.config={autoPlay:!0,sources:[{src:r.trustAsResourceUrl(t.asset_url),type:t.asset_mimetype}],theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}}})},10)):"video"==t.asset_type?(e.audio=!1,a(function(){e.$apply(function(){e.config={autoPlay:!0,sources:[{src:r.trustAsResourceUrl(t.asset_url),type:t.asset_mimetype}],theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}}})},10)):(e.audio=null,e.pdfName=t.media_name,"application/pdf"==t.asset_mimetype?a(function(){e.$apply(function(){e.pdfUrl=r.trustAsResourceUrl(t.asset_url)})},10):"text/plain"==t.asset_mimetype?a(function(){e.$apply(function(){e.pdfUrl=r.trustAsResourceUrl("https://docs.google.com/gview?url="+t.asset_url+"&embedded=true")})},10):a(function(){e.$apply(function(){e.pdfUrl=r.trustAsResourceUrl("https://view.officeapps.live.com/op/view.aspx?src="+t.asset_url)})},10))},s.on("pair:init",function(){console.log("pair:init")}),s.on("pair:connected",function(t){console.log("pair:connected: ",t),e.isConnected=!0,e.stop(),e.roomId=c,e.userId=t.asset_file.deviceUUID,e.asset_file=t.asset_file}),s.on("pair:closePresentation",function(){a(function(){e.$apply(function(){e.isConnected=!1,e.config={},e.pdfUrl={},l.reload()})},10)}),s.on("pair:fail",function(){e.isConnected=!1,e.init()}),s.on("pair:screenshotR",function(t){console.log("screenshotR: ",t),e.isConnected=!0,d.innerHTML="";var o=document.createElement("img"),s=(new XMLSerializer).serializeToString(t),i="data:image/svg+xml;base64,"+btoa(s);o.src=i,o.style.top=0,o.style.bottom=0,o.style.right=0,o.style.left=0,o.style.width="100%",o.style.height="100%",d.appendChild(o)})}])}();